var Tiled;!function r(a,s,h){function l(e,t){if(!s[e]){if(!a[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(p)return p(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[e]={exports:{}};a[e][0].call(o.exports,function(t){return l(a[e][1][t]||t)},o,o.exports,r,a,s,h)}return s[e].exports}for(var p="function"==typeof require&&require,t=0;t<h.length;t++)l(h[t]);return l}({1:[function(t,o,r){(function(e){var t=function(){this._tweens={},this._tweensAddedDuringUpdate={}};t.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,e){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(t=void 0!==t?t:s.now();0<i.length;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++){var o=this._tweens[i[n]];o&&!1===o.update(t)&&(o._isPlaying=!1,e||delete this._tweens[i[n]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var n,i,s=new t;s.Group=t,s._nextId=0,s.nextId=function(){return s._nextId++},"undefined"==typeof window&&void 0!==e&&e.hrtime?s.now=function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?s.now=window.performance.now.bind(window.performance):void 0!==Date.now?s.now=Date.now:s.now=function(){return(new Date).getTime()},s.Tween=function(t,e){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=s.Easing.Linear.None,this._interpolationFunction=s.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=e||s,this._id=s.nextId()},s.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,e){return this._valuesEnd=t,void 0!==e&&(this._duration=e),this},start:function(t){for(var e in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?"string"==typeof t?s.now()+parseFloat(t):t:s.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop()},group:function(t){return this._group=t,this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e,i,n;if(t<this._startTime)return!0;for(e in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=0===this._duration||1<i?1:i,n=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[e]){var o=this._valuesStart[e]||0,r=this._valuesEnd[e];r instanceof Array?this._object[e]=this._interpolationFunction(r,n):("string"==typeof r&&(r="+"===r.charAt(0)||"-"===r.charAt(0)?o+parseFloat(r):parseFloat(r)),"number"==typeof r&&(this._object[e]=o+(r-o)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1!==i)return!0;if(0<this._repeat){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var a=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=a}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,h=this._chainedTweens.length;s<h;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}},s.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-s.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*s.Easing.Bounce.In(2*t):.5*s.Easing.Bounce.Out(2*t-1)+.5}}},s.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,o=Math.floor(n),r=s.Interpolation.Utils.Linear;return e<0?r(t[0],t[1],n):1<e?r(t[i],t[i-1],i-n):r(t[o],t[i<o+1?i:o+1],n-o)},Bezier:function(t,e){for(var i=0,n=t.length-1,o=Math.pow,r=s.Interpolation.Utils.Bernstein,a=0;a<=n;a++)i+=o(1-e,n-a)*o(e,a)*t[a]*r(n,a);return i},CatmullRom:function(t,e){var i=t.length-1,n=i*e,o=Math.floor(n),r=s.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(o=Math.floor(n=i*(1+e))),r(t[(o-1+i)%i],t[o],t[(o+1)%i],t[(o+2)%i],n-o)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-n)-t[0]):1<e?t[i]-(r(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):r(t[o?o-1:0],t[o],t[i<o+1?i:o+1],t[i<o+2?i:o+2],n-o)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=s.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:(n=[1],function(t){var e=1;if(n[t])return n[t];for(var i=t;1<i;i--)e*=i;return n[t]=e}),CatmullRom:function(t,e,i,n,o){var r=.5*(i-t),a=.5*(n-e),s=o*o;return(2*e-2*i+r+a)*(o*s)+(-3*e+3*i-2*r-a)*s+r*o+e}}},i=this,"function"==typeof define&&define.amd?define([],function(){return s}):void 0!==o&&"object"==typeof r?o.exports=s:void 0!==i&&(i.TWEEN=s)}).call(this,t("_process"))},{_process:64}],2:[function(t,o,r){!function(t){var e=!1;if("function"==typeof define&&define.amd&&(define(t),e=!0),"object"==typeof r&&(o.exports=t(),e=!0),!e){var i=window.Cookies,n=window.Cookies=t();n.noConflict=function(){return window.Cookies=i,n}}}(function(){function y(){for(var t=0,e={};t<arguments.length;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}return function t(d){function f(t,e,i){var n;if("undefined"!=typeof document){if(1<arguments.length){if("number"==typeof(i=y({path:"/"},f.defaults,i)).expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*i.expires),i.expires=o}i.expires=i.expires?i.expires.toUTCString():"";try{n=JSON.stringify(e),/^[\{\[]/.test(n)&&(e=n)}catch(t){}e=d.write?d.write(e,t):encodeURIComponent(String(e)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var r="";for(var a in i)i[a]&&(r+="; "+a,!0!==i[a]&&(r+="="+i[a]));return document.cookie=t+"="+e+r}t||(n={});for(var s=document.cookie?document.cookie.split("; "):[],h=/(%[0-9A-Z]{2})+/g,l=0;l<s.length;l++){var p=s[l].split("="),c=p.slice(1).join("=");this.json||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=p[0].replace(h,decodeURIComponent);if(c=d.read?d.read(c,u):d(c,u)||c.replace(h,decodeURIComponent),this.json)try{c=JSON.parse(c)}catch(t){}if(t===u){n=c;break}t||(n[u]=c)}catch(t){}}return n}}return(f.set=f).get=function(t){return f.call(f,t)},f.getJSON=function(){return f.apply({json:!0},[].slice.call(arguments))},f.defaults={},f.remove=function(t,e){f(t,"",y(e,{expires:-1}))},f.withConverter=t,f}(function(){})})},{}],3:[function(t,e,i){e.exports={_from:"p2",_id:"p2@0.7.1",_inBundle:!1,_integrity:"sha1-JfJHTZvDptMUCh2iamfJ4RislUM=",_location:"/p2",_phantomChildren:{},_requested:{type:"tag",registry:!0,raw:"p2",name:"p2",escapedName:"p2",rawSpec:"",saveSpec:null,fetchSpec:"latest"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/p2/-/p2-0.7.1.tgz",_shasum:"25f2474d9bc3a6d3140a1da26a67c9e118ac9543",_spec:"p2",_where:"C:\\Projects\\GamesFromHell",author:{name:"Stefan Hedman",email:"schteppe@gmail.com",url:"http://steffe.se"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},bundleDependencies:!1,dependencies:{"poly-decomp":"0.1.1"},deprecated:!1,description:"A JavaScript 2D physics engine.",devDependencies:{grunt:"^0.4.5","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0"},engines:{node:"*"},homepage:"https://github.com/schteppe/p2.js#readme",keywords:["p2.js","p2","physics","engine","2d"],licenses:[{type:"MIT"}],main:"./src/p2.js",name:"p2",repository:{type:"git",url:"git+https://github.com/schteppe/p2.js.git"},version:"0.7.1"}},{}],4:[function(t,e,i){var d=t("../math/vec2");t("../utils/Utils");function n(t){this.lowerBound=d.create(),t&&t.lowerBound&&d.copy(this.lowerBound,t.lowerBound),this.upperBound=d.create(),t&&t.upperBound&&d.copy(this.upperBound,t.upperBound)}e.exports=n;var f=d.create();n.prototype.setFromPoints=function(t,e,i,n){var o=this.lowerBound,r=this.upperBound;"number"!=typeof i&&(i=0),0!==i?d.rotate(o,t[0],i):d.copy(o,t[0]),d.copy(r,o);for(var a=Math.cos(i),s=Math.sin(i),h=1;h<t.length;h++){var l=t[h];if(0!==i){var p=l[0],c=l[1];f[0]=a*p-s*c,f[1]=s*p+a*c,l=f}for(var u=0;u<2;u++)l[u]>r[u]&&(r[u]=l[u]),l[u]<o[u]&&(o[u]=l[u])}e&&(d.add(this.lowerBound,this.lowerBound,e),d.add(this.upperBound,this.upperBound,e)),n&&(this.lowerBound[0]-=n,this.lowerBound[1]-=n,this.upperBound[0]+=n,this.upperBound[1]+=n)},n.prototype.copy=function(t){d.copy(this.lowerBound,t.lowerBound),d.copy(this.upperBound,t.upperBound)},n.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var n=t.upperBound[e];this.upperBound[e]<n&&(this.upperBound[e]=n)}},n.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,n=t.lowerBound,o=t.upperBound;return(n[0]<=i[0]&&i[0]<=o[0]||e[0]<=o[0]&&o[0]<=i[0])&&(n[1]<=i[1]&&i[1]<=o[1]||e[1]<=o[1]&&o[1]<=i[1])},n.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},n.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],n=(this.lowerBound[0]-t.from[0])*e,o=(this.upperBound[0]-t.from[0])*e,r=(this.lowerBound[1]-t.from[1])*i,a=(this.upperBound[1]-t.from[1])*i,s=Math.max(Math.max(Math.min(n,o),Math.min(r,a))),h=Math.min(Math.min(Math.max(n,o),Math.max(r,a)));return h<0?-1:h<s?-1:s}},{"../math/vec2":27,"../utils/Utils":54}],5:[function(t,e,i){var o=t("../math/vec2"),r=t("../objects/Body");function n(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=n.AABB}(e.exports=n).AABB=1,n.BOUNDING_CIRCLE=2,n.prototype.setWorld=function(t){this.world=t},n.prototype.getCollisionPairs=function(t){};var a=o.create();n.boundingRadiusCheck=function(t,e){o.sub(a,t.position,e.position);var i=o.squaredLength(a),n=t.boundingRadius+e.boundingRadius;return i<=n*n},n.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},n.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:i=n.boundingRadiusCheck(t,e);break;case n.AABB:i=n.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},n.canCollide=function(t,e){var i=r.KINEMATIC,n=r.STATIC;return(t.type!==n||e.type!==n)&&(!(t.type===i&&e.type===n||t.type===n&&e.type===i)&&((t.type!==i||e.type!==i)&&((t.sleepState!==r.SLEEPING||e.sleepState!==r.SLEEPING)&&!(t.sleepState===r.SLEEPING&&e.type===n||e.sleepState===r.SLEEPING&&t.type===n))))},n.NAIVE=1,n.SAP=2},{"../math/vec2":27,"../objects/Body":28}],6:[function(t,e,i){t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle");var h=t("../collision/Broadphase");t("../math/vec2");function n(){h.call(this,h.NAIVE)}(((e.exports=n).prototype=new h).constructor=n).prototype.getCollisionPairs=function(t){for(var e=t.bodies,i=this.result,n=i.length=0,o=e.length;n!==o;n++)for(var r=e[n],a=0;a<n;a++){var s=e[a];h.canCollide(r,s)&&this.boundingVolumeCheck(r,s)&&i.push(r,s)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[];for(var n=t.bodies,o=0;o<n.length;o++){var r=n[o];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&i.push(r)}return i}},{"../collision/Broadphase":5,"../math/vec2":27,"../shapes/Circle":36,"../shapes/Particle":40,"../shapes/Plane":41,"../shapes/Shape":42}],7:[function(t,e,i){var F=t("../math/vec2"),X=F.sub,q=F.add,U=F.dot,n=(t("../utils/Utils"),t("../utils/ContactEquationPool")),o=t("../utils/FrictionEquationPool"),r=t("../utils/TupleDictionary"),a=t("../equations/Equation"),s=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),h=t("../shapes/Convex"),l=t("../shapes/Shape"),A=(t("../objects/Body"),t("../shapes/Box"));e.exports=$;var x=F.fromValues(0,1),W=F.fromValues(0,0),Y=F.fromValues(0,0),z=F.fromValues(0,0),H=F.fromValues(0,0),K=F.fromValues(0,0),R=F.fromValues(0,0),Z=F.fromValues(0,0),J=F.fromValues(0,0),Q=F.fromValues(0,0),N=F.fromValues(0,0),D=F.fromValues(0,0),G=F.fromValues(0,0),k=F.fromValues(0,0),j=F.fromValues(0,0),C=F.fromValues(0,0),O=F.fromValues(0,0),I=F.fromValues(0,0),T=F.fromValues(0,0),V=[];function $(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new n({size:32}),this.frictionEquationPool=new o({size:64}),this.restitution=0,this.stiffness=a.DEFAULT_STIFFNESS,this.relaxation=a.DEFAULT_RELAXATION,this.frictionStiffness=a.DEFAULT_STIFFNESS,this.frictionRelaxation=a.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new r,this.contactSkinSize=.01}var p=F.create(),c=F.create();function b(t,e){F.set(t.vertices[0],.5*-e.length,-e.radius),F.set(t.vertices[1],.5*e.length,-e.radius),F.set(t.vertices[2],.5*e.length,e.radius),F.set(t.vertices[3],.5*-e.length,e.radius)}$.prototype.bodiesOverlap=function(t,e){for(var i=p,n=c,o=0,r=t.shapes.length;o!==r;o++){var a=t.shapes[o];t.toWorldFrame(i,a.position);for(var s=0,h=e.shapes.length;s!==h;s++){var l=e.shapes[s];if(e.toWorldFrame(n,l.position),this[a.type|l.type](t,a,i,a.angle+t.angle,e,l,n,l.angle+e.angle,!0))return!0}}return!1},$.prototype.collidedLastStep=function(t,e){var i=0|t.id,n=0|e.id;return!!this.collidingBodiesLastStep.get(i,n)},$.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],n=i.bodyA.id,o=i.bodyB.id;this.collidingBodiesLastStep.set(n,o,!0)}for(var r=this.contactEquations,a=this.frictionEquations,s=0;s<r.length;s++)this.contactEquationPool.release(r[s]);for(s=0;s<a.length;s++)this.frictionEquationPool.release(a[s]);this.contactEquations.length=this.frictionEquations.length=0},$.prototype.createContactEquation=function(t,e,i,n){var o=this.contactEquationPool.get();return o.bodyA=t,o.bodyB=e,o.shapeA=i,o.shapeB=n,o.restitution=this.restitution,o.firstImpact=!this.collidedLastStep(t,e),o.stiffness=this.stiffness,o.relaxation=this.relaxation,o.needsUpdate=!0,o.enabled=this.enabledEquations,o.offset=this.contactSkinSize,o},$.prototype.createFrictionEquation=function(t,e,i,n){var o=this.frictionEquationPool.get();return o.bodyA=t,o.bodyB=e,o.shapeA=i,o.shapeB=n,o.setSlipForce(this.slipForce),o.frictionCoefficient=this.frictionCoefficient,o.relativeVelocity=this.surfaceVelocity,o.enabled=this.enabledEquations,o.needsUpdate=!0,o.stiffness=this.frictionStiffness,o.relaxation=this.frictionRelaxation,o.contactEquations.length=0,o},$.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return F.copy(e.contactPointA,t.contactPointA),F.copy(e.contactPointB,t.contactPointB),F.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},$.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),n=e.bodyA;e.bodyB;F.set(i.contactPointA,0,0),F.set(i.contactPointB,0,0),F.set(i.t,0,0);for(var o=0;o!==t;o++)(e=this.contactEquations[this.contactEquations.length-1-o]).bodyA===n?(F.add(i.t,i.t,e.normalA),F.add(i.contactPointA,i.contactPointA,e.contactPointA),F.add(i.contactPointB,i.contactPointB,e.contactPointB)):(F.sub(i.t,i.t,e.normalA),F.add(i.contactPointA,i.contactPointA,e.contactPointB),F.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var r=1/t;return F.scale(i.contactPointA,i.contactPointA,r),F.scale(i.contactPointB,i.contactPointB,r),F.normalize(i.t,i.t),F.rotate90cw(i.t,i.t),i},$.prototype[l.LINE|l.CONVEX]=$.prototype.convexLine=function(t,e,i,n,o,r,a,s,h){return!h&&0},$.prototype[l.LINE|l.BOX]=$.prototype.lineBox=function(t,e,i,n,o,r,a,s,h){return!h&&0};var d=new A({width:1,height:1}),f=F.create();$.prototype[l.CAPSULE|l.CONVEX]=$.prototype[l.CAPSULE|l.BOX]=$.prototype.convexCapsule=function(t,e,i,n,o,r,a,s,h){var l=f;F.set(l,r.length/2,0),F.rotate(l,l,s),F.add(l,l,a);var p=this.circleConvex(o,r,l,s,t,e,i,n,h,r.radius);F.set(l,-r.length/2,0),F.rotate(l,l,s),F.add(l,l,a);var c=this.circleConvex(o,r,l,s,t,e,i,n,h,r.radius);if(h&&(p||c))return!0;var u=d;return b(u,r),this.convexConvex(t,e,i,n,o,u,a,s,h)+p+c},$.prototype[l.CAPSULE|l.LINE]=$.prototype.lineCapsule=function(t,e,i,n,o,r,a,s,h){return!h&&0};var _=F.create(),w=F.create(),P=new A({width:1,height:1});$.prototype[l.CAPSULE|l.CAPSULE]=$.prototype.capsuleCapsule=function(t,e,i,n,o,r,a,s,h){for(var l=_,p=w,c=0,u=0;u<2;u++){F.set(l,(0===u?-1:1)*e.length/2,0),F.rotate(l,l,n),F.add(l,l,i);for(var d=0;d<2;d++){F.set(p,(0===d?-1:1)*r.length/2,0),F.rotate(p,p,s),F.add(p,p,a),this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var f=this.circleCircle(t,e,l,n,o,r,p,s,h,e.radius,r.radius);if(this.enableFrictionReduction&&(this.enableFriction=g),h&&f)return!0;c+=f}}this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var y=P;b(y,e);var m=this.convexCapsule(t,y,i,n,o,r,a,s,h);if(this.enableFrictionReduction&&(this.enableFriction=g),h&&m)return!0;if(c+=m,this.enableFrictionReduction){var g=this.enableFriction;this.enableFriction=!1}b(y,r);var v=this.convexCapsule(o,y,a,s,t,e,i,n,h);return this.enableFrictionReduction&&(this.enableFriction=g),!(!h||!v)||(c+=v,this.enableFrictionReduction&&c&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(c)),c)},$.prototype[l.LINE|l.LINE]=$.prototype.lineLine=function(t,e,i,n,o,r,a,s,h){return!h&&0},$.prototype[l.PLANE|l.LINE]=$.prototype.planeLine=function(t,e,i,n,o,r,a,s,h){var l=W,p=Y,c=z,u=H,d=K,f=R,y=Z,m=J,g=Q,v=V,b=0;F.set(l,-r.length/2,0),F.set(p,r.length/2,0),F.rotate(c,l,s),F.rotate(u,p,s),q(c,c,a),q(u,u,a),F.copy(l,c),F.copy(p,u),X(d,p,l),F.normalize(f,d),F.rotate90cw(g,f),F.rotate(m,x,n),v[0]=l,v[1]=p;for(var _=0;_<v.length;_++){var w=v[_];X(y,w,i);var P=U(y,m);if(P<0){if(h)return!0;var A=this.createContactEquation(t,o,e,r);b++,F.copy(A.normalA,m),F.normalize(A.normalA,A.normalA),F.scale(y,m,P),X(A.contactPointA,w,y),X(A.contactPointA,A.contactPointA,t.position),X(A.contactPointB,w,a),q(A.contactPointB,A.contactPointB,a),X(A.contactPointB,A.contactPointB,o.position),this.contactEquations.push(A),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}}return!h&&(this.enableFrictionReduction||b&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(b)),b)},$.prototype[l.PARTICLE|l.CAPSULE]=$.prototype.particleCapsule=function(t,e,i,n,o,r,a,s,h){return this.circleLine(t,e,i,n,o,r,a,s,h,r.radius,0)},$.prototype[l.CIRCLE|l.LINE]=$.prototype.circleLine=function(t,e,i,n,o,r,a,s,h,l,p){l=l||0,p=void 0!==p?p:e.radius;var c=W,u=Y,d=z,f=H,y=K,m=R,g=Z,v=J,b=Q,_=N,w=D,P=G,A=k,x=j,E=V;F.set(v,-r.length/2,0),F.set(b,r.length/2,0),F.rotate(_,v,s),F.rotate(w,b,s),q(_,_,a),q(w,w,a),F.copy(v,_),F.copy(b,w),X(m,b,v),F.normalize(g,m),F.rotate90cw(y,g),X(P,i,v);var M=U(P,y);X(f,v,a),X(A,i,a);var S=p+l;if(Math.abs(M)<S){F.scale(c,y,M),X(d,i,c),F.scale(u,y,U(y,A)),F.normalize(u,u),F.scale(u,u,l),q(d,d,u);var I=U(g,d),T=U(g,v),C=U(g,b);if(T<I&&I<C){if(h)return!0;var O=this.createContactEquation(t,o,e,r);return F.scale(O.normalA,c,-1),F.normalize(O.normalA,O.normalA),F.scale(O.contactPointA,O.normalA,p),q(O.contactPointA,O.contactPointA,i),X(O.contactPointA,O.contactPointA,t.position),X(O.contactPointB,d,a),q(O.contactPointB,O.contactPointB,a),X(O.contactPointB,O.contactPointB,o.position),this.contactEquations.push(O),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O)),1}}E[0]=v,E[1]=b;for(var B=0;B<E.length;B++){var L=E[B];if(X(P,L,i),F.squaredLength(P)<Math.pow(S,2)){if(h)return!0;O=this.createContactEquation(t,o,e,r);return F.copy(O.normalA,P),F.normalize(O.normalA,O.normalA),F.scale(O.contactPointA,O.normalA,p),q(O.contactPointA,O.contactPointA,i),X(O.contactPointA,O.contactPointA,t.position),X(O.contactPointB,L,a),F.scale(x,O.normalA,-l),q(O.contactPointB,O.contactPointB,x),q(O.contactPointB,O.contactPointB,a),X(O.contactPointB,O.contactPointB,o.position),this.contactEquations.push(O),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O)),1}}return 0},$.prototype[l.CIRCLE|l.CAPSULE]=$.prototype.circleCapsule=function(t,e,i,n,o,r,a,s,h){return this.circleLine(t,e,i,n,o,r,a,s,h,r.radius)},$.prototype[l.CIRCLE|l.CONVEX]=$.prototype[l.CIRCLE|l.BOX]=$.prototype.circleConvex=function(t,e,i,n,o,r,a,s,h,l){l="number"==typeof l?l:e.radius;for(var p=W,c=Y,u=z,d=H,f=K,y=N,m=D,g=k,v=j,b=C,_=O,w=!1,P=Number.MAX_VALUE,A=r.vertices,x=0;x!==A.length+1;x++){var E=A[x%A.length],M=A[(x+1)%A.length];if(F.rotate(p,E,s),F.rotate(c,M,s),q(p,p,a),q(c,c,a),X(u,c,p),F.normalize(d,u),F.rotate90cw(f,d),F.scale(v,f,-e.radius),q(v,v,i),B(v,r,a,s)){F.sub(b,p,v);var S=Math.abs(F.dot(b,f));S<P&&(F.copy(_,v),P=S,F.scale(g,f,S),F.add(g,g,v),w=!0)}}if(w){if(h)return!0;var I=this.createContactEquation(t,o,e,r);return F.sub(I.normalA,_,i),F.normalize(I.normalA,I.normalA),F.scale(I.contactPointA,I.normalA,l),q(I.contactPointA,I.contactPointA,i),X(I.contactPointA,I.contactPointA,t.position),X(I.contactPointB,g,a),q(I.contactPointB,I.contactPointB,a),X(I.contactPointB,I.contactPointB,o.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I)),1}if(0<l)for(x=0;x<A.length;x++){var T=A[x];if(F.rotate(m,T,s),q(m,m,a),X(y,m,i),F.squaredLength(y)<Math.pow(l,2)){if(h)return!0;I=this.createContactEquation(t,o,e,r);return F.copy(I.normalA,y),F.normalize(I.normalA,I.normalA),F.scale(I.contactPointA,I.normalA,l),q(I.contactPointA,I.contactPointA,i),X(I.contactPointA,I.contactPointA,t.position),X(I.contactPointB,m,a),q(I.contactPointB,I.contactPointB,a),X(I.contactPointB,I.contactPointB,o.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I)),1}}return 0};var y=F.create(),m=F.create(),g=F.create(),v=F.create();function B(t,e,i,n){for(var o=y,r=m,a=g,s=v,h=t,l=e.vertices,p=null,c=0;c!==l.length+1;c++){var u=l[c%l.length],d=l[(c+1)%l.length];F.rotate(o,u,n),F.rotate(r,d,n),q(o,o,i),q(r,r,i),X(a,o,h),X(s,r,h);var f=F.crossLength(a,s);if(null===p&&(p=f),f*p<=0)return!1;p=f}return!0}$.prototype[l.PARTICLE|l.CONVEX]=$.prototype[l.PARTICLE|l.BOX]=$.prototype.particleConvex=function(t,e,i,n,o,r,a,s,h){var l=W,p=Y,c=z,u=H,d=K,f=R,y=Z,m=N,g=k,v=I,b=T,_=Number.MAX_VALUE,w=!1,P=r.vertices;if(!B(i,r,a,s))return 0;if(h)return!0;for(var A=0;A!==P.length+1;A++){var x=P[A%P.length],E=P[(A+1)%P.length];F.rotate(l,x,s),F.rotate(p,E,s),q(l,l,a),q(p,p,a),X(c,p,l),F.normalize(u,c),F.rotate90cw(d,u),X(m,i,l);U(m,d);X(f,l,a),X(y,i,a),F.sub(v,l,i);var M=Math.abs(F.dot(v,d));M<_&&(_=M,F.scale(g,d,M),F.add(g,g,i),F.copy(b,d),w=!0)}if(w){var S=this.createContactEquation(t,o,e,r);return F.scale(S.normalA,b,-1),F.normalize(S.normalA,S.normalA),F.set(S.contactPointA,0,0),q(S.contactPointA,S.contactPointA,i),X(S.contactPointA,S.contactPointA,t.position),X(S.contactPointB,g,a),q(S.contactPointB,S.contactPointB,a),X(S.contactPointB,S.contactPointB,o.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}return 0},$.prototype[l.CIRCLE]=$.prototype.circleCircle=function(t,e,i,n,o,r,a,s,h,l,p){var c=W;l=l||e.radius,p=p||r.radius;X(c,i,a);var u=l+p;if(F.squaredLength(c)>Math.pow(u,2))return 0;if(h)return!0;var d=this.createContactEquation(t,o,e,r);return X(d.normalA,a,i),F.normalize(d.normalA,d.normalA),F.scale(d.contactPointA,d.normalA,l),F.scale(d.contactPointB,d.normalA,-p),q(d.contactPointA,d.contactPointA,i),X(d.contactPointA,d.contactPointA,t.position),q(d.contactPointB,d.contactPointB,a),X(d.contactPointB,d.contactPointB,o.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1},$.prototype[l.PLANE|l.CONVEX]=$.prototype[l.PLANE|l.BOX]=$.prototype.planeConvex=function(t,e,i,n,o,r,a,s,h){var l=W,p=Y,c=z,u=0;F.rotate(p,x,n);for(var d=0;d!==r.vertices.length;d++){var f=r.vertices[d];if(F.rotate(l,f,s),q(l,l,a),X(c,l,i),U(c,p)<=0){if(h)return!0;u++;var y=this.createContactEquation(t,o,e,r);X(c,l,i),F.copy(y.normalA,p);var m=U(c,y.normalA);F.scale(c,y.normalA,m),X(y.contactPointB,l,o.position),X(y.contactPointA,l,c),X(y.contactPointA,y.contactPointA,t.position),this.contactEquations.push(y),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y))}}return this.enableFrictionReduction&&this.enableFriction&&u&&this.frictionEquations.push(this.createFrictionFromAverage(u)),u},$.prototype[l.PARTICLE|l.PLANE]=$.prototype.particlePlane=function(t,e,i,n,o,r,a,s,h){var l=W,p=Y;s=s||0,X(l,i,a),F.rotate(p,x,s);var c=U(l,p);if(0<c)return 0;if(h)return!0;var u=this.createContactEquation(o,t,r,e);return F.copy(u.normalA,p),F.scale(l,u.normalA,c),X(u.contactPointA,i,l),X(u.contactPointA,u.contactPointA,o.position),X(u.contactPointB,i,t.position),this.contactEquations.push(u),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(u)),1},$.prototype[l.CIRCLE|l.PARTICLE]=$.prototype.circleParticle=function(t,e,i,n,o,r,a,s,h){var l=W;if(X(l,a,i),F.squaredLength(l)>Math.pow(e.radius,2))return 0;if(h)return!0;var p=this.createContactEquation(t,o,e,r);return F.copy(p.normalA,l),F.normalize(p.normalA,p.normalA),F.scale(p.contactPointA,p.normalA,e.radius),q(p.contactPointA,p.contactPointA,i),X(p.contactPointA,p.contactPointA,t.position),X(p.contactPointB,a,o.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1};var E=new s({radius:1}),M=F.create(),S=F.create();F.create();$.prototype[l.PLANE|l.CAPSULE]=$.prototype.planeCapsule=function(t,e,i,n,o,r,a,s,h){var l,p=M,c=S,u=E;F.set(p,-r.length/2,0),F.rotate(p,p,s),q(p,p,a),F.set(c,r.length/2,0),F.rotate(c,c,s),q(c,c,a),u.radius=r.radius,this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var d=this.circlePlane(o,u,p,0,t,e,i,n,h),f=this.circlePlane(o,u,c,0,t,e,i,n,h);if(this.enableFrictionReduction&&(this.enableFriction=l),h)return d||f;var y=d+f;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},$.prototype[l.CIRCLE|l.PLANE]=$.prototype.circlePlane=function(t,e,i,n,o,r,a,s,h){var l=t,p=e,c=i,u=o,d=a,f=s;f=f||0;var y=W,m=Y,g=z;X(y,c,d),F.rotate(m,x,f);var v=U(m,y);if(v>p.radius)return 0;if(h)return!0;var b=this.createContactEquation(u,l,r,e);return F.copy(b.normalA,m),F.scale(b.contactPointB,b.normalA,-p.radius),q(b.contactPointB,b.contactPointB,c),X(b.contactPointB,b.contactPointB,l.position),F.scale(g,b.normalA,v),X(b.contactPointA,y,g),q(b.contactPointA,b.contactPointA,d),X(b.contactPointA,b.contactPointA,u.position),this.contactEquations.push(b),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(b)),1},$.prototype[l.CONVEX]=$.prototype[l.CONVEX|l.BOX]=$.prototype[l.BOX]=$.prototype.convexConvex=function(t,e,i,n,o,r,a,s,h,l){var p=W,c=Y,u=z,d=H,f=K,y=Z,m=J,g=Q,v=0;l="number"==typeof l?l:0;if(!$.findSeparatingAxis(e,i,n,r,a,s,p))return 0;X(m,a,i),0<U(p,m)&&F.scale(p,p,-1);var b=$.getClosestEdge(e,n,p,!0),_=$.getClosestEdge(r,s,p);if(-1===b||-1===_)return 0;for(var w=0;w<2;w++){var P,A=b,x=_,E=e,M=r,S=i,I=a,T=n,C=s,O=t,B=o;if(0===w)P=A,A=x,x=P,P=E,E=M,M=P,P=S,S=I,I=P,P=T,T=C,C=P,P=O,O=B,B=P;for(var L=x;L<x+2;L++){var R=M.vertices[(L+M.vertices.length)%M.vertices.length];F.rotate(c,R,C),q(c,c,I);for(var N=0,D=A-1;D<A+2;D++){var G=E.vertices[(D+E.vertices.length)%E.vertices.length],k=E.vertices[(D+1+E.vertices.length)%E.vertices.length];F.rotate(u,G,T),F.rotate(d,k,T),q(u,u,S),q(d,d,S),X(f,d,u),F.rotate90cw(g,f),F.normalize(g,g),X(m,c,u);var j=U(g,m);(D===A&&j<=l||D!==A&&j<=0)&&N++}if(3<=N){if(h)return!0;var V=this.createContactEquation(O,B,E,M);v++;G=E.vertices[A%E.vertices.length],k=E.vertices[(A+1)%E.vertices.length];F.rotate(u,G,T),F.rotate(d,k,T),q(u,u,S),q(d,d,S),X(f,d,u),F.rotate90cw(V.normalA,f),F.normalize(V.normalA,V.normalA),X(m,c,u);j=U(V.normalA,m);F.scale(y,V.normalA,j),X(V.contactPointA,c,S),X(V.contactPointA,V.contactPointA,y),q(V.contactPointA,V.contactPointA,S),X(V.contactPointA,V.contactPointA,O.position),X(V.contactPointB,c,I),q(V.contactPointB,V.contactPointB,I),X(V.contactPointB,V.contactPointB,B.position),this.contactEquations.push(V),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(V))}}}return this.enableFrictionReduction&&this.enableFriction&&v&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v};var L=F.fromValues(0,0);$.projectConvexOntoAxis=function(t,e,i,n,o){var r,a,s=null,h=null,l=L;F.rotate(l,n,-i);for(var p=0;p<t.vertices.length;p++)r=t.vertices[p],a=U(r,l),(null===s||s<a)&&(s=a),(null===h||a<h)&&(h=a);if(s<h){var c=h;h=s,s=c}var u=U(e,n);F.set(o,h+u,s+u)};var tt=F.fromValues(0,0),et=F.fromValues(0,0),it=F.fromValues(0,0),nt=F.fromValues(0,0),ot=F.fromValues(0,0),rt=F.fromValues(0,0);$.findSeparatingAxis=function(t,e,i,n,o,r,a){var s=null,h=!1,l=!1,p=tt,c=et,u=it,d=nt,f=ot,y=rt;if(t instanceof A&&n instanceof A)for(var m=0;2!==m;m++){var g=t,v=i;1===m&&(g=n,v=r);for(var b=0;2!==b;b++){0===b?F.set(d,0,1):1===b&&F.set(d,1,0),0!==v&&F.rotate(d,d,v),$.projectConvexOntoAxis(t,e,i,d,f),$.projectConvexOntoAxis(n,o,r,d,y);var _=f,w=y;f[0]>y[0]&&(w=f,_=y,!0),h=(P=w[0]-_[1])<=0,(null===s||s<P)&&(F.copy(a,d),s=P,l=h)}}else for(m=0;2!==m;m++){g=t,v=i;1===m&&(g=n,v=r);for(b=0;b!==g.vertices.length;b++){F.rotate(c,g.vertices[b],v),F.rotate(u,g.vertices[(b+1)%g.vertices.length],v),X(p,u,c),F.rotate90cw(d,p),F.normalize(d,d),$.projectConvexOntoAxis(t,e,i,d,f),$.projectConvexOntoAxis(n,o,r,d,y);var P;_=f,w=y;f[0]>y[0]&&(w=f,_=y,!0),h=(P=w[0]-_[1])<=0,(null===s||s<P)&&(F.copy(a,d),s=P,l=h)}}return l};var u=F.fromValues(0,0),at=F.fromValues(0,0),st=F.fromValues(0,0);$.getClosestEdge=function(t,e,i,n){var o=u,r=at,a=st;F.rotate(o,i,-e),n&&F.scale(o,o,-1);for(var s=-1,h=t.vertices.length,l=-1,p=0;p!==h;p++){X(r,t.vertices[(p+1)%h],t.vertices[p%h]),F.rotate90cw(a,r),F.normalize(a,a);var c=U(a,o);(-1===s||l<c)&&(s=p%h,l=c)}return s};var ht=F.create(),lt=F.create(),pt=F.create(),ct=F.create(),ut=F.create(),dt=F.create(),ft=F.create();$.prototype[l.CIRCLE|l.HEIGHTFIELD]=$.prototype.circleHeightfield=function(t,e,i,n,o,r,a,s,h,l){var p=r.heights,c=(l=l||e.radius,r.elementWidth),u=lt,d=ht,f=ut,y=ft,m=dt,g=pt,v=ct,b=Math.floor((i[0]-l-a[0])/c),_=Math.ceil((i[0]+l-a[0])/c);b<0&&(b=0),_>=p.length&&(_=p.length-1);for(var w=p[b],P=p[_],A=b;A<_;A++)p[A]<P&&(P=p[A]),p[A]>w&&(w=p[A]);if(i[1]-l>w)return!h&&0;var x=!1;for(A=b;A<_;A++){F.set(g,A*c,p[A]),F.set(v,(A+1)*c,p[A+1]),F.add(g,g,a),F.add(v,v,a),F.sub(m,v,g),F.rotate(m,m,Math.PI/2),F.normalize(m,m),F.scale(d,m,-l),F.add(d,d,i),F.sub(u,d,g);var E=F.dot(u,m);if(d[0]>=g[0]&&d[0]<v[0]&&E<=0){if(h)return!0;x=!0,F.scale(u,m,-E),F.add(f,d,u),F.copy(y,m);var M=this.createContactEquation(o,t,r,e);F.copy(M.normalA,y),F.scale(M.contactPointB,M.normalA,-l),q(M.contactPointB,M.contactPointB,i),X(M.contactPointB,M.contactPointB,t.position),F.copy(M.contactPointA,f),F.sub(M.contactPointA,M.contactPointA,o.position),this.contactEquations.push(M),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(M))}}if(x=!1,0<l)for(A=b;A<=_;A++)if(F.set(g,A*c,p[A]),F.add(g,g,a),F.sub(u,i,g),F.squaredLength(u)<Math.pow(l,2)){if(h)return!0;x=!0;M=this.createContactEquation(o,t,r,e);F.copy(M.normalA,u),F.normalize(M.normalA,M.normalA),F.scale(M.contactPointB,M.normalA,-l),q(M.contactPointB,M.contactPointB,i),X(M.contactPointB,M.contactPointB,t.position),X(M.contactPointA,g,a),q(M.contactPointA,M.contactPointA,a),X(M.contactPointA,M.contactPointA,o.position),this.contactEquations.push(M),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(M))}return x?1:0};var yt=F.create(),mt=F.create(),gt=F.create(),vt=new h({vertices:[F.create(),F.create(),F.create(),F.create()]});$.prototype[l.BOX|l.HEIGHTFIELD]=$.prototype[l.CONVEX|l.HEIGHTFIELD]=$.prototype.convexHeightfield=function(t,e,i,n,o,r,a,s,h){var l=r.heights,p=r.elementWidth,c=yt,u=mt,d=gt,f=vt,y=Math.floor((t.aabb.lowerBound[0]-a[0])/p),m=Math.ceil((t.aabb.upperBound[0]-a[0])/p);y<0&&(y=0),m>=l.length&&(m=l.length-1);for(var g=l[y],v=l[m],b=y;b<m;b++)l[b]<v&&(v=l[b]),l[b]>g&&(g=l[b]);if(t.aabb.lowerBound[1]>g)return!h&&0;var _=0;for(b=y;b<m;b++){F.set(c,b*p,l[b]),F.set(u,(b+1)*p,l[b+1]),F.add(c,c,a),F.add(u,u,a);F.set(d,.5*(u[0]+c[0]),.5*(u[1]+c[1]-100)),F.sub(f.vertices[0],u,d),F.sub(f.vertices[1],c,d),F.copy(f.vertices[2],f.vertices[1]),F.copy(f.vertices[3],f.vertices[0]),f.vertices[2][1]-=100,f.vertices[3][1]-=100,_+=this.convexConvex(t,e,i,n,o,f,d,0,h)}return _}},{"../equations/ContactEquation":18,"../equations/Equation":19,"../equations/FrictionEquation":20,"../math/vec2":27,"../objects/Body":28,"../shapes/Box":34,"../shapes/Circle":36,"../shapes/Convex":37,"../shapes/Shape":42,"../utils/ContactEquationPool":45,"../utils/FrictionEquationPool":46,"../utils/TupleDictionary":53,"../utils/Utils":54}],8:[function(t,e,i){e.exports=a;var h=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB");function a(t){t=t||{},this.from=t.from?h.fromValues(t.from[0],t.from[1]):h.create(),this.to=t.to?h.fromValues(t.to[0],t.to[1]):h.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:a.ANY,this.callback=t.callback||function(t){},this.direction=h.create(),this.length=1,this.update()}(a.prototype.constructor=a).CLOSEST=1,a.ANY=2,a.ALL=4,a.prototype.update=function(){var t=this.direction;h.sub(t,this.to,this.from),this.length=h.length(t),h.normalize(t,t)},a.prototype.intersectBodies=function(t,e){for(var i=0,n=e.length;!t.shouldStop(this)&&i<n;i++){var o=e[i],r=o.getAABB();(0<=r.overlapsRay(this)||r.containsPoint(this.from))&&this.intersectBody(t,o)}};var l=h.create();a.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var n=l,o=0,r=e.shapes.length;o<r;o++){var a=e.shapes[o];if((!i||a.collisionResponse)&&(0!=(this.collisionGroup&a.collisionMask)&&0!=(a.collisionGroup&this.collisionMask))){h.rotate(n,a.position,e.angle),h.add(n,n,e.position);var s=a.angle+e.angle;if(this.intersectShape(t,a,s,n,e),t.shouldStop(this))break}}},a.prototype.intersectShape=function(t,e,i,n,o){(function(t,e,i){h.sub(r,i,t);var n=h.dot(r,e);return h.scale(s,e,n),h.add(s,s,t),h.squaredDistance(i,s)})(this.from,this.direction,n)>e.boundingRadius*e.boundingRadius||(this._currentBody=o,(this._currentShape=e).raycast(t,this,n,i),this._currentBody=this._currentShape=null)},a.prototype.getAABB=function(t){var e=this.to,i=this.from;h.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),h.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};h.create();a.prototype.reportIntersection=function(t,e,i,n){this.from,this.to;var o=this._currentShape,r=this._currentBody;if(!(this.skipBackfaces&&0<h.dot(i,this.direction)))switch(this.mode){case a.ALL:t.set(i,o,r,e,n),this.callback(t);break;case a.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,o,r,e,n);break;case a.ANY:t.set(i,o,r,e,n)}};var r=h.create(),s=h.create()},{"../collision/AABB":4,"../collision/RaycastResult":9,"../math/vec2":27,"../shapes/Shape":42}],9:[function(t,e,i){var r=t("../math/vec2"),n=t("../collision/Ray");function o(){this.normal=r.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}(e.exports=o).prototype.reset=function(){r.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(t){return r.distance(t.from,t.to)*this.fraction},o.prototype.hasHit=function(){return-1!==this.fraction},o.prototype.getHitPoint=function(t,e){r.lerp(t,e.from,e.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===n.ANY},o.prototype.set=function(t,e,i,n,o){r.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=n,this.faceIndex=o}},{"../collision/Ray":8,"../math/vec2":27}],10:[function(t,e,i){var n=t("../utils/Utils"),c=t("../collision/Broadphase");function o(){c.call(this,c.SAP),this.axisList=[],this.axisIndex=0;var i=this;this._addBodyHandler=function(t){i.axisList.push(t.body)},this._removeBodyHandler=function(t){var e=i.axisList.indexOf(t.body);-1!==e&&i.axisList.splice(e,1)}}(((e.exports=o).prototype=new c).constructor=o).prototype.setWorld=function(t){this.axisList.length=0,n.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.sortAxisList=function(t,e){e|=0;for(var i=1,n=t.length;i<n;i++){for(var o=t[i],r=i-1;0<=r&&!(t[r].aabb.lowerBound[e]<=o.aabb.lowerBound[e]);r--)t[r+1]=t[r];t[r+1]=o}return t},o.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;o.sortAxisList(t,e)},o.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,n=this.axisIndex;i.length=0;for(var o=e.length;o--;){var r=e[o];r.aabbNeedsUpdate&&r.updateAABB()}this.sortList();for(var a=0,s=0|e.length;a!==s;a++)for(var h=e[a],l=a+1;l<s;l++){var p=e[l];if(!(p.aabb.lowerBound[n]<=h.aabb.upperBound[n]))break;c.canCollide(h,p)&&this.boundingVolumeCheck(h,p)&&i.push(h,p)}return i},o.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var n=this.axisIndex,o="x";1===n&&(o="y"),2===n&&(o="z");for(var r=this.axisList,a=(e.lowerBound[o],e.upperBound[o],0);a<r.length;a++){var s=r[a];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}},{"../collision/Broadphase":5,"../utils/Utils":54}],11:[function(t,e,i){e.exports=n;var o=t("../utils/Utils");function n(t,e,i,n){this.type=i,n=o.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.DISTANCE=1,n.GEAR=2,n.LOCK=3,n.PRISMATIC=4,n.REVOLUTE=5,n.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.stiffness=t,n.needsUpdate=!0}},n.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.relaxation=t,n.needsUpdate=!0}}},{"../utils/Utils":54}],12:[function(t,e,i){var d=t("./Constraint"),f=t("../equations/Equation"),y=t("../math/vec2"),m=t("../utils/Utils");function n(t,e,i){i=m.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),d.call(this,t,e,d.DISTANCE,i),this.localAnchorA=y.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=y.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var n,o=this.localAnchorA,r=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var a=y.create(),s=y.create(),h=y.create();y.rotate(a,o,t.angle),y.rotate(s,r,e.angle),y.add(h,e.position,s),y.sub(h,h,a),y.sub(h,h,t.position),this.distance=y.length(h)}n=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce;var l=new f(t,e,-n,n);this.equations=[l],this.maxForce=n;h=y.create();var p=y.create(),c=y.create(),u=this;l.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,n=e.position;return y.rotate(p,o,t.angle),y.rotate(c,r,e.angle),y.add(h,n,c),y.sub(h,h,p),y.sub(h,h,i),y.length(h)-u.distance},this.setMaxForce(n),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}((e.exports=n).prototype=new d).constructor=n;var p=y.create(),c=y.create(),u=y.create();n.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,n=(this.distance,e.position),o=i.position,r=this.equations[0],a=t.G;y.rotate(c,this.localAnchorA,e.angle),y.rotate(u,this.localAnchorB,i.angle),y.add(p,o,u),y.sub(p,p,c),y.sub(p,p,n),this.position=y.length(p);var s=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(r.maxForce=0,r.minForce=-this.maxForce,this.distance=this.upperLimit,s=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(r.maxForce=this.maxForce,r.minForce=0,this.distance=this.lowerLimit,s=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||s){r.enabled=!0,y.normalize(p,p);var h=y.crossLength(c,p),l=y.crossLength(u,p);a[0]=-p[0],a[1]=-p[1],a[2]=-h,a[3]=p[0],a[4]=p[1],a[5]=l}else r.enabled=!1},n.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":19,"../math/vec2":27,"../utils/Utils":54,"./Constraint":11}],13:[function(t,e,i){var n=t("./Constraint"),o=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2");function r(t,e,i){i=i||{},n.call(this,t,e,n.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new o(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}(((e.exports=r).prototype=new n).constructor=r).prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},r.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},r.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":17,"../equations/Equation":19,"../math/vec2":27,"./Constraint":11}],14:[function(t,e,i){var u=t("./Constraint"),d=t("../math/vec2"),f=t("../equations/Equation");function n(t,e,i){i=i||{},u.call(this,t,e,u.LOCK,i);var n=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce,o=(i.localAngleB,new f(t,e,-n,n)),r=new f(t,e,-n,n),a=new f(t,e,-n,n),s=d.create(),h=d.create(),l=this;o.computeGq=function(){return d.rotate(s,l.localOffsetB,t.angle),d.sub(h,e.position,t.position),d.sub(h,h,s),h[0]},r.computeGq=function(){return d.rotate(s,l.localOffsetB,t.angle),d.sub(h,e.position,t.position),d.sub(h,h,s),h[1]};var p=d.create(),c=d.create();a.computeGq=function(){return d.rotate(p,l.localOffsetB,e.angle-l.localAngleB),d.scale(p,p,-1),d.sub(h,t.position,e.position),d.add(h,h,p),d.rotate(c,p,-Math.PI/2),d.normalize(c,c),d.dot(h,c)},this.localOffsetB=d.create(),i.localOffsetB?d.copy(this.localOffsetB,i.localOffsetB):(d.sub(this.localOffsetB,e.position,t.position),d.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(o,r,a),this.setMaxForce(n)}(((e.exports=n).prototype=new u).constructor=n).prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce};var r=d.create(),a=d.create(),s=d.create(),h=d.fromValues(1,0),l=d.fromValues(0,1);n.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],n=this.bodyA,o=this.bodyB;d.rotate(r,this.localOffsetB,n.angle),d.rotate(a,this.localOffsetB,o.angle-this.localAngleB),d.scale(a,a,-1),d.rotate(s,a,Math.PI/2),d.normalize(s,s),t.G[0]=-1,t.G[1]=0,t.G[2]=-d.crossLength(r,h),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-d.crossLength(r,l),e.G[4]=1,i.G[0]=-s[0],i.G[1]=-s[1],i.G[3]=s[0],i.G[4]=s[1],i.G[5]=d.crossLength(a,s)}},{"../equations/Equation":19,"../math/vec2":27,"./Constraint":11}],15:[function(t,e,i){var y=t("./Constraint"),m=t("../equations/ContactEquation"),g=t("../equations/Equation"),v=t("../math/vec2"),b=t("../equations/RotationalLockEquation");function n(n,o,t){t=t||{},y.call(this,n,o,y.PRISMATIC,t);var r=v.fromValues(0,0),a=v.fromValues(1,0),s=v.fromValues(0,0);t.localAnchorA&&v.copy(r,t.localAnchorA),t.localAxisA&&v.copy(a,t.localAxisA),t.localAnchorB&&v.copy(s,t.localAnchorB),this.localAnchorA=r,this.localAnchorB=s,this.localAxisA=a;var e=this.maxForce=void 0!==t.maxForce?t.maxForce:Number.MAX_VALUE,i=new g(n,o,-e,e),h=new v.create,l=new v.create,p=new v.create,c=new v.create;if(i.computeGq=function(){return v.dot(p,c)},i.updateJacobian=function(){var t=this.G,e=n.position,i=o.position;v.rotate(h,r,n.angle),v.rotate(l,s,o.angle),v.add(p,i,l),v.sub(p,p,e),v.sub(p,p,h),v.rotate(c,a,n.angle+Math.PI/2),t[0]=-c[0],t[1]=-c[1],t[2]=-v.crossLength(h,c)+v.crossLength(c,p),t[3]=c[0],t[4]=c[1],t[5]=v.crossLength(l,c)},this.equations.push(i),!t.disableRotationalLock){var u=new b(n,o,-e,e);this.equations.push(u)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==t.lowerLimit,this.upperLimitEnabled=void 0!==t.upperLimit,this.lowerLimit=void 0!==t.lowerLimit?t.lowerLimit:0,this.upperLimit=void 0!==t.upperLimit?t.upperLimit:1,this.upperLimitEquation=new m(n,o),this.lowerLimitEquation=new m(n,o),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e,this.motorEquation=new g(n,o),this.motorEnabled=!1,this.motorSpeed=0;var d=this,f=this.motorEquation;f.computeGW;f.computeGq=function(){return 0},f.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,o=i.velocity,r=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,n,r,o,a)+d.motorSpeed}}((e.exports=n).prototype=new y).constructor=n;var f=v.create(),_=v.create(),w=v.create(),P=v.create(),A=v.create(),x=v.create();n.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,n=this.lowerLimit,o=this.upperLimitEquation,r=this.lowerLimitEquation,a=this.bodyA,s=this.bodyB,h=this.localAxisA,l=this.localAnchorA,p=this.localAnchorB;e.updateJacobian(),v.rotate(f,h,a.angle),v.rotate(P,l,a.angle),v.add(_,P,a.position),v.rotate(A,p,s.angle),v.add(w,A,s.position);var c,u=this.position=v.dot(w,f)-v.dot(_,f);if(this.motorEnabled){var d=this.motorEquation.G;d[0]=f[0],d[1]=f[1],d[2]=v.crossLength(f,A),d[3]=-f[0],d[4]=-f[1],d[5]=-v.crossLength(f,P)}this.upperLimitEnabled&&i<u?(v.scale(o.normalA,f,-1),v.sub(o.contactPointA,_,a.position),v.sub(o.contactPointB,w,s.position),v.scale(x,f,i),v.add(o.contactPointA,o.contactPointA,x),-1===t.indexOf(o)&&t.push(o)):-1!==(c=t.indexOf(o))&&t.splice(c,1);this.lowerLimitEnabled&&u<n?(v.scale(r.normalA,f,1),v.sub(r.contactPointA,_,a.position),v.sub(r.contactPointB,w,s.position),v.scale(x,f,n),v.sub(r.contactPointB,r.contactPointB,x),-1===t.indexOf(r)&&t.push(r)):-1!==(c=t.indexOf(r))&&t.splice(c,1)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},n.prototype.setLimits=function(t,e){this.lowerLimitEnabled="number"==typeof t?(this.lowerLimit=t,!0):(this.lowerLimit=t,!1),this.upperLimitEnabled="number"==typeof e?(this.upperLimit=e,!0):(this.upperLimit=e,!1)}},{"../equations/ContactEquation":18,"../equations/Equation":19,"../equations/RotationalLockEquation":21,"../math/vec2":27,"./Constraint":11}],16:[function(t,e,i){var h=t("./Constraint"),l=t("../equations/Equation"),p=t("../equations/RotationalVelocityEquation"),c=t("../equations/RotationalLockEquation"),d=t("../math/vec2");e.exports=n;var f=d.create(),y=d.create(),m=d.fromValues(1,0),g=d.fromValues(0,1),u=d.create();function n(t,e,i){i=i||{},h.call(this,t,e,h.REVOLUTE,i);var n=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=d.create(),this.pivotB=d.create(),i.worldPivot?(d.sub(this.pivotA,i.worldPivot,t.position),d.sub(this.pivotB,i.worldPivot,e.position),d.rotate(this.pivotA,this.pivotA,-t.angle),d.rotate(this.pivotB,this.pivotB,-e.angle)):(d.copy(this.pivotA,i.localPivotA),d.copy(this.pivotB,i.localPivotB));var o=this.equations=[new l(t,e,-n,n),new l(t,e,-n,n)],r=o[0],a=o[1],s=this;r.computeGq=function(){return d.rotate(f,s.pivotA,t.angle),d.rotate(y,s.pivotB,e.angle),d.add(u,e.position,y),d.sub(u,u,t.position),d.sub(u,u,f),d.dot(u,m)},a.computeGq=function(){return d.rotate(f,s.pivotA,t.angle),d.rotate(y,s.pivotB,e.angle),d.add(u,e.position,y),d.sub(u,u,t.position),d.sub(u,u,f),d.dot(u,g)},a.minForce=r.minForce=-n,a.maxForce=r.maxForce=n,this.motorEquation=new p(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new c(t,e),this.lowerLimitEquation=new c(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}((n.prototype=new h).constructor=n).prototype.setLimits=function(t,e){this.lowerLimitEnabled="number"==typeof t?(this.lowerLimit=t,!0):(this.lowerLimit=t,!1),this.upperLimitEnabled="number"==typeof e?(this.upperLimit=e,!0):(this.upperLimit=e,!1)},n.prototype.update=function(){var t,e=this.bodyA,i=this.bodyB,n=this.pivotA,o=this.pivotB,r=this.equations,a=(r[0],r[1],r[0]),s=r[1],h=this.upperLimit,l=this.lowerLimit,p=this.upperLimitEquation,c=this.lowerLimitEquation,u=this.angle=i.angle-e.angle;this.upperLimitEnabled&&h<u?(p.angle=h,-1===r.indexOf(p)&&r.push(p)):-1!==(t=r.indexOf(p))&&r.splice(t,1);this.lowerLimitEnabled&&u<l?(c.angle=l,-1===r.indexOf(c)&&r.push(c)):-1!==(t=r.indexOf(c))&&r.splice(t,1);d.rotate(f,n,e.angle),d.rotate(y,o,i.angle),a.G[0]=-1,a.G[1]=0,a.G[2]=-d.crossLength(f,m),a.G[3]=1,a.G[4]=0,a.G[5]=d.crossLength(y,m),s.G[0]=0,s.G[1]=-1,s.G[2]=-d.crossLength(f,g),s.G[3]=0,s.G[4]=1,s.G[5]=d.crossLength(y,g)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},n.prototype.motorIsEnabled=function(){return!!this.motorEnabled},n.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},n.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":19,"../equations/RotationalLockEquation":21,"../equations/RotationalVelocityEquation":22,"../math/vec2":27,"./Constraint":11}],17:[function(t,e,i){var n=t("./Equation");t("../math/vec2");function o(t,e,i){i=i||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}(((e.exports=o).prototype=new n).constructor=o).prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},o.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},o.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":27,"./Equation":19}],18:[function(t,e,i){var n=t("./Equation"),m=t("../math/vec2");function o(t,e){n.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=m.create(),this.penetrationVec=m.create(),this.contactPointB=m.create(),this.normalA=m.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}(((e.exports=o).prototype=new n).constructor=o).prototype.computeB=function(t,e,i){var n,o,r=this.bodyA,a=this.bodyB,s=this.contactPointA,h=this.contactPointB,l=r.position,p=a.position,c=this.penetrationVec,u=this.normalA,d=this.G,f=m.crossLength(s,u),y=m.crossLength(h,u);return d[0]=-u[0],d[1]=-u[1],d[2]=-f,d[3]=u[0],d[4]=u[1],d[5]=y,m.add(c,p,h),m.sub(c,c,l),m.sub(c,c,s),n=this.firstImpact&&0!==this.restitution?(o=0,1/e*(1+this.restitution)*this.computeGW()):(o=m.dot(u,c)+this.offset,this.computeGW()),-o*t-n*e-i*this.computeGiMf()};var r=m.create(),a=m.create(),s=m.create();o.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(r,this.contactPointA),this.bodyB.getVelocityAtPoint(a,this.contactPointB),m.subtract(s,r,a),m.dot(this.normalA,s)}},{"../math/vec2":27,"./Equation":19}],19:[function(t,e,i){e.exports=a;var c=t("../math/vec2"),r=t("../utils/Utils");t("../objects/Body");function a(t,e,i,n){this.minForce=void 0===i?-Number.MAX_VALUE:i,this.maxForce=void 0===n?Number.MAX_VALUE:n,this.bodyA=t,this.bodyB=e,this.stiffness=a.DEFAULT_STIFFNESS,this.relaxation=a.DEFAULT_RELAXATION,this.G=new r.ARRAY_TYPE(6);for(var o=0;o<6;o++)this.G[o]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}(a.prototype.constructor=a).DEFAULT_STIFFNESS=1e6,a.DEFAULT_RELAXATION=4,a.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},a.prototype.gmult=function(t,e,i,n,o){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*n[0]+t[4]*n[1]+t[5]*o},a.prototype.computeB=function(t,e,i){var n=this.computeGW();return-this.computeGq()*t-n*e-this.computeGiMf()*i};var s=c.create(),h=c.create();a.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=(e.position,i.position,e.angle),o=i.angle;return this.gmult(t,s,n,h,o)+this.offset},a.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,o=i.velocity,r=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,n,r,o,a)+this.relativeVelocity},a.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.vlambda,o=i.vlambda,r=e.wlambda,a=i.wlambda;return this.gmult(t,n,r,o,a)};var u=c.create(),d=c.create();a.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,n=t.angularForce,o=e.force,r=e.angularForce,a=t.invMassSolve,s=e.invMassSolve,h=t.invInertiaSolve,l=e.invInertiaSolve,p=this.G;return c.scale(u,i,a),c.multiply(u,t.massMultiplier,u),c.scale(d,o,s),c.multiply(d,e.massMultiplier,d),this.gmult(p,u,n*h,d,r*l)},a.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,n=e.invMassSolve,o=t.invInertiaSolve,r=e.invInertiaSolve,a=this.G;return a[0]*a[0]*i*t.massMultiplier[0]+a[1]*a[1]*i*t.massMultiplier[1]+a[2]*a[2]*o+a[3]*a[3]*n*e.massMultiplier[0]+a[4]*a[4]*n*e.massMultiplier[1]+a[5]*a[5]*r};var f=c.create(),y=c.create(),m=c.create();c.create(),c.create(),c.create();a.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,n=f,o=y,r=m,a=e.invMassSolve,s=i.invMassSolve,h=e.invInertiaSolve,l=i.invInertiaSolve,p=this.G;o[0]=p[0],o[1]=p[1],r[0]=p[3],r[1]=p[4],c.scale(n,o,a*t),c.multiply(n,n,e.massMultiplier),c.add(e.vlambda,e.vlambda,n),e.wlambda+=h*p[2]*t,c.scale(n,r,s*t),c.multiply(n,n,i.massMultiplier),c.add(i.vlambda,i.vlambda,n),i.wlambda+=l*p[5]*t},a.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":27,"../objects/Body":28,"../utils/Utils":54}],20:[function(t,e,i){var s=t("../math/vec2"),n=t("./Equation");t("../utils/Utils");function o(t,e,i){n.call(this,t,e,-i,i),this.contactPointA=s.create(),this.contactPointB=s.create(),this.t=s.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}(((e.exports=o).prototype=new n).constructor=o).prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,i){this.bodyA,this.bodyB;var n=this.contactPointA,o=this.contactPointB,r=this.t,a=this.G;return a[0]=-r[0],a[1]=-r[1],a[2]=-s.crossLength(n,r),a[3]=r[0],a[4]=r[1],a[5]=s.crossLength(o,r),-this.computeGW()*e-i*this.computeGiMf()}},{"../math/vec2":27,"../utils/Utils":54,"./Equation":19}],21:[function(t,e,i){var o=t("./Equation"),n=t("../math/vec2");function r(t,e,i){i=i||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var n=this.G;n[2]=1,n[5]=-1}((e.exports=r).prototype=new o).constructor=r;var a=n.create(),s=n.create(),h=n.fromValues(1,0),l=n.fromValues(0,1);r.prototype.computeGq=function(){return n.rotate(a,h,this.bodyA.angle+this.angle),n.rotate(s,l,this.bodyB.angle),n.dot(a,s)}},{"../math/vec2":27,"./Equation":19}],22:[function(t,e,i){var n=t("./Equation");t("../math/vec2");function o(t,e){n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}(((e.exports=o).prototype=new n).constructor=o).prototype.computeB=function(t,e,i){var n=this.G;n[2]=-1,n[5]=this.ratio;var o=this.computeGiMf();return-this.computeGW()*e-i*o}},{"../math/vec2":27,"./Equation":19}],23:[function(t,e,i){var n=function(){};(e.exports=n).prototype={constructor:n,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,n=i[t].indexOf(e);return-1!==n&&i[t].splice(n,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,n=e.length;i<n;i++){var o=e[i];o.call(o.context,t)}}return this}}},{}],24:[function(t,e,i){var n=t("./Material"),o=t("../equations/Equation");function r(t,e,i){if(i=i||{},!(t instanceof n&&e instanceof n))throw new Error("First two arguments must be Material instances.");this.id=r.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==i.friction?Number(i.friction):.3,this.restitution=void 0!==i.restitution?Number(i.restitution):0,this.stiffness=void 0!==i.stiffness?Number(i.stiffness):o.DEFAULT_STIFFNESS,this.relaxation=void 0!==i.relaxation?Number(i.relaxation):o.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==i.frictionStiffness?Number(i.frictionStiffness):o.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==i.frictionRelaxation?Number(i.frictionRelaxation):o.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}(e.exports=r).idCounter=0},{"../equations/Equation":19,"./Material":25}],25:[function(t,e,i){function n(t){this.id=t||n.idCounter++}(e.exports=n).idCounter=0},{}],26:[function(t,e,i){var v={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,n=0;n<e;n+=2)i+=(t[n+2]-t[n])*(t[n+1]+t[n+3]);return.5*-(i+=(t[0]-t[e])*(t[e+1]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],n=[],o=0;o<e;o++)n.push(o);o=0;for(var r=e;3<r;){var a=n[(o+0)%r],s=n[(o+1)%r],h=n[(o+2)%r],l=t[2*a],p=t[2*a+1],c=t[2*s],u=t[2*s+1],d=t[2*h],f=t[2*h+1],y=!1;if(v._convex(l,p,c,u,d,f)){y=!0;for(var m=0;m<r;m++){var g=n[m];if(g!=a&&g!=s&&g!=h&&v._PointInTriangle(t[2*g],t[2*g+1],l,p,c,u,d,f)){y=!1;break}}}if(y)i.push(a,s,h),n.splice((o+1)%r,1),r--,o=0;else if(o++>3*r)break}return i.push(n[0],n[1],n[2]),i},_PointInTriangle:function(t,e,i,n,o,r,a,s){var h=a-i,l=s-n,p=o-i,c=r-n,u=t-i,d=e-n,f=h*h+l*l,y=h*p+l*c,m=h*u+l*d,g=p*p+c*c,v=p*u+c*d,b=1/(f*g-y*y),_=(g*m-y*v)*b,w=(f*v-y*m)*b;return 0<=_&&0<=w&&_+w<1},_convex:function(t,e,i,n,o,r){return 0<=(e-n)*(o-i)+(i-t)*(r-n)}};e.exports=v},{}],27:[function(t,e,i){var a=e.exports={},n=t("../utils/Utils");a.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},a.crossVZ=function(t,e,i){return a.rotate(t,e,-Math.PI/2),a.scale(t,t,i),t},a.crossZV=function(t,e,i){return a.rotate(t,i,Math.PI/2),a.scale(t,t,e),t},a.rotate=function(t,e,i){if(0!==i){var n=Math.cos(i),o=Math.sin(i),r=e[0],a=e[1];t[0]=n*r-o*a,t[1]=o*r+n*a}else t[0]=e[0],t[1]=e[1]},a.rotate90cw=function(t,e){var i=e[0],n=e[1];t[0]=n,t[1]=-i},a.toLocalFrame=function(t,e,i,n){a.copy(t,e),a.sub(t,t,i),a.rotate(t,t,-n)},a.toGlobalFrame=function(t,e,i,n){a.copy(t,e),a.rotate(t,t,n),a.add(t,t,i)},a.vectorToLocalFrame=function(t,e,i){a.rotate(t,e,-i)},a.vectorToGlobalFrame=function(t,e,i){a.rotate(t,e,i)},a.centroid=function(t,e,i,n){return a.add(t,e,i),a.add(t,t,n),a.scale(t,t,1/3),t},a.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},a.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},a.fromValues=function(t,e){var i=new n.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},a.set=function(t,e,i){return t[0]=e,t[1]=i,t},a.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},a.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},a.sub=a.subtract,a.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},a.mul=a.multiply,a.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},a.div=a.divide,a.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},a.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},a.dist=a.distance,a.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},a.len=a.length,a.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},a.normalize=function(t,e){var i=e[0],n=e[1],o=i*i+n*n;return 0<o&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},a.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},a.lerp=function(t,e,i,n){var o=e[0],r=e[1];return t[0]=o+n*(i[0]-o),t[1]=r+n*(i[1]-r),t},a.reflect=function(t,e,i){var n=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*n,t[1]=e[1]-2*i[1]*n},a.getLineSegmentsIntersection=function(t,e,i,n,o){var r=a.getLineSegmentsIntersectionFraction(e,i,n,o);return!(r<0)&&(t[0]=e[0]+r*(i[0]-e[0]),t[1]=e[1]+r*(i[1]-e[1]),!0)},a.getLineSegmentsIntersectionFraction=function(t,e,i,n){var o,r,a=e[0]-t[0],s=e[1]-t[1],h=n[0]-i[0],l=n[1]-i[1];return o=(-s*(t[0]-i[0])+a*(t[1]-i[1]))/(-h*s+a*l),r=(h*(t[1]-i[1])-l*(t[0]-i[0]))/(-h*s+a*l),0<=o&&o<=1&&0<=r&&r<=1?r:-1}},{"../utils/Utils":54}],28:[function(t,e,i){var c=t("../math/vec2"),l=t("poly-decomp"),p=t("../shapes/Convex"),n=t("../collision/RaycastResult"),o=t("../collision/Ray"),r=t("../collision/AABB"),a=t("../events/EventEmitter");function s(t){t=t||{},a.call(this),this.id=t.id||++s._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=c.create(),this.position=c.fromValues(0,0),t.position&&c.copy(this.position,t.position),this.interpolatedPosition=c.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=c.fromValues(0,0),this.previousAngle=0,this.velocity=c.fromValues(0,0),t.velocity&&c.copy(this.velocity,t.velocity),this.vlambda=c.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=c.create(),t.force&&c.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=s.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=s.DYNAMIC:this.type=s.STATIC,this.boundingRadius=0,this.aabb=new r,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=s.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}(((e.exports=s).prototype=new a).constructor=s)._idCounter=0,s.prototype.updateSolveMassProperties=function(){this.sleepState===s.SLEEPING||this.type===s.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},s.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},s.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},s.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var h=new r,u=c.create();s.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=u,n=this.angle,o=0;o!==e;o++){var r=t[o],a=r.angle+n;c.rotate(i,r.position,n),c.add(i,i,this.position),r.computeAABB(h,i,a),0===o?this.aabb.copy(h):this.aabb.extend(h)}this.aabbNeedsUpdate=!1},s.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,n=0;n!==e;n++){var o=t[n],r=c.length(o.position),a=o.boundingRadius;i<r+a&&(i=r+a)}this.boundingRadius=i},s.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?c.copy(t.position,e):c.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},s.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,!(t.body=null))},s.prototype.updateMassProperties=function(){if(this.type===s.STATIC||this.type===s.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,n=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var o=0;o<e;o++){var r=t[o],a=c.squaredLength(r.position);n+=r.computeMomentOfInertia(i)+i*a}this.inertia=n,this.invInertia=0<n?1/n:0}this.invMass=1/this.mass,c.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};c.create();s.prototype.applyForce=function(t,e){if(c.add(this.force,this.force,t),e){var i=c.crossLength(e,t);this.angularForce+=i}};var d=c.create(),f=c.create(),y=c.create();s.prototype.applyForceLocal=function(t,e){e=e||y;var i=d,n=f;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyForce(i,n)};var m=c.create();s.prototype.applyImpulse=function(t,e){if(this.type===s.DYNAMIC){var i=m;if(c.scale(i,t,this.invMass),c.multiply(i,this.massMultiplier,i),c.add(this.velocity,i,this.velocity),e){var n=c.crossLength(e,t);n*=this.invInertia,this.angularVelocity+=n}}};var g=c.create(),v=c.create(),b=c.create();s.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=g,n=v;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyImpulse(i,n)},s.prototype.toLocalFrame=function(t,e){c.toLocalFrame(t,e,this.position,this.angle)},s.prototype.toWorldFrame=function(t,e){c.toGlobalFrame(t,e,this.position,this.angle)},s.prototype.vectorToLocalFrame=function(t,e){c.vectorToLocalFrame(t,e,this.angle)},s.prototype.vectorToWorldFrame=function(t,e){c.vectorToGlobalFrame(t,e,this.angle)},s.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;0<=i;--i)this.removeShape(this.shapes[i]);var n,o=new l.Polygon;if(o.vertices=t,o.makeCCW(),"number"==typeof e.removeCollinearPoints&&o.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!o.isSimple())return!1;this.concavePath=o.vertices.slice(0);for(i=0;i<this.concavePath.length;i++){var r=[0,0];c.copy(r,this.concavePath[i]),this.concavePath[i]=r}n=e.optimalDecomp?o.decomp():o.quickDecomp();var a=c.create();for(i=0;i!==n.length;i++){for(var s=new p({vertices:n[i].vertices}),h=0;h!==s.vertices.length;h++){r=s.vertices[h];c.sub(r,r,s.centerOfMass)}c.scale(a,s.centerOfMass,1),s.updateTriangles(),s.updateCenterOfMass(),s.updateBoundingRadius(),this.addShape(s,a)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0};c.fromValues(0,0);var _=c.fromValues(0,0),w=c.fromValues(0,0),P=c.fromValues(0,0);s.prototype.adjustCenterOfMass=function(){var t=_,e=w,i=P,n=0;c.set(e,0,0);for(var o=0;o!==this.shapes.length;o++){var r=this.shapes[o];c.scale(t,r.position,r.area),c.add(e,e,t),n+=r.area}c.scale(i,e,1/n);for(o=0;o!==this.shapes.length;o++){r=this.shapes[o];c.sub(r.position,r.position,i)}c.add(this.position,this.position,i);for(o=0;this.concavePath&&o<this.concavePath.length;o++)c.sub(this.concavePath[o],this.concavePath[o],i);this.updateMassProperties(),this.updateBoundingRadius()},s.prototype.setZeroForce=function(){c.set(this.force,0,0),this.angularForce=0},s.prototype.resetConstraintVelocity=function(){var t=this.vlambda;c.set(t,0,0),this.wlambda=0},s.prototype.addConstraintVelocity=function(){var t=this.velocity;c.add(t,t,this.vlambda),this.angularVelocity+=this.wlambda},s.prototype.applyDamping=function(t){if(this.type===s.DYNAMIC){var e=this.velocity;c.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},s.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=s.AWAKE,this.idleTime=0,t!==s.AWAKE&&this.emit(s.wakeUpEvent)},s.prototype.sleep=function(){this.sleepState=s.SLEEPING,this.angularVelocity=0,this.angularForce=0,c.set(this.velocity,0,0),c.set(this.force,0,0),this.emit(s.sleepEvent)},s.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==s.SLEEPING){this.wantsToSleep=!1;this.sleepState;var n=c.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),o=Math.pow(this.sleepSpeedLimit,2);this.sleepState=o<=n?(this.idleTime=0,s.AWAKE):(this.idleTime+=i,s.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},s.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var A=c.create(),x=c.create();s.prototype.integrate=function(t){var e=this.invMass,i=this.force,n=this.position,o=this.velocity;c.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),c.scale(A,i,t*e),c.multiply(A,this.massMultiplier,A),c.add(o,A,o),this.integrateToTimeOfImpact(t)||(c.scale(x,o,t),c.add(n,n,x),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var E=new n,M=new o({mode:o.ALL}),S=c.create(),I=c.create(),T=c.create(),C=c.create();s.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||c.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;c.normalize(S,this.velocity),c.scale(I,this.velocity,t),c.add(I,I,this.position),c.sub(T,I,this.position);var e,i=this.angularVelocity*t,n=c.length(T),o=1,r=this;if(E.reset(),M.callback=function(t){t.body!==r&&(e=t.body,t.getHitPoint(I,M),c.sub(T,I,r.position),o=c.length(T)/n,t.stop())},c.copy(M.from,this.position),c.copy(M.to,I),M.update(),this.world.raycast(E,M),!e)return!1;var a=this.angle;c.copy(C,this.position);for(var s=0,h=0,l=0,p=o;h<=p&&s<this.ccdIterations;){s++,l=(p-h)/2,c.scale(x,T,o),c.add(this.position,C,x),this.angle=a+i*o,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?h=l:p=l}return o=l,c.copy(this.position,C),this.angle=a,c.scale(x,T,o),c.add(this.position,this.position,x),this.fixedRotation||(this.angle+=i*o),!0},s.prototype.getVelocityAtPoint=function(t,e){return c.crossVZ(t,e,this.angularVelocity),c.subtract(t,this.velocity,t),t},s.sleepyEvent={type:"sleepy"},s.sleepEvent={type:"sleep"},s.wakeUpEvent={type:"wakeup"},s.DYNAMIC=1,s.STATIC=2,s.KINEMATIC=4,s.AWAKE=0,s.SLEEPY=1,s.SLEEPING=2},{"../collision/AABB":4,"../collision/Ray":8,"../collision/RaycastResult":9,"../events/EventEmitter":23,"../math/vec2":27,"../shapes/Convex":37,"poly-decomp":63}],29:[function(t,e,i){var g=t("../math/vec2"),a=t("./Spring");t("../utils/Utils");function n(t,e,i){i=i||{},a.call(this,t,e,i),this.localAnchorA=g.fromValues(0,0),this.localAnchorB=g.fromValues(0,0),i.localAnchorA&&g.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&g.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var n=g.create(),o=g.create();this.getWorldAnchorA(n),this.getWorldAnchorB(o);var r=g.distance(n,o);this.restLength="number"==typeof i.restLength?i.restLength:r}(((e.exports=n).prototype=new a).constructor=n).prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},n.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},n.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},n.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var v=g.create(),b=g.create(),_=g.create(),w=g.create(),P=g.create(),A=g.create(),x=g.create(),E=g.create(),M=g.create();n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,n=this.bodyA,o=this.bodyB,r=v,a=b,s=_,h=w,l=M,p=P,c=A,u=x,d=E;this.getWorldAnchorA(p),this.getWorldAnchorB(c),g.sub(u,p,n.position),g.sub(d,c,o.position),g.sub(r,c,p);var f=g.len(r);g.normalize(a,r),g.sub(s,o.velocity,n.velocity),g.crossZV(l,o.angularVelocity,d),g.add(s,s,l),g.crossZV(l,n.angularVelocity,u),g.sub(s,s,l),g.scale(h,a,-t*(f-i)-e*g.dot(s,a)),g.sub(n.force,n.force,h),g.add(o.force,o.force,h);var y=g.crossLength(u,h),m=g.crossLength(d,h);n.angularForce-=y,o.angularForce+=m}},{"../math/vec2":27,"../utils/Utils":54,"./Spring":31}],30:[function(t,e,i){t("../math/vec2");var n=t("./Spring");function o(t,e,i){i=i||{},n.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}(((e.exports=o).prototype=new n).constructor=o).prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,n=this.bodyA,o=this.bodyB,r=-t*(o.angle-n.angle-i)-e*(o.angularVelocity-n.angularVelocity)*0;n.angularForce-=r,o.angularForce+=r}},{"../math/vec2":27,"./Spring":31}],31:[function(t,e,i){t("../math/vec2");var n=t("../utils/Utils");function o(t,e,i){i=n.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}(e.exports=o).prototype.applyForce=function(){}},{"../math/vec2":27,"../utils/Utils":54}],32:[function(t,e,i){var n=t("../math/vec2"),o=(t("../utils/Utils"),t("../constraints/Constraint")),r=t("../equations/FrictionEquation"),a=t("../objects/Body");function s(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new a({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function h(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new r(t.chassisBody,t.groundBody),this.sideEquation=new r(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=n.fromValues(0,1),e.localForwardVector&&n.copy(this.localForwardVector,e.localForwardVector),this.localPosition=n.fromValues(0,0),e.localPosition&&n.copy(this.localPosition,e.localPosition),o.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}(e.exports=s).prototype.addToWorld=function(t){(this.world=t).addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},s.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},s.prototype.addWheel=function(t){var e=new h(this,t);return this.wheels.push(e),e},s.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},(h.prototype=new o).setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},h.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var l=n.create(),p=n.create();h.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(p,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(l,p),n.dot(l,p)};var c=n.create();h.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),n.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),n.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),n.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),n.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),n.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),n.normalize(c,this.forwardEquation.t),n.scale(c,c,this.engineForce),this.vehicle.chassisBody.applyForce(c,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":11,"../equations/FrictionEquation":20,"../math/vec2":27,"../objects/Body":28,"../utils/Utils":54}],33:[function(t,e,i){var n=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(n,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":3,"./collision/AABB":4,"./collision/Broadphase":5,"./collision/NaiveBroadphase":6,"./collision/Narrowphase":7,"./collision/Ray":8,"./collision/RaycastResult":9,"./collision/SAPBroadphase":10,"./constraints/Constraint":11,"./constraints/DistanceConstraint":12,"./constraints/GearConstraint":13,"./constraints/LockConstraint":14,"./constraints/PrismaticConstraint":15,"./constraints/RevoluteConstraint":16,"./equations/AngleLockEquation":17,"./equations/ContactEquation":18,"./equations/Equation":19,"./equations/FrictionEquation":20,"./equations/RotationalVelocityEquation":22,"./events/EventEmitter":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/vec2":27,"./objects/Body":28,"./objects/LinearSpring":29,"./objects/RotationalSpring":30,"./objects/Spring":31,"./objects/TopDownVehicle":32,"./shapes/Box":34,"./shapes/Capsule":35,"./shapes/Circle":36,"./shapes/Convex":37,"./shapes/Heightfield":38,"./shapes/Line":39,"./shapes/Particle":40,"./shapes/Plane":41,"./shapes/Shape":42,"./solver/GSSolver":43,"./solver/Solver":44,"./utils/ContactEquationPool":45,"./utils/FrictionEquationPool":46,"./utils/Pool":52,"./utils/Utils":54,"./world/World":58}],34:[function(t,e,i){var r=t("../math/vec2"),a=t("./Shape"),s=t("./Convex");function n(t){"number"==typeof t&&"number"==typeof arguments[1]&&(t={width:t,height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,n=[r.fromValues(-e/2,-i/2),r.fromValues(e/2,-i/2),r.fromValues(e/2,i/2),r.fromValues(-e/2,i/2)],o=[r.fromValues(1,0),r.fromValues(0,1)];t.vertices=n,t.axes=o,t.type=a.BOX,s.call(this,t)}(((e.exports=n).prototype=new s).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},n.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};r.create(),r.create(),r.create(),r.create();n.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},n.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":27,"./Convex":37,"./Shape":42}],35:[function(t,e,i){var n=t("./Shape"),P=t("../math/vec2");function o(t){"number"==typeof t&&"number"==typeof arguments[1]&&(t={length:t,radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=n.CAPSULE,n.call(this,t)}(((e.exports=o).prototype=new n).constructor=o).prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,n=2*e;return t*(n*n+i*i)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var r=P.create();o.prototype.computeAABB=function(t,e,i){var n=this.radius;P.set(r,this.length/2,0),0!==i&&P.rotate(r,r,i),P.set(t.upperBound,Math.max(r[0]+n,-r[0]+n),Math.max(r[1]+n,-r[1]+n)),P.set(t.lowerBound,Math.min(r[0]-n,-r[0]-n),Math.min(r[1]-n,-r[1]-n)),P.add(t.lowerBound,t.lowerBound,e),P.add(t.upperBound,t.upperBound,e)};var A=P.create(),x=P.create(),E=P.create(),M=P.create(),S=P.fromValues(0,1);o.prototype.raycast=function(t,e,i,n){for(var o=e.from,r=e.to,a=(e.direction,A),s=x,h=E,l=M,p=this.length/2,c=0;c<2;c++){var u=this.radius*(2*c-1);if(P.set(h,-p,u),P.set(l,p,u),P.toGlobalFrame(h,h,i,n),P.toGlobalFrame(l,l,i,n),0<=(f=P.getLineSegmentsIntersectionFraction(o,r,h,l))&&(P.rotate(s,S,n),P.scale(s,s,2*c-1),e.reportIntersection(t,f,s,-1),t.shouldStop(e)))return}var d=Math.pow(this.radius,2)+Math.pow(p,2);for(c=0;c<2;c++){P.set(h,p*(2*c-1),0),P.toGlobalFrame(h,h,i,n);var f,y=Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2),m=2*((r[0]-o[0])*(o[0]-h[0])+(r[1]-o[1])*(o[1]-h[1])),g=Math.pow(o[0]-h[0],2)+Math.pow(o[1]-h[1],2)-Math.pow(this.radius,2);if(!((f=Math.pow(m,2)-4*y*g)<0))if(0===f){if(P.lerp(a,o,r,f),P.squaredDistance(a,i)>d&&(P.sub(s,a,h),P.normalize(s,s),e.reportIntersection(t,f,s,-1),t.shouldStop(e)))return}else{var v=Math.sqrt(f),b=1/(2*y),_=(-m-v)*b,w=(-m+v)*b;if(0<=_&&_<=1&&(P.lerp(a,o,r,_),P.squaredDistance(a,i)>d&&(P.sub(s,a,h),P.normalize(s,s),e.reportIntersection(t,_,s,-1),t.shouldStop(e))))return;if(0<=w&&w<=1&&(P.lerp(a,o,r,w),P.squaredDistance(a,i)>d&&(P.sub(s,a,h),P.normalize(s,s),e.reportIntersection(t,w,s,-1),t.shouldStop(e))))return}}}},{"../math/vec2":27,"./Shape":42}],36:[function(t,e,i){var n=t("./Shape"),g=t("../math/vec2");function o(t){"number"==typeof t&&(t={radius:t},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=n.CIRCLE,n.call(this,t)}(((e.exports=o).prototype=new n).constructor=o).prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e,i){var n=this.radius;g.set(t.upperBound,n,n),g.set(t.lowerBound,-n,-n),e&&(g.add(t.lowerBound,t.lowerBound,e),g.add(t.upperBound,t.upperBound,e))};var v=g.create(),b=g.create();o.prototype.raycast=function(t,e,i,n){var o=e.from,r=e.to,a=this.radius,s=Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2),h=2*((r[0]-o[0])*(o[0]-i[0])+(r[1]-o[1])*(o[1]-i[1])),l=Math.pow(o[0]-i[0],2)+Math.pow(o[1]-i[1],2)-Math.pow(a,2),p=Math.pow(h,2)-4*s*l,c=v,u=b;if(!(p<0))if(0===p)g.lerp(c,o,r,p),g.sub(u,c,i),g.normalize(u,u),e.reportIntersection(t,p,u,-1);else{var d=Math.sqrt(p),f=1/(2*s),y=(-h-d)*f,m=(-h+d)*f;if(0<=y&&y<=1&&(g.lerp(c,o,r,y),g.sub(u,c,i),g.normalize(u,u),e.reportIntersection(t,y,u,-1),t.shouldStop(e)))return;0<=m&&m<=1&&(g.lerp(c,o,r,m),g.sub(u,c,i),g.normalize(u,u),e.reportIntersection(t,m,u,-1))}}},{"../math/vec2":27,"./Shape":42}],37:[function(t,e,i){var h=t("./Shape"),d=t("../math/vec2"),s=t("../math/polyk");t("poly-decomp");function u(t){Array.isArray(t)&&(t={vertices:t,axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var n=d.create();d.copy(n,e[i]),this.vertices.push(n)}if(this.axes=[],t.axes)for(i=0;i<t.axes.length;i++){var o=d.create();d.copy(o,t.axes[i]),this.axes.push(o)}else for(i=0;i<this.vertices.length;i++){var r=this.vertices[i],a=this.vertices[(i+1)%this.vertices.length],s=d.create();d.sub(s,a,r),d.rotate90cw(s,s),d.normalize(s,s),this.axes.push(s)}if(this.centerOfMass=d.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=h.CONVEX,h.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}((e.exports=u).prototype=new h).constructor=u;var l=d.create(),a=d.create();u.prototype.projectOntoLocalAxis=function(t,e){for(var i,n,o=null,r=null,a=(t=l,0);a<this.vertices.length;a++)i=this.vertices[a],n=d.dot(i,t),(null===o||o<n)&&(o=n),(null===r||n<r)&&(r=n);if(o<r){var s=r;r=o,o=s}d.set(e,r,o)},u.prototype.projectOntoWorldAxis=function(t,e,i,n){var o=a;this.projectOntoLocalAxis(t,n),0!==i?d.rotate(o,t,i):o=t;var r=d.dot(e,o);d.set(n,n[0]+r,n[1]+r)},u.prototype.updateTriangles=function(){for(var t=[],e=this.triangles.length=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}var n=s.Triangulate(t);for(e=0;e<n.length;e+=3){var o=n[e],r=n[e+1],a=n[e+2];this.triangles.push([o,r,a])}};var f=d.create(),y=d.create(),m=d.create(),g=d.create(),v=d.create();d.create(),d.create(),d.create(),d.create();u.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,n=f,o=m,r=g,a=v,s=y;d.set(i,0,0);for(var h=0,l=0;l!==t.length;l++){var p=t[l];o=e[p[0]],r=e[p[1]],a=e[p[2]];d.centroid(n,o,r,a);var c=u.triangleArea(o,r,a);h+=c,d.scale(s,n,c),d.add(i,i,s)}d.scale(i,i,1/h)},u.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,n=this.vertices.length,o=n-1,r=0;r<n;o=r,r++){var a=this.vertices[o],s=this.vertices[r],h=Math.abs(d.crossLength(a,s));e+=h*(d.dot(s,s)+d.dot(s,a)+d.dot(a,a)),i+=h}return t/6*(e/i)},u.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var n=d.squaredLength(t[i]);e<n&&(e=n)}this.boundingRadius=Math.sqrt(e)},u.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},u.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var n=t[i],o=e[n[0]],r=e[n[1]],a=e[n[2]],s=u.triangleArea(o,r,a);this.area+=s}},u.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var b=d.create(),_=d.create(),w=d.create();u.prototype.raycast=function(t,e,i,n){var o=b,r=_,a=w,s=this.vertices;d.toLocalFrame(o,e.from,i,n),d.toLocalFrame(r,e.to,i,n);for(var h=s.length,l=0;l<h&&!t.shouldStop(e);l++){var p=s[l],c=s[(l+1)%h],u=d.getLineSegmentsIntersectionFraction(o,r,p,c);0<=u&&(d.sub(a,c,p),d.rotate(a,a,-Math.PI/2+n),d.normalize(a,a),e.reportIntersection(t,u,a,l))}}},{"../math/polyk":26,"../math/vec2":27,"./Shape":42,"poly-decomp":63}],38:[function(t,e,i){var n=t("./Shape"),m=t("../math/vec2");t("../utils/Utils");function o(t){if(Array.isArray(t)){if(t={heights:t},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=n.HEIGHTFIELD,n.call(this,t)}(((e.exports=o).prototype=new n).constructor=o).prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],n=0;n!==t.length;n++){var o=t[n];e<o&&(e=o),o<i&&(i=o)}this.maxValue=e,this.minValue=i},o.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var r=[m.create(),m.create(),m.create(),m.create()];o.prototype.computeAABB=function(t,e,i){m.set(r[0],0,this.maxValue),m.set(r[1],this.elementWidth*this.heights.length,this.maxValue),m.set(r[2],this.elementWidth*this.heights.length,this.minValue),m.set(r[3],0,this.minValue),t.setFromPoints(r,e,i)},o.prototype.getLineSegment=function(t,e,i){var n=this.heights,o=this.elementWidth;m.set(t,i*o,n[i]),m.set(e,(i+1)*o,n[i+1])},o.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};m.create();var g=m.create(),v=m.create(),b=m.create(),_=m.create(),w=m.create();m.fromValues(0,1);o.prototype.raycast=function(t,e,i,n){var o=e.from,r=e.to,a=(e.direction,g),s=v,h=b,l=_,p=w;m.toLocalFrame(l,o,i,n),m.toLocalFrame(p,r,i,n);var c=this.getClampedSegmentIndex(l),u=this.getClampedSegmentIndex(p);if(u<c){var d=c;c=u,u=d}for(var f=0;f<this.heights.length-1;f++){this.getLineSegment(s,h,f);var y=m.getLineSegmentsIntersectionFraction(l,p,s,h);if(0<=y&&(m.sub(a,h,s),m.rotate(a,a,n+Math.PI/2),m.normalize(a,a),e.reportIntersection(t,y,a,-1),t.shouldStop(e)))return}}},{"../math/vec2":27,"../utils/Utils":54,"./Shape":42}],39:[function(t,e,i){var n=t("./Shape"),c=t("../math/vec2");function o(t){"number"==typeof t&&(t={length:t},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=n.LINE,n.call(this,t)}(((e.exports=o).prototype=new n).constructor=o).prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var r=[c.create(),c.create()];o.prototype.computeAABB=function(t,e,i){var n=this.length/2;c.set(r[0],-n,0),c.set(r[1],n,0),t.setFromPoints(r,e,i,0)};c.create();var u=c.create(),d=c.create(),f=c.create(),y=c.fromValues(0,1);o.prototype.raycast=function(t,e,i,n){var o=e.from,r=e.to,a=d,s=f,h=this.length/2;c.set(a,-h,0),c.set(s,h,0),c.toGlobalFrame(a,a,i,n),c.toGlobalFrame(s,s,i,n);var l=c.getLineSegmentsIntersectionFraction(a,s,o,r);if(0<=l){var p=u;c.rotate(p,y,n),e.reportIntersection(t,l,p,-1)}}},{"../math/vec2":27,"./Shape":42}],40:[function(t,e,i){var n=t("./Shape"),o=t("../math/vec2");function r(t){(t=t||{}).type=n.PARTICLE,n.call(this,t)}(((e.exports=r).prototype=new n).constructor=r).prototype.computeMomentOfInertia=function(t){return 0},r.prototype.updateBoundingRadius=function(){this.boundingRadius=0},r.prototype.computeAABB=function(t,e,i){o.copy(t.lowerBound,e),o.copy(t.upperBound,e)}},{"../math/vec2":27,"./Shape":42}],41:[function(t,e,i){var n=t("./Shape"),d=t("../math/vec2");t("../utils/Utils");function o(t){(t=t||{}).type=n.PLANE,n.call(this,t)}(((e.exports=o).prototype=new n).constructor=o).prototype.computeMomentOfInertia=function(t){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,i){var n=i%(2*Math.PI),o=d.set,r=t.lowerBound,a=t.upperBound;o(r,-1e7,-1e7),o(a,1e7,1e7),0===n?a[1]=0:n===Math.PI/2?r[0]=0:n===Math.PI?r[1]=0:n===3*Math.PI/2&&(a[0]=0)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var f=d.create(),y=(d.create(),d.create(),d.create()),m=d.create();o.prototype.raycast=function(t,e,i,n){var o=e.from,r=e.to,a=e.direction,s=f,h=y,l=m;d.set(h,0,1),d.rotate(h,h,n),d.sub(l,o,i);var p=d.dot(l,h);if(d.sub(l,r,i),!(0<p*d.dot(l,h)||d.squaredDistance(o,r)<p*p)){var c=d.dot(h,a);d.sub(s,o,i);var u=-d.dot(h,s)/c/e.length;e.reportIntersection(t,u,h,-1)}}},{"../math/vec2":27,"../utils/Utils":54,"./Shape":42}],42:[function(t,e,i){e.exports=o;var n=t("../math/vec2");function o(t){t=t||{},this.body=null,this.position=n.fromValues(0,0),t.position&&n.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=o.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}o.idCounter=0,o.CIRCLE=1,o.PARTICLE=2,o.PLANE=4,o.CONVEX=8,o.LINE=16,o.BOX=32,Object.defineProperty(o,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),o.BOX}}),o.CAPSULE=64,o.HEIGHTFIELD=128,o.prototype.computeMomentOfInertia=function(t){},o.prototype.updateBoundingRadius=function(){},o.prototype.updateArea=function(){},o.prototype.computeAABB=function(t,e,i){},o.prototype.raycast=function(t,e,i,n){}},{"../math/vec2":27}],43:[function(t,e,i){var P=t("../math/vec2"),n=t("./Solver"),A=t("../utils/Utils"),x=t("../equations/FrictionEquation");function E(t){n.call(this,t,n.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new A.ARRAY_TYPE(this.arrayStep),this.Bs=new A.ARRAY_TYPE(this.arrayStep),this.invCs=new A.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}(((e.exports=E).prototype=new n).constructor=E).prototype.solve=function(t,e){this.sortEquations();var i=0,n=this.iterations,o=this.frictionIterations,r=this.equations,a=r.length,s=Math.pow(this.tolerance*a,2),h=e.bodies,l=e.bodies.length,p=(P.add,P.set,this.useZeroRHS),c=this.lambda;if(this.usedIterations=0,a)for(var u=0;u!==l;u++){h[u].updateSolveMassProperties()}c.length<a&&(c=this.lambda=new A.ARRAY_TYPE(a+this.arrayStep),this.Bs=new A.ARRAY_TYPE(a+this.arrayStep),this.invCs=new A.ARRAY_TYPE(a+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(c);var d,f,y=this.invCs,m=this.Bs;for(c=this.lambda,u=0;u!==r.length;u++){var g;((g=r[u]).timeStep!==t||g.needsUpdate)&&(g.timeStep=t,g.update()),m[u]=g.computeB(g.a,g.b,t),y[u]=g.computeInvC(g.epsilon)}if(0!==a){for(u=0;u!==l;u++){h[u].resetConstraintVelocity()}if(o){for(i=0;i!==o;i++){for(f=d=0;f!==a;f++){g=r[f];var v=E.iterateEquation(f,g,g.epsilon,m,y,c,p,t,i);d+=Math.abs(v)}if(this.usedIterations++,d*d<=s)break}for(E.updateMultipliers(r,c,1/t),f=0;f!==a;f++){var b=r[f];if(b instanceof x){for(var _=0,w=0;w!==b.contactEquations.length;w++)_+=b.contactEquations[w].multiplier;_*=b.frictionCoefficient/b.contactEquations.length,b.maxForce=_,b.minForce=-_}}}for(i=0;i!==n;i++){for(f=d=0;f!==a;f++){g=r[f];v=E.iterateEquation(f,g,g.epsilon,m,y,c,p,t,i);d+=Math.abs(v)}if(this.usedIterations++,d*d<=s)break}for(u=0;u!==l;u++)h[u].addConstraintVelocity();E.updateMultipliers(r,c,1/t)}},E.updateMultipliers=function(t,e,i){for(var n=t.length;n--;)t[n].multiplier=e[n]*i},E.iterateEquation=function(t,e,i,n,o,r,a,s,h){var l=n[t],p=o[t],c=r[t],u=e.computeGWlambda(),d=e.maxForce,f=e.minForce;a&&(l=0);var y=p*(l-u-i*c),m=c+y;return m<f*s?y=f*s-c:d*s<m&&(y=d*s-c),r[t]+=y,e.addToWlambda(y),y}},{"../equations/FrictionEquation":20,"../math/vec2":27,"../utils/Utils":54,"./Solver":44}],44:[function(t,e,i){t("../utils/Utils");var n=t("../events/EventEmitter");function o(t,e){t=t||{},n.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}(((e.exports=o).prototype=new n).constructor=o).prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var r={bodies:[]};o.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),r.bodies.length=0,e.getBodies(r.bodies),r.bodies.length&&this.solve(t,r))},o.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},o.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},o.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var n=t[e];n.enabled&&this.equations.push(n)}},o.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},o.prototype.removeAllEquations=function(){this.equations.length=0},o.GS=1,o.ISLAND=2},{"../events/EventEmitter":23,"../utils/Utils":54}],45:[function(t,e,i){var n=t("../equations/ContactEquation"),o=t("./Pool");function r(){o.apply(this,arguments)}(((e.exports=r).prototype=new o).constructor=r).prototype.create=function(){return new n},r.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":18,"./Pool":52}],46:[function(t,e,i){var n=t("../equations/FrictionEquation"),o=t("./Pool");function r(){o.apply(this,arguments)}(((e.exports=r).prototype=new o).constructor=r).prototype.create=function(){return new n},r.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":20,"./Pool":52}],47:[function(t,e,i){var n=t("../world/IslandNode"),o=t("./Pool");function r(){o.apply(this,arguments)}(((e.exports=r).prototype=new o).constructor=r).prototype.create=function(){return new n},r.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":57,"./Pool":52}],48:[function(t,e,i){var n=t("../world/Island"),o=t("./Pool");function r(){o.apply(this,arguments)}(((e.exports=r).prototype=new o).constructor=r).prototype.create=function(){return new n},r.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":55,"./Pool":52}],49:[function(t,e,i){var n=t("./TupleDictionary"),o=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils");function r(){this.overlappingShapesLastState=new n,this.overlappingShapesCurrentState=new n,this.recordPool=new o({size:16}),this.tmpDict=new n,this.tmpArray1=[]}(e.exports=r).prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var n=t.keys[i],o=t.getByKey(n);e.getByKey(n);o&&this.recordPool.release(o)}t.reset(),t.copy(e),e.reset()},r.prototype.setOverlapping=function(t,e,i,n){this.overlappingShapesLastState;var o=this.overlappingShapesCurrentState;if(!o.get(e.id,n.id)){var r=this.recordPool.get();r.set(t,e,i,n),o.set(e.id,n.id,r)}},r.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},r.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},r.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,n=i.keys.length;n--;){var o=i.keys[n],r=i.data[o];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},r.prototype.getDiff=function(t,e,i){var n=t,o=e;(i=i||[]).length=0;for(var r=o.keys.length;r--;){var a=o.keys[r],s=o.data[a];if(!s)throw new Error("Key "+a+" had no data!");n.data[a]||i.push(s)}return i},r.prototype.isNewOverlap=function(t,e){var i=0|t.id,n=0|e.id,o=this.overlappingShapesLastState,r=this.overlappingShapesCurrentState;return!o.get(i,n)&&!!r.get(i,n)},r.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},r.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},r.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,n=t.length;n--;){var o=t[n];i.set(0|o.bodyA.id,0|o.bodyB.id,o)}for(n=i.keys.length;n--;){(o=i.getByKey(i.keys[n]))&&e.push(o.bodyA,o.bodyB)}return i.reset(),e}},{"./OverlapKeeperRecord":50,"./OverlapKeeperRecordPool":51,"./TupleDictionary":53,"./Utils":54}],50:[function(t,e,i){function o(t,e,i,n){this.shapeA=e,this.shapeB=n,this.bodyA=t,this.bodyB=i}(e.exports=o).prototype.set=function(t,e,i,n){o.call(this,t,e,i,n)}},{}],51:[function(t,e,i){var n=t("./OverlapKeeperRecord"),o=t("./Pool");function r(){o.apply(this,arguments)}(((e.exports=r).prototype=new o).constructor=r).prototype.create=function(){return new n},r.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":50,"./Pool":52}],52:[function(t,e,i){function n(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}(e.exports=n).prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},n.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},n.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],53:[function(t,e,i){var n=t("./Utils");function o(){this.data={},this.keys=[]}(e.exports=o).prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|e)<(0|t)?t<<16|65535&e:e<<16|65535&t)},o.prototype.getByKey=function(t){return t|=0,this.data[t]},o.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},o.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var n=this.getKey(t,e);return this.data[n]||this.keys.push(n),this.data[n]=i,n},o.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},o.prototype.copy=function(t){this.reset(),n.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":54}],54:[function(t,e,i){function n(){}(e.exports=n).appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,n=e.length;i!==n;++i)t.push(e[i])},n.splice=function(t,e,i){i=i||1;for(var n=e,o=t.length-i;n<o;n++)t[n]=t[n+i];t.length=o},n.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Float32Array:Array,n.extend=function(t,e){for(var i in e)t[i]=e[i]},n.defaults=function(t,e){for(var i in t=t||{},e)i in t||(t[i]=e[i]);return t}},{}],55:[function(t,e,i){var n=t("../objects/Body");function o(){this.equations=[],this.bodies=[]}(e.exports=o).prototype.reset=function(){this.equations.length=this.bodies.length=0};var r=[];o.prototype.getBodies=function(t){for(var e=t||[],i=this.equations,n=r.length=0;n!==i.length;n++){var o=i[n];-1===r.indexOf(o.bodyA.id)&&(e.push(o.bodyA),r.push(o.bodyA.id)),-1===r.indexOf(o.bodyB.id)&&(e.push(o.bodyB),r.push(o.bodyB.id))}return e},o.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===n.DYNAMIC&&!e.wantsToSleep)return!1}return!0},o.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){this.bodies[t].sleep()}return!0}},{"../objects/Body":28}],56:[function(t,e,i){t("../math/vec2"),t("./Island"),t("./IslandNode");var n=t("./../utils/IslandNodePool"),o=t("./../utils/IslandPool"),a=t("../objects/Body");function f(t){this.nodePool=new n({size:16}),this.islandPool=new o({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}(e.exports=f).getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var n=t[i];if(!n.visited&&n.body.type===a.DYNAMIC)return n}return!1},f.prototype.visit=function(t,e,i){e.push(t.body);for(var n=t.equations.length,o=0;o!==n;o++){var r=t.equations[o];-1===i.indexOf(r)&&i.push(r)}},f.prototype.bfs=function(t,e,i){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,i);n.length;)for(var o,r=n.pop();o=f.getUnvisitedNode(r.neighbors);)o.visited=!0,this.visit(o,e,i),o.body.type===a.DYNAMIC&&n.push(o)},f.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,n=this.equations;i.length;)this.nodePool.release(i.pop());for(var o=0;o!==e.length;o++){var r=this.nodePool.get();r.body=e[o],i.push(r)}for(var a=0;a!==n.length;a++){var s=n[a],h=(o=e.indexOf(s.bodyA),e.indexOf(s.bodyB)),l=i[o],p=i[h];l.neighbors.push(p),p.neighbors.push(l),l.equations.push(s),p.equations.push(s)}var c,u=this.islands;for(o=0;o<u.length;o++)this.islandPool.release(u[o]);for(u.length=0;c=f.getUnvisitedNode(i);){var d=this.islandPool.get();this.bfs(c,d.bodies,d.equations),u.push(d)}return u}},{"../math/vec2":27,"../objects/Body":28,"./../utils/IslandNodePool":47,"./../utils/IslandPool":48,"./Island":55,"./IslandNode":57}],57:[function(t,e,i){function n(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}(e.exports=n).prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],58:[function(t,e,i){var n=t("../solver/GSSolver"),W=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),g=t("../shapes/Circle"),v=t("../shapes/Convex"),b=(t("../shapes/Line"),t("../shapes/Plane")),_=t("../shapes/Capsule"),w=t("../shapes/Particle"),o=t("../events/EventEmitter"),Y=t("../objects/Body"),r=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),a=t("../material/ContactMaterial"),s=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),h=t("../collision/SAPBroadphase"),l=t("../collision/Narrowphase"),z=t("../utils/Utils"),p=t("../utils/OverlapKeeper"),c=t("./IslandManager");t("../objects/RotationalSpring");function H(t){o.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new n,this.narrowphase=new l(this),this.islandManager=new c,this.gravity=W.fromValues(0,-9.78),t.gravity&&W.copy(this.gravity,t.gravity),this.frictionGravity=W.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new h,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new r,this.defaultContactMaterial=new a(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=H.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new p}(((e.exports=H).prototype=new Object(o.prototype)).constructor=H).NO_SLEEPING=1,H.BODY_SLEEPING=2,H.ISLAND_SLEEPING=4,H.prototype.addConstraint=function(t){this.constraints.push(t)},H.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},H.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&z.splice(this.contactMaterials,e,1)},H.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,n=0,o=i.length;n!==o;n++){var r=i[n];if(r.materialA.id===t.id&&r.materialB.id===e.id||r.materialA.id===e.id&&r.materialB.id===t.id)return r}return!1},H.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&z.splice(this.constraints,e,1)};W.create(),W.create(),W.create(),W.create(),W.create(),W.create();var K=W.create(),x=W.fromValues(0,0),E=W.fromValues(0,0);W.fromValues(0,0),W.fromValues(0,0);H.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var n=0;this.accumulator>=t&&n<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,n++;for(var o=this.accumulator%t/t,r=0;r!==this.bodies.length;r++){var a=this.bodies[r];W.lerp(a.interpolatedPosition,a.previousPosition,a.position,o),a.interpolatedAngle=a.previousAngle+o*(a.angle-a.previousAngle)}}};var Z=[];H.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,n=this.bodies,o=this.gravity,r=this.solver,a=this.bodies.length,s=this.broadphase,h=this.narrowphase,l=this.constraints,p=K,c=(W.scale,W.add),u=(W.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var d=W.length(this.gravity);0===d&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=d)}if(this.applyGravity)for(var f=0;f!==a;f++){var y=(m=n[f]).force;m.type===Y.DYNAMIC&&m.sleepState!==Y.SLEEPING&&(W.scale(p,o,m.mass*m.gravityScale),c(y,y,p))}if(this.applySpringForces)for(f=0;f!==e;f++){i[f].applyForce()}if(this.applyDamping)for(f=0;f!==a;f++){var m;(m=n[f]).type===Y.DYNAMIC&&m.applyDamping(t)}var g=s.getCollisionPairs(this),v=this.disabledBodyCollisionPairs;for(f=v.length-2;0<=f;f-=2)for(var b=g.length-2;0<=b;b-=2)(v[f]===g[b]&&v[f+1]===g[b+1]||v[f+1]===g[b]&&v[f]===g[b+1])&&g.splice(b,2);var _=l.length;for(f=0;f!==_;f++){var w=l[f];if(!w.collideConnected)for(b=g.length-2;0<=b;b-=2)(w.bodyA===g[b]&&w.bodyB===g[b+1]||w.bodyB===g[b]&&w.bodyA===g[b+1])&&g.splice(b,2)}this.postBroadphaseEvent.pairs=g,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,h.reset(this);f=0;for(var P=g.length;f!==P;f+=2)for(var A=g[f],x=g[f+1],E=0,M=A.shapes.length;E!==M;E++)for(var S=A.shapes[E],I=S.position,T=S.angle,C=0,O=x.shapes.length;C!==O;C++){var B=x.shapes[C],L=B.position,R=B.angle,N=this.defaultContactMaterial;if(S.material&&B.material){var D=this.getContactMaterial(S.material,B.material);D&&(N=D)}this.runNarrowphase(h,A,S,I,T,x,B,L,R,N,this.frictionGravity)}for(f=0;f!==a;f++){(V=n[f])._wakeUpAfterNarrowphase&&(V.wakeUp(),V._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(Z);var G=this.endContactEvent;for(C=Z.length;C--;){var k=Z[C];G.shapeA=k.shapeA,G.shapeB=k.shapeB,G.bodyA=k.bodyA,G.bodyB=k.bodyB,this.emit(G)}Z.length=0}var j=this.preSolveEvent;j.contactEquations=h.contactEquations,j.frictionEquations=h.frictionEquations,this.emit(j),j.contactEquations=j.frictionEquations=null;_=l.length;for(f=0;f!==_;f++)l[f].update();if(h.contactEquations.length||h.frictionEquations.length||_)if(this.islandSplit){for(u.equations.length=0,z.appendArray(u.equations,h.contactEquations),z.appendArray(u.equations,h.frictionEquations),f=0;f!==_;f++)z.appendArray(u.equations,l[f].equations);u.split(this);for(f=0;f!==u.islands.length;f++){(q=u.islands[f]).equations.length&&r.solveIsland(t,q)}}else{for(r.addEquations(h.contactEquations),r.addEquations(h.frictionEquations),f=0;f!==_;f++)r.addEquations(l[f].equations);this.solveConstraints&&r.solve(t,this),r.removeAllEquations()}for(f=0;f!==a;f++){var V;(V=n[f]).integrate(t)}for(f=0;f!==a;f++)n[f].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var F=this.impactEvent;for(f=0;f!==h.contactEquations.length;f++){var X=h.contactEquations[f];X.firstImpact&&(F.bodyA=X.bodyA,F.bodyB=X.bodyB,F.shapeA=X.shapeA,F.shapeB=X.shapeB,F.contactEquation=X,this.emit(F))}}if(this.sleepMode===H.BODY_SLEEPING)for(f=0;f!==a;f++)n[f].sleepTick(this.time,!1,t);else if(this.sleepMode===H.ISLAND_SLEEPING&&this.islandSplit){for(f=0;f!==a;f++)n[f].sleepTick(this.time,!0,t);for(f=0;f<this.islandManager.islands.length;f++){var q;(q=this.islandManager.islands[f]).wantsToSleep()&&q.sleep()}}this.stepping=!1;var U=this.bodiesToBeRemoved;for(f=0;f!==U.length;f++)this.removeBody(U[f]);U.length=0,this.emit(this.postStepEvent)},H.prototype.runNarrowphase=function(t,e,i,n,o,r,a,s,h,l,p){if(0!=(i.collisionGroup&a.collisionMask)&&0!=(a.collisionGroup&i.collisionMask)){W.rotate(x,n,e.angle),W.rotate(E,s,r.angle),W.add(x,x,e.position),W.add(E,E,r.position);var c,u=o+e.angle,d=h+r.angle;t.enableFriction=0<l.friction,t.frictionCoefficient=l.friction,c=e.type===Y.STATIC||e.type===Y.KINEMATIC?r.mass:r.type===Y.STATIC||r.type===Y.KINEMATIC?e.mass:e.mass*r.mass/(e.mass+r.mass),t.slipForce=l.friction*p*c,t.restitution=l.restitution,t.surfaceVelocity=l.surfaceVelocity,t.frictionStiffness=l.frictionStiffness,t.frictionRelaxation=l.frictionRelaxation,t.stiffness=l.stiffness,t.relaxation=l.relaxation,t.contactSkinSize=l.contactSkinSize,t.enabledEquations=e.collisionResponse&&r.collisionResponse&&i.collisionResponse&&a.collisionResponse;var f=t[i.type|a.type],y=0;if(f){var m=i.sensor||a.sensor,g=t.frictionEquations.length;y=i.type<a.type?f.call(t,e,i,x,u,r,a,E,d,m):f.call(t,r,a,E,d,e,i,x,u,m);var v=t.frictionEquations.length-g;if(y){if(e.allowSleep&&e.type===Y.DYNAMIC&&e.sleepState===Y.SLEEPING&&r.sleepState===Y.AWAKE&&r.type!==Y.STATIC){var b=W.squaredLength(r.velocity)+Math.pow(r.angularVelocity,2);2*Math.pow(r.sleepSpeedLimit,2)<=b&&(e._wakeUpAfterNarrowphase=!0)}if(r.allowSleep&&r.type===Y.DYNAMIC&&r.sleepState===Y.SLEEPING&&e.sleepState===Y.AWAKE&&e.type!==Y.STATIC){var _=W.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2);2*Math.pow(e.sleepSpeedLimit,2)<=_&&(r._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,i,r,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,a)){var w=this.beginContactEvent;if(w.shapeA=i,w.shapeB=a,w.bodyA=e,w.bodyB=r,w.contactEquations.length=0,"number"==typeof y)for(var P=t.contactEquations.length-y;P<t.contactEquations.length;P++)w.contactEquations.push(t.contactEquations[P]);this.emit(w)}if("number"==typeof y&&1<v)for(P=t.frictionEquations.length-v;P<t.frictionEquations.length;P++){var A=t.frictionEquations[P];A.setSlipForce(A.getSlipForce()/v)}}}}},H.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},H.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&z.splice(this.springs,e,1)},H.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t);var e=(t.world=this).addBodyEvent;e.body=t,this.emit(e),e.body=null}},H.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(z.splice(this.bodies,e,1),(this.removeBodyEvent.body=t).resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},H.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}return!1},H.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},H.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,n=0;n<i.length;n+=2)if(i[n]===t&&i[n+1]===e||i[n+1]===t&&i[n]===e)return void i.splice(n,2)},H.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;0<=e;e--)this.removeConstraint(t[e]);var i=this.bodies;for(e=i.length-1;0<=e;e--)this.removeBody(i[e]);var n=this.springs;for(e=n.length-1;0<=e;e--)this.removeSpring(n[e]);var o=this.contactMaterials;for(e=o.length-1;0<=e;e--)this.removeContactMaterial(o[e]);H.apply(this)};var P=W.create(),A=(W.fromValues(0,0),W.fromValues(0,0));H.prototype.hitTest=function(t,e,i){i=i||0;var n=new Y({position:t}),o=new w,r=t,a=P,s=A;n.addShape(o);for(var h=this.narrowphase,l=[],p=0,c=e.length;p!==c;p++)for(var u=e[p],d=0,f=u.shapes.length;d!==f;d++){var y=u.shapes[d];W.rotate(a,y.position,u.angle),W.add(a,a,u.position);var m=y.angle+u.angle;(y instanceof g&&h.circleParticle(u,y,a,m,n,o,r,0,!0)||y instanceof v&&h.particleConvex(n,o,r,0,u,y,a,m,!0)||y instanceof b&&h.particlePlane(n,o,r,0,u,y,a,m,!0)||y instanceof _&&h.particleCapsule(n,o,r,0,u,y,a,m,!0)||y instanceof w&&W.squaredLength(W.sub(s,a,t))<i*i)&&l.push(u)}return l},H.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var n=e[i],o=0;o!==n.equations.length;o++){var r=n.equations[o];r.stiffness=t,r.needsUpdate=!0}var a=this.contactMaterials;for(i=0;i!==a.length;i++){(n=a[i]).stiffness=n.frictionStiffness=t}(n=this.defaultContactMaterial).stiffness=n.frictionStiffness=t},H.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],n=0;n!==i.equations.length;n++){var o=i.equations[n];o.relaxation=t,o.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++){(i=this.contactMaterials[e]).relaxation=i.frictionRelaxation=t}(i=this.defaultContactMaterial).relaxation=i.frictionRelaxation=t};var u=new s,d=[];H.prototype.raycast=function(t,e){return e.getAABB(u),this.broadphase.aabbQuery(this,u,d),e.intersectBodies(t,d),d.length=0,t.hasHit()}},{"../../package.json":3,"../collision/AABB":4,"../collision/Broadphase":5,"../collision/Narrowphase":7,"../collision/Ray":8,"../collision/SAPBroadphase":10,"../constraints/Constraint":11,"../constraints/DistanceConstraint":12,"../constraints/GearConstraint":13,"../constraints/LockConstraint":14,"../constraints/PrismaticConstraint":15,"../constraints/RevoluteConstraint":16,"../events/EventEmitter":23,"../material/ContactMaterial":24,"../material/Material":25,"../math/vec2":27,"../objects/Body":28,"../objects/LinearSpring":29,"../objects/RotationalSpring":30,"../shapes/Capsule":35,"../shapes/Circle":36,"../shapes/Convex":37,"../shapes/Line":39,"../shapes/Particle":40,"../shapes/Plane":41,"../shapes/Shape":42,"../solver/GSSolver":43,"../solver/Solver":44,"../utils/OverlapKeeper":49,"../utils/Utils":54,"./IslandManager":56}],59:[function(t,e,i){var c=t("./Scalar");function n(){}(e.exports=n).lineInt=function(t,e,i){i=i||0;var n,o,r,a,s,h,l,p=[0,0];return n=t[1][1]-t[0][1],o=t[0][0]-t[1][0],r=n*t[0][0]+o*t[0][1],a=e[1][1]-e[0][1],s=e[0][0]-e[1][0],h=a*e[0][0]+s*e[0][1],l=n*s-a*o,c.eq(l,0,i)||(p[0]=(s*r-o*h)/l,p[1]=(n*h-a*r)/l),p},n.segmentsIntersect=function(t,e,i,n){var o=e[0]-t[0],r=e[1]-t[1],a=n[0]-i[0],s=n[1]-i[1];if(a*r-s*o==0)return!1;var h=(o*(i[1]-t[1])+r*(t[0]-i[0]))/(a*r-s*o),l=(a*(t[1]-i[1])+s*(i[0]-t[0]))/(s*o-a*r);return 0<=h&&h<=1&&0<=l&&l<=1}},{"./Scalar":62}],60:[function(t,e,i){function l(){}(e.exports=l).area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},l.left=function(t,e,i){return 0<l.area(t,e,i)},l.leftOn=function(t,e,i){return 0<=l.area(t,e,i)},l.right=function(t,e,i){return l.area(t,e,i)<0},l.rightOn=function(t,e,i){return l.area(t,e,i)<=0};var p=[],c=[];l.collinear=function(t,e,i,n){if(n){var o=p,r=c;o[0]=e[0]-t[0],o[1]=e[1]-t[1],r[0]=i[0]-e[0],r[1]=i[1]-e[1];var a=o[0]*r[0]+o[1]*r[1],s=Math.sqrt(o[0]*o[0]+o[1]*o[1]),h=Math.sqrt(r[0]*r[0]+r[1]*r[1]);return Math.acos(a/(s*h))<n}return 0==l.area(t,e,i)},l.sqdist=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}},{}],61:[function(t,e,i){var s=t("./Line"),P=t("./Point"),u=t("./Scalar");function A(){this.vertices=[]}(e.exports=A).prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},A.prototype.first=function(){return this.vertices[0]},A.prototype.last=function(){return this.vertices[this.vertices.length-1]},A.prototype.clear=function(){this.vertices.length=0},A.prototype.append=function(t,e,i){if(void 0===e)throw new Error("From is not given!");if(void 0===i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var n=e;n<i;n++)this.vertices.push(t.vertices[n])},A.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);P.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},A.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},A.prototype.isReflex=function(t){return P.right(this.at(t-1),this.at(t),this.at(t+1))};var h=[],l=[];function x(t,e,i,n,o){o=o||0;var r=e[1]-t[1],a=t[0]-e[0],s=r*t[0]+a*t[1],h=n[1]-i[1],l=i[0]-n[0],p=h*i[0]+l*i[1],c=r*l-h*a;return u.eq(c,0,o)?[0,0]:[(l*s-a*p)/c,(r*p-h*s)/c]}A.prototype.canSee=function(t,e){var i,n,o=h,r=l;if(P.leftOn(this.at(t+1),this.at(t),this.at(e))&&P.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;n=P.sqdist(this.at(t),this.at(e));for(var a=0;a!==this.vertices.length;++a)if((a+1)%this.vertices.length!==t&&a!==t&&P.leftOn(this.at(t),this.at(e),this.at(a+1))&&P.rightOn(this.at(t),this.at(e),this.at(a))&&(o[0]=this.at(t),o[1]=this.at(e),r[0]=this.at(a),r[1]=this.at(a+1),i=s.lineInt(o,r),P.sqdist(this.at(t),i)<n))return!1;return!0},A.prototype.copy=function(t,e,i){var n=i||new A;if(n.clear(),t<e)for(var o=t;o<=e;o++)n.vertices.push(this.vertices[o]);else{for(o=0;o<=e;o++)n.vertices.push(this.vertices[o]);for(o=t;o<this.vertices.length;o++)n.vertices.push(this.vertices[o])}return n},A.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],n=new A,o=Number.MAX_VALUE,r=0;r<this.vertices.length;++r)if(this.isReflex(r))for(var a=0;a<this.vertices.length;++a)if(this.canSee(r,a)){e=this.copy(r,a,n).getCutEdges(),i=this.copy(a,r,n).getCutEdges();for(var s=0;s<i.length;s++)e.push(i[s]);e.length<o&&(o=(t=e).length,t.push([this.at(r),this.at(a)]))}return t},A.prototype.decomp=function(){var t=this.getCutEdges();return 0<t.length?this.slice(t):[this]},A.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var n=t[i],o=0;o<e.length;o++){var r=e[o].slice(n);if(r){e.splice(o,1),e.push(r[0],r[1]);break}}return e}n=t,i=this.vertices.indexOf(n[0]),o=this.vertices.indexOf(n[1]);return-1!=i&&-1!=o&&[this.copy(i,o),this.copy(o,i)]},A.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(s.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(e=1;e<t.length-2;e++)if(s.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},A.prototype.quickDecomp=function(t,e,i,n,o,r){o=o||100,r=r||0,n=n||25,t=void 0!==t?t:[],e=e||[],i=i||[];var a=[0,0],s=[0,0],h=[0,0],l=0,p=0,c=0,u=0,d=0,f=0,y=0,m=new A,g=new A,v=this,b=this.vertices;if(b.length<3)return t;if(o<++r)return console.warn("quickDecomp: max level ("+o+") reached."),t;for(var _=0;_<this.vertices.length;++_)if(v.isReflex(_)){e.push(v.vertices[_]),l=p=Number.MAX_VALUE;for(var w=0;w<this.vertices.length;++w)P.left(v.at(_-1),v.at(_),v.at(w))&&P.rightOn(v.at(_-1),v.at(_),v.at(w-1))&&(h=x(v.at(_-1),v.at(_),v.at(w),v.at(w-1)),P.right(v.at(_+1),v.at(_),h)&&(c=P.sqdist(v.vertices[_],h))<p&&(p=c,s=h,f=w)),P.left(v.at(_+1),v.at(_),v.at(w+1))&&P.rightOn(v.at(_+1),v.at(_),v.at(w))&&(h=x(v.at(_+1),v.at(_),v.at(w),v.at(w+1)),P.left(v.at(_-1),v.at(_),h)&&(c=P.sqdist(v.vertices[_],h))<l&&(l=c,a=h,d=w));if(f==(d+1)%this.vertices.length)h[0]=(s[0]+a[0])/2,h[1]=(s[1]+a[1])/2,i.push(h),_<d?(m.append(v,_,d+1),m.vertices.push(h),g.vertices.push(h),0!=f&&g.append(v,f,v.vertices.length),g.append(v,0,_+1)):(0!=_&&m.append(v,_,v.vertices.length),m.append(v,0,d+1),m.vertices.push(h),g.vertices.push(h),g.append(v,f,_+1));else{if(d<f&&(d+=this.vertices.length),u=Number.MAX_VALUE,d<f)return t;for(w=f;w<=d;++w)P.leftOn(v.at(_-1),v.at(_),v.at(w))&&P.rightOn(v.at(_+1),v.at(_),v.at(w))&&(c=P.sqdist(v.at(_),v.at(w)))<u&&(u=c,y=w%this.vertices.length);_<y?(m.append(v,_,y+1),0!=y&&g.append(v,y,b.length),g.append(v,0,_+1)):(0!=_&&m.append(v,_,b.length),m.append(v,0,y+1),g.append(v,y,_+1))}return m.vertices.length<g.vertices.length?(m.quickDecomp(t,e,i,n,o,r),g.quickDecomp(t,e,i,n,o,r)):(g.quickDecomp(t,e,i,n,o,r),m.quickDecomp(t,e,i,n,o,r)),t}return t.push(this),t},A.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;3<this.vertices.length&&0<=i;--i)P.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":59,"./Point":60,"./Scalar":62}],62:[function(t,e,i){function n(){}(e.exports=n).eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],63:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":60,"./Polygon":61}],64:[function(t,e,i){var n,o,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function h(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(t){n=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}}();var l,p=[],c=!1,u=-1;function d(){c&&l&&(c=!1,l.length?p=l.concat(p):u=-1,p.length&&f())}function f(){if(!c){var t=h(d);c=!0;for(var e=p.length;e;){for(l=p,p=[];++u<e;)l&&l[u].run();u=-1,e=p.length}l=null,c=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new y(t,e)),1!==p.length||c||h(f)},y.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],65:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(i){function t(t){var e=i.call(this)||this;return e.ticker=new PIXI.Ticker,e.stage=new PIXI.Container,e.loader=new PIXI.Loader,e.renderer=new PIXI.Renderer(t),e.renderer.plugins.interaction.moveWhenInside=!0,t.autoStart&&e.ticker.start(),e}return o(t,i),Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.size.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.renderer.screen},enumerable:!0,configurable:!0}),t.prototype.render=function(){this.renderer.render(this.stage)},t.prototype.start=function(t){this.ticker.start()},t.prototype.stop=function(){this.ticker.stop()},t.prototype.destory=function(t){void 0===t&&(t={children:!1}),this.stage.destroy(t),this.ticker.destroy(),this.renderer.destroy(!0)},t}(PIXI.utils.EventEmitter);i.Application=r},{}],66:[function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});var o=n(t("js-cookie")),r=t("./index"),a=function(){function t(){this._hook={},console.warn("FakeAPI","GameAPI object not found! Used Fake API")}return t.prototype.invokeHook=function(t,e){this._hook[t]?(this._hook[t](e),console.warn("FakeAPI","Hook "+t+" executed with",e)):console.warn("FakeAPI","Hook "+t+" cant'be executed!")},t.prototype.cleanGameData=function(){o.default.set("_GameSaves_",{}),console.warn("FakeAPI","Game data was cleaned!")},t.prototype.openAllLevels=function(){var t=r.App.instance.games,e={};for(var i in t)e[i]={level:3};o.default.set("_GameSaves_",e),console.warn("FakeAPI","God Mode enabled!")},t.prototype.getGameData=function(t){var e=(o.default.getJSON("_GameSaves_")||{})[t]||{data:{}};return console.log("FakeAPI","Game requiest data:",t,e),e},t.prototype.setGameData=function(t,e){var i=o.default.getJSON("_GameSaves_")||{};return i[t]=e,o.default.set("_GameSaves_",i),console.log("FakeAPI","Game send data:",t,e),i},t.prototype.submitGameState=function(t,e){console.log("FakeAPI","Game submit Phase:",t,e)},t.prototype.registerHook=function(t,e){this._hook[t]=e,console.log("FakeAPI","Register hook of",t)},t.prototype.removeHook=function(t){this._hook[t]=void 0,console.log("FakeAPI","Remove hook of",t)},t}();i.FakeGameApi=a;var s=function(){function t(){if(this._hook={},this.api=window.InternalAPI,!this.api)throw new Error("Illegal state, InternalAPI is missing")}return t.prototype.invokeHook=function(t,e){this._hook[t]&&this._hook[t](e)},t.prototype.getGameData=function(t){var e=this._invokeMethod("getGameData",{gameId:t,data:{}});return e?e.data:void 0},t.prototype.setGameData=function(t,e){var i=this._invokeMethod("setGameData",{gameId:t,data:e});return i?i.data:void 0},t.prototype.submitGameState=function(t,e){this._invokeMethod("submitGameState",{gameId:t,data:e})},t.prototype.registerHook=function(t,e){this._hook[t]=e},t.prototype.removeHook=function(t){this._hook[t]=void 0},t.prototype._invokeMethod=function(t,e){var i=JSON.stringify(e||{}),n=this.api[t](i);return JSON.parse(n||"null")},t}();i.EmbeddedGameApi=s},{"./index":103,"js-cookie":2}],67:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../shared/config");i.Assets={BaseDir:n.Config.BaseResDir+"/game3",Assets:{"game-atlas":{name:"game-atlas",url:"/game3-atlas.json"},bg0:{name:"bg0",url:"/bg0.jpg"},bg1:{name:"bg1",url:"/bg1.jpg"},bg2:{name:"bg2",url:"/bg2.jpg"}}}},{"../shared/config":137}],68:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=t("p2"),r=t("../physics/constants"),n=function(){function t(){}return t.build=function(t,e){for(var i={x:e.width*e.anchor.x*r.PIXEL_TO_METR,y:e.height*e.anchor.y*r.PIXEL_TO_METR,w:e.width*r.PIXEL_TO_METR,h:e.height*r.PIXEL_TO_METR,sx:e.scale.x,sy:e.scale.y},n={shapes:[]},o=0;o<t.length;o++)n.shapes.push(this.buildSingle(t[o],i));return n},t.buildSingle=function(t,e){for(var i=this._prepareVertx(t.shape,e),n=new s.Convex({vertices:i}),o=s.vec2.clone(n.centerOfMass),r=0;r!==n.vertices.length;r++){var a=n.vertices[r];s.vec2.sub(a,a,o)}return n.updateTriangles(),n.updateCenterOfMass(),n.updateBoundingRadius(),s.vec2.sub(n.position,o,[e.x,e.y]),n},t._prepareVertx=function(t,e){for(var i=[],n=0;n<t.length;n+=2)i.push([e.w-t[n]*r.PIXEL_TO_METR*e.sx,e.h-t[n+1]*r.PIXEL_TO_METR*e.sy]);return i},t}();i.CustomShapeBuilder=n},{"../physics/constants":116,p2:33}],69:[function(t,e,i){"use strict";var n,o,r,a,s,h=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});var l=h(t("./shapes.json"));i.ObjectType={BOOKS:{BOOK_BIG:"books/big three",BOOK_MIDDLE:"books/one back big",BOOK_MINI:"books/one small"},SCROLLS:{LONG:"scrolls/long",ZAG:"scrolls/zagogulinka",ZAG_FLIP:"zagogulinka flip"},ADDITS:{OPENED_BOOK:"addits/opened book",GLASSES:"addits/glasses"}},i.VARIANTS=((n={})[i.ObjectType.BOOKS.BOOK_BIG]=9,n[i.ObjectType.BOOKS.BOOK_MIDDLE]=9,n[i.ObjectType.BOOKS.BOOK_MINI]=3,n[i.ObjectType.SCROLLS.ZAG]=5,n[i.ObjectType.ADDITS.OPENED_BOOK]=3,n),i.GameConfig={defaulFree:7,keyboardSpeed:100,objectMoveSpeed:200,objectRotateTime:.08,doubleTapDelay:250,shapes:l.default,mass:(o={},o[i.ObjectType.BOOKS.BOOK_BIG]=3,o[i.ObjectType.BOOKS.BOOK_MIDDLE]=2,o[i.ObjectType.BOOKS.BOOK_MINI]=1,o[i.ObjectType.SCROLLS.LONG]=2,o[i.ObjectType.SCROLLS.ZAG]=2,o[i.ObjectType.ADDITS.GLASSES]=.75,o[i.ObjectType.ADDITS.OPENED_BOOK]=1,o),levels:[{free:4,stackToWin:30,maxDrops:50,gravity:-10,probs:(r={},r[i.ObjectType.BOOKS.BOOK_BIG]=.3,r[i.ObjectType.BOOKS.BOOK_MIDDLE]=.2,r[i.ObjectType.BOOKS.BOOK_MINI]=.15,r[i.ObjectType.ADDITS.OPENED_BOOK]=.05,r[i.ObjectType.ADDITS.GLASSES]=.05,r[i.ObjectType.SCROLLS.LONG]=.1,r[i.ObjectType.SCROLLS.ZAG]=.1,r[i.ObjectType.SCROLLS.ZAG_FLIP]=.1,r)},{free:5,stackToWin:40,maxDrops:50,gravity:-15,probs:(a={},a[i.ObjectType.BOOKS.BOOK_BIG]=.3,a[i.ObjectType.BOOKS.BOOK_MIDDLE]=.2,a[i.ObjectType.BOOKS.BOOK_MINI]=.1,a[i.ObjectType.ADDITS.OPENED_BOOK]=.05,a[i.ObjectType.ADDITS.GLASSES]=.05,a[i.ObjectType.SCROLLS.LONG]=.1,a[i.ObjectType.SCROLLS.ZAG]=.1,a[i.ObjectType.SCROLLS.ZAG_FLIP]=.1,a)},{free:6,stackToWin:50,maxDrops:50,gravity:-20,probs:(s={},s[i.ObjectType.BOOKS.BOOK_BIG]=.2,s[i.ObjectType.BOOKS.BOOK_MIDDLE]=.2,s[i.ObjectType.BOOKS.BOOK_MINI]=.1,s[i.ObjectType.ADDITS.OPENED_BOOK]=.075,s[i.ObjectType.ADDITS.GLASSES]=.075,s[i.ObjectType.SCROLLS.LONG]=.1,s[i.ObjectType.SCROLLS.ZAG]=.1,s[i.ObjectType.SCROLLS.ZAG_FLIP]=.1,s)}]}},{"./shapes.json":73}],70:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("p2"),a=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t.stack=[],t}return o(t,i),t.prototype.setBody=function(t){var e=i.prototype.setBody.call(this,t);return this.body.allowSleep=!0,this.body.sleepSpeedLimit=.05,this.body.sleepTimeLimit=1,this.body.angularDamping=.3,e},Object.defineProperty(t.prototype,"freeze",{get:function(){return this.body.type==r.Body.STATIC},set:function(t){t?(this.body.type=r.Body.STATIC,this.body.setZeroForce(),r.vec2.set(this.body.velocity,0,0),this.body.angularVelocity=0,this.body.updateMassProperties(),this.tint=8421504):(this.body.type=r.Body.DYNAMIC,this.body.updateMassProperties())},enumerable:!0,configurable:!0}),t.prototype.destroy=function(t){this.body&&this.body.world&&this.body.world.removeBody(this.body),i.prototype.destroy.call(this,t)},t}(PIXI.Sprite);i.PhysicSprite=a},{p2:33}],71:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Assets"),o=t("../shared/M2"),c=t("./GameConfig"),u=t("./CustomShapeBuilder"),d=t("./Object"),r=function(){function t(t,e){this._tex=t[n.Assets.Assets["game-atlas"].name].textures,this._parent=e}return t.prototype.createObject=function(t,e,i){void 0===i&&(i=.5);var n=t==c.ObjectType.SCROLLS.ZAG_FLIP;n&&(t=c.ObjectType.SCROLLS.ZAG);var o=this.getRandomTexture(t);n&&(o=new PIXI.Texture(o.baseTexture,o.frame,o.orig,o.trim,12|o.rotate));var r=t.slice(t.indexOf("/")+1);n&&(r+=" flip");var a=c.GameConfig.shapes[r],s=new d.PhysicSprite(o);if(s.name=t,s.anchor.set(.5),s.scale.set(i),s.setBody({mass:c.GameConfig.mass[t]||1,boundsToShape:null==a}),a)for(var h=0,l=u.CustomShapeBuilder.build(a,s).shapes;h<l.length;h++){var p=l[h];s.body.addShape(p,p.position)}return e&&(s.x=e.x,s.y=e.y,s.body.update()),this._parent&&this._parent.addChild(s),s},t.prototype.getRandomTexture=function(t){var e=c.VARIANTS[t],i=t;e&&(i+=" "+(1+o.M2.randint(e)));return i+=".png",console.log(i),this._tex[i]},t}();i.ObjectBuilder=r},{"../shared/M2":134,"./Assets":67,"./CustomShapeBuilder":68,"./GameConfig":69,"./Object":70}],72:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});var a=t("../shared/BaseGame"),s=t("../shared/APIData"),h=t("../physics/PhysicContainer"),l=t("./Assets"),p=t("./ObjectBuider"),c=t("./GameConfig"),u=t("../shared/M2"),d=t("../shared/ui/Popup"),f=t("../shared/CrossplatformInputHandler"),y=t("../physics/constants"),m=t("@tweenjs/tween.js"),g=r(t("p2")),v=t("p2"),b=t("../shared/ui/IUIListener"),_=function(e){function t(){var t=e.call(this)||this;return t.target=new PIXI.Point,t._pool=[],t._freeSize=0,t._stackSize=0,t._drops=0,t._lastFingerId=-1,t._lastTapTime=-1,t._tapRegister=-1,t._latesPosition=new PIXI.Point,t._wasMoved=!1,t._tapState=[],t._poolUpdateTrotling=0,t.input=new f.InputHandler(!1,!1),t.apiData=new s.APIData("Balance",t),t.stage=new PIXI.Container,t.physics=new h.PhysicContainer({gravity:[0,-20]}),t.physics.world.setGlobalRelaxation(20),t.physics.world.defaultContactMaterial.friction=2,t.physics.world.sleepMode=g.default.World.BODY_SLEEPING,t.loader=new PIXI.Loader(l.Assets.BaseDir),t}return o(t,e),Object.defineProperty(t.prototype,"totalStackSize",{get:function(){return this._freeSize-this.totatlDrops},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totatlDrops",{get:function(){return this._drops},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this.app=t,this.gameState.on("enter",this.onStateEnter,this),this.ui=this.app.uiManager,this.lang=this.app.multilang.getTextBase("Balance"),this.ui.setOptions({showArrows:!1,showProgress:!1,level:this.apiData.lastOpenedLevel,levelHint:this.lang.levels[0],progressHint:this.lang.progress[0]}),this.ui.popup.show(d.PopupType.START,!0),this.physics.y=t.height,this._res=this.loader.resources,this._spawner=new p.ObjectBuilder(this._res,this.physics),this._bg=new PIXI.TilingSprite(this._res.bg0.texture),this._bg.width=t.width,this._bg.height=t.height,this.registerInput(),this.physics.world.on("beginContact",this.onBeginContact,this),this.stage.addChild(this._bg,this.physics),this.app.uiManager.hint.open(this.lang.hello),e.prototype.init.call(this,t),e.prototype.start.call(this)},t.prototype.preload=function(){return this.loader.add(Object.values(l.Assets.Assets)),e.prototype.preload.call(this)},t.prototype.setLevel=function(t){this.apiData.current=t,this._levelData=c.GameConfig.levels[t-1],this.physics.world.gravity[1]=(this._levelData.gravity||-40)*y.PIXEL_TO_METR,this._bg.texture=this._res["bg"+(t-1)].texture,this.reset(),this.bookStand(),this.spawnObject(),this.gameState.current=a.GameState.GAME},t.prototype.reload=function(){this.setLevel(this.apiData.current)},t.prototype.popupOpened=function(t){t==b.IPopup.MENU&&this.app.uiManager.setOptions({showArrows:!1,level:this.apiData.lastOpenedLevel})},t.prototype.softPause=function(){return e.prototype.softPause.call(this)},t.prototype.registerInput=function(){if(u.M2.mobile)return this.stage.interactive=!0,this.stage.on("touchmove",this.onTouchMove,this),this.stage.on("touchstart",this.onTouchStart,this),this.stage.on("touchcancel",this.onTouchEnd,this),void this.stage.on("touchend",this.onTouchEnd,this)},t.prototype.onTouchMove=function(t){this.target.copyFrom(t.data.global),this.target.x=Math.max(100,Math.min(this.target.x,this.app.width-100)),this.target.x+=this.physics.pivot.x,this._wasMoved=!0},t.prototype.onTouchEnd=function(t){this._tapState[t.data.pointerId]=!1},t.prototype.onTouchStart=function(t){var e=this;if(this._tapState[t.data.pointerId]=!0,-1<this._lastTapTime){var i=t.data.originalEvent.timeStamp-this._lastTapTime;if(this._lastFingerId==t.data.pointerId&&i<c.GameConfig.doubleTapDelay)return console.log("double tap event"),this.onSpeedDown(),void clearTimeout(this._tapRegister)}var n=t.data.pointerId;this._tapRegister=setTimeout(function(){e._tapState[n]||(e.onFlip(),console.log("sigle tap event")),e._tapRegister=void 0},c.GameConfig.doubleTapDelay),this._lastFingerId=t.data.pointerId,this._lastTapTime=t.data.originalEvent.timeStamp},t.prototype.reset=function(){this.physics.pivot.set(0,0),this._pool.forEach(function(t){t.destroy()}),this._pool=[],this._stackSize=0,this._freeSize=0,this._drops=0},t.prototype.spawnObject=function(){var t={x:.5*this.app.width+this.physics.pivot.x,y:this.physics.pivot.y-this.app.height-200},e=u.M2.randKey(this._levelData.probs),i=this._spawner.createObject(e,t);i.angle=90*u.M2.randint(4),i.body.update(),this.target.x=i.x,this.currentObject=i,this._pool.push(i),this._freeSize++},t.prototype.bookStand=function(){for(var t=this.app.width/180|0,e={x:90,y:0},i=0;i<t;i++){var n=this._spawner.createObject(c.ObjectType.BOOKS.BOOK_MIDDLE,e);n.angle=90,n.body.update(),n.freeze=!0,e.x+=180,this._pool.push(n)}},t.prototype.onStateEnter=function(t){var e=this;switch(t){case a.GameState.PRE:this.ui.setOptions({showProgress:!1,progress:0,level:this.apiData.lastOpenedLevel}),this.ui.popup.open();break;case a.GameState.GAME:this.ui.setOptions({showProgress:!0,progress:0,level:this.apiData.current,progressMax:this._levelData.stackToWin}),this.ui.popup.close();break;case a.GameState.PREWIN:this.apiData.levelSucsess(),this.ui.setOptions({showProgress:!1,progress:0,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(d.PopupType.WIN),this.gameState.current=a.GameState.WIN;break;case a.GameState.LOSE:this.apiData.levelFailed(),this.ui.setOptions({showProgress:!1,progress:0,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(d.PopupType.LOSE),setTimeout(function(){e.gameState.current==a.GameState.LOSE&&(e.apiData.loosesAtRun%3==0&&e.lang.falling_3times?e.app.uiManager.hint.open(e.lang.falling_3times):e.app.uiManager.hint.open(e.lang.falling))},1e3);break;case a.GameState.WIN:setTimeout(function(){e.gameState.current==a.GameState.WIN&&e.app.uiManager.hint.open(e.lang.endings)},1e3)}},t.prototype.stop=function(){e.prototype.stop.call(this)},t.prototype.pause=function(){this.app.uiManager.onPause(),e.prototype.pause.call(this)},t.prototype.resume=function(){this.app.uiManager.onResume(),e.prototype.resume.call(this)},t.prototype.update=function(t){if(!this._isPaused){!u.M2.mobile&&this.input&&this.pcInputUpdate(t);var e=this._bg.texture;if(this._bg.tilePosition.x=-this.physics.pivot.x%e.width,this._bg.tilePosition.y=-this.physics.pivot.y%e.height,this.gameState.current==a.GameState.GAME){if(this.updateObject(t),this.physics.update(),this.ui.progress=this.totalStackSize-1,this.totalStackSize-1>=this._levelData.stackToWin)return void(this.gameState.current=a.GameState.PREWIN);if(this.totatlDrops>=this._levelData.maxDrops)return void(this.gameState.current=a.GameState.LOSE)}}},Object.defineProperty(t.prototype,"canUpdateObject",{get:function(){return void 0!==this.currentObject},enumerable:!0,configurable:!0}),t.prototype.updateObject=function(t){if(10<this._poolUpdateTrotling&&(this._drops+=this.refreshPool(),this.currentObject||this.spawnObject(),this._poolUpdateTrotling=0),this._poolUpdateTrotling++,this.canUpdateObject){var e=this.target.x-this.currentObject.x;Math.abs(e)<50?e/=50:e=Math.sign(e);var i=-e*c.GameConfig.objectMoveSpeed*y.PIXEL_TO_METR;this.currentObject.body.velocity[0]=i}},t.prototype.pcInputUpdate=function(t){this.input.update();var e=.01*c.GameConfig.keyboardSpeed*t.elapsedMS;this.target.x+=this.input.axis.x*e,this.target.y+=this.input.axis.y*e,this.target.x=Math.max(100,Math.min(this.target.x,this.app.width-100));var i=this.input.keys[32],n=0<this.input.axis.y;!this._speedDownTriggered&&n&&(this.onSpeedDown(),this._speedDownTriggered=!0),!this._flipTriggered&&i&&(this.onFlip(),this._flipTriggered=!0),this._flipTriggered=i&&this._flipTriggered,this._speedDownTriggered=n&&this._speedDownTriggered},t.prototype.refreshPool=function(){for(var t=0,e=0;0<this._pool.length&&t<this._pool.length;){var i=this._pool[t];i.getBounds(!0).top>=this.app.height?(i==this.currentObject&&(this.currentObject=void 0),i.freeze||e++,i.destroy(),this._pool.splice(t,1)):t++}return e},t.prototype.onBeginContact=function(t){var e=this._pool[this._pool.length-1].body;if(t.bodyA==e||t.bodyB==e){this._drops+=this.refreshPool(),e.velocity[0]*=.2;for(var i=void 0,n=this._levelData.free||c.GameConfig.defaulFree,o=this._pool.length-n,r=0;r<o;r++){var a=this._pool[r];if(!a.freeze&&a.body.sleepState!=v.Body.AWAKE){i=a;break}}i&&(this._stackSize++,i.freeze=!0,new m.Tween(this.physics.pivot).to({y:i.y,x:i.x-.5*this.app.width},500).start()),this.spawnObject()}},t.prototype.onFlip=function(){if(this.canUpdateObject){var t=.5*Math.PI*c.GameConfig.objectRotateTime*5;this.currentObject.body.angularVelocity=t,console.log("Flip")}},t.prototype.onSpeedDown=function(){this.canUpdateObject&&(this.currentObject.body.velocity[1]=-400*y.PIXEL_TO_METR,console.log("Speed"))},t}(a.BaseGame);i.Balance=_},{"../physics/PhysicContainer":113,"../physics/constants":116,"../shared/APIData":129,"../shared/BaseGame":131,"../shared/CrossplatformInputHandler":132,"../shared/M2":134,"../shared/ui/IUIListener":143,"../shared/ui/Popup":145,"./Assets":67,"./GameConfig":69,"./ObjectBuider":71,"@tweenjs/tween.js":1,p2:33}],73:[function(t,e,i){e.exports={"opened book":[{shape:[70,31,179,84,212,150,153,150,1,72]},{shape:[311,31,364,71,212,150,179,84]}],glasses:[{shape:[322,100,280,134,234,134,189,87,194,40,231,3,278,2,323,35]},{shape:[123,5,152,41,159,88,24,89,25,44,60,3]},{shape:[24,89,159,88,114,133,62,132]},{shape:[189,87,159,88,152,41,194,40]}],zagogulinka:[{shape:[141,236,-1,351,-3,0,147,1]},{shape:[521,355,-1,351,141,236,519,223]}],"zagogulinka flip":[{shape:[521,0,519,351,377,236,371,1]},{shape:[377,236,519,351,-3,355,-1,223]}],long:[{shape:[10,35,30,10,209,20,213,98,29,129,8,100]},{shape:[695,128,518,95,507,16,696,4,715,30,715,98]},{shape:[213,98,209,20,507,16,518,95]}]}},{}],74:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../shared/config");i.Assets={BaseDir:n.Config.BaseResDir+"/game4",Assets:{"game-atlas":{name:"game-atlas",url:"/game4-atlas.json"},bg:{name:"bg",url:"/nature.jpg"},fg:{name:"fg",url:"/foreground.png"},player:{name:"player",url:"Player/Game Character.json"}}}},{"../shared/config":137}],75:[function(t,e,i){"use strict";var n,o,r,a,s;Object.defineProperty(i,"__esModule",{value:!0}),i.ObjectType={ALIEN:"alien",NORMAL:"normal",BROKEN:"broken",METEOR:"meteor"},i.VARIANTS=((n={})[i.ObjectType.NORMAL]=4,n[i.ObjectType.BROKEN]=4,n[i.ObjectType.METEOR]=4,n[i.ObjectType.ALIEN]=3,n),i.GameConfig={playerSpeed:10,deltaMult:.75,speedMult:1.5,costs:(o={},o[i.ObjectType.NORMAL]=1,o[i.ObjectType.BROKEN]=-1,o[i.ObjectType.ALIEN]=-2,o[i.ObjectType.METEOR]=-3,o),levels:[{spavnDelta:1.5,catchsToWin:30,dropsToLoose:50,maxDistance:500,fallingSpeed:30,probs:(r={},r[i.ObjectType.NORMAL]=.6,r[i.ObjectType.BROKEN]=.2,r[i.ObjectType.ALIEN]=.1,r[i.ObjectType.METEOR]=.1,r)},{spavnDelta:1.25,catchsToWin:50,dropsToLoose:50,maxDistance:700,fallingSpeed:40,probs:(a={},a[i.ObjectType.NORMAL]=.5,a[i.ObjectType.BROKEN]=.3,a[i.ObjectType.ALIEN]=.1,a[i.ObjectType.METEOR]=.1,a)},{spavnDelta:1,catchsToWin:80,dropsToLoose:50,maxDistance:800,fallingSpeed:45,probs:(s={},s[i.ObjectType.NORMAL]=.5,s[i.ObjectType.BROKEN]=.3,s[i.ObjectType.ALIEN]=.15,s[i.ObjectType.METEOR]=.15,s)}]}},{}],76:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("p2"),a=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return o(t,i),t.prototype.setBody=function(t){var e=i.prototype.setBody.call(this,t);return this.body.allowSleep=!0,this.body.sleepSpeedLimit=.05,this.body.sleepTimeLimit=1,this.body.shapes[0].sensor=!0,e},Object.defineProperty(t.prototype,"freeze",{get:function(){return this.body.type==r.Body.STATIC},set:function(t){t?(this.body.type=r.Body.STATIC,this.body.setZeroForce(),r.vec2.set(this.body.velocity,0,0),this.body.angularVelocity=0,this.body.updateMassProperties(),this.tint=8421504):(this.body.type=r.Body.DYNAMIC,this.body.updateMassProperties())},enumerable:!0,configurable:!0}),t.prototype.removeBody=function(){this.body&&this.body.world&&this.body.world.removeBody(this.body)},t.prototype.destroy=function(t){this.removeBody(),i.prototype.destroy.call(this,t)},t}(PIXI.Sprite);i.PhysicSprite=a},{p2:33}],77:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Assets"),o=t("../shared/M2"),r=t("./GameConfig"),a=t("./Object"),s=function(){function t(t,e){this._tex=t[n.Assets.Assets["game-atlas"].name].textures,this._parent=e}return t.prototype.createObject=function(t,e,i){void 0===i&&(i=1);var n=this.getRandomTexture(t),o=new a.PhysicSprite(n);return o.name=t,o.anchor.set(.5),o.scale.set(i),o.type=t,o.setBody({mass:1}),e&&(o.x=e.x,o.y=e.y,o.body.update()),this._parent&&this._parent.addChild(o),o},t.prototype.getRandomTexture=function(t){var e=r.VARIANTS[t],i=t;e&&(i+=" "+(1+o.M2.randint(e)));return i+=".png",this._tex[i]},t}();i.ObjectBuilder=s},{"../shared/M2":134,"./Assets":74,"./GameConfig":75,"./Object":76}],78:[function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var a,o,s=t("./Assets");(o=a=i.PlayerAnimPhase||(i.PlayerAnimPhase={})).NONE="none",o.JUMP="Jump",o.LOSE="Lose",o.WIN="Win",o.DAMAGE="Damage",o.WALK="Walk";var h=function(o){function t(t){var e=o.call(this)||this;e.safeArea=new PIXI.Rectangle(0,0,100,100),e.lockMovement=!1,e._lastAnim=a.NONE;var i=t[s.Assets.Assets.player.name].spineData,n=new PIXI.spine.Spine(i);return n.state.timeScale=1,e.anim=n,e.addChild(n),e.startHeight=e.height,e}return r(t,o),t.prototype.getSlotSprite=function(t){var e=this.anim.skeleton.findSlot(t);if(e)return e.currentSprite},Object.defineProperty(t.prototype,"face",{set:function(t){0<t?this.anim.scale.x=1:t<0&&(this.anim.scale.x=-1)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.animPhase(a.NONE),this.lockMovement=!1},t.prototype.animPhase=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=1),this._lastAnim!=t){if(t==a.NONE)this.anim.state.setEmptyAnimation(0,.75);else this.anim.state.setAnimation(0,t,e).mixDuration=.5;this.anim.state.timeScale=i,this._lastAnim=t}},t.prototype.update=function(){},t.prototype.damaged=function(){this.lockMovement=!0,this.animPhase(a.DAMAGE,!1)},t.prototype.move=function(t){this.face=-t;var e=this.x+t;Math.abs(t)<1||e<this.safeArea.left||e>this.safeArea.right?this.animPhase(a.NONE,!0):this.animPhase(a.WALK,!0,4),this.x=Math.max(this.safeArea.left,Math.min(this.safeArea.right,e)),this.lockMovement},t}(PIXI.Container);i.Player=h},{"./Assets":74}],79:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});var a=t("../shared/BaseGame"),s=t("../shared/APIData"),l=t("../physics/PhysicContainer"),p=t("./Assets"),c=t("./ObjectBuider"),u=t("./GameConfig"),d=t("../shared/M2"),f=t("../shared/ui/Popup"),y=t("../shared/ui/UiManager"),m=t("../shared/CrossplatformInputHandler"),g=t("../physics/constants"),v=r(t("p2")),b=t("./Player"),_=t("../shared/FrontSprite"),w=t("p2"),P=t("../shared/ui/IUIListener"),h=function(h){function t(){var t=h.call(this)||this;return t.target=new PIXI.Point,t.spawnOffset=100,t._pool=[],t._bucketPool=[],t._freeSize=0,t._stackSize=0,t._drops=0,t.catched=0,t._nextSpawnTime=-1,t.input=new m.InputHandler(!1,d.M2.mobile),t.apiData=new s.APIData("Catcher",t),t.stage=new PIXI.Container,t.physics=new l.PhysicContainer({gravity:[0,-20]}),t.physics.sortableChildren=!0,t.physics.world.setGlobalRelaxation(20),t.physics.world.defaultContactMaterial.friction=2,t.physics.world.sleepMode=v.default.World.BODY_SLEEPING,t.loader=new PIXI.Loader(p.Assets.BaseDir),t}return o(t,h),Object.defineProperty(t.prototype,"totatlDrops",{get:function(){return this._drops},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this.app=t,this.gameState.on("enter",this.onStateEnter,this),this.lang=this.app.multilang.getTextBase("Catcher"),this.ui=this.app.uiManager,this.ui.setOptions({showArrows:!1,showProgress:!1,level:this.apiData.lastOpenedLevel,controlLayout:y.ControlsLayout.HOR,levelHint:this.lang.levels[0],progressHint:this.lang.progress[0]}),this.input.mobileControlls=this.ui.controls,this.ui.popup.show(f.PopupType.START,!0),this._res=this.loader.resources,this._spawner=new c.ObjectBuilder(this._res,this.physics);var e=d.M2.mobile?300:120;this.player=new b.Player(this._res),this.player.scale.set(1.5),this.player.safeArea=new PIXI.Rectangle(160,0,t.width-320,t.height),this.player.position.set(.5*t.width,t.height-e);var i=this.player.getSlotSprite("basket front");this.bucket=new _.FrontSprite(i),this.bucket.texture=PIXI.Texture.EMPTY,this.bucket.zIndex=99,this.bucket.sortableChildren=!0;var n=new PIXI.Sprite(i.texture);n.anchor.set(.5),n.zIndex=10,this.bucket.addChild(n);var o=new w.Box({width:g.PIXEL_TO_METR*i.width,height:g.PIXEL_TO_METR*i.height});this.bucket.setBody({type:w.Body.KINEMATIC,mass:1,shape:o,boundsToShape:!1});var r=new _.FrontSprite(this.player.getSlotSprite("Hand Left"));r.zIndex=100,this.physics.addChild(this.player,this.bucket,r),this.app.renderer.backgroundColor=6165;var a=new PIXI.Sprite(this._res.fg.texture);a.scale.set(t.width/a.texture.width),a.anchor.set(0,1),a.y=t.height+300-e,this.spawnOffset=t.height-a.height;var s=new PIXI.Sprite(this._res.bg.texture);s.scale.set(t.width/s.texture.width),s.anchor.set(0,1),s.y=a.y-240,this.physics.world.on("beginContact",this.onBeginContact,this),this.stage.addChild(s,this.physics,a),this.app.uiManager.hint.open(this.lang.hello),h.prototype.init.call(this,t),h.prototype.start.call(this)},t.prototype.preload=function(){return this.loader.add(Object.values(p.Assets.Assets)),h.prototype.preload.call(this)},t.prototype.reset=function(){this.physics.pivot.set(0,0),this._pool.forEach(function(t){t.destroy()}),this._pool=[],this._bucketPool.forEach(function(t){t.destroy()}),this._bucketPool=[],this.player.reset(),this.player.x=.5*this.app.width,this._lastX=.5*this.app.width,this.catched=0,this._stackSize=0,this._freeSize=0,this._drops=0},t.prototype.setLevel=function(t){this.apiData.current=t,this._levelData=u.GameConfig.levels[t-1],this.physics.world.gravity[1]=-this._levelData.fallingSpeed*g.PIXEL_TO_METR,this.reset(),this.gameState.current=a.GameState.GAME},t.prototype.reload=function(){this.setLevel(this.apiData.current)},t.prototype.popupOpened=function(t){t==P.IPopup.MENU&&this.app.uiManager.setOptions({showArrows:!1,level:this.apiData.lastOpenedLevel})},t.prototype.softPause=function(){return h.prototype.softPause.call(this)},t.prototype.spawnObject=function(t){if(!(0<this._nextSpawnTime&&t.lastTime<this._nextSpawnTime)){var e=this.catched/this._levelData.catchsToWin,i=Math.pow(u.GameConfig.deltaMult,e)*this._levelData.spavnDelta;this._nextSpawnTime=t.lastTime+1e3*i;var n=this.player.safeArea;this._lastX+=(2*Math.random()-1)*this._levelData.maxDistance,this._lastX>n.right?this._lastX=2*n.right-this._lastX:this._lastX<n.left&&(this._lastX=2*n.left-this._lastX);var o={x:this._lastX,y:100+this.spawnOffset},r=d.M2.randKey(this._levelData.probs),a=this._spawner.createObject(r,o,.75);a.body.update(),this._pool.push(a),this._freeSize++}},t.prototype.onStateEnter=function(t){var e=this;switch(t){case a.GameState.PRE:this.ui.setOptions({showProgress:!1,progress:0,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(f.PopupType.START);break;case a.GameState.GAME:this.ui.setOptions({showProgress:!0,progress:0,showArrows:d.M2.mobile,level:this.apiData.current,progressMax:this._levelData.catchsToWin}),this.ui.progress=0;break;case a.GameState.PREWIN:this.apiData.levelSucsess(),this.ui.setOptions({showProgress:!1,progress:0,showArrows:!1,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(f.PopupType.WIN),this.player.animPhase(b.PlayerAnimPhase.WIN,!0,1),this.gameState.current=a.GameState.WIN;break;case a.GameState.WIN:setTimeout(function(){e.gameState.current===a.GameState.WIN&&e.ui.hint.open(e.lang.endings)},1e3);break;case a.GameState.LOSE:this.apiData.levelFailed(),this.ui.setOptions({showProgress:!1,progress:0,showArrows:!1,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(f.PopupType.LOSE),this.player.animPhase(b.PlayerAnimPhase.LOSE,!0,1),setTimeout(function(){if(e.gameState.current===a.GameState.LOSE){var t=e.apiData.loosesAtRun%3==0&&0<e.apiData.loosesAtRun&&e.lang.falling_3times;e.ui.hint.open(t?e.lang.falling_3times:e.lang.falling)}},1e3)}},t.prototype.stop=function(){h.prototype.stop.call(this)},t.prototype.pause=function(){this.app.uiManager.onPause(),h.prototype.pause.call(this)},t.prototype.resume=function(){this.app.uiManager.onResume(),h.prototype.resume.call(this)},t.prototype.update=function(t){if(!this._isPaused&&(this.input.update(),this.flush(),this.physics.update(),this.gameState.current==a.GameState.GAME)){this.spawnObject(t);var e=this.input.axis.x*u.GameConfig.playerSpeed*t.deltaTime;this.player.move(e)}},t.prototype.flush=function(){for(var t=this._pool.length-1;0<=t;t--)this._pool[t].y>this.app.height&&this._pool.splice(t,1)[0].destroy()},t.prototype.animateDrop=function(t,e){t.destroy(),this._pool.splice(this._pool.indexOf(t),1);for(var i=Math.min(Math.abs(e),this._bucketPool.length)-1;0<=i;i--){var n=this._bucketPool[i];this._bucketPool.splice(i,1),n&&n.transform&&(n.setBody({mass:1}),n.body.shapes[0].collisionGroup=0,n.zIndex=150,n.position.x+=this.bucket.x,n.position.y+=this.bucket.y,n.scale.set(this.bucket.scale.x),this._pool.push(n),this.physics.addChild(n),n.body.applyImpulse([d.M2.rand(100*-g.PIXEL_TO_METR,100*g.PIXEL_TO_METR),400*g.PIXEL_TO_METR]))}},t.prototype.animateCatch=function(t){this._pool.splice(this._pool.indexOf(t),1),this._bucketPool.push(t),t.removeBody(),this.bucket.addChild(t),t.scale.set(1),t.position.set(d.M2.rand(-40,40),d.M2.rand(-50,-80)),t.rotation=d.M2.rand(-Math.PI/6,Math.PI/6)},t.prototype.onBeginContact=function(t){if(this.gameState.current===a.GameState.GAME){var e=this.bucket.body;if(t.bodyA==e||t.bodyB==e){var i=(e==t.bodyA?t.bodyB:t.bodyA).display,n=u.GameConfig.costs[i.type];n<0?this.animateDrop(i,-n):this.animateCatch(i),this.catched+=n,this.ui.progress=this.catched,this.catched>=this._levelData.catchsToWin?this.gameState.current=a.GameState.PREWIN:this.catched<0&&(this.gameState.current=a.GameState.LOSE)}}},t}(a.BaseGame);i.Catcher=h},{"../physics/PhysicContainer":113,"../physics/constants":116,"../shared/APIData":129,"../shared/BaseGame":131,"../shared/CrossplatformInputHandler":132,"../shared/FrontSprite":133,"../shared/M2":134,"../shared/ui/IUIListener":143,"../shared/ui/Popup":145,"../shared/ui/UiManager":147,"./Assets":74,"./GameConfig":75,"./ObjectBuider":77,"./Player":78,p2:33}],80:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../shared/config");i.Assets={BaseDir:n.Config.BaseResDir+"/game0/",Assets:{"game-atlass":{name:"game-atlass",url:"./game0-atlas.json"},"back-tile":{name:"back-tile",url:"./tile.jpg"},player:{name:"player",url:"./Animate/Game Character/Game Character.json"},bricable:{name:"bricable",url:"./Animate/Platform/Game Platform.json"},monster:{name:"monster",url:"./Animate/Monster/Monster.json"}}}},{"../shared/config":137}],81:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r,a,s=t("p2"),h=t("../physics/constants"),l=t("@tweenjs/tween.js"),p=t("./GameConfig");(a=r=i.BonusObjectType||(i.BonusObjectType={})).MONSTER="monster",a.COIN="coins",a.SPIKES="spikes",a.BALL="ball",a.NONE="none";var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.interract=function(){},e.prototype.reset=function(){},e.prototype.update=function(t){},e}(PIXI.Container),u=function(i){function t(t){var e=i.call(this)||this;return e._sprite=new PIXI.Sprite(t),e._sprite.anchor.set(.5,.5),e.addChild(e._sprite),e.setBody({}),e.body.shapes[0].collisionGroup=p.GameConfig.groups.BONUSES,e.body.shapes[0].collisionMask=p.GameConfig.groups.PLAYER,e.body.shapes[0].sensor=!0,e.type=r.COIN,e}return o(t,i),t.prototype.interract=function(){this.visible=!1,this.type=r.NONE},t.prototype.reset=function(){this.visible=!0,this.type=r.COIN},t}(i.BonusObject=c);i.Coins=u;var d=function(i){function t(t){var e=i.call(this)||this;return e._sprite=new PIXI.Sprite(t),e._sprite.anchor.set(.5,.5),e.addChild(e._sprite),e.setBody({boundsToShape:!1,shape:new s.Circle({radius:.4*e._sprite.width*h.PIXEL_TO_METR})}),e.body.shapes[0].collisionGroup=p.GameConfig.groups.BONUSES,e.body.shapes[0].collisionMask=p.GameConfig.groups.PLAYER,e.body.shapes[0].sensor=!0,e.type=r.BALL,e}return o(t,i),t.prototype.interract=function(){},t.prototype.reset=function(){},t}(c);i.Ball=d;var f=function(n){function t(t){var e=n.call(this)||this,i=new PIXI.Sprite(t);return i.anchor.set(.5,1),i.y=30,e._sprite=i,e.addChild(i),e.type=r.SPIKES,e.setBody({}),e.body.shapes[0].collisionGroup=p.GameConfig.groups.BONUSES,e.body.shapes[0].collisionMask=p.GameConfig.groups.PLAYER,e.body.shapes[0].sensor=!0,e}return o(t,n),t.prototype.interract=function(){var t=this,e=this._sprite.scale.y;new l.Tween(this._sprite.scale).to({y:2},250).onComplete(function(){t._sprite.scale.y=e}).start()},t.prototype.reset=function(){},t}(c);i.Spikes=f;var y=function(n){function t(t){var e=n.call(this)||this;e.type=r.MONSTER,e._anim=new PIXI.spine.Spine(t),e._anim.position.y+=e._anim.height,e._anim.state.setAnimation(0,"Walk",!0),e.addChild(e._anim);var i=new s.Box({width:150*h.PIXEL_TO_METR,height:150*h.PIXEL_TO_METR});return e.setBody({boundsToShape:!1}),i.sensor=!0,i.collisionGroup=p.GameConfig.groups.BONUSES,i.collisionMask=p.GameConfig.groups.PLAYER,e.body.addShape(i,[0,-h.PIXEL_TO_METR*e._anim.height*.5]),e}return o(t,n),t.prototype.interract=function(){},t.prototype.reset=function(){},t.prototype.update=function(t){},t}(c);i.Monster=y},{"../physics/constants":116,"./GameConfig":83,"@tweenjs/tween.js":1,p2:33}],82:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Platform"),a=t("p2"),s=t("./GameConfig"),h=t("../physics/constants"),l=t("@tweenjs/tween.js"),p=t("./BonusObject"),c=function(n){function t(t,e){var i=n.call(this)||this;return i._animation=new PIXI.spine.Spine(t),i._animation.y+=.5*i._animation.height,i._animation.state.timeScale=2,i.addChild(i._animation),e&&(i._cloud=new PIXI.Sprite(e),i._cloud.anchor.set(.5),i._cloud.y=.5*i._cloud.height,i.addChild(i._cloud)),i.setBody({boundsToShape:!1,type:a.Body.STATIC,mass:2,shape:new a.Box({width:s.GameConfig.platformWidth*h.PIXEL_TO_METR,height:s.GameConfig.platformHeight*h.PIXEL_TO_METR})}),i.body.shapes[0].collisionGroup=s.GameConfig.groups.PLATFORM,i.body.shapes[0].collisionMask=s.GameConfig.groups.PLAYER,i.solid=!0,i}return o(t,n),Object.defineProperty(t.prototype,"top",{get:function(){return this.y-.5*this._animation.height},enumerable:!0,configurable:!0}),t.prototype.interract=function(){var t=this;this.solid=!1,this.type=s.PlatformType.DISABLED,this.visible&&(this._animation.state.setAnimation(0,"Platform 1",!1),this._animation.state.addListener({complete:function(){t.visible=!1}}),this._cloud&&new l.Tween(this._cloud).to({alpha:0},500).start(),this.child&&(this.child.visible=!1,this.child.type=p.BonusObjectType.NONE))},Object.defineProperty(t.prototype,"solid",{get:function(){return this.body&&this.body.shapes[0].collisionGroup!=s.GameConfig.groups.NONE},set:function(t){this.type!=s.PlatformType.DISABLED&&this.body&&(this.body.shapes[0].collisionGroup=t?s.GameConfig.groups.PLATFORM:s.GameConfig.groups.NONE)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){n.prototype.reset.call(this),console.log("Platfrom reset"),this.visible=!0,this.type=s.PlatformType.BRICABLE,this._animation.state.clearTrack(0),this._animation.skeleton.setToSetupPose(),this._cloud&&(this._cloud.alpha=1),this.child&&(this.child.visible=!0)},t}(r.BasePlatform);i.BrickablePlatform=c},{"../physics/constants":116,"./BonusObject":81,"./GameConfig":83,"./Platform":85,"@tweenjs/tween.js":1,p2:33}],83:[function(t,e,i){"use strict";var n,o,r,a,s;Object.defineProperty(i,"__esModule",{value:!0}),(s=a=i.PlatformType||(i.PlatformType={})).DISABLED="disabled",s.NORMAL="standart",s.ICE="ice",s.STICKY="sticky",s.BRICABLE="bricable",s.ENDINGS="endings",i.GameConfig={coinCost:2,groups:{ANY:-1,PLAYER:1,PLATFORM:2,BORDER:4,BONUSES:8,NONE:0},levels:[{platforms:100,platformsMain:80,probs:(n={},n[a.ICE]=.1,n[a.STICKY]=.1,n),things:{spikes:.1,monster:.02,coins:.15,balls:.05}},{platforms:200,platformsMain:160,probs:(o={},o[a.ICE]=.2,o[a.STICKY]=.2,o[a.BRICABLE]=.1,o),things:{spikes:.05,monster:.015,coins:.15,balls:.05}},{platforms:300,platformsMain:240,probs:(r={},r[a.ICE]=.2,r[a.STICKY]=.2,r[a.BRICABLE]=.2,r),things:{spikes:.1,monster:.01,coins:.15,balls:.05}}],yDistance:{min:4,max:9},xDistance:{min:1,max:2},maxHorizontlalCount:3,borderOffsets:50,jumpHeight:11,windowsStep:1400,playerMove:200,icePlatformEffect:{duration:.05,strave:1.5},slickPlatformEffect:{mult:.75},platformHeight:70,platformWidth:260}},{}],84:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){this.childs=[],this._saveArea=new PIXI.Rectangle,this._placed=[],this._free=[]}return t.prototype.init=function(t,e){this.childs=t,this.parent=e,this._free=this.childs.slice(),this._placed=[]},Object.defineProperty(t.prototype,"safeArea",{get:function(){return this._saveArea.clone()},set:function(t){t.y==this._saveArea.y&&t.height==this._saveArea.height||(this._saveArea.copyFrom(t),this.rePulling())},enumerable:!0,configurable:!0}),t.prototype.reset=function(t){var e;void 0===t&&(t=!1),t&&(this.childs.forEach(function(t){t&&t.destroy({children:!0})}),this.childs=[],this._placed=[]),this.parent&&(e=this.parent).removeChild.apply(e,this._placed),this._free=this.childs.slice(),this._placed=[],this._saveArea.x=this._saveArea.y=this._saveArea.width=this.safeArea.height=0},t.prototype.rePulling=function(){for(var t,e=[],i=this._free.length-1;0<=i;i--){var n=(o=this._free[i]).position;this.safeArea.contains(n.x,n.y)&&(this.parent.addChild(o),e.push(o),this._free.splice(i,1))}for(i=this._placed.length-1;0<=i;i--){var o;n=(o=this._placed[i]).position;this.safeArea.contains(n.x,n.y)||(this.parent.removeChild(o),this._free.push(o),this._placed.splice(i,1))}(t=this._placed).push.apply(t,e)},t.prototype.removeItem=function(t){if(t){var e=this.childs.indexOf(t);-1<e&&this.childs.splice(e,1),-1<(e=this._free.indexOf(t))&&this._free.splice(e,1),-1<(e=this._placed.indexOf(t))&&this._placed.splice(e,1)}},Object.defineProperty(t.prototype,"placed",{get:function(){return this._placed},enumerable:!0,configurable:!0}),t}();i.LongPool=n},{}],85:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});var a=r(t("p2")),s=t("../shared/M2"),h=t("@tweenjs/tween.js"),l=t("./GameConfig"),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.interract=function(){},e.prototype.reset=function(){},e.prototype.pairBonus=function(t){this.child=t},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.child&&this.child.destroy()},e}(PIXI.Container),c=function(r){function t(t,e){var i=r.call(this)||this,n=e[t];null==n&&(t=l.PlatformType.NORMAL,n=e[l.PlatformType.NORMAL]);var o=n[s.M2.randint(n.length)];return i.type=t,i._base=new PIXI.Sprite(o),i._base.anchor.set(.5),i.addChild(i._base),i.setBody({type:a.default.Body.STATIC}),i.body.shapes[0].collisionGroup=l.GameConfig.groups.PLATFORM,i.body.shapes[0].collisionMask=l.GameConfig.groups.PLAYER,i.solid=!0,i}return o(t,r),Object.defineProperty(t.prototype,"top",{get:function(){return this.y-.5*this.height},enumerable:!0,configurable:!0}),t.prototype.interract=function(){var e=this,i={val:0},n=this._base.y,o=this.child?this.child.y:0;new h.Tween(i).to({val:1},500).onUpdate(function(){var t=40*Math.sin(i.val*Math.PI*2)*(1-i.val);e._base.y=n+t,e.child&&(e.child.y=o+t)}).start()},Object.defineProperty(t.prototype,"solid",{get:function(){return this.body&&this.body.shapes[0].collisionGroup!=l.GameConfig.groups.NONE},set:function(t){this.body&&(this.body.shapes[0].collisionGroup=t?l.GameConfig.groups.PLATFORM:l.GameConfig.groups.NONE)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){},t}(i.BasePlatform=p);i.Platform=c},{"../shared/M2":134,"./GameConfig":83,"@tweenjs/tween.js":1,p2:33}],86:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=t("./BrickablePlatform"),h=t("./Assets"),l=t("./Platform"),p=t("./GameConfig"),n=function(){function t(t,e){this._res=t,this._app=e}return t.prototype.Single=function(t){var e,i=this._res[h.Assets.Assets["game-atlass"].name].textures,n=this.level,o=null,r=((e={})[p.PlatformType.NORMAL]=[i["standart_trapes.png"]],e[p.PlatformType.ENDINGS]=[i["standart_colored.png"]],e[p.PlatformType.ICE]=[i["ice.png"]],e[p.PlatformType.STICKY]=[i["sticky_colored.png"]],e);switch(n){case 2:r[p.PlatformType.NORMAL]=[i["standart_colored.png"]].concat(r[p.PlatformType.NORMAL]),r[p.PlatformType.ENDINGS]=[i["standart.png"]];break;case 3:r[p.PlatformType.NORMAL]=[i["standart.png"]],r[p.PlatformType.STICKY]=[i["sticky.png"]],r[p.PlatformType.ENDINGS]=[i["standart.png"]],o=i["cloud.png"]}switch(t){case p.PlatformType.BRICABLE:var a=this._res[h.Assets.Assets.bricable.name].spineData;return new s.BrickablePlatform(a,o);default:return new l.Platform(t,r)}},t.prototype.Line=function(t,e){for(var i=this._app.width-2*p.GameConfig.borderOffsets,n=Math.floor(i/p.GameConfig.platformWidth),o=i/n,r=[],a=0;a<n;a++){var s=this.Single(e),h=p.GameConfig.borderOffsets+(a+.5)*o;s.position.set(h,t),r.push(s)}return r},t}();i.PlatformBuilder=n},{"./Assets":80,"./BrickablePlatform":82,"./GameConfig":83,"./Platform":85}],87:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var U=t("./GameConfig"),W=t("./BonusObject"),r=function(t){function e(){return t.call(this)||this}return o(e,t),e.prototype.genRnd=function(t){var e=t.probs,i=Math.random();for(var n in e){if(i<e[n])return n;i-=e[n]}return U.PlatformType.NORMAL},e.prototype.genNotMatchingRnd=function(t,e){var i=this.genRnd(t);return i===e&&(i=this.genRnd(t)),i},e.prototype.genREALLYNotMatchingRnd=function(t,e,i){for(var n=null;(n=this.genRnd(t))===e&&(n=this.genRnd(t)),n===i;);return n},e.prototype.unfoldVariant=function(t){return{variant:t,things:W.BonusObjectType.NONE}},e.prototype.populate=function(t){for(var e=[],i=(U.GameConfig.maxHorizontlalCount,this.screenSize.width-2*U.GameConfig.borderOffsets),n=this.screenSize.width-U.GameConfig.borderOffsets-this.psize.width/2,o=U.GameConfig.borderOffsets+this.psize.width/2,r={pos:{x:(o+n)/2,y:0},variant:U.PlatformType.NORMAL,restrictHorizontal:!1},a=t.platformsMain,s=t.platforms,h=0;h<a;h++){var l=2*(2*Math.random()|0)-1;if(r.variant!==U.PlatformType.ICE&&!r.restrictHorizontal){var p=r.pos.x+l*this.psize.width*(.8*Math.random()+1.6);if(o<=p&&p<=n){var c=this.unfoldVariant(this.genNotMatchingRnd(t,r.variant)),u=c.variant,d=c.things,f={pos:{x:p,y:r.pos.y+(3*Math.random()|0)*this.psize.height},variant:u,things:d,restrictHorizontal:!0};e.push(f),r=f;continue}}r.pos.x<o+.5*this.psize.width&&(l=1),r.pos.x>n-.5*this.psize.width&&(l=-1);var y=this.psize.width,m=r.pos.x+l*(Math.random()*y);r.variant===U.PlatformType.ICE&&(m+=3*l*this.psize.width),m<o&&(m=o),n<m&&(m=n);var g=.7*U.GameConfig.jumpHeight;r.variant===U.PlatformType.STICKY&&(g/=2),r.variant===U.PlatformType.ICE&&(g/=1.5);var v=r.pos.y+Math.max(0,g-(2*Math.random()|0))*this.psize.height,b=this.unfoldVariant(this.genNotMatchingRnd(t,r.variant)),_={pos:{x:m,y:v},variant:b.variant,things:b.things,restrictHorizontal:!1};e.push(_),r=_}var w=r.pos.y+this.psize.height,P=w/this.psize.height|0,A=[];for(h=a;h<s;h++){for(var x=-1,E=-1,M=0,S=0;S<100;S++){for(var I=Math.random()*(n-o)+o,T=(5+(Math.random()*(P-5)|0))*this.psize.height,C=1e9,O=0;O<h;O++){var B=e[O].pos.x,L=e[O].pos.y,R=(B-I)*(B-I)*4+(L-T)*(L-T);C=Math.min(C,R)}M<C&&(M=C,x=I,E=T)}var N=this.unfoldVariant(this.genNotMatchingRnd(t,r.variant));_={pos:{x:x,y:E},variant:N.variant,things:N.things,restrictHorizontal:!1};e.push(_),A.push(_)}A.sort(function(t,e){var i=t.pos.y,n=e.pos.y;return n<i?1:i<n?-1:0});for(h=a;h<s;h++)e[h]=A[h-a];e.sort(function(t,e){var i=t.pos.y,n=e.pos.y;return n<i?1:i<n?-1:0});var D=Math.round(s*t.things.coins),G=Math.round(A.length/2);this.populateExtra(A,W.BonusObjectType.COIN,A.length/4|0,G,D);for(var k=0<D?e[e.length-D*U.GameConfig.coinCost].pos.y:w+100,j=A.length-1;0<=j&&A[j].pos.y>=k;)j--;var V=Math.round(A.length/4),F=Math.round(s*t.things.monster);this.populateExtra(A,W.BonusObjectType.MONSTER,j+1-V,F,V);var X=Math.round(s*t.things.balls);this.spawnMoreShit(A,W.BonusObjectType.BALL,X,10);var q=Math.round(s*t.things.spikes);return this.spawnMoreShit(e,W.BonusObjectType.SPIKES,q,5),{data:e,width:i,height:w}},e.prototype.populateExtra=function(t,e,i,n,o){if(i+n>t.length&&(n=t.length-i),!(n<0)){for(var r=[],a=0;a<n;a++)r[a]=o<=a?0:1;this.shuffle(r);for(a=0;a<n;a++)1===r[a]&&(t[i+a].things=e)}},e.prototype.spawnMoreShit=function(t,e,i,n){for(var o=0;o<i;o++)for(var r=0;r<10;r++){var a=n+Math.random()*(t.length-n)|0;if(t[a].things===W.BonusObjectType.NONE&&!(0!==a&&t[a-1].things===e||a!==t.length-1&&t[a+1].things===e)){t[a].things=e;break}}},e.prototype.shuffle=function(t){for(var e=t,i=e.length-1;0<=i;i--){var n=Math.floor(Math.random()*(i+1)),o=e[n];e[n]=e[i],e[i]=o}return e},e}(t("./PlatformPopulator").PlatformPopulator);i.PlatformPopelyshev=r},{"./BonusObject":81,"./GameConfig":83,"./PlatformPopulator":88}],88:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var P=t("./GameConfig"),A=t("../shared/M2"),x=t("./BonusObject"),n=function(){function t(){this.variants=[]}return t.prototype.populate=function(t){var e=[],i=0,n=P.GameConfig.maxHorizontlalCount,o=P.GameConfig.yDistance.min*this.psize.height,r=(P.GameConfig.yDistance.max-P.GameConfig.yDistance.min)*this.psize.height,a=this.screenSize.width-2*P.GameConfig.borderOffsets,s=1,h=[],l=t.platforms;for(var p in t.probs)for(var c=0;c<Math.floor(t.probs[p]*l);c++)h.push(p);for(var u=h.length;u<l;u++)h.push(P.PlatformType.NORMAL);var d=Object.keys(t.things);for(c=0;c<l;){var f=a/s,y=f/2,m=0,g=a-s*this.psize.width-(s-1)*(f-this.psize.width),v=d[A.M2.randint(d.length)],b=!1;for(u=0;u<s;u++){var _={pos:{x:0,y:0},variant:h[A.M2.randint(l)],things:x.BonusObjectType.NONE},w=0==c?o+r:o+A.M2.rand(r);_.pos.y=i+w,_.pos.x=P.GameConfig.borderOffsets+y+f*u,_.pos.x+=(.5-Math.random())*g,(c+u)%Math.round(t.things[v]*l)&&!b&&1<s&&(_.things=v,b=!0),e.push(_),m=Math.max(m,w)}i+=m,c+=s,s=Math.min(1+A.M2.randint(n),t.platforms-s)}return{data:e,width:a,height:i+this.psize.height}},t.prototype.shuffle=function(t){for(var e=t,i=e.length-1;0<=i;i--){var n=Math.floor(Math.random()*(i+1)),o=e[n];e[n]=e[i],e[i]=o}return e},t}();i.PlatformPopulator=n},{"../shared/M2":134,"./BonusObject":81,"./GameConfig":83}],89:[function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var a,o,s=t("p2"),h=t("../physics/constants"),l=t("./Assets"),p=t("./GameConfig");(o=a=i.PlayerAnimPhase||(i.PlayerAnimPhase={})).NONE="none",o.JUMP="Jump",o.LOSE="Lose",o.WIN="Win",o.DAMAGE="Damage";var c=124,u=190,d=function(o){function t(t){var e=o.call(this)||this;e._jumpMult=1,e._jumpAffectApplyed=!1,e.lockMovement=!1,e.pivot.set(.5*c,.5*u),e._animPhase=a.JUMP;var i=t[l.Assets.Assets.player.name].spineData,n=new PIXI.spine.Spine(i);return n.position.set(.5*c,u),n.state.timeScale=.75,e.anim=n,e.setBody({fixedRotation:!0,mass:10,boundsToShape:!1,shape:new s.Box({width:c*h.PIXEL_TO_METR,height:u*h.PIXEL_TO_METR})}),new s.Box({width:c*h.PIXEL_TO_METR,height:10*h.PIXEL_TO_METR}).sensor=!0,e.addChild(n),e.body.shapes.forEach(function(t){t.collisionMask=p.GameConfig.groups.ANY,t.collisionGroup=p.GameConfig.groups.PLAYER}),e.startHeight=e.height,e}return r(t,o),Object.defineProperty(t.prototype,"face",{set:function(t){0<t?this.anim.scale.x=1:t<0&&(this.anim.scale.x=-1)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.animPhase(a.NONE),this._damaged=!1,this.canCollide=!0,this.lockMovement=!1},t.prototype.animPhase=function(t,e){void 0===e&&(e=!1),t!=a.NONE?this.anim.state.setAnimation(0,t,e):this.anim.state.setEmptyAnimation(0,0)},t.prototype.update=function(){},t.prototype.damaged=function(){this._damaged=!0,this.lockMovement=!0,this.canCollide=!1,this.jump(),this.animPhase(a.DAMAGE,!1)},Object.defineProperty(t.prototype,"canCollide",{get:function(){return 0!=this.body.shapes[1].collisionGroup},set:function(t){t=t&&!this._damaged,this.body.shapes[0].collisionMask=t?p.GameConfig.groups.ANY:p.GameConfig.groups.BORDER},enumerable:!0,configurable:!0}),t.prototype.jump=function(){if(this.jumpVel<=0)throw Error("JumpVel must be >0");this._jumpAffectApplyed&&(this._jumpMult=1,this._jumpAffectApplyed=!1);var t=this.body.velocity[1];this.body.applyImpulse([0,(this.jumpVel*this._jumpMult-t)*this.body.mass]),this.animPhase(a.JUMP),this._jumpAffectApplyed=1!==this._jumpMult},t.prototype.applyJumpMutiplier=function(t){this._jumpMult=t,this._jumpAffectApplyed=!1},t.prototype.applyStrave=function(t){this.body.velocity[0]=p.GameConfig.playerMove*h.PIXEL_TO_METR*t},t.prototype.move=function(t){this.body.velocity[1]=Math.min(this.jumpVel*this._jumpMult,this.body.velocity[1]),this.face=t,this.lockMovement||this.applyStrave(Math.min(1,Math.max(t,-1)))},t.prototype.freeze=function(t){t?this.body.sleep():this.body.wakeUp()},t}(PIXI.Container);i.Player=d},{"../physics/constants":116,"./Assets":80,"./GameConfig":83,p2:33}],90:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var a=t("./Assets"),s=t("./GameConfig"),h=t(".."),r=function(r){function t(t){var e=r.call(this)||this,i=t[a.Assets.Assets["game-atlass"].name].textures,n=t[a.Assets.Assets["back-tile"].name].texture;e._bg=new PIXI.TilingSprite(n),e._bg.anchor.set(0,1);var o=i["door_all.png"];return e._goal=new PIXI.Sprite(o),e._goal.anchor.set(0,1),e.windowTexture=i["window.png"],e.addChild(e._bg),e.addChild(e._goal),e}return o(t,r),t.prototype.updateSize=function(t){this._bg.width=t.width,this._bg.height=h.App.instance.height,this._windows&&this._windows.destroy({children:!0}),this._windows=new PIXI.Container;for(var e=Math.floor(t.height/s.GameConfig.windowsStep),i=this._bg.width-(2*s.GameConfig.borderOffsets+this.windowTexture.height),n=1;n<e+1;n++){var o=new PIXI.Sprite(this.windowTexture);o.anchor.set(.5,1),o.position.x=s.GameConfig.borderOffsets+.5*this.windowTexture.width+Math.random()*i,o.position.y=-n*s.GameConfig.windowsStep,this._windows.addChild(o)}this.addChild(this._windows)},t.prototype.scroll=function(t){this._bg.tilePosition.y=t.y%this._bg.texture.height,this._windows.pivot.y=-t.y,t.y<=this._goal.height&&(this._goal.position.y=t.y)},t.prototype.reset=function(){this._bg.tilePosition.y=0,this._goal.position.y=0},t}(PIXI.Container);i.StaticBack=r},{"..":103,"./Assets":80,"./GameConfig":83}],91:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../shared/BaseGame"),a=t("../physics/PhysicContainer"),h=t("./Platform"),l=t("./Assets"),p=t("./StaticBack"),m=t("./GameConfig"),c=t("./Player"),u=r(t("p2")),d=t("../physics/constants"),f=t("../shared/ui/Popup"),y=t("@tweenjs/tween.js"),g=t("./BonusObject"),v=t("./PlatformBuilder"),b=t("../shared/CrossplatformInputHandler"),_=t("../shared/APIData"),w=t("../shared/ui/UiManager"),P=t("./LongPool"),A=t("./PlatformPopelyshev"),x=t("../shared/M2"),E=t("../shared/ui/IUIListener"),M=function(e){function t(){var t=e.call(this)||this;return t.pooler=new P.LongPool,t.generator=new A.PlatformPopelyshev,t.platforms=[],t.things=[],t.bounds=[],t._tmpArea=new PIXI.Rectangle,t.apiData=new _.APIData("Tower",t),t.stage=new PIXI.Container,t.physics=new a.PhysicContainer({gravity:[0,-100]}),t.physics.sortableChildren=!0,t.loader=new PIXI.Loader(l.Assets.BaseDir),t}return o(t,e),t.prototype.preload=function(){return this.loader.add(Object.values(l.Assets.Assets)),e.prototype.preload.call(this)},t.prototype.init=function(t){this.app=t,this.lang=this.app.multilang.getTextBase("Tower"),this.platfomBuilder=new v.PlatformBuilder(this.loader.resources,t),this.input=new b.InputHandler(!1,x.M2.mobile),this.gameState.on("enter",this.OnStateEnter,this),t.uiManager.setOptions({level:this.apiData.lastOpenedLevel,showProgress:!1,showArrows:!1,levelHint:this.lang.levels[0],progressHint:this.lang.progress[0],progress:0,controlLayout:x.M2.mobile?w.ControlsLayout.HOR:w.ControlsLayout.NONE}),this.input.mobileControlls=t.uiManager.controls,t.uiManager.popup.show(f.PopupType.START,!0),this.stage.position.y=t.height,this.back=new p.StaticBack(this.loader.resources),this.back.updateSize(t.size),this.stage.addChild(this.back),this.generator.screenSize=t.size,this.generator.psize=new PIXI.Rectangle(0,0,250,m.GameConfig.platformHeight),this.generator.variants=[m.PlatformType.NORMAL],this.player=new c.Player(this.loader.resources),this.player.zIndex=100,this.player.jumpVel=Math.sqrt(2*d.PIXEL_TO_METR*m.GameConfig.jumpHeight*this.generator.psize.height*Math.abs(this.physics.world.gravity[1])),this.player.position.set(.5*this.app.width,-200),this.player.body.update(),this.player.freeze(!0),this.createBounds(t.size),this.stage.addChild(this.physics),this.physics.addChild(this.player),this.app.uiManager.hint.open(x.M2.mobile?this.lang.hello:this.lang.hello_pc),e.prototype.init.call(this,t),e.prototype.start.call(this)},t.prototype.setLevel=function(t){this.apiData.current=t,this.gameState.current=s.GameState.GAME},t.prototype.reload=function(){this.gameState.current=s.GameState.GAME},t.prototype.popupOpened=function(t){t==E.IPopup.MENU&&this.app.uiManager.setOptions({showArrows:!1,level:this.apiData.lastOpenedLevel})},t.prototype.softPause=function(){return e.prototype.softPause.call(this)},t.prototype.softResume=function(){e.prototype.softResume.call(this)},t.prototype.startLevel=function(t){this.player.reset(),this.reset(!0),this.pooler.reset(!0),this.platfomBuilder.level=t,this.levelData=this.generator.populate(m.GameConfig.levels[t-1]);var e=1==t,i={width:this.app.width,height:this.levelData.height+this.app.height};this.back._goal.visible=e,this.back.updateSize(i),this.createPlatforms(i),this._levelStartData={cameraPos:this.physics.pivot.clone(),playerPos:this.player.position.clone(),groundLevel:this.groundLevel},this.physics.world.on("beginContact",this.OnBeginContact,this),this.player.freeze(!1),this.player.jump()},t.prototype.createThing=function(t,e){var i=this.loader.resources[l.Assets.Assets["game-atlass"].name],n=this.loader.resources[l.Assets.Assets.monster.name].spineData,o=void 0;switch(e){case g.BonusObjectType.COIN:o=new g.Coins(i.textures["coin.png"]);break;case g.BonusObjectType.BALL:o=new g.Ball(i.textures["ball.png"]);break;case g.BonusObjectType.SPIKES:o=new g.Spikes(i.textures["spikes.png"]);break;case g.BonusObjectType.MONSTER:o=new g.Monster(n)}return o.position.x=t.position.x,o instanceof g.Monster?(o.position.y=t.top-200,o._anim.scale.x=Math.sign(.5*this.app.width-o.position.x)):o.position.y=t.top-.5*o.height,o.body&&o.body.update(),o},t.prototype.createPlatforms=function(t){var e,i,n=this,o=[],r=this.platfomBuilder.level;this.platfomBuilder.level=Math.min(1,r-1);var a=this.platfomBuilder.Line(this.groundLevel,1<r?m.PlatformType.ENDINGS:m.PlatformType.NORMAL);this.platfomBuilder.level=r,a.forEach(function(t){t.type=m.PlatformType.NORMAL,t.visible=1!=n.platfomBuilder.level}),(e=this.platforms).push.apply(e,a),o.push.apply(o,a);for(var s=0,h=0,l=this.levelData.data;h<l.length;h++){var p=l[h],c=this.platfomBuilder.Single(p.variant),u=-p.pos.y+this.groundLevel;if(s=Math.min(u,s),c.position.set(p.pos.x,u),p.things!=g.BonusObjectType.NONE){var d=this.createThing(c,p.things);c.pairBonus(d),o.push(d)}this.platforms.push(c),o.push(c)}this.levelData.data[this.levelData.data.length-1].pos;var f=-m.GameConfig.yDistance.min*m.GameConfig.platformHeight+s,y=this.platfomBuilder.Line(f,m.PlatformType.ENDINGS);(i=this.platforms).push.apply(i,y),o.push.apply(o,y),this.pooler.init(o,this.physics),this._updatePooler()},t.prototype.createBounds=function(t){for(var e=0;e<2;e++){var i=new PIXI.Sprite(PIXI.Texture.WHITE);i.width=m.GameConfig.borderOffsets,i.height=t.height,i.anchor.set(.5),i.position.set(.5*m.GameConfig.borderOffsets+e*(this.app.width-m.GameConfig.borderOffsets),.5*-t.height);var n=new u.Box({width:d.PIXEL_TO_METR*m.GameConfig.borderOffsets,height:d.PIXEL_TO_METR*t.height});n.collisionGroup=m.GameConfig.groups.BORDER,i.setBody({type:u.default.Body.STATIC,shape:n,boundsToShape:!1}),i.visible=!1,this.bounds.push(i),this.physics.addChild(i)}},t.prototype.reset=function(t){void 0===t&&(t=!1);try{this.physics.world.off("beginContact",this.OnBeginContact)}catch(t){}this.groundLevel=0,this.offsetByCoins=0,this.platforms=[],this.physics.pivot.set(0,0),this.player.position.set(.5*this.app.width,-200),this.back.scroll({x:0,y:0}),this.back._goal.visible=!0,this.levelData=void 0},t.prototype.cointCollection=function(){this.offsetByCoins+=m.GameConfig.coinCost;for(var t=this.platforms.length-3,e=t-m.GameConfig.coinCost,i=this.platforms[e].y,n=t-1;e<=n;n--){(o=this.platforms[n])&&(this.pooler.removeItem(o),this.pooler.removeItem(o.child),o.child&&o.child.destroy(),o.destroy()),this.platforms.splice(n,1)}for(n=0;n<3;n++){var o;(o=this.platforms[this.platforms.length-n-1]).y=i,o.body.update()}},t.prototype.OnBeginContact=function(t){if(t.bodyA==this.player.body||t.bodyB==this.player.body){var e=t.bodyA==this.player.body?t.bodyB:t.bodyA;if(this.player.body.velocity[1]<=0){var i=e.display;if(i instanceof g.BonusObject){var n=!1;switch(i.type){case g.BonusObjectType.SPIKES:case g.BonusObjectType.MONSTER:case g.BonusObjectType.BALL:this.player.damaged(),n=!0;break;case g.BonusObjectType.COIN:this.cointCollection()}if(i.interract(),n)return}i instanceof h.BasePlatform&&this.processPlatformTouch(i)}}},t.prototype.OnStateEnter=function(t){var e=this;if(t==s.GameState.GAME&&(this.player.lockMovement=!1,this.app.uiManager.setOptions({level:this.apiData.current,showProgress:!0,showArrows:!0,progressMax:m.GameConfig.levels[this.apiData.current-1].platforms,progress:0}),this.app.uiManager.popup.close(),this.startLevel(this.apiData.current)),t==s.GameState.LOSE&&(this.apiData.levelFailed(),this.app.uiManager.setOptions({showProgress:!1,showArrows:!1,level:this.apiData.lastOpenedLevel}),this.app.uiManager.popup.show(f.PopupType.LOSE),setTimeout(function(){e.gameState.current==s.GameState.LOSE&&(e.apiData.loosesAtRun%3==0&&e.lang.falling_3times?e.app.uiManager.hint.open(e.lang.falling_3times):e.app.uiManager.hint.open(e.lang.falling))},1e3)),t==s.GameState.PREWIN){this.apiData.levelSucsess(),this.app.uiManager.setOptions({showProgress:!1,showArrows:!1,level:this.apiData.lastOpenedLevel});var i=this.platforms[this.platforms.length-1].y;new y.Tween(this.physics.pivot).to({y:i},500).onComplete(function(){e.app.uiManager.popup.show(f.PopupType.WIN).then(function(){e.gameState.current=s.GameState.WIN})}).start(),this.player.body.velocity=[0,0],this.player.lockMovement=!0}t==s.GameState.WIN&&(this.player.animPhase(c.PlayerAnimPhase.WIN,!0),setTimeout(function(){e.gameState.current==s.GameState.WIN&&e.app.uiManager.hint.open(e.lang.endings)},1e3))},t.prototype.pause=function(){this.app.uiManager.onPause(),e.prototype.pause.call(this)},t.prototype.resume=function(){this.app.uiManager.onResume(),e.prototype.resume.call(this)},t.prototype.stop=function(){this.reset(),e.prototype.stop.call(this)},t.prototype.update=function(t){if(!this._isPaused){switch(this.gameState.current){case s.GameState.GAME:this.updateGame(t)}this.player.position.y;this.physics.update(),this.back.scroll({y:-this.physics.pivot.y,x:0})}},t.prototype.processPlatformTouch=function(t){var e=this;if(this.gameState.current===s.GameState.GAME&&t.type!=m.PlatformType.DISABLED){if(t.type==m.PlatformType.ENDINGS&&(this.gameState.current=s.GameState.PREWIN),t.type==m.PlatformType.ICE){this.player.lockMovement=!0;var i=Math.sign(this.player.body.velocity[0]),n=m.GameConfig.icePlatformEffect.strave*(0==i?1-2*Math.random():i);this.player.applyStrave(n),new y.Tween(this.player).delay(1e3*m.GameConfig.icePlatformEffect.duration).onComplete(function(){e.player.lockMovement=!1}).start()}t.type==m.PlatformType.STICKY&&this.player.applyJumpMutiplier(m.GameConfig.slickPlatformEffect.mult),this.gameState.current==s.GameState.GAME&&(t.interract(),this.player.jump())}},t.prototype.updateGame=function(t){this.input.update();var e=this.input.axis.x;this.player.move(-e),this.physics.pivot.y>this.player.position.y+.5*this.app.height&&(this.physics.pivot.y=this.player.position.y+.5*this.app.height),this._updatePooler();for(var i=this.pooler.placed,n=.5*this.player.startHeight+this.player.y,o=0,r=i;o<r.length;o++){var a=r[o];a instanceof h.BasePlatform&&(a.solid=!(a.y+.5*a.height<=n||0<=this.player.body.velocity[1]))}this.bounds[0].y=this.bounds[1].y=this.physics.pivot.y-.5*this.app.height,this.progress=this._collectPlatforms(-this.player.y+this.groundLevel)+this.offsetByCoins,this.app.uiManager.progress=Math.max(this.progress,this.app.uiManager.progress),this.player.position.y>this.physics.pivot.y&&(this.gameState.current=s.GameState.LOSE)},t.prototype._updatePooler=function(){this._tmpArea.width=this.app.width,this._tmpArea.height=this.app.height+400,this._tmpArea.y=-this.app.height+this.physics.pivot.y-200,this.pooler.safeArea=this._tmpArea},t.prototype._collectPlatforms=function(t){for(var e=0,i=0;i<this.levelData.data.length;i++)this.levelData.data[i].pos.y<t&&e++;return e},t}(s.BaseGame);i.Tower=M},{"../physics/PhysicContainer":113,"../physics/constants":116,"../shared/APIData":129,"../shared/BaseGame":131,"../shared/CrossplatformInputHandler":132,"../shared/M2":134,"../shared/ui/IUIListener":143,"../shared/ui/Popup":145,"../shared/ui/UiManager":147,"./Assets":80,"./BonusObject":81,"./GameConfig":83,"./LongPool":84,"./Platform":85,"./PlatformBuilder":86,"./PlatformPopelyshev":87,"./Player":89,"./StaticBack":90,"@tweenjs/tween.js":1,p2:33}],92:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../shared/config");i.Assets={BaseDir:n.Config.BaseResDir+"/game1/",Assets:{"game-atlass":{name:"game-atlass",url:"./game-assets.json"},water:{name:"water",url:"./water.json"},splash:{name:"splash",url:"./splash.json"},player:{name:"player",url:"./Player/Game Character (up).json"},turtle:{name:"turtle",url:"./Turtle/Turtle.json"}}}},{"../shared/config":137}],93:[function(t,e,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var y=t("./Line"),m=t("./Object"),g=t("../shared/M2"),i=t("./GameConfig");f._DemoMap={lines:[{type:y.LineType.SAND,lineCount:2,objects:[{type:m.ObjectType.OBSTACLE,variant:m.ObstacleVariant.STONE,pos:{x:g.M2.rand(100,1e3),y:i.GameConfig.LineHeight}}]},{type:y.LineType.RIVER,lineCount:2,objects:[{type:m.ObjectType.MOVABLE,variant:m.MovableVariant.TURTLE,speed:1.5,pos:{x:g.M2.rand(100,1e3),y:i.GameConfig.LineHeight}}]},{type:y.LineType.SAND,lineCount:2,objects:[{type:m.ObjectType.OBSTACLE,variant:m.ObstacleVariant.STONE,pos:{x:g.M2.rand(100,1e3),y:i.GameConfig.LineHeight}}]},{type:y.LineType.RIVER,lineCount:4,objects:[{type:m.ObjectType.MOVABLE,variant:m.MovableVariant.TIMBER,speed:-2,pos:{x:g.M2.rand(100,1e3),y:1.5*i.GameConfig.LineHeight}},{type:m.ObjectType.MOVABLE,variant:m.MovableVariant.TIMBER,speed:3,pos:{x:g.M2.rand(100,1e3),y:3*i.GameConfig.LineHeight}}]}]};var v={type:y.LineType.ENDING,lineCount:1,objects:[{type:m.ObjectType.OBSTACLE,variant:m.ObstacleVariant.STONE,pos:{x:g.M2.rand(100,1e3),y:72}}]},b=[2,3,4];f.genMap=function(t){for(var e=[],i=f._DemoMap.lines,n=b[t-1],o=[m.ObstacleVariant.BUSH,m.ObstacleVariant.RAAD,m.ObstacleVariant.STONE],r=0;r<8;r++)for(var a=0;a<i.length;a++){var s=JSON.parse(JSON.stringify(i[a]));if(s.type==y.LineType.RIVER)for(var h=0,l=s.objects;h<l.length;h++){var p=l[h],c=.5*n+Math.random()*n*1.5;p.speed=c*(16<32*Math.random()?-1:1),p.variant==m.MovableVariant.TURTLE&&(p.speed=g.M2.clamp(p.speed,-2,2))}if(s.type==y.LineType.SAND)for(var u=0,d=s.objects;u<d.length;u++)(p=d[u]).variant=o[Math.random()*o.length|0],p.pos.x=g.M2.rand(100,1e3);e.push(s)}return e.push(v),{lines:e}}},{"../shared/M2":134,"./GameConfig":94,"./Line":95,"./Object":97}],94:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameConfig={AnimationFPS:25,MobileBottomOffset:4,BottomOffset:2,TopOffset:4,PlayerStart:{x:540,y:-213},StepSand:142,StepBeetwen:213,HorizontalStep:142,StepRiver:213,Duration:.15,LineHeight:142,RiverSpeed:72}},{}],95:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r,a,s,h,l=t("./Assets"),p=t("../shared/M2"),c=t("./GameConfig");(a=r=i.LineType||(i.LineType={})).RIVER="river",a.SAND="sand",a.ENDING="end",a.NONE="none",(h=s=i.SandVariant||(i.SandVariant={}))[h.VAR1=0]="VAR1",h[h.VAR2=1]="VAR2",h[h.VAR3=2]="VAR3",h[h.EDGE_TOP=3]="EDGE_TOP",h[h.EDGE_BTM=4]="EDGE_BTM";var u=["sand 1.png","sand 2.png","sand 3.png","sand edge 1.png","sand edge 2.png"],d=function(i){function t(t){var e=i.call(this)||this;return e.type=r.NONE,e.objects=[],e._res=t,e}return o(t,i),t}(PIXI.Container),f=function(i){function t(t){var e=i.call(this,t)||this;return e.type=r.RIVER,e}return o(t,i),t}(i.GameLine=d);i.River=f;var y=function(i){function t(t){var e=i.call(this,t)||this;return e.type=r.SAND,e._sprites=[],e._lines=1,e._textures=t[l.Assets.Assets["game-atlass"].name].textures,e.lineCount=2,e}return o(t,i),Object.defineProperty(t.prototype,"lineCount",{get:function(){return this._lines},set:function(t){if(this._lines!=t){this._lines=t,this._sprites.forEach(function(t){t.destroy()}),this._sprites=[];for(var e=0;e<t;e++){var i=p.M2.randint(3);0==e&&(i=s.EDGE_BTM),e==t-1&&(i=s.EDGE_TOP);var n=new PIXI.Sprite(this._textures[u[i]]);n.y=-e*n.height,n.pivot.y=n.height,this._sprites.push(n)}this.addChild.apply(this,this._sprites)}},enumerable:!0,configurable:!0}),t.prototype.getAnchor=function(t){var e=this.height,i=this.y-t.y,n=this.y-e-t.y;return Math.abs(i)<Math.abs(n)?t.y=this.y-.5*c.GameConfig.LineHeight:t.y=this.y-e+.5*c.GameConfig.LineHeight,t},t}(d);i.Sand=y},{"../shared/M2":134,"./Assets":92,"./GameConfig":94}],96:[function(t,e,i){"use strict";var n;Object.defineProperty(i,"__esModule",{value:!0});var c=t("./Line"),a=t("./Object"),s=t("./Obstacle"),u=t("./GameConfig"),h=((n={})[a.MovableVariant.TIMBER]=a.Timber,n[a.MovableVariant.TURTLE]=a.Turtle,n),o=function(){function t(t){this.bottomOffset=0,this.topOffset=0,this._res=t}return t.prototype.build=function(t){for(var e,i=[],n=[],o=[],r=t.lines.length,a=0;a<r;a++){var s=t.lines[a],h=this.createLine(s),l=void 0;l=0<a&&a<r-1?(h.y=e.y-e.lineCount*u.GameConfig.LineHeight,h.lineCount=s.lineCount,h.position):0==a?(h.lineCount=s.lineCount+this.bottomOffset,{x:0,y:-this.bottomOffset*u.GameConfig.LineHeight}):(h.y=e.y-e.lineCount*u.GameConfig.LineHeight,h.lineCount=s.lineCount+this.topOffset,h.type=c.LineType.ENDING,h.position),h.objects=this.createObjects(t.lines[a].objects,l),h.type==c.LineType.RIVER&&(n.push(h),o.push.apply(o,h.objects)),i.push.apply(i,[h].concat(h.objects)),e=h}var p=(this.bottomOffset+t.lines[0].lineCount-.5)*u.GameConfig.LineHeight;return{objects:i,rivers:n,movables:o,playerStart:new PIXI.Point(0,p)}},t.prototype.createLine=function(t){var e=void 0;switch(t.type){case c.LineType.ENDING:case c.LineType.SAND:e=new c.Sand(this._res);break;case c.LineType.RIVER:e=new c.River(this._res);break;default:return}return e},t.prototype.createObjects=function(t,e){if(!t)return[];for(var i=[],n=0;n<t.length;n++){var o=t[n],r=void 0;o.type==a.ObjectType.OBSTACLE&&(r=new s.Obstacle(this._res),o.variant&&(r.variant=o.variant)),o.type==a.ObjectType.MOVABLE&&((r=new h[o.variant||a.MovableVariant.TIMBER](this._res)).speed=o.speed||1),r.position.set(e.x+o.pos.x,e.y-o.pos.y),i.push(r)}return i},t}();i.MapBuilder=o},{"./GameConfig":94,"./Line":95,"./Object":97,"./Obstacle":98}],97:[function(t,e,i){"use strict";var n,o,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var a,s,h,l,p,c,u=t("./Assets"),d=t("./GameConfig");(s=a=i.ObjectType||(i.ObjectType={})).OBSTACLE="obstacle",s.MOVABLE="walkable",s.NONE="none",(l=h=i.ObstacleVariant||(i.ObstacleVariant={})).STONE="stone",l.RAAD="raad",l.BUSH="bush",(c=p=i.MovableVariant||(i.MovableVariant={})).TIMBER="timber",c.TURTLE="turtle",i.VARIAN2TEXTURE=((o={})[h.STONE]="stone.png",o[h.RAAD]="raad.png",o[h.BUSH]="bush.png",o);var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=a.MOVABLE,t._anchors=[new PIXI.Point(0,0)],t}return r(t,e),t.prototype.getNearAnchor=function(t){for(var e,i=1e3,n=this.position,o=0,r=this._anchors;o<r.length;o++){var a=r[o].clone();a.x+=n.x,a.y+=n.y;var s=Math.abs(a.x-t.x);s<i&&(e=a,i=s)}return e},t}(PIXI.Container),y=function(o){function t(t){var e=o.call(this)||this;e.varaint=p.TIMBER,e.speed=1;var i=t[u.Assets.Assets["game-atlass"].name].textures;e._sprite=new PIXI.Sprite(i["timber.png"]),e._sprite.anchor.set(.5),e.addChild(e._sprite);for(var n=0;n<3;n++)e._anchors[n]=new PIXI.Point((n-1)*d.GameConfig.LineHeight,0);return e}return r(t,o),t}(i.Movable=f);i.Timber=y;var m=function(n){function t(t){var e=n.call(this)||this;e.varaint=p.TURTLE,e._speed=1;var i=t[u.Assets.Assets.turtle.name].spineData;return e._spine=new PIXI.spine.Spine(i),e._spine.pivot.y=-e._spine.width>>1,e._spine.angle=90,e._spine.state.setAnimation(0,"Move",!0),e.addChild(e._spine),e}return r(t,n),Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(t){this._spine.angle=90*Math.sign(t),this._spine.state.timeScale=Math.abs(.5*t),this._speed=t},enumerable:!0,configurable:!0}),t}(f);i.Turtle=m},{"./Assets":92,"./GameConfig":94}],98:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Assets"),a=t("./Object"),s=function(i){function t(t){var e=i.call(this,PIXI.Texture.EMPTY)||this;return e.type=a.ObjectType.OBSTACLE,e.anchor.set(.5),e._textures=t[r.Assets.Assets["game-atlass"].name].textures,e.varaint=a.ObstacleVariant.STONE,e}return o(t,i),Object.defineProperty(t.prototype,"variant",{get:function(){return this._variant},set:function(t){t!=this._variant&&(this._variant=t,this.texture=this._textures[a.VARIAN2TEXTURE[t]])},enumerable:!0,configurable:!0}),t}(PIXI.Sprite);i.Obstacle=s},{"./Assets":92,"./Object":97}],99:[function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var a,o,s=t("./Splash"),h=t("./Assets"),d=t("@tweenjs/tween.js"),f=t("./GameConfig"),y=t("./Object"),m=t("./Obstacle"),g=t("./Line");(o=a||(a={})).NONE="none",o.LEFT="left",o.RIGHT="right",o.UP="up",o.DOWN="down";var l={up:"Step up",down:"Step down",left:"Step left",right:"Step right"},p=function(o){function t(t){var e=o.call(this)||this;e.localPos=new PIXI.Point(0,0),e._prevDirection=a.NONE,e._drowned=!1,e._lastLineType=g.LineType.SAND,e._filter=new PIXI.filters.AlphaFilter(.6),e._splash=new s.Splash(t);var i=t[h.Assets.Assets.player.name].spineData,n=new PIXI.spine.Spine(i);return n.pivot.y-=60,e._spine=n,e.addChild(n,e._splash),e}return r(t,o),t.prototype.move=function(t){if(!this.moved&&!this._drowned){var e=a.NONE;if(t.x<-.05&&(e=a.LEFT),.05<t.x&&(e=a.RIGHT),t.y<-.05&&(e=a.DOWN),.05<t.y&&(e=a.UP),e!=a.NONE).05<Math.abs(t.y)&&(t.x=0),this._moveNext(t)&&this._setAnim(e);else this._setAnim(e)}},t.prototype.drown=function(){var t=this;this._drowned=!0,this._setAnim(a.NONE),this._splash.spawn({x:0,y:0}),this._spine.tint=2187384,this._spine.filters=[this._filter];var e=this._filter.alpha,i={val:1};new d.Tween(i).to({val:.1},1e3).onUpdate(function(){t._spine.scale.set(i.val),t._filter.alpha=i.val*e}).start(),this.emit("drown",this)},t.prototype.reset=function(){this._drowned=!1,this._spine.visible=!0,this._spine.tint=16777215,this._spine.filters=[],this._filter.alpha=.3,this._spine.scale.set(1),this.movableParent=void 0,this._nextSandLine=void 0,this.currentSandLine=void 0,this._lastLineType=g.LineType.SAND},Object.defineProperty(t.prototype,"moved",{get:function(){return this._tween&&this._tween.isPlaying()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"movableParent",{get:function(){return this._movableParent},set:function(t){if(t!=this._movableParent){var e=this._movableParent;this._movableParent=t,e&&(this.localPos.x+=e.x,this.localPos.y+=e.y),t&&(this.localPos.x-=t.x,this.localPos.y-=t.y),this._updatePos()}},enumerable:!0,configurable:!0}),t.prototype._updatePos=function(){this.position.x=this.localPos.x,this.position.y=this.localPos.y,this._movableParent&&(this.position.x+=this.movableParent.x,this.position.y+=this.movableParent.y)},t.prototype.update=function(t){this._splash.update(t),this._updatePos()},t.prototype._setAnim=function(t){t!==this._prevDirection&&(t==a.NONE?(this._spine.state.clearTracks(),this._spine.skeleton.setToSetupPose()):(this._spine.state.setAnimation(0,l[t],!0),this._spine.state.timeScale=this._spine.state.getCurrent(0).animation.duration/f.GameConfig.Duration),this._prevDirection=t)},t.prototype._testStep=function(t){for(var e=new PIXI.Rectangle(t.x-20,t.y-40,40,80),i=new PIXI.Rectangle,n=this.parent.children,o=[],r=0;r<n.length;r++){var a=n[r];a!=this&&(a.getLocalBounds(i),i.x+=a.x,i.y+=a.y,i.width*=a.scale.x,i.height*=a.scale.y,0!=i.width&&0!=i.height&&(i.fit(e),0<i.width&&0<i.height&&o.push(a),i.width=i.height=0))}return o},t.prototype._testIsSand=function(t){var e=this.position.clone();e.x+=t.x*f.GameConfig.StepSand,e.y+=t.y*f.GameConfig.StepSand;var i=this._testStep(e);if(i[0]instanceof g.Sand)return i},t.prototype._moveNext=function(t){var e=this,i=this._testIsSand(t),n=t.clone(),o=this.movableParent;this.movableParent=void 0;var r=!!i;r&&this._lastLineType!=g.LineType.RIVER?(n.x*=f.GameConfig.HorizontalStep,n.y*=f.GameConfig.StepSand):(n.x*=f.GameConfig.HorizontalStep,n.y*=f.GameConfig.StepRiver,i=this._testStep({x:this.x+n.x,y:this.y+n.y})),this._lastHits=i,n.x+=this.x,n.y+=this.y;for(var a=!1,s=!1,h=0,l=i;h<l.length;h++){var p=l[h];if(p instanceof m.Obstacle&&(a=!0),p instanceof y.Movable){var c=p.speed*f.GameConfig.Duration*f.GameConfig.RiverSpeed;n.x-=c*Math.abs(t.y);var u=p.getNearAnchor(n);n.y=u.y,Math.abs(n.x-u.x)<=.5*f.GameConfig.HorizontalStep||this._lastLineType==g.LineType.SAND?n.x=u.x+c:(n.x=u.x+f.GameConfig.StepRiver*t.x,s=!0)}this._lastLineType==g.LineType.RIVER&&p instanceof g.Sand&&(n=p.getAnchor(n),this._nextSandLine=p),r=r||p instanceof g.Sand}return this._lastLineType=r?g.LineType.SAND:g.LineType.RIVER,a?(this.movableParent=o,!1):(this.movableParent=void 0,this._tween=new d.Tween(this.localPos),this._tween.to({x:n.x,y:n.y},1e3*f.GameConfig.Duration).onComplete(function(){e._postMove(s)}).start(),!0)},t.prototype._postMove=function(t){if(void 0===t&&(t=!1),this.currentSandLine=this._nextSandLine,!this._lastHits||0==this._lastHits.length||t)return console.log("Drowing"),this.drown(),void(this.movableParent=void 0);if(this.movableParent=void 0,this._lastLineType==g.LineType.RIVER)for(var e=0,i=this._lastHits;e<i.length;e++){var n=i[e];if(n instanceof y.Movable){this.movableParent=n;break}}},t}(PIXI.Container);i.Player=p},{"./Assets":92,"./GameConfig":94,"./Line":95,"./Object":97,"./Obstacle":98,"./Splash":100,"@tweenjs/tween.js":1}],100:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Assets"),a=t("./GameConfig"),s=function(n){function t(t){var e=this,i=t[r.Assets.Assets.splash.name].spritesheet;return(e=n.call(this,i.animations.splash,!1)||this).animationSpeed=a.GameConfig.AnimationFPS/60,e.loop=!1,e.visible=!1,e.anchor.set(.5),e}return o(t,n),t.prototype.spawn=function(t){var e=this;this.position.copyFrom(t),this.visible=!0,this.gotoAndPlay(0),this.onComplete=function(){e.visible=!1,e.onComplete=void 0}},t.prototype.update=function(t){this.visible&&n.prototype.update.call(this,t.deltaTime)},t}(PIXI.AnimatedSprite);i.Splash=s},{"./Assets":92,"./GameConfig":94}],101:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Assets"),a=function(n){function t(t){var e=n.call(this)||this;e._deep=0;var i=t[r.Assets.Assets.water.name].spritesheet;return e._front=new PIXI.TilingSprite(i.textures["water_1.png"]),e._animator=new PIXI.AnimatedSprite(i.animations.water,!1),e._animator.onFrameChange=function(){return e._changeTexture()},e._animator.play(),e._animator.animationSpeed=.25,e.addChild(e._front),e}return o(t,n),t.prototype.updateSize=function(t){this._front.width=t.width,this._front.height=t.height},t.prototype._changeTexture=function(){this._front.texture=this._animator.texture},t.prototype.scroll=function(t){this._front.tilePosition.x=t.x%this._front.width,this._front.tilePosition.y=t.x%this._front.height},t.prototype.update=function(t){this._animator.update(t.deltaTime)},Object.defineProperty(t.prototype,"deep",{get:function(){return this._deep},set:function(t){this._deep=t,this._front.tint=16777215*(1-this._deep)},enumerable:!0,configurable:!0}),t}(PIXI.Container);i.Water=a},{"./Assets":92}],102:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var s=t("../shared/BaseGame"),r=t("../shared/APIData"),a=t("./Assets"),h=t("./Water"),l=t("../shared/ui/Popup"),p=t("../shared/CrossplatformInputHandler"),c=t("../shared/ui/UiManager"),u=t("./Player"),d=t("./GameConfig"),f=t("../shared/M2"),y=t("./MapBuilder"),m=t("./DemoMap"),g=t("./Line"),v=t("./Object"),b=t("../shared/ui/IUIListener"),_=function(i){function t(){var t=i.call(this)||this;return t.stage=new PIXI.Container,t.physics=new PIXI.Container,t.apiData=new r.APIData("Frogger",t),t.loader=new PIXI.Loader(a.Assets.BaseDir),t}return o(t,i),t.prototype.preload=function(){return this.loader.add(Object.values(a.Assets.Assets)),i.prototype.preload.call(this)},t.prototype.init=function(t){var e=this;this.app=t,this.lang=this.app.multilang.getTextBase("Frogger"),this.physics.position.y=t.height,this.physics.sortableChildren=!0,this.gameState.on("enter",this.OnStateEnter,this),this.water=new h.Water(this.loader.resources),this.water.updateSize(t.size),this.player=new u.Player(this.loader.resources),this.player.on("drown",function(){e.gameState.current=s.GameState.LOSE}),this.player.zIndex=100,this.builder=new y.MapBuilder(this.loader.resources),t.uiManager.setOptions({showArrows:!1,showProgress:!1,level:this.apiData.lastOpenedLevel,levelHint:this.lang.levels[0],progressHint:this.lang.progress[0],controlLayout:f.M2.mobile?c.ControlsLayout.FULL:c.ControlsLayout.NONE}),t.uiManager.popup.show(l.PopupType.START,!0),this.input=new p.InputHandler(!1,f.M2.mobile),this.input.mobileControlls=t.uiManager.controls,this.physics.addChild(this.player),this.builder.bottomOffset=f.M2.mobile?d.GameConfig.MobileBottomOffset:d.GameConfig.BottomOffset,this.builder.topOffset=d.GameConfig.TopOffset,this.stage.addChild(this.water,this.physics),this.app.uiManager.hint.open(this.lang.hello),i.prototype.init.call(this,t),i.prototype.start.call(this)},t.prototype.setLevel=function(t){this.apiData.current=t,this.gameState.current=s.GameState.PRE},t.prototype.reload=function(){this.setLevel(this.apiData.current)},t.prototype.popupOpened=function(t){t==b.IPopup.MENU&&this.app.uiManager.setOptions({showArrows:!1,level:this.apiData.lastOpenedLevel})},t.prototype.softPause=function(){return i.prototype.softPause.call(this)},t.prototype.pause=function(){this.app.uiManager.onPause(),i.prototype.pause.call(this)},t.prototype.resume=function(){this.app.uiManager.onResume(),i.prototype.resume.call(this)},t.prototype.OnStateEnter=function(t){var e,i=this;if(console.log("State:",t),t==s.GameState.PRE){this.gameState.before&&this.reset(),this.app.uiManager.popup.close(),this.mapData=m.genMap(this.apiData.current);var n=this.builder.build(this.mapData);this.mapObjects=n,this.player.localPos.y=-n.playerStart.y,this.player.localPos.x=d.GameConfig.PlayerStart.x,this.player._updatePos(),(e=this.physics).addChild.apply(e,n.objects),this.gameState.current=s.GameState.GAME}t==s.GameState.GAME&&this.app.uiManager.setOptions({showProgress:!0,level:this.apiData.current,showArrows:f.M2.mobile,progressMax:this.mapObjects.movables.length,progress:0}),t==s.GameState.LOSE&&(this.apiData.levelFailed(),this.app.uiManager.setOptions({level:this.apiData.lastOpenedLevel,showArrows:!1,showProgress:!1}),this.app.uiManager.popup.show(l.PopupType.LOSE),setTimeout(function(){if(i.gameState.current==s.GameState.LOSE){var t=i.apiData.loosesAtRun%3==0&&0<i.apiData.loosesAtRun;i.app.uiManager.hint.open(t?i.lang.falling_3times:i.lang.falling)}},1e3)),t==s.GameState.PREWIN&&(this.apiData.levelSucsess(),this.app.uiManager.setOptions({showArrows:!1,showProgress:!1,level:this.apiData.lastOpenedLevel}),this.app.uiManager.popup.show(l.PopupType.WIN),this.gameState.current=s.GameState.WIN,this.player.move(new PIXI.Point(0,0))),t==s.GameState.WIN&&setTimeout(function(){i.gameState.current==s.GameState.WIN&&i.app.uiManager.hint.open(i.lang.endings)},1e3)},t.prototype.update=function(t){this._isPaused||(i.prototype.update.call(this,t),this.gameState.current==s.GameState.GAME&&this._updateGame(t),this.player.update(t),this.water.update(t))},t.prototype.reset=function(){if(this.player.reset(),this.physics.pivot.y=0,this.mapObjects)for(var t=0,e=this.mapObjects.objects;t<e.length;t++){e[t].destroy()}},t.prototype._updateGame=function(t){this.player.move(this.input.axis);var e=this.player.position.y,i=this.physics.pivot.y,n=this.builder.topOffset*d.GameConfig.LineHeight*2;this.builder.bottomOffset,d.GameConfig.LineHeight;i>e+this.app.height-n&&(this.physics.pivot.y=e+this.app.height-n),this.water.scroll(this.physics.pivot);for(var o=0,r=this.mapObjects.rivers;o<r.length;o++){var a=r[o];this._updateRiver(a,t)}this.app.uiManager.progress=this._collectRivers(),this.player.currentSandLine&&this.player.currentSandLine.type==g.LineType.ENDING&&(this.gameState.current=s.GameState.PREWIN)},t.prototype._updateRiver=function(t,e){if(t.objects)for(var i=0;i<t.objects.length;i++){var n=t.objects[i];if(n instanceof v.Movable){var o=this.apiData._levels[2].playing||1;n.x+=o*e.deltaMS*n.speed*d.GameConfig.RiverSpeed*.001;var r=n.getBounds(!1);r.x>this.app.width&&0<n.speed&&(n.x=.5*-r.width),r.x+r.width<0&&n.speed<0&&(n.x=this.app.width+.5*r.width)}}},t.prototype._collectRivers=function(){for(var t=this.player.y,e=0,i=0;i<this.mapObjects.movables.length;i++)this.mapObjects.movables[i].y>t&&e++;return e},t}(s.BaseGame);i.Frogger=_},{"../shared/APIData":129,"../shared/BaseGame":131,"../shared/CrossplatformInputHandler":132,"../shared/M2":134,"../shared/ui/IUIListener":143,"../shared/ui/Popup":145,"../shared/ui/UiManager":147,"./Assets":92,"./DemoMap":93,"./GameConfig":94,"./Line":95,"./MapBuilder":96,"./Object":97,"./Player":99,"./Water":101}],103:[function(t,e,i){"use strict";var n,a=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),o(t("./pixi-utils")).default();var h=o(t("@tweenjs/tween.js")),r=t("./Application"),l=t("./shared/config"),p=t("./shared/AssetsLib"),c=t("./shared/ui/UiManager"),u=t("./GameAPI"),d=t("./shared/Multilang"),f=t("./cloud-jump"),y=t("./frogger/index"),m=t("./balance/index"),g=t("./catcher/index"),v=t("./twofold/index"),b=t("./maze/index"),_=t("./pong"),w=function(o){function r(t){var e=this;if(!t)throw new Error("aprent element must be div!");var i=window.innerWidth/window.innerHeight,n=s({},l.Config.ReferenceSize);return i<n.width/n.height&&(n.height=n.width/i),PIXI.settings.PREFER_ENV=PIXI.ENV.WEBGL,e=o.call(this,s({autoStart:!1,powerPreference:"low-power",backgroundColor:13421772},n))||this,t.appendChild(e.view),e.games={Pong:_.Pong,Maze:b.Maze,Twofold:v.Twofold,Catcher:g.Catcher,Balance:m.Balance,Tower:f.Tower,Frogger:y.Frogger},e.lang="en_US",e.api=window.GameAPI||new u.EmbeddedGameApi,window.GameAPI=e.api,e.uiManager=new c.UiManager(e),e.uiManager.visible=!1,e.ticker.add(e.update,e),l.Config.PausedInBackground&&(window.addEventListener("blur",function(){e.pause()}),window.addEventListener("focus",function(){e.resume()})),e.render(),window.AppInstance=e,r.instance=e}return a(r,o),r.prototype.load=function(){var t=this;this.loader.baseUrl=p.Assets.BaseDir;var e=this.api.getGameData("Loader");this.lang=e.data.lang||this.lang;var i=p.Assets.AssetsTranslated[this.lang]||{};this.loader.add(Object.values(s({},p.Assets.Assets,i))),this.loader.add("mainfest",l.Config.Translations),this.loader.load(function(){t.init()})},r.prototype.init=function(){var e=this;this.multilang=new d.Multilang(this.loader.resources.mainfest.data),this.multilang.preload(this.lang),this.uiManager.init(this.loader.resources),this.uiManager.visible=!1,this.stage.addChild(this.uiManager.stage),this.multilang.once("loaded",function(){e.api.registerHook("Loader",function(t){e.apiHook(t)}),e._init=!0,e.emit("loaded"),e.api.submitGameState("Loader",{type:"init",data:{message:"Game loader init"}})})},r.prototype.apiHook=function(t){if("start"==t.type){if(!t.data)return void this.api.submitGameState("Loader",{type:"error",data:{game:void 0,message:"Data can't be empty! ",variants:{data:{name:Object.keys(this.games)[0]}}}});var e=t.data.name||t.data.game;this.startGameByName(e)||this.api.submitGameState("Loader",{type:"error",data:{game:e,message:"Can't found",variants:Object.keys(this.games)}})}"close"==t.type&&(this.stop(),this.api.submitGameState("Loader",{type:"close",data:{message:"Stoped by API Request"}}))},r.prototype.startGameByName=function(t){return!(!t||!this.games[t])&&(this.preparedStart(new this.games[t]),!0)},r.prototype.preparedStart=function(t){var e=this;if(!this._init)throw Error("App can't init!");if(!t)throw Error("Game can't be null!");this.stop(),t.preload().load(function(){e.start(t)})},r.prototype.start=function(t){this._currentGame=t,this.uiManager.bindListener(t),this._currentGame.init(this),this.uiManager.postInit(),this.stage.addChildAt(this._currentGame.stage,0),this.resume(),o.prototype.start.call(this)},r.prototype.stop=function(){this._currentGame&&(this.stage.removeChild(this._currentGame.stage),this.uiManager.reset(),this._currentGame.stop()),this._currentGame=void 0,o.prototype.render.call(this),o.prototype.stop.call(this)},r.prototype.pause=function(){this.ticker.stop(),this._currentGame&&this._currentGame.pause(),this.update()},r.prototype.resume=function(){this._currentGame&&(this._currentGame.resume(),o.prototype.start.call(this))},r.prototype.update=function(){h.default.update(this.ticker.lastTime),null!=this._currentGame&&this._currentGame.update(this.ticker),this.render()},r}(r.Application);i.App=w,window.GamesFromHell=w},{"./Application":65,"./GameAPI":66,"./balance/index":72,"./catcher/index":79,"./cloud-jump":91,"./frogger/index":102,"./maze/index":112,"./pixi-utils":121,"./pong":128,"./shared/AssetsLib":130,"./shared/Multilang":135,"./shared/config":137,"./shared/ui/UiManager":147,"./twofold/index":156,"@tweenjs/tween.js":1}],104:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../shared/config");i.Assets={BaseDir:n.Config.BaseResDir+"/game6",Assets:{"map-atlas":{name:"game-atlas",url:"/map-atlas.json"},player:{name:"player",url:"/Player/Game Character (up).json"}}}},{"../shared/config":137}],105:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameConfig={stepDuration:.45,stepLen:444,gemtopower:30,offsets:{top:500,bottom:500,left:300,right:300},levels:[{size:10,power:60,gems:10},{size:15,power:45,gems:20},{size:17,power:30,gems:30}]}},{}],106:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Assets"),a=t("@tweenjs/tween.js"),s=function(n){function t(t){var e=n.call(this)||this;e._showed=!1;var i=t[r.Assets.Assets["map-atlas"].name].textures;return e._body=new PIXI.Sprite(i["ghost.png"]),e._body.pivot.set(.5),e._body.x-=e._body.width>>1,e._body.y-=e._body.height>>1,e._baloon=new PIXI.Sprite(i["balloon.png"]),e._baloon.anchor.set(1,1),e._text=new PIXI.Text("x00",new PIXI.TextStyle({fontFamily:"Carter One MultiCyr, CarterOne",fontSize:30,fill:0})),e._baloon.addChild(e._text),e._text.anchor.set(0,.5),e._text.y-=75,e._text.x-=100,e._baloon.y+=e._baloon.height>>1,e._baloon.visible=!1,e.addChild(e._body,e._baloon),e}return o(t,n),t.prototype.setAmount=function(t){this._text.text="x"+(0|t)},t.prototype.showBalloon=function(t){if(!this._showed)return this._showed=!0,this.setAmount(t),this._baloon.alpha=1,this._baloon.visible=!0,this._baloon.scale.set(.001),new a.Tween(this._baloon.scale).to({x:1,y:1},300).start()},t.prototype.hideBaloon=function(){var t=this;if(this._showed)return this._showed=!1,new a.Tween(this._baloon).to({alpha:0},300).onComplete(function(){t._baloon.visible=!1}).start()},t.prototype.reset=function(){this.angle=0,this._baloon.visible=!1,this._showed=!1},t}(PIXI.Container);i.Ghost=s},{"./Assets":104,"@tweenjs/tween.js":1}],107:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n,l=[0,1,2,3],p=[1,0,3,2],c={x:[0,0,-1,1],y:[-1,1,0,0]};Math.random();function o(e){switch(e.type){case r.ELLEE:for(var i=new Array,n=new Array,t=0;t<e.columns;t++)i[t]=t,n[t]=t;s(function(t){return function(t,e,i,n){var o=t.columns,r=t.rows;for(a=0;a<t.columns;a++)if(s()&&i[a]!=a+1&&a!=o-1&&(e[i[a]]=e[a+1],i[e[a+1]]=i[a],i[a]=a+1,e[a+1]=a,t.cells[a][n].wall[3]=!1,t.cells[a+1][n].wall[2]=!1),s()&&i[a]!=a?(e[i[a]]=e[a],i[e[a]]=i[a],e[a]=i[a]=a):(t.cells[a][n].wall[1]=!1,t.cells[a][n+1].wall[0]=!1),a==o-1&&n==r-2)for(var a=0;a<o-1;a++)i[a]!=a+1&&(e[i[a]]=e[a+1],i[e[a+1]]=i[a],i[a]=a+1,e[a+1]=a,t.cells[a][r-1].wall[3]=!1,t.cells[a+1][r-1].wall[2]=!1);return n+1;function s(){return 14<Math.floor(32*h())}}(e,i,n,t)},e.rows-1,function(){e.complete()},void 0);break;case r.DFS:var o=[{x:h()*e.columns|0,y:h()*e.rows|0,neighbors:u(l)}];s(function(){return function(t,e){var i=e[e.length-1],n=i.x,o=i.y,r=i.neighbors;0==t.cells[n][o].visited&&(t.cells[n][o].visited=!0,t.visitedCount++);for(;0<r.length;){var a=r.pop();0==r.length&&e.pop();var s=n+c.x[a],h=o+c.y[a];if(0<=s&&0<=h&&s<t.columns&&h<t.rows&&0==t.cells[s][h].visited){t.cells[n][o].wall[a]=!1,t.cells[s][h].wall[p[a]]=!1,e.push({x:s,y:h,neighbors:u(l)});break}}return t.visitedCount}(e,o)},e.rows*e.columns,function(){e.complete()},void 0)}}(n=r=i.MazeType||(i.MazeType={}))[n.ELLEE=0]="ELLEE",n[n.DFS=1]="DFS";var a=function(){function t(){this.cells=new Array,this.visitedCount=0,this.columns=4,this.rows=4,this.type=0}return t.prototype.build=function(t,e,i){var n=this;return void 0===i&&(i=r.ELLEE),this.columns=t,this.rows=e,this.type=i,this.cells=[],new Promise(function(t){n.complete=t;for(var e=0;e<n.columns;e++)n.rowInitializer(e);o(n)})},t.prototype.rowInitializer=function(t){this.cells[t]=new Array(this.columns);for(var e=0;e<this.rows;e++)this.cells[t][e]={visited:!1,x:t,y:e,wall:[!0,!0,!0,!0]};return t+1},t}();i.Maze=a;var u=function(t){for(var e,i,n=t.slice(),o=n.length;o;e=h()*o|0,i=n[--o],n[o]=n[e],n[e]=i);return n};function s(e,i,n,o){var r=0,a=function(t){for(;(t=e(t))!=i;){if(!(r<50)){r=0,setTimeout(function(){a(t)},0);break}r++}o&&o(t,i),n&&t==i&&setTimeout(function(){n()},0)};a(0)}function h(){return Math.random()}},{}],108:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var C=t("./MazeView");function a(t){if(4!=t.length)throw Error("FTW??? Array length must be 4");for(var e=0,i=0;i<4;i++)e|=~~t[i]<<i;var n=o.MazeCelType[e];return{baseType:n.t,flip:n.r||0}}o.MazeCelType={0:{t:"cross"},1:{t:"t"},2:{t:"t",r:4},8:{t:"t",r:6},4:{t:"t",r:2},13:{t:"deadend"},14:{t:"deadend",r:4},11:{t:"deadend",r:6},7:{t:"deadend",r:2},5:{t:"corner"},6:{t:"corner",r:2},9:{t:"corner",r:6},10:{t:"corner",r:4},12:{t:"straight"},3:{t:"straight",r:2}},o.ArrayToCell=a;var i=function(){function T(t){this.textures=t}return T.prototype.getCellSize=function(){return this.textures["t.png"].width},T.prototype.buildMaze=function(t,e){void 0===e&&(e=0);var i=1+(t.columns-2)*Math.random()|0,n=1+(t.columns-2)*Math.random()|0;t.cells[i][0].wall[0]=!1,t.cells[n][t.rows-1].wall[1]=!1;var o=T.mazeCellsToTyped(t);t.rows+=2;for(var r=new C.MazeView,a=this.textures["t.png"].width,s=this.textures["t.png"].height,h=[],l=[],p=this.textures["empty.png"],c=this.textures["deadend.png"],u=new PIXI.Texture(c.baseTexture,c.frame,c.orig,c.trim,8|c.rotate),d=this.textures["straight.png"],f=0;f<t.columns;f++){var y=new C.CellView(f===n?u:p),m=new C.CellView(f===i?d:p);y.x=m.x=f*a,y.data={wall:[!1,!0,!0,!0],x:f,y:t.rows-1,visited:!1},y.y=y.data.y*s,m.data={wall:[!0,!1,!0,!0],x:f,y:0,visited:!1},m.y=m.data.y*s,r.addChild(y,m),h[f*t.rows+y.data.y]=y,h[f*t.rows+m.data.y]=m}for(var g=0,v=o;g<v.length;g++){var b=v[g],_=this.textures[b.baseType+".png"],w=new PIXI.Texture(_.baseTexture,_.frame,_.orig,_.trim,_.rotate|b.flip),P=new C.CellView(w);b.orig.y+=1,P.data=b.orig,P.type=b.baseType,P.x=b.orig.x*a,P.y=b.orig.y*s,h[b.orig.x*t.rows+b.orig.y]=P,r.addChild(P)}var A=[];for(f=0;f<e;f++){var x=this.textures["normal "+(1+4*Math.random()|0)+".png"],E=new PIXI.Sprite(x);E.anchor.set(.5),E.scale.set(.35);var M=0;do{var S=t.columns*Math.random()|0,I=1+(t.rows-2)*Math.random()|0;M=S*t.rows+I}while(A[M]);A[M]=!0,E.x=h[M].x+.5*a,E.y=h[M].y+.5*s,l.push(E),r.addChild(E)}return r.data=t,r.cells=h,r.gems=l,r.endCell=r.getCellByIndex(i,0),r.startCell=r.getCellByIndex(n,t.rows-1),r},T.mazeCellsToTyped=function(t){for(var e=t.cells,i=[],n=0;n<e.length;n++)i.push.apply(i,this.mazeRowToTyped(e[n]));return i},T.mazeRowToTyped=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i],r=a(o.wall);r.orig=o,e.push(r)}return e},T}();o.MazeBuilder=i},{"./MazeView":109}],109:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getGlobalCenter=function(){var t=this.parent.parent.toLocal(this.position,this.parent,void 0,!1);return t.x+=this.width>>1,t.y+=this.height>>1,t},e}(PIXI.Sprite);i.CellView=r;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cells=[],t}return o(t,e),t.prototype.getCellByPoint=function(t){var e=this.mapGlobalToCell(t),i=e.x,n=e.y;return this.getCellByIndex(i,n)},t.prototype.getCellByIndex=function(t,e){if(!(t<0||t>=this.data.columns||e<0||e>=this.data.rows)){var i=t*this.data.rows+e;return this.cells[i]}},t.prototype.mapGlobalToCell=function(t){var e=new PIXI.Point(t.x,t.y);return this.toLocal(e,this.parent,e,!1),e.x=e.x/this.width*this.data.columns|0,e.y=e.y/this.height*this.data.rows|0,e},t}(PIXI.Container);i.MazeView=a},{}],110:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var a,r,s=t("./Assets"),h=t("@tweenjs/tween.js"),l=t("./GameConfig"),p=t("../shared/M2");(r=a||(a={})).NONE="none",r.LEFT="left",r.RIGHT="right",r.UP="up",r.DOWN="down";var c={up:"Step up",left:"Step left 90",right:"Step right 90"};function u(t){return 0<t.y?1:t.y<0?0:0<t.x?3:t.x<0?2:-1}var d=function(r){function t(t){var e=r.call(this)||this;e.localPos=new PIXI.Point(0,0),e._prevDirection=a.NONE,e._drowned=!1,e._targetPoint=new PIXI.Point,e._targetAngle=0,e._moveComplete=!1;var i=t[s.Assets.Assets.player.name].spineData,n=new PIXI.spine.Spine(i);n.autoUpdate=!1,n.pivot.y-=60,e._spine=n;var o=t[s.Assets.Assets["map-atlas"].name].textures["deadend_mask.png"];return e.deadmask=new PIXI.Sprite(o),e.deadmask.anchor.set(.5),e.addChild(n),e}return o(t,r),t.prototype.tilt=function(t){var e=this,i=this._targetAngle;if(0<t.y?i=180:t.y<0?i=0:0<Math.abs(t.x)&&(i=90*t.x),!(Math.abs(p.M2.AngleDist(this._targetAngle,i))<.1)){this._tiltTween&&this._tiltTween.isPlaying()&&this._tiltTween.stop();var n=p.M2.AngleDist(this._targetAngle,i),o=this._targetAngle;this._tiltTween=new h.Tween({a:0}).to({a:1},200).onUpdate(function(t){e.angle=o+t.a*n}).start(),this._targetAngle=i}},t.prototype.place=function(t){this.currentCell=t,this.localPos.x=t.data.x,this.localPos.y=t.data.y,this.position.copyFrom(this.currentCell.getGlobalCenter()),this._targetPoint.copyFrom(this.position),this.lastDirection=new PIXI.Point(0,-1)},t.prototype.move=function(t){if(!this.moved){var e=a.NONE,i=u(t);if(-1!=i){if((0<Math.abs(t.x)||0<Math.abs(t.y))&&(e=a.UP),.05<Math.abs(t.y)&&(t.x=0),this.lastDirection=t,this.tilt(t),!this.currentCell.data.wall[i]){var n=this.localPos.x+t.x,o=this.localPos.y+t.y,r=this.mazeView.getCellByIndex(n,o);r&&!r.data.wall[u({x:-t.x,y:-t.y})]?(this.localPos.set(n,o),this.currentCell=r,this._targetPoint=r.getGlobalCenter(),"deadend"==r.type&&(this.deadmask.visible=!0,this.deadmask.texture.rotate=r.texture.rotate,this.deadmask.zIndex=this.zIndex+10,this.parent.addChild(this.deadmask),this.deadmask.position.copyFrom(this._targetPoint))):this.deadmask.visible=!1}}else this._setAnim(e)}},t.prototype.reset=function(){this._spine.scale.set(1)},Object.defineProperty(t.prototype,"moved",{get:function(){return!this._moveComplete},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this._spine.update(t.deltaMS/1e3);var e=this._targetPoint.x-this.x,i=this._targetPoint.y-this.y,n=l.GameConfig.stepLen*t.deltaMS*.001/l.GameConfig.stepDuration;Math.abs(e)>2*n||Math.abs(i)>2*n?(this._moveComplete=!1,this.x+=Math.sign(e)*n,this.y+=Math.sign(i)*n,this._setAnim(a.UP)):this._moveComplete||(this._moveComplete=!0,this.currentCell==this.mazeView.endCell&&this.emit("endreached"),this.position.copyFrom(this._targetPoint),this._setAnim(a.NONE))},t.prototype._setAnim=function(t){t!==this._prevDirection&&(t==a.NONE?(this._spine.state.clearTracks(),this._spine.skeleton.setToSetupPose()):(this._spine.state.setAnimation(0,c[t],!0),this._spine.state.timeScale=this._spine.state.getCurrent(0).animation.duration/l.GameConfig.stepDuration),this._prevDirection=t)},t}(PIXI.Container);i.Player=d},{"../shared/M2":134,"./Assets":104,"./GameConfig":105,"@tweenjs/tween.js":1}],111:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(s){function t(t,e){void 0===t&&(t=100),void 0===e&&(e=220);var i=this,n=document.createElement("canvas"),o=.5*e|0;n.width=n.height=2*o;var r=n.getContext("2d");r.clearRect(0,0,2*o,2*o);var a=r.createRadialGradient(o,o,.1*t,o,o,t);return a.addColorStop(0,"#00000080"),a.addColorStop(1,"#FFFFFF"),r.fillStyle=a,r.fillRect(0,0,2*o,2*o),(i=s.call(this,PIXI.Texture.from(n))||this).blendMode=PIXI.BLEND_MODES.SUBTRACT,i.anchor.set(.5),i.context=r,i}return o(t,s),t}(PIXI.Sprite);i.Spot=r},{}],112:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("../shared/BaseGame"),a=t("../shared/APIData"),s=t("./Assets"),h=t("./GameConfig"),l=t("../shared/M2"),p=t("../shared/ui/Popup"),c=t("../shared/ui/UiManager"),u=t("../shared/CrossplatformInputHandler"),d=t("../shared/ui/IUIListener"),f=t("./Maze"),y=t("./MazeBuilder"),m=t("./Player"),g=t("./Spot"),v=t("@tweenjs/tween.js"),b=t("./Ghost"),_=function(n){function t(){var t=n.call(this)||this;return t._progress=0,t._power=0,t._lastNear=!1,t._allowMovement=!1,t.input=new u.InputHandler(!1,l.M2.mobile),t.apiData=new a.APIData("Maze",t),t.stage=new PIXI.Container,t.gameLevel=new PIXI.Container,t.gameLevel.sortableChildren=!0,t.loader=new PIXI.Loader(s.Assets.BaseDir),t}return o(t,n),Object.defineProperty(t.prototype,"spotPower",{get:function(){return this._power},set:function(t){if(!this.levelData||!this.levelData.power)return this._power=1/0,void(this.overlay.alpha=0);var e=this.levelData.power;this._power=l.M2.clamp(t,0,e),this.overlay.alpha=1-this._power/e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=t,this.ui.progress=t},enumerable:!0,configurable:!0}),t.prototype.init=function(t){var e=this;this.app=t,this.lang=this.app.multilang.getTextBase("Maze"),this.gameState.on("enter",this.onStateEnter,this),this.res=this.loader.resources,this.maze=new f.Maze,this.stage.y=t.height,this.ui=this.app.uiManager,this.ui.setOptions({showArrows:!1,showProgress:!1,level:this.apiData.lastOpenedLevel,controlLayout:c.ControlsLayout.FULL,levelHint:this.lang.levels[0],progressHint:this.lang.progress[0]}),this.input.mobileControlls=this.ui.controls,this.player=new m.Player(this.res),this.player.on("endreached",this.onEndReached,this),this.player.zIndex=100,this.ghost=new b.Ghost(this.res),this.ghost.zIndex=110,this.spot=new g.Spot(500,1.5*t.height),this.spot.scale.set(2),this.spot.zIndex=200,this.overlay=new PIXI.Sprite(PIXI.Texture.WHITE),this.overlay.anchor.set(0,1),this.overlay.width=this.app.width,this.overlay.height=this.app.height,this.overlay.zIndex=300,this.overlay.alpha=0,this.overlay.tint=0,this.mazeBuilder=new y.MazeBuilder(this.res[s.Assets.Assets["map-atlas"].name].textures);var i=h.GameConfig.levels[0];this.maze.build(i.size,i.size).then(function(){return e.onMazeBuilded()}),this.gameState.current=r.GameState.PRE,this.gameLevel.addChild(this.player,this.ghost,this.spot),this.stage.addChild(this.gameLevel,this.overlay),this.app.uiManager.hint.open(this.lang.hello),n.prototype.init.call(this,t),n.prototype.start.call(this)},t.prototype.preload=function(){return this.loader.add(Object.values(s.Assets.Assets)),n.prototype.preload.call(this)},t.prototype.reset=function(){this._progress=0,this.mazeView.destroy({children:!0}),this.mazeView=void 0,this.gameState.current=void 0,this.ghost.reset(),this._allowMovement=!1},t.prototype.onPlayerNearAtEnd=function(t){var e=this;if(void 0===t&&(t=!1),this._lastNear!=t&&!this._allowMovement&&(this._lastNear=t,this.levelData)){var i=this.progress==this.levelData.gems;if(t){var n=this.ghost.showBalloon(this.levelData.gems);if(i){var o=new v.Tween(this.ghost).to({angle:180},200),r=new v.Tween(this.ghost.position).to({y:this.ghost.y-600},800);n.chain(o,this.ghost.hideBaloon()),o.chain(r),r.onComplete(function(){e.mazeView.endCell.data.wall[1]=!1}),this._allowMovement=!0}}else this.ghost.hideBaloon()}},t.prototype.onEndReached=function(){var t=this;this.progress<this.levelData.gems||(this.gameState.current=r.GameState.PREWIN,new v.Tween(this.player.position).to({y:this.player.y-2*h.GameConfig.stepLen},2*h.GameConfig.stepDuration*1e3).onComplete(function(){t.gameState.current=r.GameState.WIN}).start())},t.prototype.onMazeBuilded=function(){this.mazeView=this.mazeBuilder.buildMaze(this.maze,this.levelData?this.levelData.gems:5),this.mazeView.y-=this.mazeView.height,this.gameLevel.addChild(this.mazeView),this.player.mazeView=this.mazeView,this.player.place(this.mazeView.startCell),this.ghost.position=this.mazeView.endCell.getGlobalCenter(),this.ghost.y+=200,this.mazeView.endCell.data.wall[1]=!0,this.levelData&&this.ghost.setAmount(this.levelData.gems),this.spot.position.copyFrom(this.player.position),this.updateCamera()},t.prototype.setLevel=function(t){var e=this;this.apiData.current=t,this.levelData=h.GameConfig.levels[t-1],this.spotPower=this.levelData.power,this.player.move(new PIXI.Point),this.reset(),this.maze.build(this.levelData.size,this.levelData.size).then(function(){e.onMazeBuilded(),e.gameState.current=r.GameState.GAME})},t.prototype.reload=function(){this.setLevel(this.apiData.current)},t.prototype.popupOpened=function(t){t==d.IPopup.MENU&&this.app.uiManager.setOptions({showArrows:!1,level:this.apiData.lastOpenedLevel})},t.prototype.softPause=function(){return this.player.move(new PIXI.Point(0,0)),n.prototype.softPause.call(this)},t.prototype.onStateEnter=function(t){var e=this;switch(t){case r.GameState.PRE:this.ui.setOptions({showProgress:!1,progress:0,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(p.PopupType.START);break;case r.GameState.GAME:this.ui.setOptions({showProgress:!0,progress:0,showArrows:l.M2.mobile,level:this.apiData.current,progressMax:this.levelData.gems}),this.ui.progress=0;break;case r.GameState.PREWIN:break;case r.GameState.WIN:this.apiData.levelSucsess(),this.ui.setOptions({showProgress:!1,progress:0,showArrows:!1,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(p.PopupType.WIN),setTimeout(function(){e.gameState.current===r.GameState.WIN&&e.ui.hint.open(e.lang.endings)},1e3);break;case r.GameState.LOSE:this.apiData.levelFailed(),this.ui.setOptions({showProgress:!1,progress:0,showArrows:!1,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(p.PopupType.LOSE),setTimeout(function(){if(e.gameState.current===r.GameState.LOSE){var t=e.apiData.loosesAtRun%3==0&&0<e.apiData.loosesAtRun;e.ui.hint.open(t?e.lang.falling_3times:e.lang.falling)}},1e3)}},t.prototype.pause=function(){this.player.move(new PIXI.Point(0,0)),this.app.uiManager.onPause(),n.prototype.pause.call(this)},t.prototype.resume=function(){this.app.uiManager.onResume(),n.prototype.resume.call(this)},t.prototype.update=function(t){if(!this._isPaused&&(this.spot.x=this.player.x+100*Math.sin(this.player.rotation),this.spot.y=this.player.y-100*Math.cos(this.player.rotation),this.gameState.current==r.GameState.GAME&&this.mazeView)){this.input.update(),this.player.move(this.input.axis),this.player.update(t),this.spotPower-=.001*t.deltaMS,this.spotPower<=.05&&(this.gameState.current=r.GameState.LOSE);var e=this.player.currentCell,i=this.mazeView.endCell,n=Math.abs(e.data.x-i.data.x)+Math.abs(e.data.y-i.data.y);this.onPlayerNearAtEnd(n<=1),this.updateGems(),this.updateCamera()}},t.prototype.updateGems=function(){for(var o=this,r=this.mazeView.gems,a=this.mazeView.toLocal(this.player.position,this.gameLevel,void 0,!0),t=function(t){var e=r[t],i=Math.abs(a.x-e.x),n=Math.abs(a.y-e.y);Math.sqrt(Math.pow(i,2)+Math.pow(n,2))<=.75*h.GameConfig.stepLen&&(s.progress++,s.spotPower+=h.GameConfig.gemtopower,r.splice(t,1),s.gameLevel.addChild(e),s.gameLevel.toLocal(e.position,s.mazeView,e.position,!0),new v.Tween({a:0}).to({a:1},200).onUpdate(function(t){e.x-=(e.x-o.player.x)*t.a,e.y-=(e.y-o.player.y)*t.a}).onComplete(function(){e.destroy()}).start())},s=this,e=r.length-1;0<=e;e--)t(e)},t.prototype.updateCamera=function(){if(this.mazeView){var t=this.player.x-.5*this.app.width,e=this.player.y+.5*this.app.height;this.gameLevel.pivot.x=l.M2.clamp(t,0,this.mazeView.width-this.app.width),this.gameLevel.pivot.y=l.M2.clamp(e,-this.mazeView.height+this.app.height,0)}},t}(r.BaseGame);i.Maze=_},{"../shared/APIData":129,"../shared/BaseGame":131,"../shared/CrossplatformInputHandler":132,"../shared/M2":134,"../shared/ui/IUIListener":143,"../shared/ui/Popup":145,"../shared/ui/UiManager":147,"./Assets":104,"./GameConfig":105,"./Ghost":106,"./Maze":107,"./MazeBuilder":108,"./Player":110,"./Spot":111,"@tweenjs/tween.js":1}],113:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),t("./PixiBindings").HookPixi();var r=t("p2"),s=t("./constants"),a=function(a){function t(t){var e=a.call(this)||this;return e._lastTime=void 0,e._enabled=!0,t.gravity=t.gravity||[0,0],t.gravity[0]*=s.PIXEL_TO_METR,t.gravity[1]*=s.PIXEL_TO_METR,e.world=new r.World(t),e}return o(t,a),t.prototype.updateBodies=function(){for(var t=0,e=this.children;t<e.length;t++){var i=e[t];i&&i.body&&-1==this.world.bodies.indexOf(i.body)&&this.world.addBody(i.body)}},t.prototype.addChild=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,n=t;i<n.length;i++){var o=n[i];o.body&&this.world.addBody(o.body)}return a.prototype.addChild.apply(this,t)},t.prototype.addChildAt=function(t,e){return t.body&&this.world.addBody(t.body),a.prototype.addChildAt.call(this,t,e)},t.prototype.removeChild=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,n=t;i<n.length;i++){var o=n[i];o.body&&this.world.removeBody(o.body)}return a.prototype.removeChild.apply(this,t)},t.prototype.removeChildAt=function(t){var e=a.prototype.removeChildAt.call(this,t);return e&&e.body&&this.world.removeBody(e.body),e},t.prototype.removeChildren=function(t,e){for(var i=a.prototype.removeChildren.call(this,t,e),n=0,o=i;n<o.length;n++){var r=o[n];r.body&&this.world.removeBody(r.body)}return i},t.prototype.now=function(){return performance?performance.now():Date.now()},Object.defineProperty(t.prototype,"enabled",{set:function(t){this._enabled=t,this._lastTime=this.now()},enumerable:!0,configurable:!0}),t.prototype.get=function(){return this._enabled},t.prototype.update=function(t,e){if(void 0===t&&(t=60),void 0===e&&(e=5),this._enabled&&this.world){var i=this.now(),n=this._lastTime?i-this._lastTime:1/t;this.world.step(1/t,n,e);for(var o=0,r=this.world.bodies;o<r.length;o++){r[o].update()}this._lastTime=i}},t.prototype.destroy=function(t){for(var e=0,i=this.world.bodies;e<i.length;e++){i[e].destroy()}a.prototype.destroy.call(this,t),this.world.clear(),this.world=void 0},t}(PIXI.Container);i.PhysicContainer=a},{"./PixiBindings":114,"./constants":116,p2:33}],114:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./PixiBody");i.HookPixi=function(){console.log("Path pixi"),PIXI.DisplayObject.prototype.setBody=function(t){return this.body||(this.body=new n.PixiBody(t,this)),this}}},{"./PixiBody":115}],115:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),p=this&&this.__assign||function(){return(p=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0});var c=t("p2"),u=t("./constants"),r=function(l){function t(t,e){var i=this;if(!e)throw Error("Display object can't be null");(t=t||{}).boundsToShape=null==t.boundsToShape||t.boundsToShape;var n=e.position,o=t.force?t.force:{x:0,y:0},r=t.velocity?t.velocity:{x:0,y:0},a=p({},t,{position:[-n.x*u.PIXEL_TO_METR,-n.y*u.PIXEL_TO_METR],velocity:[r.x,r.y],force:[o.x,o.y]});if((i=l.call(this,a)||this).angle=e.rotation,i.display=e,t.shape instanceof c.Shape)i.addShape(t.shape);else if(t.boundsToShape){var s=e.getLocalBounds(),h=new c.Box({width:Math.abs(s.width*u.PIXEL_TO_METR*e.scale.x),height:Math.abs(s.height*u.PIXEL_TO_METR*e.scale.y)});h.material=t.material,i.addShape(h)}return i._lastTransform=i.display.transform._localID,i}return o(t,l),t.prototype.update=function(){if(this._lastTransform!==this.display.transform._localID)this.position[0]=-this.display.x*u.PIXEL_TO_METR,this.position[1]=-this.display.y*u.PIXEL_TO_METR,this.angle=this.display.rotation;else{if(this.sleepState!=c.Body.AWAKE)return;this.display.position.set(-this.position[0]*u.METR_TO_PIXEL,-this.position[1]*u.METR_TO_PIXEL),this.display.rotation=this.angle}this._lastTransform=this.display.transform._localID},t.prototype.destroy=function(){this.display=void 0},t}(c.Body);i.PixiBody=r},{"./constants":116,p2:33}],116:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PIXEL_TO_METR=.01,i.METR_TO_PIXEL=100},{}],117:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){PIXI.Container.prototype.getChildByPath=function(t){if(this instanceof PIXI.Container&&0!=this.children.length){for(var e=this,i=t.split("/"),n=new RegExp("(?:{{0})-?d+(?=})"),o=0,r=i;o<r.length;o++){var a=r[o];if(null==e||!(e instanceof PIXI.Container)){e=void 0;break}if(0!=a.trim().length){var s=a.match(n);if(s){var h=parseInt(s[0]);h<0&&(h+=e.children.length),e=h>=e.children.length?void 0:e.children[h]}else e=e.getChildByName(a)}}return e}},PIXI.Container.prototype.addGlobalChild=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.transform.updateLocalTransform();for(var i=new PIXI.Matrix,n=this.transform.localTransform.clone().invert(),o=0;o<t.length;o++){var r=t[o];r.transform.updateLocalTransform(),i.copyFrom(n),i.append(r.localTransform),t[o].transform.setFromMatrix(i)}return this.addChild.apply(this,t)}}},{}],118:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){PIXI.DisplayObject.prototype.replaceWithTransform=function(t){t.updateTransform(),t.parent&&t.parent.addChildAt(this,t.parent.getChildIndex(t)),this.position.copy(t.position),this.scale.copy(t.scale),this.rotation=t.rotation,this.updateTransform()}}},{}],119:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(){}return e.upHandler=function(t){t.preventDefault(),e.IsKeyDown[t.keyCode]=!1,e.events.emit("keyup",t)},e.downHandler=function(t){t.preventDefault(),e.IsKeyDown[t.keyCode]=!0,e.events.emit("keydown",t)},e.focusOut=function(t){e.IsKeyDown=[]},e.BindKeyHandler=function(t){(e.latestDom=t).addEventListener("keydown",e.downHandler),t.addEventListener("keyup",e.upHandler),t.addEventListener("blur",e.focusOut)},e.ReleaseKeyHandler=function(){e.latestDom&&(e.latestDom.removeEventListener("keydown",e.downHandler),e.latestDom.removeEventListener("keyup",e.upHandler),e.latestDom.removeEventListener("blur",e.focusOut),e.latestDom=void 0),e.IsKeyDown=[],e.events.removeAllListeners()},e.IsKeyDown=[],e.events=new PIXI.utils.EventEmitter,e}();i.KeyInputHandler=n},{}],120:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){PIXI.Loader.prototype.filter=function(e){if(!e)return[];var i=this.resources,n=[];return Object.keys(i).forEach(function(t){e(i[t])&&n.push(i[t])}),n}}},{}],121:[function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});var o=n(t("./ContainerExt")),r=n(t("./DisplayExt")),a=n(t("./LoaderExt"));i.default=function(){o.default(),r.default(),a.default()}},{"./ContainerExt":117,"./DisplayExt":118,"./LoaderExt":120}],122:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../shared/config");i.Assets={BaseDir:n.Config.BaseResDir+"/game2/",Assets:{"game-atlas":{name:"game-atlas",url:"./game2-atlas.json"},bg:{name:"bg.png",url:"./bg.png"},bg_front:{name:"bg_front.jpg",url:"./bg_front.jpg"}}}},{"../shared/config":137}],123:[function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var a=t("./Assets"),o=function(o){function t(t){var e=this,i=t[a.Assets.Assets.bg_front.name].texture;e=o.call(this,i)||this;var n=t[a.Assets.Assets.bg.name].texture;return e._overlay=new PIXI.Sprite(n),e._overlay.visible=!1,e._overlay.anchor.set(.5),e._overlay.position.set(.5*i.width,.5*i.height),e.addChild(e._overlay),e}return r(t,o),Object.defineProperty(t.prototype,"level",{set:function(t){this._overlay.visible=1<t,this._overlay.alpha=.5*(1-(t-1)/3),this._overlay.scale.set(1+.1*(t-1))},enumerable:!0,configurable:!0}),t}(PIXI.Sprite);i.Background=o},{"./Assets":122}],124:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("p2"),a=t("../physics/constants"),s=t("./Assets"),h=t("./GameConfig"),l=function(n){function t(t){var e=n.call(this,t)||this;e.anchor.set(.5);var i=new r.Circle({radius:.5*t.width*a.PIXEL_TO_METR});return i.material=null,i.collisionGroup=h.GameConfig.groups.ball,i.collisionMask=h.GameConfig.groups.any&~h.GameConfig.groups.ball,e.setBody({mass:1,fixedRotation:!1,damping:0,shape:i}),e}return o(t,n),t.prototype.push=function(t){var e=[-t.x*a.PIXEL_TO_METR,-t.y*a.PIXEL_TO_METR];this._speed=r.vec2.len(e),this.body.applyImpulse(e)},t.prototype.freeze=function(){this.body.velocity=[0,0]},t.prototype.OnTouch=function(t){var e=t.contactEquations[0],i=[0,0];i=t.bodyB===this.body?e.normalA:[-e.normalA[0],-e.normalA[1]];var n=r.vec2.clone(this.body.velocity);r.vec2.normalize(n,n),r.vec2.reflect(n,n,i),this.body.velocity[0]=n[0]*this._speed,this.body.velocity[1]=n[1]*this._speed},t}(PIXI.Sprite);i.Ball=l;var p=function(){function t(t){this.balls=[];var e=t[s.Assets.Assets["game-atlas"].name].textures;this.ballTex=e["snowball.png"]}return t.prototype.getBall=function(t){var e=new l(this.ballTex);return e.zIndex=100,t&&(e.position.set(t.x,t.y),e.body.update()),this.parent.addChild(e),this.balls.push(e),e},t.prototype.releaseAll=function(){for(var t=0,e=this.balls;t<e.length;t++){var i=e[t];i&&i.destroy()}this.balls=[]},t}();i.BallFabric=p},{"../physics/constants":116,"./Assets":122,"./GameConfig":126,p2:33}],125:[function(t,e,r){"use strict";var n,i,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(r,"__esModule",{value:!0});var a,s,h=t("@tweenjs/tween.js"),l=t("./Assets"),p=t("./Ball");(s=a=r.BoostType||(r.BoostType={})).NONE="none",s.SPEED="speed",s.BOUND="bound",s.TRIPLE="triple",r.BOOST2TEX=((i={})[a.BOUND]="boost bound.png",i[a.SPEED]="boost speed.png",i[a.TRIPLE]="boost 1 in 3.png",i);var c=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.activate=function(){this.attractor.activate(this.type,this.duration),this.destroy()},t.prototype.OnTouch=function(t){this.activate()},t}(p.Ball);r.Boost=c;var u=function(i){function t(t){var e=i.call(this)||this;return e.tex=t[l.Assets.Assets["game-atlas"].name].textures,e._icon=new PIXI.Sprite(PIXI.Texture.EMPTY),e._icon.anchor.set(.5),e._bar=new PIXI.Graphics,e.addChild(e._icon,e._bar),e.activate(a.NONE,0),e}return o(t,i),t.prototype.activate=function(t,e){var i=this;this._tween&&this._tween.stop(),(this._active=t)!=a.NONE?(this.visible=!0,this._duration=e,this._icon.texture=this.tex[r.BOOST2TEX[t]],this._progress=0,this._tween=new h.Tween(this).to({_progress:1},1e3*this._duration).onUpdate(function(){i._update()}).onComplete(function(){i.visible=!1}).start()):this.visible=!1},Object.defineProperty(t.prototype,"progress",{get:function(){return this._progress},enumerable:!0,configurable:!0}),t.prototype._update=function(){var t=.5*this._icon.width,e=2*this._progress*Math.PI-.5*Math.PI,i=Math.sin(e)*t,n=Math.cos(e)*t;this._bar.clear().beginFill(0,.4).lineTo(n,i).arc(0,0,t,e,.5*-Math.PI,!0).lineTo(0,0).endFill().closePath()},t.prototype.spawn=function(t,e,i){var n=this.tex[r.BOOST2TEX[e]],o=new c(n);return o.x=t.x,o.y=t.y,o.body.update(),o.duration=i,o.type=e,o.attractor=this,o},t}(PIXI.Container);r.BoostView=u},{"./Assets":122,"./Ball":124,"@tweenjs/tween.js":1}],126:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameConfig={groups:{any:-1,ball:1,boost:2},padding:{top:200,bottom:0},playerSpeed:200}},{}],127:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var s,r,h=t("./Assets"),l=t("p2"),p=t("../physics/constants"),c=t(".."),u=t("./GameConfig");(r=s=i.PadType||(i.PadType={}))[r.PLAYER=0]="PLAYER",r[r.BOT=1]="BOT";var a=function(a){function t(t,e){void 0===e&&(e=s.PLAYER);var i=this,n=t[h.Assets.Assets["game-atlas"].name].textures,o=n["Neeo.png"];e==s.BOT&&(o=n["penguin.png"]),(i=a.call(this,o)||this).anchor.set(.5),e==s.BOT&&(i.angle=180),i.setBody({type:l.Body.KINEMATIC,boundsToShape:!1});var r=new l.Line({length:i.width*p.PIXEL_TO_METR,collisionGroup:u.GameConfig.groups.any,collisionMask:u.GameConfig.groups.any});return i.body.addShape(r,[0,.5*i.height*p.PIXEL_TO_METR]),i.speed=u.GameConfig.playerSpeed,i.safeZone=c.App.instance.size,i}return o(t,a),Object.defineProperty(t.prototype,"targetX",{get:function(){return this._targetX},set:function(t){this._targetX=Math.max(this.safeZone.x,Math.min(this.safeZone.right,t));var e=Math.sign(this._targetX-this.x)*this.speed*p.PIXEL_TO_METR;this.body.velocity=[-e,0]},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(this._isNear())return this.x=this.targetX,void(this.body.velocity=[0,0])},t.prototype._isNear=function(){return Math.abs(this.x-this._targetX)<10},t}(PIXI.Sprite);i.Pad=a},{"..":103,"../physics/constants":116,"./Assets":122,"./GameConfig":126,p2:33}],128:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var s=t("../shared/BaseGame"),r=t("../physics/PhysicContainer"),h=t("p2"),l=t("./Background"),p=t("./Assets"),c=t("./Pad"),u=t("./Ball"),d=t("../physics/constants"),f=t("../shared/APIData"),y=t("./GameConfig"),m=t("./Boost"),g=t("@tweenjs/tween.js"),v=t("../shared/ui/IUIListener"),b=t("../shared/ui/Popup"),_=t("../shared/M2"),a=function(a){function t(){var t=a.call(this)||this;return t._ballSpeed=2,t.apiData=new f.APIData("Pong",t),t.stage=new PIXI.Container,t.physic=new r.PhysicContainer({gravity:[0,0]}),t.physic.world.defaultContactMaterial.friction=0,t.loader=new PIXI.Loader(p.Assets.BaseDir),t}return o(t,a),t.prototype.preload=function(){return this.loader.add(Object.values(p.Assets.Assets)),a.prototype.preload.call(this)},t.prototype.init=function(t){var e;a.prototype.init.call(this,t),this.lang=this.app.multilang.getTextBase("Pong"),this.gameState.on("enter",this.onStateEnter,this),this.ui=this.app.uiManager,this.ui.setOptions({showArrows:!1,showProgress:!1,level:this.apiData.lastOpenedLevel,levelHint:this.lang.levels[0],progressHint:this.lang.progress[0]});var i=this.loader.resources;this.boostManager=new m.BoostView(i),this.boostManager.x=t.width-200,this.boostManager.y=200,this._back=new l.Background(i),this._back.height=t.height,this._spawner=new u.BallFabric(i),this._spawner.parent=this.physic,this._bot=new c.Pad(i,c.PadType.BOT),this._player=new c.Pad(i,c.PadType.PLAYER),this._bot.x=this._player.x=.5*t.width,this._player.y=t.height-.5*this._player.height-y.GameConfig.padding.bottom,this._bot.y=.5*this._bot.height+y.GameConfig.padding.top,this.stage.interactive=!0,this.stage.on("mousemove",this.move,this),this.stage.on("touchmove",this.move,this);for(var n=[],o=0;o<2;o++){var r=new PIXI.DisplayObject;r.x=o*t.width,r.y=.5*t.height,r.setBody({type:h.Body.STATIC,shape:new h.Box({width:10*d.PIXEL_TO_METR,height:t.height*d.PIXEL_TO_METR,collisionGroup:y.GameConfig.groups.any,collisionMask:y.GameConfig.groups.any})}),n.push(r)}(e=this.physic).addChild.apply(e,n.concat([this._player,this._bot])),this.physic.world.on("beginContact",this.beginContact,this),this.stage.addChild(this._back,this.physic,this.boostManager),this.gameState.current=s.GameState.PRE,this.ui.hint.open(this.lang.hello)},t.prototype.onStateEnter=function(t){var e=this;switch(t){case s.GameState.PRE:this.ui.setOptions({showProgress:!1,progress:0,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(b.PopupType.START);break;case s.GameState.GAME:this.ui.setOptions({showProgress:!0,progress:0,showArrows:!1,level:this.apiData.current,progressMax:3}),this.ui.progress=0;break;case s.GameState.PREWIN:break;case s.GameState.WIN:this.apiData.levelSucsess(),this.ui.setOptions({showProgress:!1,progress:0,showArrows:!1,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(b.PopupType.WIN),setTimeout(function(){e.gameState.current===s.GameState.WIN&&e.ui.hint.open(e.lang.endings)},1e3);break;case s.GameState.LOSE:this.apiData.levelFailed(),this.ui.setOptions({showProgress:!1,progress:0,showArrows:!1,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(b.PopupType.LOSE),setTimeout(function(){if(e.gameState.current===s.GameState.LOSE){var t=e.apiData.loosesAtRun%3==0&&0<e.apiData.loosesAtRun;e.ui.hint.open(t?e.lang.falling_3times:e.lang.falling)}},1e3)}},t.prototype.beginContact=function(t){t.bodyA.display.OnTouch&&t.bodyA.display.OnTouch(t),t.bodyB.display.OnTouch&&t.bodyB.display.OnTouch(t)},t.prototype.spawnBoost=function(t,e,i){var n=this.boostManager.spawn(t,e,i);n.body.shapes[0].sensor=!0,n.scale.set(.1),this.stage.addChild(n);var o={val:.1};new g.Tween(o).to({val:1},200).onUpdate(function(){n.scale.set(o.val)}).onComplete(function(){n.body.shapes[0].sensor=!1}).start()},t.prototype.spawnBall=function(){this._spawner.getBall(new PIXI.Point(.5*this.app.width,.5*this.app.height)).push({x:this._ballSpeed*d.METR_TO_PIXEL,y:this._ballSpeed*d.METR_TO_PIXEL})},t.prototype.setLevel=function(t){this.reset(),this.apiData.current=t,this.gameState.current=s.GameState.GAME,this.spawnBall()},t.prototype.reload=function(){this.setLevel(this.apiData.current)},t.prototype.popupOpened=function(t){t==v.IPopup.MENU&&this.app.uiManager.setOptions({showArrows:!1,level:this.apiData.lastOpenedLevel})},t.prototype.softPause=function(){return a.prototype.softPause.call(this)},t.prototype.pause=function(){this.app.uiManager.onPause(),a.prototype.pause.call(this)},t.prototype.resume=function(){this.app.uiManager.onResume(),a.prototype.resume.call(this)},t.prototype.reset=function(){this._spawner.releaseAll(),this._bot.x=this._player.x=.5*this.app.width},t.prototype.update=function(t){this._isPaused||this.gameState.current===s.GameState.GAME&&(this._player.update(t),this.updateBalls(),this.physic.update(t.FPS,5))},t.prototype.updateBalls=function(){for(var t=0,e=this._spawner.balls;t<e.length;t++){var i=e[t].position.y;if(i>=this._player.y)return void console.log("BOT WIN");if(i<this._bot.y)return void console.log("Player Win")}},t.prototype.move=function(t){var e=_.M2.clamp(t.data.global.x,.5*this._player.width,this.app.width-.5*this._player.width);this._player.targetX=e},t}(s.BaseGame);i.Pong=a},{"../physics/PhysicContainer":113,"../physics/constants":116,"../shared/APIData":129,"../shared/BaseGame":131,"../shared/M2":134,"../shared/ui/IUIListener":143,"../shared/ui/Popup":145,"./Assets":122,"./Background":123,"./Ball":124,"./Boost":125,"./GameConfig":126,"./Pad":127,"@tweenjs/tween.js":1,p2:33}],129:[function(t,e,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0});var o=t("../index"),r=function(){function t(t,e){if(this._levels=[{opened:!0,playing:0},{opened:!1,playing:0},{opened:!1,playing:0}],!o.App.instance)throw new Error("Main app must be instanced!");this._name=t,this._loosesAtRun=0,this._winsAtRun=0,this._apiBridge=o.App.instance.api,this._game=e}return t.prototype.init=function(){if(!this._inited){var t=this._apiBridge.getGameData(this._name);if((t=n({},{level:1,score:0},t||{}))&&!t.error){if(t.data instanceof Array){for(var e=0;e<Math.min(t.data.length,this._levels.length);e++)this._levels[e].opened=t.data[e].opened,this._levels[e].playing=t.data[e].playing;return void(this._inited=!0)}for(e=0;e<this._levels.length;e++)this._levels[e].opened=t.level>=e+1,this._levels[e].playing=~~this._levels[e].opened;this._levels[t.level-1].playing=0}this._inited=!0}},Object.defineProperty(t.prototype,"lastOpenedLevel",{get:function(){this.init();for(var t=0,e=0;e<this._levels.length;e++)this._levels[e].opened&&t++;return t},enumerable:!0,configurable:!0}),t.prototype.levelFailed=function(){this._loosesAtRun++,(this._winsAtRun=0)!=this._current&&(this._levels[this._current].opened=0<this._levels[this._current].playing),this._apiBridge.setGameData(this._name,{level:this.lastOpenedLevel,score:200*(this.lastOpenedLevel-1),data:this._levels}),this._apiBridge.submitGameState(this._name,{type:"other",data:{reason:"fail",message:"Level failed"}})},t.prototype.levelSucsess=function(){this._loosesAtRun=0,this._winsAtRun++,this._levels[this._current].playing++,this._current+1<this._levels.length&&(this._levels[this._current+1].opened=!0),this._apiBridge.submitGameState(this._name,{type:"other",data:{reason:this._current==this._levels.length-1?"gameComplete":"success",message:"Level success"}}),this._apiBridge.setGameData(this._name,{level:this.lastOpenedLevel,score:2e3*(this.lastOpenedLevel-1),data:this._levels})},t.prototype.submitLoadingProgress=function(t,e){this._apiBridge.submitGameState(this._name,{type:"loading",progress:t,data:e})},t.prototype.submitState=function(t){this._apiBridge.submitGameState(this._name,t)},Object.defineProperty(t.prototype,"current",{get:function(){return this._current+1},set:function(t){this._current=Math.min(this.lastOpenedLevel-1,t-1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loosesAtRun",{get:function(){return this._loosesAtRun},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"winsAtRun",{get:function(){return this._winsAtRun},enumerable:!0,configurable:!0}),t}();i.APIData=r},{"../index":103}],130:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./config");i.Assets={BaseDir:n.Config.BaseResDir,Assets:{"ui-atlas":{name:"ui-atlas",url:"./ui/en_US/ui-atlas.json"},"ui-map":{name:"ui-map",url:"./ui/ui-map.json"}},AssetsTranslated:{en_US:{"ui-atlas":{name:"ui-atlas",url:"./ui/en_US/ui-atlas.json"}},ru_RU:{"ui-atlas":{name:"ui-atlas",url:"./uiru_RU/ui-atlas.json"}}}}},{"./config":137}],131:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,o,r=t("./StateBech");(o=n=i.GameState||(i.GameState={}))[o.PRE=0]="PRE",o[o.GAME=1]="GAME",o[o.PREWIN=2]="PREWIN",o[o.WIN=3]="WIN",o[o.LOSE=4]="LOSE";var a=function(){function t(){this.gameState=new r.StateBech,this._isPaused=!1}return t.prototype.init=function(t){this.app=t,this.apiData.submitState({type:"init"})},t.prototype.start=function(){this.apiData.submitState({type:"start"})},t.prototype.preload=function(){var i=this;return this.apiData&&this.loader.on("progress",function(t,e){i.apiData.submitLoadingProgress(t.progress,{name:e.name})}),this.loader},t.prototype.softPause=function(){var t=this.gameState.current==n.GAME&&!this._isPaused;return this._isPaused=!0,t},t.prototype.softResume=function(){this._isPaused&&(this._isPaused=!1)},t.prototype.pause=function(){this.softPause(),this.input&&this.input.unbindInput(),this.apiData.submitState({type:"pause"})},t.prototype.resume=function(){this.input&&this.input.bindInput(),this.apiData.submitState({type:"resume"})},t.prototype.stop=function(){for(var t in this.input&&this.input.unbindInput(),this.loader.resources){var e=this.loader.resources[t];if(e.texture&&e.texture.destroy(!0),e.textures)for(var i in e.textures)e.textures[i]&&e.textures[i].destroy(!0)}this.stage.destroy({children:!0,texture:!0,baseTexture:!0}),this.loader.reset(),this.apiData.submitState({type:"close"})},t.prototype.update=function(t){this.input&&this.input.update()},t}();i.BaseGame=a},{"./StateBech":136}],132:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,o,r,a,s=t("../pixi-utils/InputHandler");(o=n||(n={})).LEFT="left",o.RIGHT="right",o.TOP="top",o.BOTTOM="bottom",(a=r||(r={}))[a.MOBILE=0]="MOBILE",a[a.ACCEL=1]="ACCEL",a[a.KEY=2]="KEY",a[a.NONE=-1]="NONE";var h=function(){function t(t,e){void 0===t&&(t=!1),this._axis=new PIXI.Point,this.useMobile=!1,this.useAccel=!1,this._binded=!1,this._active=r.NONE,this._mobileKeysStatus={},this._latestAccelX=void 0,this._accelX=0,e=null==e?PIXI.utils.isMobile.any:e,this.useAccel=t&&e,this.useMobile=e}return t.prototype.accelIsSupported=function(){return"ondevicemotion"in window},t.prototype.bindInput=function(){this._binded||(this.useMobile?(this._bindMobile(),this.useAccel&&this._bindAccel()):this._bindKeys(),this._binded=!0,console.log("Input binded"))},t.prototype._bindMobile=function(){var i=this;if(this.mobileControlls)for(var t=function(e){var t=n.mobileControlls[e+"Button"];if(!t)return"continue";t.on("touchstart",function(){var t=e;i._mobileKeysStatus[t]=!0,i._active=r.MOBILE}),t.on("touchend",function(){var t=e;i._mobileKeysStatus[t]=!1}),t.on("touchcancel",function(){var t=e;i._mobileKeysStatus[t]=!1}),t.on("touchendoutside",function(){var t=e;i._mobileKeysStatus[t]=!1})},n=this,e=0,o=["left","right","top","bottom"];e<o.length;e++){t(o[e])}else console.warn("Mobile Controlls UI cant found\n Assign it in c `controlls` property!")},t.prototype._bindAccel=function(){if(this.accelIsSupported())return this._accelHandlerBinding=this._accelHandler.bind(this),void window.addEventListener("devicemotion",this._accelHandlerBinding);console.log("Sorry, but  device orientaon can't support on you device!")},t.prototype._bindKeys=function(){s.KeyInputHandler.BindKeyHandler(window)},t.prototype.unbindInput=function(){this._unbindMobile(),this._unbindAccel(),this._unbindKeys(),this._binded=!1},t.prototype._unbindMobile=function(){if(this.mobileControlls)for(var t=0,e=["left","right","top","bottom"];t<e.length;t++){var i=e[t],n=this.mobileControlls[i+"Button"];n&&(n.removeAllListeners("touchstart"),n.removeAllListeners("touchend"),n.removeAllListeners("touchcancel"),n.removeAllListeners("touchendoutside"),n.removeAllListeners("touchmove"))}},t.prototype._accelHandler=function(t){this.useAccel&&(this._latestAccelX=this._accelX,this._accelX=t.accelerationIncludingGravity.x,this._latestAccelX&&.25<Math.abs(this._accelX-this._latestAccelX)&&(this._active=r.ACCEL))},t.prototype._unbindAccel=function(){window.removeEventListener("devicemotion",this._accelHandlerBinding)},t.prototype._unbindKeys=function(){s.KeyInputHandler.ReleaseKeyHandler()},Object.defineProperty(t.prototype,"axis",{get:function(){return this._axis.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keys",{get:function(){return s.KeyInputHandler.IsKeyDown},enumerable:!0,configurable:!0}),t.prototype.update=function(){switch(this._axis.x=0,this._axis.y=0,this.useAccel||this.useMobile||(this._active=r.KEY),this._active){case r.MOBILE:this._axis.x=~~this._mobileKeysStatus[n.RIGHT]-~~this._mobileKeysStatus[n.LEFT],this._axis.y=~~this._mobileKeysStatus[n.BOTTOM]-~~this._mobileKeysStatus[n.TOP];break;case r.KEY:this._axis.x=~~s.KeyInputHandler.IsKeyDown[39]-~~s.KeyInputHandler.IsKeyDown[37],this._axis.y=~~s.KeyInputHandler.IsKeyDown[40]-~~s.KeyInputHandler.IsKeyDown[38];case r.ACCEL:if(Math.abs(this._accelX)<.25)return;var t=Math.max(-3,Math.min(3,this._accelX))/3;this._axis.x=-t}},t}();i.InputHandler=h},{"../pixi-utils/InputHandler":119}],133:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(n){function t(t){var e=n.call(this,t?t.texture:PIXI.Texture.EMPTY)||this;return e.proto=t,e.rememberWorldID=-1,e.tempTransform=new PIXI.Matrix,e}return o(t,n),t.prototype.updateTransform=function(){var t=this.proto,e=t.transform;if(this.rememberWorldID!==e._worldID){this.rememberWorldID=e._worldID,this.anchor.copyFrom(t.anchor);var i=this.tempTransform;i.copyFrom(this.parent.transform.worldTransform),i.invert(),i.append(e.worldTransform),this.transform.setFromMatrix(i)}n.prototype.updateTransform.call(this)},t}(PIXI.Sprite);i.FrontSprite=r},{}],134:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function i(){}return i.randint=function(t,e){return null==e?Math.floor(i.rand(t)):Math.floor(i.rand(e-t))+t},i.rand=function(t,e){return null==e?Math.random()*t:Math.random()*(e-t)+t},Object.defineProperty(i,"mobile",{get:function(){return PIXI.utils.isMobile.any},enumerable:!0,configurable:!0}),i.randKey=function(t,e){var i=t,n=1,o=0;if(!e)for(var r in n=0,i)o<i[r]&&(o=i[r],e=r),n+=i[r];var a=Math.random()*n;for(var r in i){if(a<i[r])return r;a-=i[r]}return e},i.AngleDist=function(t,e,i){void 0===i&&(i=!0);var n=i?360:2*Math.PI,o=(e-t)%n;return 2*o%n-o},i.clamp=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),Math.max(e,Math.min(i,t))},i}();i.M2=n},{}],135:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0});var a=t("./config"),s=function(i){function t(t){var e=i.call(this)||this;return e.langdata={},e.manifest=t,e._lang="en_US",e.loader=new PIXI.Loader(a.Config.BaseResDir),e}return o(t,i),t.prototype.preload=function(t){var i=this,e=this.manifest[t];if(e){this._lang=t;var n=a.Config.Translations.substr(0,a.Config.Translations.lastIndexOf("/"));this.loader.add(n+"/"+e.url).load().on("load",function(t,e){i.langdata=e.data,i.emit("loaded")})}else this.emit("loaded")},t.prototype.getTextBase=function(t){var e=this.langdata[t]||{},i=this.langdata.ANY||{};return r({},i,e)},t.prototype.map=function(t,e,i){var n=this.getTextBase(t);if(!n)return[e];var o=n[e],r=[];if(!o)return[e];for(var a in r=o instanceof Array?o:[o],i=i||{})for(var s=0;s<r.length;s++)r[s]=r[s].replace(new RegExp("{"+a+"}","g"),""+a);return r},t}(PIXI.utils.EventEmitter);i.Multilang=s},{"./config":137}],136:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return t.call(this)||this}return o(e,t),e.prototype.send=function(t){this._before=this._current,this._current=t,this._current&&this.emit("leave",this._current),this.emit("enter",t)},Object.defineProperty(e.prototype,"current",{get:function(){return this._current},set:function(t){this.send(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"before",{get:function(){return this._before},enumerable:!0,configurable:!0}),e.prototype.release=function(){this.removeAllListeners()},e}(PIXI.utils.EventEmitter);i.StateBech=r},{}],137:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Config={ReferenceSize:{width:1080,height:1720,resolution:1},PausedInBackground:!0,TextStyle:{fontSize:32},BaseResDir:"./res",Translations:"/translations/manifest.json"}},{}],138:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var u=t("./Button"),r=t("@tweenjs/tween.js"),a=t("../../index"),s=function(c){function t(t,e){void 0===e&&(e={});var i=c.call(this)||this;i.fadeDuration=250,i.buttons={},i.texts={},i._animated=!1,i.name=t.name;var n=t.getBounds();i.position.set(n.x,n.y),i.addGlobalChild.apply(i,t.children);for(var o=0,r=e.buttons||[];o<r.length;o++){var a=r[o],s=i.getChildByPath(a+"-btn"),h=i.getChildByPath(a+"-btn:disabled"),l=i.getChildByPath(a+"-btn:text");if(s){var p=new u.Button(s,h,l);p.name=a,i.buttons[a]=p,i.addChild(p)}}return t.destroy(),i.pivot.x=i.width>>1,i.pivot.y=i.height>>1,i}return o(t,c),t.prototype.open=function(t){var i=this;return void 0===t&&(t=!1),this.visible=!0,this._animated?Promise.resolve():t?(this._animated=!1,Promise.resolve()):new Promise(function(t){i._animated=!0;var e=i.y;i.y=-(i.width-i.pivot.y),new r.Tween(i).to({y:e},i.fadeDuration).onComplete(function(){t(),i._animated=!1}).start()})},t.prototype.close=function(t){var e=this;if(void 0===t&&(t=!1),this._animated)return Promise.resolve();if(t)return this.visible=!1,this._animated=!1,Promise.resolve();this._animated=!0;var i=this.y,n=a.App.instance.height+this.pivot.y;return new Promise(function(t){new r.Tween(e).to({y:n},e.fadeDuration).onComplete(function(){e.visible=!1,e.y=i,e._animated=!1,t()}).start()})},t.prototype.reset=function(){for(var t in this.close(!0),this.buttons)this.buttons[t].reset();this.interactiveChildren=!0},t}(PIXI.Container);i.AnimatedPopup=s},{"../../index":103,"./Button":139,"@tweenjs/tween.js":1}],139:[function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var o=function(o){function t(t,e,i){var n=o.call(this)||this;return t&&([t,e,i].forEach(function(t){t&&(t.interactive=t.buttonMode=!1)}),n.interactive=n.buttonMode=!0,n._mainSprite=t,n._disabledSprite=e,n._text=i?i.text:void 0,n._disabled=!1,n.addChild.apply(n,[t,e,i].filter(function(t){return t})),n.disabled=!1,n.reset()),n}return r(t,o),t.prototype.on=function(t,e,i){return o.prototype.on.call(this,t,e,i),this},t.prototype.clicked=function(t){this.emit("b-click",this)},Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled=t,this.interactive=this.buttonMode=!t,this._mainSprite.visible=!t,this._disabledSprite&&(this._disabledSprite.visible=t)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.removeAllListeners(),this.on("click",this.clicked,this),this.on("tap",this.clicked,this)},t}(PIXI.Container);i.Button=o},{}],140:[function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var o=function(o){function t(t,e,i){var n=o.call(this,t,i)||this;return n._checkedSprite=e,n.interactiveChildren=!0,n._checked=!1,n.on("b-click",function(){n.checked=!n.checked,n.emit("b-check",n),console.log("chechked")}),n.addChild(n._checkedSprite),n}return r(t,o),Object.defineProperty(t.prototype,"checked",{get:function(){return this._checked},set:function(t){this._checked=t,this._mainSprite.visible=!t,this._checkedSprite.visible=t},enumerable:!0,configurable:!0}),t}(t("./Button").Button);i.CheckedButton=o},{"./Button":139}],141:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(h){function t(t){var e=h.call(this)||this,i=[],n=t.getBounds();e.position.set(n.x,n.y);for(var o=0,r=["left","right","top","bottom"];o<r.length;o++){var a=r[o],s=t.getChildByPath("arrow-"+a+"-btn");s&&(s.interactive=s.buttonMode=!0,i.push(s),e[a+"Button"]=s)}return e.addGlobalChild.apply(e,i),e}return o(t,h),t.prototype.reset=function(){this.rightButton&&this.rightButton.removeAllListeners(),this.leftButton&&this.leftButton.removeAllListeners(),this.topButton&&this.topButton.removeAllListeners(),this.downButton&&this.downButton.removeAllListeners(),this.interactiveChildren=!0},t}(PIXI.Container);i.Controls=r},{}],142:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var h=t("./Button"),r=function(s){function t(t,e){var i=s.call(this)||this;i._storyIndex=0;var n=t.getChildByPath("hint");i.name=n.name;var o=n.getBounds();i.position.set(o.x,o.y);var r=n.height,a=new PIXI.Sprite(PIXI.Texture.WHITE);return a.tint=0,a.alpha=.5,a.width=e.width+50,a.height=e.height+50,a.y=-e.height+r,a.interactive=!0,i.addChild(a),i.addGlobalChild.apply(i,n.children),i._avatar=i.getChildByName("avatar"),i._avatar.anchor.set(0,1),i._text=i.getChildByPath("text").text,i._text.style.align="left",i._next=new h.Button(i.getChildByName("next-btn")),i.addChild(i._next),i.pivot=n.pivot,n.destroy(),i.pivot.y=r,i._next.on("b-click",function(){i._nextStory()}),i.visible=!1,i}return o(t,s),t.prototype.open=function(t,e){var i=this;return e&&(this._avatar.texture=e),this._textData=t,this._textData&&0!=this._textData.length?(this.visible=!0,this._nextStory(),new Promise(function(t){i._comlite=t})):Promise.resolve()},t.prototype.close=function(){this._comlite&&this._comlite(),this._storyIndex=0,this._textData=[],this._comlite=void 0,this.visible=!1},t.prototype._nextStory=function(){this._storyIndex>=this._textData.length?this.close():(this._text.text=this._textData[this._storyIndex],this._storyIndex+=1)},t}(PIXI.Container);i.Hint=r},{"./Button":139}],143:[function(t,e,i){"use strict";var n;Object.defineProperty(i,"__esModule",{value:!0}),(n=i.IPopup||(i.IPopup={}))[n.MENU=0]="MENU",n[n.PAUSE=1]="PAUSE",n[n.CLOSING=2]="CLOSING"},{}],144:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(n){function t(t){var e=this,i=t.getChildByPath("pause");return(e=n.call(this,i,{buttons:["play","reload","menu"]})||this).reloadButton=e.buttons.reload,e.menuButton=e.buttons.menu,e.playButton=e.buttons.play,e}return o(t,n),t}(t("./AnimatedPopup").AnimatedPopup);i.Pause=r},{"./AnimatedPopup":138}],145:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var f,r,y=t("./Utils"),a=t("./AnimatedPopup");(r=f=i.PopupType||(i.PopupType={})).START="start",r.LOSE="lose",r.WIN="win";var s=function(d){function t(t){var e=this,i=y.Utils.findOn(t,"popup");(e=d.call(this,i,{buttons:["menu","level-0","level-1","level-2"]})||this).levelButtons=[];for(var n=0;n<3;n++){var o=e.buttons["level-"+n];e.levelButtons[n]=o}var r=function(t){a.buttons[t].on("b-click",function(){console.log(t)})},a=this;for(var s in e.buttons)r(s);e.exitButton=e.buttons.menu;var h=[f.WIN,f.LOSE,f.START];e._titles={};for(var l=0,p=h;l<p.length;l++){var c=p[l];e._titles[c]=e.getChildByPath("title-"+c)}var u=e.getChildByPath("bg");return e.pivot.x=u.x+(u.width>>1),e.pivot.y=u.y-(u.height>>1),e}return o(t,d),t.prototype.show=function(t,e){for(var i in void 0===t&&(t=f.START),void 0===e&&(e=!1),this._titles)this._titles[i].visible=t==i;return d.prototype.open.call(this,e)},t.prototype.reset=function(){var n=this;for(var t in d.prototype.reset.call(this),this.close(!0),this.removeAllListeners(),this.buttons)this.buttons[t].reset();this.levelButtons.forEach(function(t,e){var i=e+1;t.on("b-click",function(){n.emit("level-click",i)})}),this.interactiveChildren=!0},t.prototype.setOpenedLevel=function(t){for(var e=0;e<this.levelButtons.length;e++)this.levelButtons[e].disabled=t<e+1},t.prototype.applyTranslation=function(t){for(var e=0;e<3;e++){var i=this.buttons["level-"+e],n=t[e];i&&n&&(i._text.text=n)}},t}(a.AnimatedPopup);i.PopupDifficulty=s},{"./AnimatedPopup":138,"./Utils":148}],146:[function(t,e,a){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(a,"__esModule",{value:!0});var s=t("./Utils");a.EXT_FONT_SETTING={dropShadow:!0,dropShadowAlpha:.4,dropShadowAngle:.4,dropShadowBlur:2,dropShadowColor:"#307a37",dropShadowDistance:4,stroke:"#307a37",strokeThickness:2};var o=function(r){function t(t){var e=r.call(this)||this;e.maxValue=100,e.minValue=0,e.maxLevels=3,e._progress=0,e.progressHint="Platform: {current}/{from} Done",e.levelHint="Level {index}/{from}";var i=s.Utils.findOn(t,"progress-bar");e.addChild.apply(e,i.children);var n=s.Utils.findOn(e,"progress-bar-text");for(var o in e._text=n.text,e._progressSprite=s.Utils.findOn(e,"slider"),e.name=i.name,e._levelText=s.Utils.findOn(e,"progress-title-text").text,a.EXT_FONT_SETTING)e._text.style[o]=a.EXT_FONT_SETTING[o],e._levelText.style[o]=a.EXT_FONT_SETTING[o];return i.destroy(),e.progress=0,e}return i(t,r),Object.defineProperty(t.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=Math.max(this.minValue,Math.min(t,this.maxValue)),this._progressSprite.scale.x=(this._progress-this.minValue)/(this.maxValue-this.minValue),this._text.text=this._formatText()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"levelIndex",{get:function(){return this._levelIndex},set:function(t){this._levelIndex=t;var e=this.levelHint.replace("{current}",""+t).replace("{total}",""+this.maxLevels);this._levelText.text=e},enumerable:!0,configurable:!0}),t.prototype._formatText=function(){var t=this.progressHint.replace("{current}",this._progress.toFixed(0));return t=t.replace("{total}",this.maxValue.toFixed(0))},t}(PIXI.Container);a.Progress=o},{"./Utils":148}],147:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=this&&this.__assign||function(){return(h=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0});var r,a,l=t("./Progress"),p=t("./Button"),c=t("./CheckedButton"),u=t("./Popup"),d=t("../AssetsLib"),f=t("./Utils"),y=t("./Hint"),m=t("./Pause"),g=t("./AnimatedPopup"),s=t("./IUIListener"),v=t("./Controls");(a=r=i.ControlsLayout||(i.ControlsLayout={}))[a.NONE=0]="NONE",a[a.HOR=1]="HOR";var b={progress:0,progressMax:100,showProgress:!0,showArrows:!(a[a.FULL=2]="FULL"),level:1,levelHint:"Level {current}/{total}",progressHint:"Progress {current}/{total}",controlLayout:r.NONE};i.EXT_FONT_SETTINGS={dropShadowAlpha:.4,dropShadowAngle:.4,dropShadowBlur:2,dropShadowColor:"#260e00",dropShadowDistance:2,stroke:"#260e00"};var _=function(i){function t(t){var e=i.call(this)||this;return e.stage=new PIXI.Container,e._options=h({},b),e.app=t,e}return o(t,i),t.prototype.init=function(t,e){e=e||b;this.app.size;var i=t["ui-atlas"].spritesheet,n=t[d.Assets.Assets["ui-map"].name].data,o=PIXI.tiled.CreateStage(i,n);this.popup=new u.PopupDifficulty(o),this.popup.position.set(this.app.width>>1,this.app.height>>1),this.popup.visible=!1,this.popup.setOpenedLevel(1),this._progress=new l.Progress(o),this._progress.progress=50,this._progress.levelIndex=2,this._settingBtn=new c.CheckedButton(f.Utils.findOn(o,"settings/settings-btn"),f.Utils.findOn(o,"settings/settings-btn:checked")),this._pauseBtn=new p.Button(f.Utils.findOn(o,"settings/pause-btn"));var r=o.getChildByName("controls_hor");this._controls=new v.Controls(r),this._controls.pivot.y=this._controls.height,this._controls.position.y=this.app.height-100,this._controls.visible=!1;var a=o.getChildByName("controls_full");this._controls_full=new v.Controls(a),this._controls_full.pivot.y=this._controls_full.height,this._controls_full.position.y=this.app.height-100,this._controls_full.visible=!1,this.hint=new y.Hint(o,this.app.size),this.hint.position.y=this.app.height,this.pause=new m.Pause(o),this.pause.position.set(this.app.width>>1,this.app.height>>1),this.pause.close(!0).then();var s=o.getChildByPath("exit");this.exit=new g.AnimatedPopup(s,{buttons:["ok","cancel"]}),this.exit.position.set(this.app.width>>1,this.app.height>>1),this.exit.close(!0).then(),o.addChild(this._progress,this._pauseBtn,this._settingBtn,this._controls,this._controls_full,this.popup,this.pause,this.exit,this.hint),this.stage.addChild(o),this.setOptions(h({},e,b)),this.reset()},t.prototype.bindListener=function(t){this.reset(),this._uiListener=t},t.prototype.postInit=function(){this.popup.applyTranslation(this._uiListener.lang.levels_button)},t.prototype.update=function(t){},t.prototype.setOptions=function(t){this._options=h({},this._options,t),this.level=this._options.level,this.progress=this._options.progress,this._progress.maxValue=this._options.progressMax,this._progress.levelHint=this._options.levelHint,this._progress.progressHint=this._options.progressHint,this._progress.visible=this._options.showProgress,this._controls.visible=this._options.controlLayout==r.HOR&&this._options.showArrows,this._controls_full.visible=this._options.controlLayout==r.FULL&&this._options.showArrows,this.visible=!0},t.prototype.reset=function(){var e=this;this.removeAllListeners(),this._pauseBtn.reset(),this.visible=!1,this.pause.reset(),this.popup.reset(),this.exit.reset(),this._controls.reset(),this._controls_full.reset(),this.popup.exitButton.on("b-click",function(){e.controls&&(e.controls.interactiveChildren=!1),e.pause.interactiveChildren=!1,e.popup.interactiveChildren=!1,e.exit.interactiveChildren=!0,e.popup.close(),e.exit.open().then(function(){e._uiListener.popupOpened(s.IPopup.CLOSING)})}),this.exit.buttons.cancel.on("b-click",function(){e.controls&&(e.controls.interactiveChildren=!0),e.pause.interactiveChildren=!0,e.popup.interactiveChildren=!0,e.exit.interactiveChildren=!0,e.popup.open(),e.exit.close()}),this.exit.buttons.ok.on("b-click",function(){e.app.stop()}),this._pauseBtn.on("b-click",function(){e.onPause(!1)}),this.pause.playButton.on("b-click",function(){e.pause.close(),e._uiListener.softResume()}),this.pause.reloadButton.on("b-click",function(){e.pause.close(),e._uiListener.reload(),e._uiListener.softResume()}),this.pause.menuButton.on("b-click",function(){e.pause.close(),e.setOptions({showArrows:!1,showProgress:!1}),e.popup.show(u.PopupType.START).then(function(){e._uiListener.popupOpened(s.IPopup.MENU)})}),this.popup.on("level-click",function(t){e._uiListener.setLevel(t),e._uiListener.softResume(),e.popup.close()})},t.prototype.onPause=function(t){var e=this;void 0===t&&(t=!0),this.emit("soft-pause"),this._uiListener.softPause()&&this.pause.open(t).then(function(){e._uiListener.popupOpened(s.IPopup.PAUSE)})},t.prototype.onResume=function(){},Object.defineProperty(t.prototype,"visible",{get:function(){return this.stage.visible},set:function(t){this.stage.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"progress",{get:function(){return this._progress.progress},set:function(t){this._progress.progress=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._progress.levelIndex},set:function(t){this._progress.levelIndex=t,this.popup.setOpenedLevel(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controls",{get:function(){if(this._options.controlLayout!=r.NONE)return this._options.controlLayout==r.HOR?this._controls:this._controls_full},enumerable:!0,configurable:!0}),t}(PIXI.utils.EventEmitter);i.UiManager=_},{"../AssetsLib":130,"./AnimatedPopup":138,"./Button":139,"./CheckedButton":140,"./Controls":141,"./Hint":142,"./IUIListener":143,"./Pause":144,"./Popup":145,"./Progress":146,"./Utils":148}],148:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){}return t.LightCopy=function(t){var e;return t instanceof PIXI.Sprite?((e=new PIXI.Sprite(t.texture)).tint=t.tint,e.anchor=t.anchor):t instanceof PIXI.Container&&(e=new PIXI.Container),this._mapTransform(t,e),e},t._mapTransform=function(t,e){t.parent&&t.parent.addChild(e),e.pivot.copyFrom(t.pivot),e.position.copyFrom(t.position),e.scale.copyFrom(t.scale),e.rotation=t.rotation,e.updateTransform()},t.findOn=function(t,e){if(t instanceof PIXI.Container&&0!=t.children.length){for(var i=t,n=e.split("/"),o=new RegExp("(?:{{0})-?d+(?=})"),r=0,a=n;r<a.length;r++){var s=a[r];if(null==i||!(i instanceof PIXI.Container)){i=void 0;break}if(0!=s.trim().length){var h=s.match(o);if(h){var l=parseInt(h[0]);l<0&&(l+=i.children.length),i=l>=i.children.length?void 0:i.children[l]}else i=i.getChildByName(s)}}return i}},t}();i.Utils=n},{}],149:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../shared/config");i.Assets={BaseDir:n.Config.BaseResDir+"/game5",Assets:{"game-atlas":{name:"game-atlas",url:"/game5-atlas.json"},bg0:{name:"bg0",url:"/LVL1.jpg"},bg1:{name:"bg1",url:"/LVL2.jpg"},bg2:{name:"bg2",url:"/LVL3.jpg"}}}},{"../shared/config":137}],150:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("./GameConfig"),a=function(e){function t(){var t=e.call(this)||this;return t._amount=0,t.line=new PIXI.Graphics,t.line.lineStyle(4,r.GameConfig.contractColor).drawRect(-40,-40,80,80).moveTo(0,40).lineTo(0,60).drawCircle(0,100,40),t.amountText=new PIXI.Text("0",new PIXI.TextStyle({fontFamily:"Carter One MultiCyr, Carter One",fontSize:46,fill:r.GameConfig.contractTextColor})),t.amountText.anchor.set(.5),t.addChild(t.line,t.amountText),t.pivot.y=42,t}return o(t,e),t.prototype.create=function(t,e){this.sprite&&this.sprite.destroy(),this.contract=e,this._amount=e.amount,this.amountText.text=""+this._amount,this.sprite=t,this.sprite.anchor.set(.5),this.sprite.scale.set(80/this.sprite.width),this.addChild(this.sprite),this.sprite.position.set(0,100)},t}(PIXI.Container);i.Contract=a},{"./GameConfig":151}],151:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./LevelGenerator");i.GameConfig={cellSize:240,arrowOffset:80,lineColor:3045893,lineStroke:36096,lineWidth:100,contractColor:50688,contractTextColor:16754688,levels:[n.LevelGenerator.generate(4,4),n.LevelGenerator.generate(6,6),n.LevelGenerator.generate(8,8)]}},{"./LevelGenerator":154}],152:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var u=t("./GameConfig"),d=t("../shared/ui/Button"),r=t("./LevelCell"),f=t("./LevelView"),i=t("./Contract");o.INDEX_MAP=["green.png","purple.png","red.png","yellow.png"];var n=function(){function t(t){this.textures=t}return t.prototype.build=function(t,e){var i=e||new f.LevelView;i.reset();for(var n=this.textures["arrow_btn.png"],o=[n,new PIXI.Texture(n.baseTexture,n.frame,n.orig,n.trim,(n.rotate+12)%15),new PIXI.Texture(n.baseTexture,n.frame,n.orig,n.trim,(n.rotate+10)%15),new PIXI.Texture(n.baseTexture,n.frame,n.orig,n.trim,(n.rotate+6)%15)],r=0;r<t.col;r++)for(var a=void 0,s=0;s<t.row;s++){var h=s*t.col+r,l=t.data[h],p=this.createLevelCell(l);p.x=r*u.GameConfig.cellSize,p.y=s*u.GameConfig.cellSize,p.interactive=!0,i.table.push(p),0==r&&((a=new d.Button(new PIXI.Sprite(o[0]))).x=.5*-u.GameConfig.cellSize-u.GameConfig.arrowOffset,a.y=u.GameConfig.cellSize*s,i.addRowArrow(a,s,-1)),r==t.col-1&&((a=new d.Button(new PIXI.Sprite(o[1]))).x+=(t.col-.5)*u.GameConfig.cellSize+u.GameConfig.arrowOffset,a.y=u.GameConfig.cellSize*s,i.addRowArrow(a,s,1)),0==s&&((a=new d.Button(new PIXI.Sprite(o[2]))).y=.5*-u.GameConfig.cellSize-u.GameConfig.arrowOffset,a.x=u.GameConfig.cellSize*r,i.addCollumnArrow(a,r,-1)),s==t.row-1&&((a=new d.Button(new PIXI.Sprite(o[3]))).y=(t.row-.5)*u.GameConfig.cellSize+u.GameConfig.arrowOffset,a.x=u.GameConfig.cellSize*r,i.addCollumnArrow(a,r,1))}i.contracts=t.contracts,i.builder=this,i.data=t;var c=u.GameConfig.cellSize;return i.arrows.forEach(function(t){t.scale.set(.5),t._mainSprite.anchor.set(.5);var e=new PIXI.Sprite(PIXI.Texture.EMPTY);e.width=e.height=1.5*c,e.anchor.set(.5),e.position.copyFrom(t._mainSprite.position),t.addChild(e)}),i.addChild.apply(i,i.table),i.addChild.apply(i,i.arrows),i.pivot.x=u.GameConfig.cellSize*(t.col-1)*.5,i.pivot.y=u.GameConfig.cellSize*(t.row-1)*.5,i.refresh(),i},t.prototype.createLevelCell=function(t,e){var i=o.INDEX_MAP[t%4],n=this.textures[i];return e?(e.reset(),e.texture=n):e=new r.LevelCell(n),e.type=t,e.anchor.set(.5),e},t.prototype.createContract=function(t){var e=new i.Contract;return e.create(this.createLevelCell(t.type),t),e},t}();o.LevelBuilder=n},{"../shared/ui/Button":139,"./Contract":150,"./GameConfig":151,"./LevelCell":153,"./LevelView":155}],153:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(i){function t(t){var e=i.call(this,t)||this;return e.neighbours=[],e._highlighted=!0,e.highlighted=!0,e}return o(t,i),t.prototype.reset=function(){this.scale.set(1),this._clone&&this._clone.scale.set(1)},t.prototype.moveTo=function(t){this._needTween=!0,this._start=this.position.clone(),this._target=t.clone(),this._teleportMode=!1},t.prototype.teleportTo=function(t){this._needTween=!0,this._sscalse=this.scale.clone(),this._clone||(this._clone=new PIXI.Sprite(this.texture),this._clone.anchor.copyFrom(this.anchor)),this.highlighted=this.highlighted,this.parent&&this.parent.addChildAt(this._clone,0),this._clone.position.copyFrom(this.position),this.position.copyFrom(t),this.scale.set(.01),this._teleportMode=!0},t.prototype.tweenComplete=function(){this._teleportMode&&this.parent.removeChild(this._clone),this._needTween=!1},Object.defineProperty(t.prototype,"twenning",{set:function(t){if(this._needTween)if(this._teleportMode){var e=Math.max(.01,t*this._sscalse.x);this.scale.set(e),this._clone.scale.set(this._sscalse.x-e)}else this.x=this._start.x+t*(this._target.x-this._start.x),this.y=this._start.y+t*(this._target.y-this._start.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlighted",{get:function(){return this._highlighted},set:function(t){this.tint=t?16777215:13421772,this._clone&&(this._clone.tint=this.tint),this._highlighted=t},enumerable:!0,configurable:!0}),t}(PIXI.Sprite);i.LevelCell=r},{}],154:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){}return t.generate=function(t,e){for(var i={col:t,row:e,data:[],contracts:[],targetScore:t*e*2},n=0;n<t*e;n++)i.data.push(4*Math.random()|0);return this.generateContracts(i,2),i},t.generateContracts=function(o,t){void 0===t&&(t=2);for(var r,e=Math.min(t,t-o.contracts.length,4),a=o.contracts.map(function(t){return t.type}),s=!1,i=function(t){for(var e=4*Math.random()|0;-1<a.indexOf(e);)e=(e+1)%4;var i=2+Math.random()*Math.sqrt(o.data.length)*1.5|0;if(!s){var n=o.data.filter(function(t){return t==e});if(n.length<2)return r=--t,"continue";i=n.length}o.contracts.push({type:e,amount:i}),a.push(e),s=!0,r=t},n=0;n<e;n++)i(n),n=r},t}();i.LevelGenerator=n},{}],155:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var s=t("./GameConfig"),r=t("@tweenjs/tween.js"),a=t("./LevelCell"),h=t("./LevelGenerator"),l=function(e){function t(){var t=e.call(this)||this;return t.table=[],t.arrows=[],t.contracts=[],t._totalScore=0,t.tweenDuration=.25,t.lineText=new PIXI.Text("0",new PIXI.TextStyle({fill:s.GameConfig.contractTextColor,fontFamily:"Carter One MultiCyr, Carter One",fontSize:42})),t.line=new PIXI.Graphics,t.selectedCells=[],t._tweenning=0,t.init(),t}return o(t,e),Object.defineProperty(t.prototype,"totalContractsAmount",{get:function(){return this.data.targetScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalContractsScore",{get:function(){return this._totalScore},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.interactive=!0,this.interactiveChildren=!0,this.on("mousedown",this.processInputDown,this),this.on("touchstart",this.processInputDown,this),this.on("mouseup",this.processInputUp,this),this.on("mouseupoutside",this.processInputUp,this),this.on("touchcancel",this.processInputUp,this),this.on("touchend",this.processInputUp,this),this.on("touchendoutside",this.processInputUp,this),this.on("mousemove",this.processInputMove,this),this.on("touchmove",this.processInputMove,this)},t.prototype.processInputDown=function(t){t.target instanceof a.LevelCell&&this.selectedCells.push(t.target)},t.prototype.processInputUp=function(t){this.processTest(),this.selectedCells=[],this.buildLine([])},t.prototype.processInputMove=function(t){if(0!=this.selectedCells.length){if(t.target instanceof a.LevelCell){var e=t.target,i=this.selectedCells[this.selectedCells.length-1];if(-1<this.selectedCells.indexOf(e))return;-1<i.neighbours.indexOf(e)&&i.type==t.target.type&&this.selectedCells.push(t.target)}1<this.selectedCells.length&&this.buildLine(this.selectedCells)}},t.prototype.buildLine=function(t){if(t.length<2)return this.line.visible=!1,void(this.lineText.visible=!1);this.lineText.style.fontSize=42/this.scale.x,this.lineText.text=""+t.length,this.lineText.anchor.set(.5),this.lineText.x=t[t.length-1].x,this.lineText.y=t[t.length-1].y-.5*s.GameConfig.cellSize,this.line.visible=!0,this.lineText.visible=!0,this.line.clear();var e=.5*s.GameConfig.lineWidth;this.line.beginFill(s.GameConfig.lineColor),this.line.lineStyle(0,s.GameConfig.lineStroke);for(var i=t.length-1;0<i;i--){var n=Math.min(t[i-1].x,t[i].x),o=Math.max(t[i-1].x,t[i].x),r=Math.min(t[i-1].y,t[i].y),a=Math.max(t[i-1].y,t[i].y);n-=e,r-=e,o+=e,a+=e,this.line.drawRoundedRect(n,r,o-n,a-r,.5*s.GameConfig.lineWidth)}this.line.lineStyle(8,s.GameConfig.lineStroke),this.line.drawCircle(this.lineText.x,this.lineText.y,.25*s.GameConfig.cellSize),this.addChild(this.line,this.lineText)},t.prototype.flipSelection=function(t){var i,e=this,n=150/t.length;t.forEach(function(t,e){t.type=4*Math.random()|0,i=new r.Tween(t.scale).to({x:.02,y:.02},150).delay(e*n).start()}),i.onComplete(function(){t.forEach(function(t){e.builder.createLevelCell(t.type,t)})}),this.refresh()},t.prototype.processTest=function(){this.testSelection()&&(this.updateContracts(this.selectedCells[0].type,this.selectedCells.length)&&(this.flipSelection(this.selectedCells),this.generateContracts()))},t.prototype.generateContracts=function(){this.data.contracts=this.contracts,h.LevelGenerator.generateContracts(this.data,2),this.contracts=this.data.contracts,this.emit("oncontractsupdated",this.contracts)},t.prototype.updateContracts=function(t,e){for(var i=[],n=0;n<this.contracts.length;n++)t==this.contracts[n].type&&e>=this.contracts[n].amount?this._totalScore+=e:i.push(this.contracts[n]);var o=this.contracts.length!=i.length;return this.contracts=i,o},t.prototype.testSelection=function(){if(this.selectedCells.length<2)return!1;for(var t=this.selectedCells,e=t[0].type,i=0,n=t;i<n.length;i++)for(var o=0,r=n[i].neighbours;o<r.length;o++){var a=r[o];if(a.type==e&&-1==t.indexOf(a))return!1}return!0},t.prototype.refresh=function(){for(var t=[],e=0;e<this.data.col;e++)for(var i=0;i<this.data.col;i++){var n=i*this.data.col+e,o=this.table[n];t[n]=o.type;var r=[];0<e&&r.push(this.table[i*this.data.col+e-1]),e<this.data.col-1&&r.push(this.table[i*this.data.col+e+1]),0<i&&r.push(this.table[(i-1)*this.data.col+e]),i<this.data.row-1&&r.push(this.table[(i+1)*this.data.col+e]),o.neighbours=r}this.data.data=t},t.prototype.addCollumnArrow=function(t,e,i){var n=this;t.on("b-click",function(){n.shiftCol(e,i)}),this.arrows.push(t)},t.prototype.addRowArrow=function(t,e,i){var n=this;t.on("b-click",function(){n.shiftRow(e,i)}),this.arrows.push(t)},t.prototype.shiftRow=function(t,e){if(!this._tween||!this._tween.isPlaying()){var i=this.table,n=this.data.col,o=this.data.row;if(0<e)for(var r=(h=i[t+o*(n-1)]).position.clone(),a=n-1;0<=a;a--){var s=void 0;a-1<0?(i[t+a*o]=h,i[t+a*o].teleportTo(r)):(s=i[t+(a-1)*o].position.clone(),i[t+a*o]=i[t+(a-1)*o],i[t+a*o].moveTo(r)),r=s}else{var h;for(r=(h=i[t]).position.clone(),a=0;a<n;a++){s=void 0;a+1==n?(i[t+o*a]=h,i[t+o*a].teleportTo(r)):(s=i[t+o*(a+1)].position.clone(),i[t+o*a]=i[t+o*(a+1)],i[t+o*a].moveTo(r)),r=s}}this.runTween()}},t.prototype.shiftCol=function(t,e){if(!this._tween||!this._tween.isPlaying()){var i=this.table,n=this.data.row;if(0<e)for(var o=(s=i[(t+1)*n-1]).position.clone(),r=n-1;0<=r;r--){var a=void 0;r-1<0?(i[t*n+r]=s,i[t*n+r].teleportTo(o)):(a=i[t*n+r-1].position.clone(),i[t*n+r]=i[t*n+r-1],i[t*n+r].moveTo(o)),o=a}else{var s;for(o=(s=i[t*n]).position.clone(),r=0;r<n;r++){a=void 0;r+1==n?(i[t*n+r]=s,i[t*n+r].teleportTo(o)):(a=i[t*n+r+1].position.clone(),i[t*n+r]=i[t*n+r+1],i[t*n+r].moveTo(o)),o=a}}this.runTween()}},t.prototype.runTween=function(){var t=this;this._tweenning=0,this._tween=new r.Tween(this).to({twenning:1},1e3*this.tweenDuration).onComplete(function(){t.tweenComplite()}).start()},t.prototype.tweenComplite=function(){this.table.forEach(function(t){t.tweenComplete()}),this.refresh()},Object.defineProperty(t.prototype,"twenning",{get:function(){return this._tweenning},set:function(e){e=Math.max(0,Math.min(1,e)),this.table.forEach(function(t){t.twenning=e}),this._tweenning=e},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.selectedCells=[],this.buildLine([]),this._tween&&this._tween.isPlaying()&&this._tween.stop(),this.table.forEach(function(t){t.destroy()}),this.table=[],this.arrows.forEach(function(t){t.destroy()}),this.arrows=[],this.contracts=[],this.data=void 0,this._totalScore=0,this.scale.set(1)},t.prototype.pause=function(){this.processInputUp(void 0)},t.prototype._loop=function(t,e){return t<0&&(t+=e),t%e},t}(PIXI.Container);i.LevelView=l},{"./GameConfig":151,"./LevelCell":153,"./LevelGenerator":154,"@tweenjs/tween.js":1}],156:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("../shared/BaseGame"),a=t("../shared/APIData"),s=t("./Assets"),h=t("./GameConfig"),l=t("../shared/ui/Popup"),p=t("../shared/ui/IUIListener"),c=t("./LevelBuilder"),u=t("./LevelView"),d=t("@tweenjs/tween.js"),f=function(e){function t(){var t=e.call(this)||this;return t.contracts=[],t.apiData=new a.APIData("Twofold",t),t.stage=new PIXI.Container,t.loader=new PIXI.Loader(s.Assets.BaseDir),t}return o(t,e),t.prototype.init=function(t){this.app=t,this.lang=this.app.multilang.getTextBase("Twofold"),t.renderer.plugins.interaction.moveWhenInside=!0,this.gameState.on("enter",this.onStateEnter,this),this.ui=this.app.uiManager,this.ui.setOptions({showArrows:!1,showProgress:!1,level:this.apiData.lastOpenedLevel,levelHint:this.lang.levels[0],progressHint:this.lang.progress[0]}),this.ui.popup.show(l.PopupType.START,!0),this.res=this.loader.resources,this.builder=new c.LevelBuilder(this.res[s.Assets.Assets["game-atlas"].name].textures),this.level=new u.LevelView,this.bg=new PIXI.Sprite(this.res.bg0.texture),this.bg.width=t.width,this.bg.height=t.height,this.stage.addChild(this.bg,this.level),this.app.uiManager.hint.open(this.lang.hello),e.prototype.init.call(this,t),e.prototype.start.call(this)},t.prototype.preload=function(){return this.loader.add(Object.values(s.Assets.Assets)),e.prototype.preload.call(this)},t.prototype.reset=function(){},t.prototype.setLevel=function(t){this.apiData.current=t,this.levelData=h.GameConfig.levels[t-1],this.bg.texture=this.res["bg"+(t-1)].texture,this.reset(),this.level=this.builder.build(h.GameConfig.levels[t-1],this.level),this.level.scale.set((this.app.width-h.GameConfig.arrowOffset)/this.level.width),this.level.x=this.app.width/2,this.level.y=Math.max(.5*this.level.height+500,.5*this.app.height),this.level.off("oncontractsupdated",this.updateContracts,this),this.level.on("oncontractsupdated",this.updateContracts,this),this.updateContracts(this.level.contracts),this.gameState.current=r.GameState.GAME},t.prototype.updateContracts=function(t){var e;if(this.ui.progress=this.level.totalContractsScore,this.level.totalContractsScore>=this.level.totalContractsAmount)this.gameState.current=r.GameState.PREWIN;else{this.contracts.forEach(function(t){return t.destroy()}),this.contracts=[];for(var i=0;i<t.length;i++){var n=this.builder.createContract(t[i]),o=100+100*i;n.x=-100,n.y=320,new d.Tween(n.position).to({x:o},250).start(),this.contracts.push(n)}0<t.length&&(e=this.stage).addChild.apply(e,this.contracts)}},t.prototype.reload=function(){this.setLevel(this.apiData.current)},t.prototype.popupOpened=function(t){t==p.IPopup.MENU&&this.app.uiManager.setOptions({showArrows:!1,level:this.apiData.lastOpenedLevel})},t.prototype.softPause=function(){return this.level.pause(),e.prototype.softPause.call(this)},t.prototype.onStateEnter=function(t){var e=this;switch(t){case r.GameState.PRE:this.ui.setOptions({showProgress:!1,progress:0,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(l.PopupType.START);break;case r.GameState.GAME:this.ui.setOptions({showProgress:!0,progress:0,level:this.apiData.current,progressMax:this.level.totalContractsAmount}),this.ui.progress=0;break;case r.GameState.PREWIN:this.apiData.levelSucsess(),this.ui.setOptions({showProgress:!1,progress:0,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(l.PopupType.WIN),this.gameState.current=r.GameState.WIN;break;case r.GameState.WIN:setTimeout(function(){e.gameState.current===r.GameState.WIN&&e.ui.hint.open(e.lang.endings)},1e3);break;case r.GameState.LOSE:this.apiData.levelFailed(),this.ui.setOptions({showProgress:!1,progress:0,showArrows:!1,level:this.apiData.lastOpenedLevel}),this.ui.popup.show(l.PopupType.LOSE),setTimeout(function(){if(e.gameState.current===r.GameState.LOSE){var t=e.apiData.loosesAtRun%3==0&&0<e.apiData.loosesAtRun;e.ui.hint.open(t?e.lang.falling_3times:e.lang.falling)}},1e3)}},t.prototype.pause=function(){this.app.uiManager.onPause(),e.prototype.pause.call(this)},t.prototype.resume=function(){this.app.uiManager.onResume(),e.prototype.resume.call(this)},t.prototype.update=function(t){this._isPaused||(this.gameState.current,r.GameState.GAME)},t}(r.BaseGame);i.Twofold=f},{"../shared/APIData":129,"../shared/BaseGame":131,"../shared/ui/IUIListener":143,"../shared/ui/Popup":145,"./Assets":149,"./GameConfig":151,"./LevelBuilder":152,"./LevelView":155,"@tweenjs/tween.js":1}]},{},[103]),function(n){!function(t){function i(e,i){i.name=e.name,i.tiledId=e.id,i.width=e.width||i.width,i.height=e.height||i.height,i.rotation=(e.rotation||0)*Math.PI/180,e.x&&(i.x=e.x),e.y&&(i.y=e.y),i.visible=null==e.visible||e.visible,i.types=e.type?e.type.split(":"):[];n.Utils.Objectype(e);i.primitive=n.Primitives.BuildPrimitive(e),e.properties&&(i.alpha=e.properties.opacity||1,Object.assign(i,e.properties)),n.Config.debugContainers&&setTimeout(function(){var t=new PIXI.Graphics;t.lineStyle(2,16711680,.7).drawRect(i.x,i.y,e.width,e.height).endFill(),i instanceof PIXI.Sprite&&(t.y-=i.height),i.parent.addChild(t)},30)}t.ApplyMeta=i,t.Build=function(t){var e=void 0;return e=-1<(t.type?t.type.split(":"):[]).indexOf("mask")?new PIXI.Sprite(PIXI.Texture.WHITE):new n.TiledContainer,t.gid&&(e instanceof PIXI.Sprite?e.anchor=n.Config.defSpriteAnchor:(e.pivot=n.Config.defSpriteAnchor,e.hitArea=new PIXI.Rectangle(0,0,t.width,t.height))),i(t,e),e}}(n.ContainerBuilder||(n.ContainerBuilder={}))}(TiledOG||(TiledOG={})),function(t){PIXI.tiled=t}(TiledOG||(TiledOG={})),function(r){(r.SpriteBuilder||(r.SpriteBuilder={})).Build=function(t){return function(t){var e=new PIXI.Sprite(PIXI.Texture.EMPTY);t.fromImageLayer||(e.anchor=r.Config.defSpriteAnchor),r.ContainerBuilder.ApplyMeta(t,e);var i=t.img.objectgroup;i&&(e.primitive=r.Primitives.BuildPrimitive(i.objects[0]));var n=t.properties.hFlip,o=t.properties.vFlip;return n&&(e.scale.x*=-1,e.anchor.x=1),o&&(e.scale.y*=-1,e.anchor.y=0),e}(t)}}(TiledOG||(TiledOG={})),function(o){(o.TextBuilder||(o.TextBuilder={})).Build=function(t){return function(t){var e=new o.TiledContainer,i=new PIXI.Text(t.text.text,{wordWrap:t.text.wrap,wordWrapWidth:t.width,fill:o.Utils.HexStringToHexInt(t.text.color)||0,align:t.text.valign||"center",fontFamily:t.text.fontfamily||"Arial",fontWeight:t.text.bold?"bold":"normal",fontStyle:t.text.italic?"italic":"normal",fontSize:t.text.pixelsize||"16px"});i.name=t.name+"_Text",o.Config.roundFontAlpha&&i.texture.once("update",function(){!function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=3;n<i.data.length;n+=4)i.data[n]=200<i.data[n]?255:0;e.putImageData(i,0,0)}(i.canvas),i.texture.baseTexture.update(),console.log("update")});var n=t.properties;switch(t.properties={},o.ContainerBuilder.ApplyMeta(t,e),e.pivot.set(0,0),t.text.halign){case"right":i.anchor.x=1,i.position.x=t.width;break;case"center":i.anchor.x=.5,i.position.x=.5*t.width;break;default:i.anchor.x=0,i.position.x=0}switch(t.text.valign){case"bottom":i.anchor.y=1,i.position.y=t.height;break;case"center":i.anchor.y=.5,i.position.y=.5*t.height;break;default:i.anchor.y=0,i.position.y=0}return n&&(i.style.stroke=o.Utils.HexStringToHexInt(t.properties.strokeColor)||0,i.style.strokeThickness=t.properties.strokeThickness||0,i.style.padding=t.properties.fontPadding||0,Object.assign(i,n)),e.addChild(i),e.text=i,e}(t)}}(TiledOG||(TiledOG={})),function(t){var e=function(){function t(t){var e=this;this.sheets=[],this.images={},t&&t.forEach(function(t){e.add(t)})}return t.prototype.add=function(t){if(!t)throw"Sheet can't be undefined";this.sheets.push(t)},t.prototype.addTexture=function(t,e){this.images[e]=t},Object.defineProperty(t.prototype,"textures",{get:function(){for(var t={},e=0,i=this.sheets;e<i.length;e++){var n=i[e];Object.assign(t,n.textures)}return Object.assign(t,this.images),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){for(var t={},e=0,i=this.sheets;e<i.length;e++){var n=i[e];Object.assign(t,n.animations)}return t},enumerable:!0,configurable:!0}),t}();t.MultiSpritesheet=e}(Tiled||(Tiled={}));var TiledOG,__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t){var e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layerHeight=0,t.layerWidth=0,t}return __extends(t,e),t}(PIXI.Container);t.TiledContainer=e}(TiledOG||(TiledOG={})),function(b){var _=!0;function w(t){var e={};if(t.properties)if(t.properties instanceof Array)for(var i=0,n=t.properties;i<n.length;i++){var o=n[i],r=o.value;"color"==o.type&&(r=b.Utils.HexStringToHexInt(r)),e[o.name]=r}else e=t.properties;if(t.gid){var a=t.gid,s=1073741824&a,h=2147483648&a,l=536870912&a;e.vFlip=s,e.hFlip=h,e.dFlip=l;var p=536870911&a;t.gid=p}t.properties=e}function P(t,e,i){for(var n=void 0,o=0;o<t.length;o++)t[o].firstgid<=i&&(n=t[o]);if(!n)return console.log("Image with gid:"+i+" not found!"),null;var r=i-n.firstgid,a=n.tiles.filter(function(t){return t.id==r})[0],s=Object.assign({},a);return s?(s.image=e+s.image,s):(console.log("Load res MISSED gid:"+r),null)}function n(r,a){var s={};if((s=r instanceof PIXI.LoaderResource?r.data:a)&&"map"==s.type){_&&(console.log("Tiled OG importer!\n eXponenta {rondo.devil[a]gmail.com}"),_=!1);var t=null!=b.Config.usePixiDisplay&&b.Config.usePixiDisplay&&null!=PIXI.display,e=t?PIXI.display.Layer:{},i=t?PIXI.display.Group:{},h=(t&&PIXI.display.Stage,new b.TiledContainer),n=new RegExp(/^.*[\\\/]/);h.layerHeight=s.height,h.layerWidth=s.width;var l="";if(r instanceof PIXI.LoaderResource&&(h.name=r.url.replace(n,"").split(".")[0],l=(l=r.url.replace(a.baseUrl,"")).match(n)[0]),s.layers){var o=0;t&&(s.layers=s.layers.reverse());for(var p=0,c=s.layers;p<c.length;p++){var u=c[p];if("objectgroup"===u.type||"imagelayer"===u.type){w(u);var d=u.properties;if(d.ignore||d.ignoreLoad)console.log("OGParser: ignore loading layer:"+u.name);else{var f=t?new e(new i(void 0!==d.zOrder?d.zOrder:o,!0)):new b.TiledContainer;if(o++,f.tiledId=u.id,f.name=u.name,h.layers={},(h.layers[u.name]=f).visible=u.visible,f.position.set(u.x,u.y),f.alpha=u.opacity||1,b.ContainerBuilder.ApplyMeta(u,f),h.addChild(f),"imagelayer"==u.type&&(u.objects=[{img:{image:l+u.image},gid:123456789,name:u.name,x:u.x+u.offsetx,y:u.y+u.offsety,fromImageLayer:!0,properties:u.properties}]),!u.objects)return;for(var y=0,m=function(e){if(w(e),e.properties.ignore)return"continue";var t=null;switch(b.Utils.Objectype(e)){case b.Utils.TiledObjectType.IMAGE:if(!e.fromImageLayer){var i=P(s.tilesets,l,e.gid);if(!i)return"continue";e.img=i}var n=t=b.SpriteBuilder.Build(e),o=void 0;if(a instanceof PIXI.Loader?o=a.resources[e.img.image]:r instanceof PIXI.Spritesheet&&(o=r.textures[e.img.image]),o)o instanceof PIXI.LoaderResource?o.isComplete?(n.texture=o.texture,e.fromImageLayer&&n.scale.set(1)):o.onAfterMiddleware.once(function(t){n.texture=o.texture,e.fromImageLayer&&n.scale.set(1)}):o&&(n.texture=o,e.fromImageLayer&&n.scale.set(1));else{if(!(a instanceof PIXI.Loader))return"continue";a.add(e.img.image,{parentResource:r},function(){var t=a.resources[e.img.image].texture;n.texture=t,e.fromImageLayer&&n.scale.set(1)})}break;case b.Utils.TiledObjectType.TEXT:t=b.TextBuilder.Build(e);break;default:t=b.ContainerBuilder.Build(e)}b.Config.usePixiDisplay?(t.parentGroup=f.group,h.addChildAt(t,y)):f.addChildAt(t,y),y++},g=0,v=u.objects;g<v.length;g++){m(v[g])}}}else console.warn("OGParser support only OBJECT or IMAGE layes!!")}}return h}}b.CreateStage=n,b.Parser={Parse:function(t,e){var i=n(t,this);t.stage=i,e()},use:function(t,e){b.Parser.Parse.call(this,t,e)},add:function(){console.log("Now you use Tiled!")}}}(TiledOG||(TiledOG={})),function(h){!function(t){var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="",t.types=[],t.visible=!0,t}return __extends(t,e),t}(PIXI.Rectangle);t.TiledRect=o;var e=function(n){function t(t,e){var i=n.call(this,t,e)||this;return i.name="",i.types=[],i.visible=!0,i}return __extends(t,n),t}(PIXI.Point);t.TiledPoint=e;var r=function(i){function t(t){var e=i.call(this,t)||this;return e.name="",e.types=[],e.visible=!0,e._x=0,e._y=0,e}return __extends(t,i),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){var e=t-this._x;this._x=t;for(var i=0;i<this.points.length;i+=2)this.points[i]+=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){var e=t-this._y;this._y=t;for(var i=1;i<this.points.length;i+=2)this.points[i]+=e},enumerable:!0,configurable:!0}),t.prototype.getBounds=function(){for(var t=new PIXI.Rectangle,e=this._x,i=this._y,n=0;n<this.points.length;n+=2){var o=this.points[n],r=this.points[n+1];t.x=o<t.x?o:t.x,t.y=r<t.y?r:t.y,e=e<o?o:e,i=i<r?r:i}return t.width=e-t.x,t.height=i-t.y,t},Object.defineProperty(t.prototype,"width",{get:function(){return this.getBounds().width},set:function(t){for(var e=t/this.width,i=0;i<this.points.length;i+=2){var n=(this.points[i]-this._x)*e;this.points[i]=this._x+n}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.getBounds().height},set:function(t){for(var e=t/this.height,i=1;i<this.points.length;i+=2){var n=(this.points[i]-this._y)*e;this.points[i]=this._y+n}},enumerable:!0,configurable:!0}),t}(PIXI.Polygon);t.TiledPolygon=r;var a=function(t){this.name="",this.types=[],this.visible=!0,this.points=[],this.points=t.slice()};t.TiledPolypine=a;var s=function(r){function t(t,e,i,n){var o=r.call(this,t,e,i,n)||this;return o.name="",o.types=[],o.visible=!0,o}return __extends(t,r),t}(PIXI.Ellipse);t.TiledEllipse=s,t.BuildPrimitive=function(e){if(e){var t=void 0,i=h.Utils.Objectype(e);switch(e.x=e.x||0,e.y=e.y||0,i){case h.Utils.TiledObjectType.ELLIPSE:t=new s(e.x+.5*e.width,e.y+.5*e.height,.5*e.width,.5*e.height);break;case h.Utils.TiledObjectType.POLYGON:var n=e.polygon.map(function(t){return new PIXI.Point(t.x+e.x,t.y+e.y)});t=new r(n);break;case h.Utils.TiledObjectType.POLYLINE:n=e.polygon.map(function(t){return new PIXI.Point(t.x+e.x,t.y+e.y)}),t=new a(n);break;default:t=new o(e.x,e.y,e.width,e.height)}return t.types=e.type?e.type.split(":"):[],t.visible=e.visible,t.name=e.name,t}}}(h.Primitives||(h.Primitives={}))}(TiledOG||(TiledOG={})),function(t){var e,i,n;(e=t.Utils||(t.Utils={})).HexStringToHexInt=function(t){if(!t)return 0;if("number"==typeof t)return t;t=7<t.length?t.substr(3,6):t.substr(1,6);try{return parseInt(t,16)}catch(t){return console.warn("Color parse error:",t.message),0}},e.HexStringToAlpha=function(t){if(!t)return 1;if("number"==typeof t)return t;if(t.length<=7)return 1;try{return parseInt(t.substr(1,2),16)/255}catch(t){return console.warn("Alpha parse error:",t.message),1}},(n=i=e.TiledObjectType||(e.TiledObjectType={}))[n.DEFAULT=0]="DEFAULT",n[n.POINT=1]="POINT",n[n.POLYGON=2]="POLYGON",n[n.POLYLINE=3]="POLYLINE",n[n.ELLIPSE=4]="ELLIPSE",n[n.TEXT=5]="TEXT",n[n.IMAGE=6]="IMAGE",e.Objectype=function(t){return t.properties&&t.properties.container?i.DEFAULT:t.gid||t.image?i.IMAGE:null!=t.text?i.TEXT:t.point?i.POINT:t.polygon?i.POLYGON:t.polyline?i.POLYLINE:t.ellipse?i.ELLIPSE:i.DEFAULT}}(TiledOG||(TiledOG={})),function(e){e.Config={defSpriteAnchor:new PIXI.Point(0,1),debugContainers:!1,usePixiDisplay:!1,roundFontAlpha:!1},e.Builders=[e.ContainerBuilder.Build,e.SpriteBuilder.Build,e.TextBuilder.Build],e.InjectToPixi=function(t){void 0===t&&(t=void 0),t&&(e.Config.defSpriteAnchor=t.defSpriteAnchor||e.Config.defSpriteAnchor,e.Config.debugContainers=null!=t.debugContainers?t.debugContainers:e.Config.debugContainers,e.Config.usePixiDisplay=null!=t.usePixiDisplay?t.usePixiDisplay:e.Config.usePixiDisplay,e.Config.roundFontAlpha=null!=t.roundFontAlpha?t.roundFontAlpha:e.Config.roundFontAlpha),PIXI.Loader.registerPlugin(e.Parser)}}(TiledOG||(TiledOG={}));var pixi_spine;__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t){!function(R){var N,t,g,e,n,i,D=function(){function t(t,e,i){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.duration=i}return t.prototype.apply=function(t,e,i,n,o,r,a,s){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(i%=this.duration,0<e&&(e%=this.duration));for(var h=this.timelines,l=0,p=h.length;l<p;l++)h[l].apply(t,e,i,o,r,a,s)},t.binarySearch=function(t,e,i){void 0===i&&(i=1);var n=0,o=t.length/i-2;if(0==o)return i;for(var r=o>>>1;;){if(t[(r+1)*i]<=e?n=r+1:o=r,n==o)return(n+1)*i;r=n+o>>>1}},t.linearSearch=function(t,e,i){for(var n=0,o=t.length-i;n<=o;n+=i)if(t[n]>e)return n;return-1},t}();R.Animation=D,(t=N=R.MixPose||(R.MixPose={}))[t.setup=0]="setup",t[t.current=1]="current",t[t.currentLayered=2]="currentLayered",(e=g=R.MixDirection||(R.MixDirection={}))[e.in=0]="in",e[e.out=1]="out",(i=n=R.TimelineType||(R.TimelineType={}))[i.rotate=0]="rotate",i[i.translate=1]="translate",i[i.scale=2]="scale",i[i.shear=3]="shear",i[i.attachment=4]="attachment",i[i.color=5]="color",i[i.deform=6]="deform",i[i.event=7]="event",i[i.drawOrder=8]="drawOrder",i[i.ikConstraint=9]="ikConstraint",i[i.transformConstraint=10]="transformConstraint",i[i.pathConstraintPosition=11]="pathConstraintPosition",i[i.pathConstraintSpacing=12]="pathConstraintSpacing",i[i.pathConstraintMix=13]="pathConstraintMix",i[i.twoColor=14]="twoColor";var o=function(){function v(t){if(t<=0)throw new Error("frameCount must be > 0: "+t);this.curves=R.Utils.newFloatArray((t-1)*v.BEZIER_SIZE)}return v.prototype.getFrameCount=function(){return this.curves.length/v.BEZIER_SIZE+1},v.prototype.setLinear=function(t){this.curves[t*v.BEZIER_SIZE]=v.LINEAR},v.prototype.setStepped=function(t){this.curves[t*v.BEZIER_SIZE]=v.STEPPED},v.prototype.getCurveType=function(t){var e=t*v.BEZIER_SIZE;if(e==this.curves.length)return v.LINEAR;var i=this.curves[e];return i==v.LINEAR?v.LINEAR:i==v.STEPPED?v.STEPPED:v.BEZIER},v.prototype.setCurve=function(t,e,i,n,o){var r=.03*(2*-e+n),a=.03*(2*-i+o),s=.006*(3*(e-n)+1),h=.006*(3*(i-o)+1),l=2*r+s,p=2*a+h,c=.3*e+r+.16666667*s,u=.3*i+a+.16666667*h,d=t*v.BEZIER_SIZE,f=this.curves;f[d++]=v.BEZIER;for(var y=c,m=u,g=d+v.BEZIER_SIZE-1;d<g;d+=2)f[d]=y,f[d+1]=m,c+=l,u+=p,l+=s,p+=h,y+=c,m+=u},v.prototype.getCurvePercent=function(t,e){e=R.MathUtils.clamp(e,0,1);var i=this.curves,n=t*v.BEZIER_SIZE,o=i[n];if(o==v.LINEAR)return e;if(o==v.STEPPED)return 0;for(var r=0,a=++n,s=n+v.BEZIER_SIZE-1;n<s;n+=2)if(e<=(r=i[n])){var h=void 0,l=void 0;return(l=n==a?h=0:(h=i[n-2],i[n-1]))+(i[n+1]-l)*(e-h)/(r-h)}var p=i[n-1];return p+(1-p)*(e-r)/(1-r)},v.LINEAR=0,v.STEPPED=1,v.BEZIER=2,v.BEZIER_SIZE=19,v}(),r=function(i){function m(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t<<1),e}return __extends(m,i),m.prototype.getPropertyId=function(){return(n.rotate<<24)+this.boneIndex},m.prototype.setFrame=function(t,e,i){t<<=1,this.frames[t]=e,this.frames[t+m.ROTATION]=i},m.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.bones[this.boneIndex];if(i<s[0])switch(r){case N.setup:return void(h.rotation=h.data.rotation);case N.current:var l=h.data.rotation-h.rotation;l-=360*(16384-(16384.499999999996-l/360|0)),h.rotation+=l*o}else if(i>=s[s.length-m.ENTRIES])if(r==N.setup)h.rotation=h.data.rotation+s[s.length+m.PREV_ROTATION]*o;else{var p=h.data.rotation+s[s.length+m.PREV_ROTATION]-h.rotation;p-=360*(16384-(16384.499999999996-p/360|0)),h.rotation+=p*o}else{var c=D.binarySearch(s,i,m.ENTRIES),u=s[c+m.PREV_ROTATION],d=s[c],f=this.getCurvePercent((c>>1)-1,1-(i-d)/(s[c+m.PREV_TIME]-d)),y=s[c+m.ROTATION]-u;y=u+(y-=360*(16384-(16384.499999999996-y/360|0)))*f,r==N.setup?(y-=360*(16384-(16384.499999999996-y/360|0)),h.rotation=h.data.rotation+y*o):(y=h.data.rotation+y-h.rotation,y-=360*(16384-(16384.499999999996-y/360|0)),h.rotation+=y*o)}},m.ENTRIES=2,m.PREV_TIME=-2,m.PREV_ROTATION=-1,m.ROTATION=1,m}(R.CurveTimeline=o);R.RotateTimeline=r;var a=function(i){function f(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t*f.ENTRIES),e}return __extends(f,i),f.prototype.getPropertyId=function(){return(n.translate<<24)+this.boneIndex},f.prototype.setFrame=function(t,e,i,n){t*=f.ENTRIES,this.frames[t]=e,this.frames[t+f.X]=i,this.frames[t+f.Y]=n},f.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.bones[this.boneIndex];if(i<s[0])switch(r){case N.setup:return h.x=h.data.x,void(h.y=h.data.y);case N.current:h.x+=(h.data.x-h.x)*o,h.y+=(h.data.y-h.y)*o}else{var l=0,p=0;if(i>=s[s.length-f.ENTRIES])l=s[s.length+f.PREV_X],p=s[s.length+f.PREV_Y];else{var c=D.binarySearch(s,i,f.ENTRIES);l=s[c+f.PREV_X],p=s[c+f.PREV_Y];var u=s[c],d=this.getCurvePercent(c/f.ENTRIES-1,1-(i-u)/(s[c+f.PREV_TIME]-u));l+=(s[c+f.X]-l)*d,p+=(s[c+f.Y]-p)*d}r==N.setup?(h.x=h.data.x+l*o,h.y=h.data.y+p*o):(h.x+=(h.data.x+l-h.x)*o,h.y+=(h.data.y+p-h.y)*o)}},f.ENTRIES=3,f.PREV_TIME=-3,f.PREV_X=-2,f.PREV_Y=-1,f.X=1,f.Y=2,f}(o),s=function(e){function m(t){return e.call(this,t)||this}return __extends(m,e),m.prototype.getPropertyId=function(){return(n.scale<<24)+this.boneIndex},m.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.bones[this.boneIndex];if(i<s[0])switch(r){case N.setup:return h.scaleX=h.data.scaleX,void(h.scaleY=h.data.scaleY);case N.current:h.scaleX+=(h.data.scaleX-h.scaleX)*o,h.scaleY+=(h.data.scaleY-h.scaleY)*o}else{var l=0,p=0;if(i>=s[s.length-m.ENTRIES])l=s[s.length+m.PREV_X]*h.data.scaleX,p=s[s.length+m.PREV_Y]*h.data.scaleY;else{var c=D.binarySearch(s,i,m.ENTRIES);l=s[c+m.PREV_X],p=s[c+m.PREV_Y];var u=s[c],d=this.getCurvePercent(c/m.ENTRIES-1,1-(i-u)/(s[c+m.PREV_TIME]-u));l=(l+(s[c+m.X]-l)*d)*h.data.scaleX,p=(p+(s[c+m.Y]-p)*d)*h.data.scaleY}if(1==o)h.scaleX=l,h.scaleY=p;else{var f=0,y=0;y=r==N.setup?(f=h.data.scaleX,h.data.scaleY):(f=h.scaleX,h.scaleY),a==g.out?(l=Math.abs(l)*R.MathUtils.signum(f),p=Math.abs(p)*R.MathUtils.signum(y)):(f=Math.abs(f)*R.MathUtils.signum(l),y=Math.abs(y)*R.MathUtils.signum(p)),h.scaleX=f+(l-f)*o,h.scaleY=y+(p-y)*o}}},m}(R.TranslateTimeline=a);R.ScaleTimeline=s;var h=function(e){function f(t){return e.call(this,t)||this}return __extends(f,e),f.prototype.getPropertyId=function(){return(n.shear<<24)+this.boneIndex},f.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.bones[this.boneIndex];if(i<s[0])switch(r){case N.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case N.current:h.shearX+=(h.data.shearX-h.shearX)*o,h.shearY+=(h.data.shearY-h.shearY)*o}else{var l=0,p=0;if(i>=s[s.length-f.ENTRIES])l=s[s.length+f.PREV_X],p=s[s.length+f.PREV_Y];else{var c=D.binarySearch(s,i,f.ENTRIES);l=s[c+f.PREV_X],p=s[c+f.PREV_Y];var u=s[c],d=this.getCurvePercent(c/f.ENTRIES-1,1-(i-u)/(s[c+f.PREV_TIME]-u));l+=(s[c+f.X]-l)*d,p+=(s[c+f.Y]-p)*d}r==N.setup?(h.shearX=h.data.shearX+l*o,h.shearY=h.data.shearY+p*o):(h.shearX+=(h.data.shearX+l-h.shearX)*o,h.shearY+=(h.data.shearY+p-h.shearY)*o)}},f}(a);R.ShearTimeline=h;var l=function(i){function b(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t*b.ENTRIES),e}return __extends(b,i),b.prototype.getPropertyId=function(){return(n.color<<24)+this.slotIndex},b.prototype.setFrame=function(t,e,i,n,o,r){t*=b.ENTRIES,this.frames[t]=e,this.frames[t+b.R]=i,this.frames[t+b.G]=n,this.frames[t+b.B]=o,this.frames[t+b.A]=r},b.prototype.apply=function(t,e,i,n,o,r,a){var s=t.slots[this.slotIndex],h=this.frames;if(i<h[0])switch(r){case N.setup:return void s.color.setFromColor(s.data.color);case N.current:var l=s.color,p=s.data.color;l.add((p.r-l.r)*o,(p.g-l.g)*o,(p.b-l.b)*o,(p.a-l.a)*o)}else{var c=0,u=0,d=0,f=0;if(i>=h[h.length-b.ENTRIES]){var y=h.length;c=h[y+b.PREV_R],u=h[y+b.PREV_G],d=h[y+b.PREV_B],f=h[y+b.PREV_A]}else{var m=D.binarySearch(h,i,b.ENTRIES);c=h[m+b.PREV_R],u=h[m+b.PREV_G],d=h[m+b.PREV_B],f=h[m+b.PREV_A];var g=h[m],v=this.getCurvePercent(m/b.ENTRIES-1,1-(i-g)/(h[m+b.PREV_TIME]-g));c+=(h[m+b.R]-c)*v,u+=(h[m+b.G]-u)*v,d+=(h[m+b.B]-d)*v,f+=(h[m+b.A]-f)*v}if(1==o)s.color.set(c,u,d,f);else{l=s.color;r==N.setup&&l.setFromColor(s.data.color),l.add((c-l.r)*o,(u-l.g)*o,(d-l.b)*o,(f-l.a)*o)}}},b.ENTRIES=5,b.PREV_TIME=-5,b.PREV_R=-4,b.PREV_G=-3,b.PREV_B=-2,b.PREV_A=-1,b.R=1,b.G=2,b.B=3,b.A=4,b}(o);R.ColorTimeline=l;var p=function(i){function x(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t*x.ENTRIES),e}return __extends(x,i),x.prototype.getPropertyId=function(){return(n.twoColor<<24)+this.slotIndex},x.prototype.setFrame=function(t,e,i,n,o,r,a,s,h){t*=x.ENTRIES,this.frames[t]=e,this.frames[t+x.R]=i,this.frames[t+x.G]=n,this.frames[t+x.B]=o,this.frames[t+x.A]=r,this.frames[t+x.R2]=a,this.frames[t+x.G2]=s,this.frames[t+x.B2]=h},x.prototype.apply=function(t,e,i,n,o,r,a){var s=t.slots[this.slotIndex],h=this.frames;if(i<h[0])switch(r){case N.setup:return s.color.setFromColor(s.data.color),void s.darkColor.setFromColor(s.data.darkColor);case N.current:var l=s.color,p=s.darkColor,c=s.data.color,u=s.data.darkColor;l.add((c.r-l.r)*o,(c.g-l.g)*o,(c.b-l.b)*o,(c.a-l.a)*o),p.add((u.r-p.r)*o,(u.g-p.g)*o,(u.b-p.b)*o,0)}else{var d=0,f=0,y=0,m=0,g=0,v=0,b=0;if(i>=h[h.length-x.ENTRIES]){var _=h.length;d=h[_+x.PREV_R],f=h[_+x.PREV_G],y=h[_+x.PREV_B],m=h[_+x.PREV_A],g=h[_+x.PREV_R2],v=h[_+x.PREV_G2],b=h[_+x.PREV_B2]}else{var w=D.binarySearch(h,i,x.ENTRIES);d=h[w+x.PREV_R],f=h[w+x.PREV_G],y=h[w+x.PREV_B],m=h[w+x.PREV_A],g=h[w+x.PREV_R2],v=h[w+x.PREV_G2],b=h[w+x.PREV_B2];var P=h[w],A=this.getCurvePercent(w/x.ENTRIES-1,1-(i-P)/(h[w+x.PREV_TIME]-P));d+=(h[w+x.R]-d)*A,f+=(h[w+x.G]-f)*A,y+=(h[w+x.B]-y)*A,m+=(h[w+x.A]-m)*A,g+=(h[w+x.R2]-g)*A,v+=(h[w+x.G2]-v)*A,b+=(h[w+x.B2]-b)*A}if(1==o)s.color.set(d,f,y,m),s.darkColor.set(g,v,b,1);else{l=s.color,p=s.darkColor;r==N.setup&&(l.setFromColor(s.data.color),p.setFromColor(s.data.darkColor)),l.add((d-l.r)*o,(f-l.g)*o,(y-l.b)*o,(m-l.a)*o),p.add((g-p.r)*o,(v-p.g)*o,(b-p.b)*o,0)}}},x.ENTRIES=8,x.PREV_TIME=-8,x.PREV_R=-7,x.PREV_G=-6,x.PREV_B=-5,x.PREV_A=-4,x.PREV_R2=-3,x.PREV_G2=-2,x.PREV_B2=-1,x.R=1,x.G=2,x.B=3,x.A=4,x.R2=5,x.G2=6,x.B2=7,x}(o);R.TwoColorTimeline=p;var c=function(){function t(t){this.frames=R.Utils.newFloatArray(t),this.attachmentNames=new Array(t)}return t.prototype.getPropertyId=function(){return(n.attachment<<24)+this.slotIndex},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},t.prototype.apply=function(t,e,i,n,o,r,a){var s=t.slots[this.slotIndex];if(a!=g.out||r!=N.setup){var h=this.frames;if(i<h[0]){if(r==N.setup){var l=s.data.attachmentName;s.setAttachment(null==l?null:t.getAttachment(this.slotIndex,l))}}else{var p=0;p=i>=h[h.length-1]?h.length-1:D.binarySearch(h,i,1)-1;var c=this.attachmentNames[p];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}}else{var u=s.data.attachmentName;s.setAttachment(null==u?null:t.getAttachment(this.slotIndex,u))}},t}();R.AttachmentTimeline=c;var G=null,u=function(i){function t(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t),e.frameVertices=new Array(t),null==G&&(G=R.Utils.newFloatArray(64)),e}return __extends(t,i),t.prototype.getPropertyId=function(){return(n.deform<<27)+ +this.attachment.id+this.slotIndex},t.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},t.prototype.apply=function(t,e,i,n,o,r,a){var s=t.slots[this.slotIndex],h=s.getAttachment();if(h instanceof R.VertexAttachment&&h.applyDeform(this.attachment)){var l=s.attachmentVertices,p=this.frameVertices,c=p[0].length,u=R.Utils.setArraySize(l,c),d=this.frames;if(i<d[0]){var f=h;switch(r){case N.setup:var y=void 0;return null==f.bones?y=f.vertices:(y=G).length<c&&(G=y=R.Utils.newFloatArray(c)),void R.Utils.arrayCopy(y,0,u,0,c);case N.current:if(1==o)break;if(null==f.bones)for(var m=f.vertices,g=0;g<c;g++)u[g]+=(m[g]-u[g])*o;else{o=1-o;for(var v=0;v<c;v++)u[v]*=o}}}else if(i>=d[d.length-1]){var b=p[d.length-1];if(1==o)R.Utils.arrayCopy(b,0,u,0,c);else if(r==N.setup){if(null==(f=h).bones){m=f.vertices;for(var _=0;_<c;_++){var w=m[_];u[_]=w+(b[_]-w)*o}}else for(var P=0;P<c;P++)u[P]=b[P]*o}else for(var A=0;A<c;A++)u[A]+=(b[A]-u[A])*o}else{var x=D.binarySearch(d,i),E=p[x-1],M=p[x],S=d[x],I=this.getCurvePercent(x-1,1-(i-S)/(d[x-1]-S));if(1==o)for(var T=0;T<c;T++){var C=E[T];u[T]=C+(M[T]-C)*I}else if(r==N.setup){if(null==(f=h).bones){m=f.vertices;for(var O=0;O<c;O++){C=E[O],w=m[O];u[O]=w+(C+(M[O]-C)*I-w)*o}}else for(var B=0;B<c;B++){C=E[B];u[B]=(C+(M[B]-C)*I)*o}}else for(var L=0;L<c;L++){C=E[L];u[L]+=(C+(M[L]-C)*I-u[L])*o}}}},t}(o);R.DeformTimeline=u;var d=function(){function t(t){this.frames=R.Utils.newFloatArray(t),this.events=new Array(t)}return t.prototype.getPropertyId=function(){return n.event<<24},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},t.prototype.apply=function(t,e,i,n,o,r,a){if(null!=n){var s=this.frames,h=this.frames.length;if(i<e)this.apply(t,e,Number.MAX_VALUE,n,o,r,a),e=-1;else if(e>=s[h-1])return;if(!(i<s[0])){var l=0;if(e<s[0])l=0;else for(var p=s[l=D.binarySearch(s,e)];0<l&&s[l-1]==p;)l--;for(;l<h&&i>=s[l];l++)n.push(this.events[l])}}},t}();R.EventTimeline=d;var f=function(){function t(t){this.frames=R.Utils.newFloatArray(t),this.drawOrders=new Array(t)}return t.prototype.getPropertyId=function(){return n.drawOrder<<24},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},t.prototype.apply=function(t,e,i,n,o,r,a){var s=t.drawOrder,h=t.slots;if(a!=g.out||r!=N.setup){var l=this.frames;if(i<l[0])r==N.setup&&R.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var p=0;p=i>=l[l.length-1]?l.length-1:D.binarySearch(l,i)-1;var c=this.drawOrders[p];if(null==c)R.Utils.arrayCopy(h,0,s,0,h.length);else for(var u=0,d=c.length;u<d;u++)s[u]=h[c[u]]}}else R.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)},t}();R.DrawOrderTimeline=f;var y=function(i){function d(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t*d.ENTRIES),e}return __extends(d,i),d.prototype.getPropertyId=function(){return(n.ikConstraint<<24)+this.ikConstraintIndex},d.prototype.setFrame=function(t,e,i,n){t*=d.ENTRIES,this.frames[t]=e,this.frames[t+d.MIX]=i,this.frames[t+d.BEND_DIRECTION]=n},d.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(i<s[0])switch(r){case N.setup:return h.mix=h.data.mix,void(h.bendDirection=h.data.bendDirection);case N.current:h.mix+=(h.data.mix-h.mix)*o,h.bendDirection=h.data.bendDirection}else if(i>=s[s.length-d.ENTRIES])r==N.setup?(h.mix=h.data.mix+(s[s.length+d.PREV_MIX]-h.data.mix)*o,h.bendDirection=a==g.out?h.data.bendDirection:s[s.length+d.PREV_BEND_DIRECTION]):(h.mix+=(s[s.length+d.PREV_MIX]-h.mix)*o,a==g.in&&(h.bendDirection=s[s.length+d.PREV_BEND_DIRECTION]));else{var l=D.binarySearch(s,i,d.ENTRIES),p=s[l+d.PREV_MIX],c=s[l],u=this.getCurvePercent(l/d.ENTRIES-1,1-(i-c)/(s[l+d.PREV_TIME]-c));r==N.setup?(h.mix=h.data.mix+(p+(s[l+d.MIX]-p)*u-h.data.mix)*o,h.bendDirection=a==g.out?h.data.bendDirection:s[l+d.PREV_BEND_DIRECTION]):(h.mix+=(p+(s[l+d.MIX]-p)*u-h.mix)*o,a==g.in&&(h.bendDirection=s[l+d.PREV_BEND_DIRECTION]))}},d.ENTRIES=3,d.PREV_TIME=-3,d.PREV_MIX=-2,d.PREV_BEND_DIRECTION=-1,d.MIX=1,d.BEND_DIRECTION=2,d}(o);R.IkConstraintTimeline=y;var m=function(i){function v(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t*v.ENTRIES),e}return __extends(v,i),v.prototype.getPropertyId=function(){return(n.transformConstraint<<24)+this.transformConstraintIndex},v.prototype.setFrame=function(t,e,i,n,o,r){t*=v.ENTRIES,this.frames[t]=e,this.frames[t+v.ROTATE]=i,this.frames[t+v.TRANSLATE]=n,this.frames[t+v.SCALE]=o,this.frames[t+v.SHEAR]=r},v.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(i<s[0]){var l=h.data;switch(r){case N.setup:return h.rotateMix=l.rotateMix,h.translateMix=l.translateMix,h.scaleMix=l.scaleMix,void(h.shearMix=l.shearMix);case N.current:h.rotateMix+=(l.rotateMix-h.rotateMix)*o,h.translateMix+=(l.translateMix-h.translateMix)*o,h.scaleMix+=(l.scaleMix-h.scaleMix)*o,h.shearMix+=(l.shearMix-h.shearMix)*o}}else{var p=0,c=0,u=0,d=0;if(i>=s[s.length-v.ENTRIES]){var f=s.length;p=s[f+v.PREV_ROTATE],c=s[f+v.PREV_TRANSLATE],u=s[f+v.PREV_SCALE],d=s[f+v.PREV_SHEAR]}else{var y=D.binarySearch(s,i,v.ENTRIES);p=s[y+v.PREV_ROTATE],c=s[y+v.PREV_TRANSLATE],u=s[y+v.PREV_SCALE],d=s[y+v.PREV_SHEAR];var m=s[y],g=this.getCurvePercent(y/v.ENTRIES-1,1-(i-m)/(s[y+v.PREV_TIME]-m));p+=(s[y+v.ROTATE]-p)*g,c+=(s[y+v.TRANSLATE]-c)*g,u+=(s[y+v.SCALE]-u)*g,d+=(s[y+v.SHEAR]-d)*g}if(r==N.setup){l=h.data;h.rotateMix=l.rotateMix+(p-l.rotateMix)*o,h.translateMix=l.translateMix+(c-l.translateMix)*o,h.scaleMix=l.scaleMix+(u-l.scaleMix)*o,h.shearMix=l.shearMix+(d-l.shearMix)*o}else h.rotateMix+=(p-h.rotateMix)*o,h.translateMix+=(c-h.translateMix)*o,h.scaleMix+=(u-h.scaleMix)*o,h.shearMix+=(d-h.shearMix)*o}},v.ENTRIES=5,v.PREV_TIME=-5,v.PREV_ROTATE=-4,v.PREV_TRANSLATE=-3,v.PREV_SCALE=-2,v.PREV_SHEAR=-1,v.ROTATE=1,v.TRANSLATE=2,v.SCALE=3,v.SHEAR=4,v}(o);R.TransformConstraintTimeline=m;var v=function(i){function d(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t*d.ENTRIES),e}return __extends(d,i),d.prototype.getPropertyId=function(){return(n.pathConstraintPosition<<24)+this.pathConstraintIndex},d.prototype.setFrame=function(t,e,i){t*=d.ENTRIES,this.frames[t]=e,this.frames[t+d.VALUE]=i},d.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(i<s[0])switch(r){case N.setup:return void(h.position=h.data.position);case N.current:h.position+=(h.data.position-h.position)*o}else{var l=0;if(i>=s[s.length-d.ENTRIES])l=s[s.length+d.PREV_VALUE];else{var p=D.binarySearch(s,i,d.ENTRIES);l=s[p+d.PREV_VALUE];var c=s[p],u=this.getCurvePercent(p/d.ENTRIES-1,1-(i-c)/(s[p+d.PREV_TIME]-c));l+=(s[p+d.VALUE]-l)*u}r==N.setup?h.position=h.data.position+(l-h.data.position)*o:h.position+=(l-h.position)*o}},d.ENTRIES=2,d.PREV_TIME=-2,d.PREV_VALUE=-1,d.VALUE=1,d}(o),b=function(e){function d(t){return e.call(this,t)||this}return __extends(d,e),d.prototype.getPropertyId=function(){return(n.pathConstraintSpacing<<24)+this.pathConstraintIndex},d.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(i<s[0])switch(r){case N.setup:return void(h.spacing=h.data.spacing);case N.current:h.spacing+=(h.data.spacing-h.spacing)*o}else{var l=0;if(i>=s[s.length-d.ENTRIES])l=s[s.length+d.PREV_VALUE];else{var p=D.binarySearch(s,i,d.ENTRIES);l=s[p+d.PREV_VALUE];var c=s[p],u=this.getCurvePercent(p/d.ENTRIES-1,1-(i-c)/(s[p+d.PREV_TIME]-c));l+=(s[p+d.VALUE]-l)*u}r==N.setup?h.spacing=h.data.spacing+(l-h.data.spacing)*o:h.spacing+=(l-h.spacing)*o}},d}(R.PathConstraintPositionTimeline=v);R.PathConstraintSpacingTimeline=b;var _=function(i){function f(t){var e=i.call(this,t)||this;return e.frames=R.Utils.newFloatArray(t*f.ENTRIES),e}return __extends(f,i),f.prototype.getPropertyId=function(){return(n.pathConstraintMix<<24)+this.pathConstraintIndex},f.prototype.setFrame=function(t,e,i,n){t*=f.ENTRIES,this.frames[t]=e,this.frames[t+f.ROTATE]=i,this.frames[t+f.TRANSLATE]=n},f.prototype.apply=function(t,e,i,n,o,r,a){var s=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(i<s[0])switch(r){case N.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case N.current:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*o,h.translateMix+=(h.data.translateMix-h.translateMix)*o}else{var l=0,p=0;if(i>=s[s.length-f.ENTRIES])l=s[s.length+f.PREV_ROTATE],p=s[s.length+f.PREV_TRANSLATE];else{var c=D.binarySearch(s,i,f.ENTRIES);l=s[c+f.PREV_ROTATE],p=s[c+f.PREV_TRANSLATE];var u=s[c],d=this.getCurvePercent(c/f.ENTRIES-1,1-(i-u)/(s[c+f.PREV_TIME]-u));l+=(s[c+f.ROTATE]-l)*d,p+=(s[c+f.TRANSLATE]-p)*d}r==N.setup?(h.rotateMix=h.data.rotateMix+(l-h.data.rotateMix)*o,h.translateMix=h.data.translateMix+(p-h.data.translateMix)*o):(h.rotateMix+=(l-h.rotateMix)*o,h.translateMix+=(p-h.translateMix)*o)}},f.ENTRIES=3,f.PREV_TIME=-3,f.PREV_ROTATE=-2,f.PREV_TRANSLATE=-1,f.ROTATE=1,f.TRANSLATE=2,f}(o);R.PathConstraintMixTimeline=_}(t.core||(t.core={}))}(pixi_spine||(pixi_spine={})),function(t){!function(x){var f=function(){function A(t){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new i(this),this.propertyIDs=new x.IntSet,this.mixingTo=new Array,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new x.Pool(function(){return new e}),this.data=t}return A.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,i=0,n=e.length;i<n;i++){var o=e[i];if(null!=o){o.animationLast=o.nextAnimationLast,o.trackLast=o.nextTrackLast;var r=t*o.timeScale;if(0<o.delay){if(o.delay-=r,0<o.delay)continue;r=-o.delay,o.delay=0}var a=o.next;if(null!=a){var s=o.trackLast-a.delay;if(0<=s){for(a.delay=0,a.trackTime=s+t*a.timeScale,o.trackTime+=r,this.setCurrent(i,a,!0);null!=a.mixingFrom;)a.mixTime+=r,a=a.mixingFrom;continue}}else if(o.trackLast>=o.trackEnd&&null==o.mixingFrom){e[i]=null,this.queue.end(o),this.disposeNext(o);continue}if(null!=o.mixingFrom&&this.updateMixingFrom(o,t)){var h=o.mixingFrom;for(o.mixingFrom=null;null!=h;)this.queue.end(h),h=h.mixingFrom}o.trackTime+=r}}this.queue.drain()},A.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var n=this.updateMixingFrom(i,e);return 0<t.mixTime&&(t.mixTime>=t.mixDuration||0==t.timeScale)?(0==i.totalAlpha&&(t.mixingFrom=i.mixingFrom,t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),n):(i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,i.trackTime+=e*i.timeScale,t.mixTime+=e*t.timeScale,!1)},A.prototype.apply=function(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var e=this.events,i=this.tracks,n=!1,o=0,r=i.length;o<r;o++){var a=i[o];if(!(null==a||0<a.delay)){n=!0;var s=0==o?x.MixPose.current:x.MixPose.currentLayered,h=a.alpha;null!=a.mixingFrom?h*=this.applyMixingFrom(a,t,s):a.trackTime>=a.trackEnd&&null==a.next&&(h=0);var l=a.animationLast,p=a.getAnimationTime(),c=a.animation.timelines.length,u=a.animation.timelines;if(1==h)for(var d=0;d<c;d++)u[d].apply(t,l,p,e,1,x.MixPose.setup,x.MixDirection.in);else{var f=a.timelineData,y=0==a.timelinesRotation.length;y&&x.Utils.setArraySize(a.timelinesRotation,c<<1,null);var m=a.timelinesRotation;for(d=0;d<c;d++){var g=u[d],v=f[d]>=A.FIRST?x.MixPose.setup:s;g instanceof x.RotateTimeline?this.applyRotateTimeline(g,t,p,h,v,m,d<<1,y):g.apply(t,l,p,e,h,v,x.MixDirection.in)}}this.queueEvents(a,p),e.length=0,a.nextAnimationLast=p,a.nextTrackLast=a.trackTime}}return this.queue.drain(),n},A.prototype.applyMixingFrom=function(t,e,i){var n=t.mixingFrom;null!=n.mixingFrom&&this.applyMixingFrom(n,e,i);var o=0;0==t.mixDuration?o=1:1<(o=t.mixTime/t.mixDuration)&&(o=1);var r=o<n.eventThreshold?this.events:null,a=o<n.attachmentThreshold,s=o<n.drawOrderThreshold,h=n.animationLast,l=n.getAnimationTime(),p=n.animation.timelines.length,c=n.animation.timelines,u=n.timelineData,d=n.timelineDipMix,f=0==n.timelinesRotation.length;f&&x.Utils.setArraySize(n.timelinesRotation,p<<1,null);for(var y,m=n.timelinesRotation,g=n.alpha*t.interruptAlpha,v=g*(1-o),b=0,_=n.totalAlpha=0;_<p;_++){var w=c[_];switch(u[_]){case A.SUBSEQUENT:if(!a&&w instanceof x.AttachmentTimeline)continue;if(!s&&w instanceof x.DrawOrderTimeline)continue;y=i,b=v;break;case A.FIRST:y=x.MixPose.setup,b=v;break;case A.DIP:y=x.MixPose.setup,b=g;break;default:y=x.MixPose.setup,b=g;var P=d[_];b*=Math.max(0,1-P.mixTime/P.mixDuration)}n.totalAlpha+=b,w instanceof x.RotateTimeline?this.applyRotateTimeline(w,e,l,b,y,m,_<<1,f):w.apply(e,h,l,r,b,y,x.MixDirection.out)}return 0<t.mixDuration&&this.queueEvents(n,l),this.events.length=0,n.nextAnimationLast=l,n.nextTrackLast=n.trackTime,o},A.prototype.applyRotateTimeline=function(t,e,i,n,o,r,a,s){if(s&&(r[a]=0),1!=n){var h=t,l=h.frames,p=e.bones[h.boneIndex];if(i<l[0])o==x.MixPose.setup&&(p.rotation=p.data.rotation);else{var c=0;if(i>=l[l.length-x.RotateTimeline.ENTRIES])c=p.data.rotation+l[l.length+x.RotateTimeline.PREV_ROTATION];else{var u=x.Animation.binarySearch(l,i,x.RotateTimeline.ENTRIES),d=l[u+x.RotateTimeline.PREV_ROTATION],f=l[u],y=h.getCurvePercent((u>>1)-1,1-(i-f)/(l[u+x.RotateTimeline.PREV_TIME]-f));c=l[u+x.RotateTimeline.ROTATION]-d,c=d+(c-=360*(16384-(16384.499999999996-c/360|0)))*y+p.data.rotation,c-=360*(16384-(16384.499999999996-c/360|0))}var m=o==x.MixPose.setup?p.data.rotation:p.rotation,g=0,v=c-m;if(0==v)g=r[a];else{v-=360*(16384-(16384.499999999996-v/360|0));var b=0,_=0;_=s?(b=0,v):(b=r[a],r[a+1]);var w=0<v,P=0<=b;x.MathUtils.signum(_)!=x.MathUtils.signum(v)&&Math.abs(_)<=90&&(180<Math.abs(b)&&(b+=360*x.MathUtils.signum(b)),P=w),g=v+b-b%360,P!=w&&(g+=360*x.MathUtils.signum(b)),r[a]=g}r[a+1]=v,m+=g*n,p.rotation=m-360*(16384-(16384.499999999996-m/360|0))}}else t.apply(e,0,i,null,1,o,x.MixDirection.in)},A.prototype.queueEvents=function(t,e){for(var i=t.animationStart,n=t.animationEnd,o=n-i,r=t.trackLast%o,a=this.events,s=0,h=a.length;s<h;s++){var l=a[s];if(l.time<r)break;l.time>n||this.queue.event(t,l)}for((t.loop?r>t.trackTime%o:n<=e&&t.animationLast<n)&&this.queue.complete(t);s<h;s++){a[s].time<i||this.queue.event(t,a[s])}},A.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},A.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var i=e;;){var n=i.mixingFrom;if(null==n)break;this.queue.end(n),i.mixingFrom=null,i=n}this.tracks[e.trackIndex]=null,this.queue.drain()}}},A.prototype.setCurrent=function(t,e,i){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(i&&this.queue.interrupt(n),e.mixingFrom=n,e.mixTime=0,null!=n.mixingFrom&&0<n.mixDuration&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)},A.prototype.setAnimation=function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,i)},A.prototype.setAnimationWith=function(t,e,i){if(null==e)throw new Error("animation cannot be null.");var n=!0,o=this.expandToIndex(t);null!=o&&(-1==o.nextTrackLast?(this.tracks[t]=o.mixingFrom,this.queue.interrupt(o),this.queue.end(o),this.disposeNext(o),o=o.mixingFrom,n=!1):this.disposeNext(o));var r=this.trackEntry(t,e,i,o);return this.setCurrent(t,r,n),this.queue.drain(),r},A.prototype.addAnimation=function(t,e,i,n){var o=this.data.skeletonData.findAnimation(e);if(null==o)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,o,i,n)},A.prototype.addAnimationWith=function(t,e,i,n){if(null==e)throw new Error("animation cannot be null.");var o=this.expandToIndex(t);if(null!=o)for(;null!=o.next;)o=o.next;var r=this.trackEntry(t,e,i,o);if(null==o)this.setCurrent(t,r,!0),this.queue.drain();else if(o.next=r,n<=0){var a=o.animationEnd-o.animationStart;0!=a?n+=a*(1+(o.trackTime/a|0))-this.data.getMix(o.animation,e):n=0}return r.delay=n,r},A.prototype.setEmptyAnimation=function(t,e){var i=this.setAnimationWith(t,A.emptyAnimation,!1);return i.mixDuration=e,i.trackEnd=e,i},A.prototype.addEmptyAnimation=function(t,e,i){i<=0&&(i-=e);var n=this.addAnimationWith(t,A.emptyAnimation,!1,i);return n.mixDuration=e,n.trackEnd=e,n},A.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,n=this.tracks.length;i<n;i++){var o=this.tracks[i];null!=o&&this.setEmptyAnimation(o.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},A.prototype.expandToIndex=function(t){return t<this.tracks.length?this.tracks[t]:(x.Utils.ensureArrayCapacity(this.tracks,t-this.tracks.length+1,null),this.tracks.length=t+1,null)},A.prototype.trackEntry=function(t,e,i,n){var o=this.trackEntryPool.obtain();return o.trackIndex=t,o.animation=e,o.loop=i,o.eventThreshold=0,o.attachmentThreshold=0,o.drawOrderThreshold=0,o.animationStart=0,o.animationEnd=e.duration,o.animationLast=-1,o.nextAnimationLast=-1,o.delay=0,o.trackTime=0,o.trackLast=-1,o.nextTrackLast=-1,o.trackEnd=Number.MAX_VALUE,o.timeScale=1,o.alpha=1,o.interruptAlpha=1,o.mixTime=0,o.mixDuration=null==n?0:this.data.getMix(n.animation,e),o},A.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},A.prototype._animationsChanged=function(){this.animationsChanged=!1;var t=this.propertyIDs;t.clear();for(var e=this.mixingTo,i=0,n=this.tracks.length;i<n;i++){var o=this.tracks[i];null!=o&&o.setTimelineData(null,e,t)}},A.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},A.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},A.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);0<=e&&this.listeners.splice(e,1)},A.prototype.clearListeners=function(){this.listeners.length=0},A.prototype.clearListenerNotifications=function(){this.queue.clear()},A.prototype.setAnimationByName=function(t,e,i){A.deprecatedWarning1||(A.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,i)},A.prototype.addAnimationByName=function(t,e,i,n){A.deprecatedWarning2||(A.deprecatedWarning2=!0,console.warn("Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,i,n)},A.prototype.hasAnimation=function(t){return null!==this.data.skeletonData.findAnimation(t)},A.prototype.hasAnimationByName=function(t){return A.deprecatedWarning3||(A.deprecatedWarning3=!0,console.warn("Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)},A.emptyAnimation=new x.Animation("<empty>",[],0),A.SUBSEQUENT=0,A.FIRST=1,A.DIP=2,A.DIP_MIX=3,A.deprecatedWarning1=!1,A.deprecatedWarning2=!1,A.deprecatedWarning3=!1,A}();x.AnimationState=f;var e=function(){function e(){this.timelineData=new Array,this.timelineDipMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.animation=null,this.listener=null,this.timelineData.length=0,this.timelineDipMix.length=0,this.timelinesRotation.length=0},e.prototype.setTimelineData=function(t,e,i){null!=t&&e.push(t);var n=null!=this.mixingFrom?this.mixingFrom.setTimelineData(this,e,i):this;null!=t&&e.pop();var o=e,r=e.length-1,a=this.animation.timelines,s=this.animation.timelines.length,h=x.Utils.setArraySize(this.timelineData,s);this.timelineDipMix.length=0;var l=x.Utils.setArraySize(this.timelineDipMix,s);t:for(var p=0;p<s;p++){var c=a[p].getPropertyId();if(i.add(c))if(null!=t&&t.hasTimeline(c)){for(var u=r;0<=u;u--){var d=o[u];if(!d.hasTimeline(c)&&0<d.mixDuration){h[p]=f.DIP_MIX,l[p]=d;continue t}}h[p]=f.DIP}else h[p]=f.FIRST;else h[p]=f.SUBSEQUENT}return n},e.prototype.hasTimeline=function(t){for(var e=this.animation.timelines,i=0,n=e.length;i<n;i++)if(e[i].getPropertyId()==t)return!0;return!1},e.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},Object.defineProperty(e.prototype,"time",{get:function(){return e.deprecatedWarning1||(e.deprecatedWarning1=!0,console.warn("Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime},set:function(t){e.deprecatedWarning1||(e.deprecatedWarning1=!0,console.warn("Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return e.deprecatedWarning2||(e.deprecatedWarning2=!0,console.warn("Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime},set:function(t){e.deprecatedWarning2||(e.deprecatedWarning2=!0,console.warn("Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t},enumerable:!0,configurable:!0}),e.prototype.loopsCount=function(){return Math.floor(this.trackTime/this.trackEnd)},e.deprecatedWarning1=!1,e.deprecatedWarning2=!1,e}();x.TrackEntry=e;var h,t,i=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(h.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(h.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(h.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(h.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(h.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(h.event),this.objects.push(t),this.objects.push(e)},t.prototype.deprecateStuff=function(){return t.deprecatedWarning1||(t.deprecatedWarning1=!0,console.warn("Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,i=0;i<t.length;i+=2){var n=t[i],o=t[i+1];switch(n){case h.start:null!=o.listener&&o.listener.start&&o.listener.start(o);for(var r=0;r<e.length;r++)e[r].start&&e[r].start(o);o.onStart&&this.deprecateStuff()&&o.onStart(o.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(o.trackIndex);break;case h.interrupt:null!=o.listener&&o.listener.interrupt&&o.listener.interrupt(o);for(r=0;r<e.length;r++)e[r].interrupt&&e[r].interrupt(o);break;case h.end:null!=o.listener&&o.listener.end&&o.listener.end(o);for(r=0;r<e.length;r++)e[r].end&&e[r].end(o);o.onEnd&&this.deprecateStuff()&&o.onEnd(o.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(o.trackIndex);case h.dispose:null!=o.listener&&o.listener.dispose&&o.listener.dispose(o);for(r=0;r<e.length;r++)e[r].dispose&&e[r].dispose(o);this.animState.trackEntryPool.free(o);break;case h.complete:null!=o.listener&&o.listener.complete&&o.listener.complete(o);for(r=0;r<e.length;r++)e[r].complete&&e[r].complete(o);var a=x.MathUtils.toInt(o.loopsCount());o.onComplete&&this.deprecateStuff()&&o.onComplete(o.trackIndex,a),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(o.trackIndex,a);break;case h.event:var s=t[2+i++];null!=o.listener&&o.listener.event&&o.listener.event(o,s);for(r=0;r<e.length;r++)e[r].event&&e[r].event(o,s);o.onEvent&&this.deprecateStuff()&&o.onEvent(o.trackIndex,s),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(o.trackIndex,s)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t.deprecatedWarning1=!1,t}();x.EventQueue=i,(t=h=x.EventType||(x.EventType={}))[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event";var n=function(){function t(){}return t.prototype.start=function(t){},t.prototype.interrupt=function(t){},t.prototype.end=function(t){},t.prototype.dispose=function(t){},t.prototype.complete=function(t){},t.prototype.event=function(t,e){},t}();x.AnimationStateAdapter2=n}(t.core||(t.core={}))}(pixi_spine||(pixi_spine={})),function(t){var e,i;e=t.core||(t.core={}),i=function(){function n(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return n.prototype.setMix=function(t,e,i){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);var o=this.skeletonData.findAnimation(e);if(null==o)throw new Error("Animation not found: "+e);this.setMixWith(n,o,i)},n.prototype.setMixByName=function(t,e,i){n.deprecatedWarning1||(n.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,i)},n.prototype.setMixWith=function(t,e,i){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var n=t.name+e.name;this.animationToMixTime[n]=i},n.prototype.getMix=function(t,e){var i=t.name+e.name,n=this.animationToMixTime[i];return void 0===n?this.defaultMix:n},n.deprecatedWarning1=!1,n}(),e.AnimationStateData=i}(pixi_spine||(pixi_spine={})),function(t){var r,e;r=t.core||(t.core={}),e=function(){function t(t){this.atlas=t}return t.prototype.newRegionAttachment=function(t,e,i){var n=this.atlas.findRegion(i);if(null==n)throw new Error("Region not found in atlas: "+i+" (region attachment: "+e+")");var o=new r.RegionAttachment(e);return o.region=n,o},t.prototype.newMeshAttachment=function(t,e,i){var n=this.atlas.findRegion(i);if(null==n)throw new Error("Region not found in atlas: "+i+" (mesh attachment: "+e+")");var o=new r.MeshAttachment(e);return o.region=n,o},t.prototype.newBoundingBoxAttachment=function(t,e){return new r.BoundingBoxAttachment(e)},t.prototype.newPathAttachment=function(t,e){return new r.PathAttachment(e)},t.prototype.newPointAttachment=function(t,e){return new r.PointAttachment(e)},t.prototype.newClippingAttachment=function(t,e){return new r.ClippingAttachment(e)},t}(),r.AtlasAttachmentLoader=e}(pixi_spine||(pixi_spine={})),function(t){var e,i;e=t.core||(t.core={}),(i=e.BlendMode||(e.BlendMode={}))[i.Normal=0]="Normal",i[i.Additive=1]="Additive",i[i.Multiply=2]="Multiply",i[i.Screen=3]="Screen"}(pixi_spine||(pixi_spine={})),function(t){var O,e;O=t.core||(t.core={}),e=function(){function C(t,e,i){if(this.matrix=new PIXI.Matrix,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}return Object.defineProperty(C.prototype,"worldX",{get:function(){return this.matrix.tx},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"worldY",{get:function(){return this.matrix.ty},enumerable:!0,configurable:!0}),C.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},C.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},C.prototype.updateWorldTransformWith=function(t,e,i,n,o,r,a){this.ax=t,this.ay=e,this.arotation=i,this.ascaleX=n,this.ascaleY=o,this.ashearX=r,this.ashearY=a,this.appliedValid=!0;var s=this.parent,h=this.matrix;if(null==s){var l=i+90+a,p=O.MathUtils.cosDeg(i+r)*n,c=O.MathUtils.cosDeg(l)*o,u=O.MathUtils.sinDeg(i+r)*n,d=O.MathUtils.sinDeg(l)*o,f=this.skeleton;return f.flipX&&(t=-t,p=-p,c=-c),f.flipY!==C.yDown&&(e=-e,u=-u,d=-d),h.a=p,h.c=c,h.b=u,h.d=d,h.tx=t+f.x,void(h.ty=e+f.y)}var y=s.matrix.a,m=s.matrix.c,g=s.matrix.b,v=s.matrix.d;switch(h.tx=y*t+m*e+s.matrix.tx,h.ty=g*t+v*e+s.matrix.ty,this.data.transformMode){case O.TransformMode.Normal:l=i+90+a,p=O.MathUtils.cosDeg(i+r)*n,c=O.MathUtils.cosDeg(l)*o,u=O.MathUtils.sinDeg(i+r)*n,d=O.MathUtils.sinDeg(l)*o;return h.a=y*p+m*u,h.c=y*c+m*d,h.b=g*p+v*u,void(h.d=g*c+v*d);case O.TransformMode.OnlyTranslation:l=i+90+a;h.a=O.MathUtils.cosDeg(i+r)*n,h.c=O.MathUtils.cosDeg(l)*o,h.b=O.MathUtils.sinDeg(i+r)*n,h.d=O.MathUtils.sinDeg(l)*o;break;case O.TransformMode.NoRotationOrReflection:var b=0,_=i+r-(b=1e-4<(P=y*y+g*g)?(m=g*(P=Math.abs(y*v-m*g)/P),v=y*P,Math.atan2(g,y)*O.MathUtils.radDeg):(g=y=0,90-Math.atan2(v,m)*O.MathUtils.radDeg)),w=i+a-b+90;p=O.MathUtils.cosDeg(_)*n,c=O.MathUtils.cosDeg(w)*o,u=O.MathUtils.sinDeg(_)*n,d=O.MathUtils.sinDeg(w)*o;h.a=y*p-m*u,h.c=y*c-m*d,h.b=g*p+v*u,h.d=g*c+v*d;break;case O.TransformMode.NoScale:case O.TransformMode.NoScaleOrReflection:var P,A=O.MathUtils.cosDeg(i),x=O.MathUtils.sinDeg(i),E=y*A+m*x,M=g*A+v*x;1e-5<(P=Math.sqrt(E*E+M*M))&&(P=1/P),E*=P,M*=P,P=Math.sqrt(E*E+M*M);var S=Math.PI/2+Math.atan2(M,E),I=Math.cos(S)*P,T=Math.sin(S)*P;p=O.MathUtils.cosDeg(r)*n,c=O.MathUtils.cosDeg(90+a)*o,u=O.MathUtils.sinDeg(r)*n,d=O.MathUtils.sinDeg(90+a)*o;return h.a=E*p+I*u,h.c=E*c+I*d,h.b=M*p+T*u,h.d=M*c+T*d,void((this.data.transformMode!=O.TransformMode.NoScaleOrReflection?y*v-m*g<0:this.skeleton.flipX!=this.skeleton.flipY!=C.yDown)&&(h.c=-h.c,h.d=-h.d))}this.skeleton.flipX&&(h.a=-h.a,h.c=-h.c),this.skeleton.flipY!=C.yDown&&(h.b=-h.b,h.d=-h.d)},C.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},C.prototype.getWorldRotationX=function(){return Math.atan2(this.matrix.b,this.matrix.a)*O.MathUtils.radDeg},C.prototype.getWorldRotationY=function(){return Math.atan2(this.matrix.d,this.matrix.c)*O.MathUtils.radDeg},C.prototype.getWorldScaleX=function(){var t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)},C.prototype.getWorldScaleY=function(){var t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)},C.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*O.MathUtils.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*O.MathUtils.radDeg);var i=t.matrix,n=1/(i.a*i.d-i.b*i.c),o=e.tx-i.tx,r=e.ty-i.ty;this.ax=o*i.d*n-r*i.c*n,this.ay=r*i.a*n-o*i.b*n;var a=n*i.d,s=n*i.a,h=n*i.c,l=n*i.b,p=a*e.a-h*e.b,c=a*e.c-h*e.d,u=s*e.b-l*e.a,d=s*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(p*p+u*u),1e-4<this.ascaleX){var f=p*d-c*u;this.ascaleY=f/this.ascaleX,this.ashearY=Math.atan2(p*c+u*d,f)*O.MathUtils.radDeg,this.arotation=Math.atan2(u,p)*O.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(c*c+d*d),this.ashearY=0,this.arotation=90-Math.atan2(d,c)*O.MathUtils.radDeg},C.prototype.worldToLocal=function(t){var e=this.matrix,i=e.a,n=e.c,o=e.b,r=e.d,a=1/(i*r-n*o),s=t.x-e.tx,h=t.y-e.ty;return t.x=s*r*a-h*n*a,t.y=h*i*a-s*o*a,t},C.prototype.localToWorld=function(t){var e=this.matrix,i=t.x,n=t.y;return t.x=i*e.a+n*e.c+e.tx,t.y=i*e.b+n*e.d+e.ty,t},C.prototype.worldToLocalRotation=function(t){var e=O.MathUtils.sinDeg(t),i=O.MathUtils.cosDeg(t),n=this.matrix;return Math.atan2(n.a*e-n.b*i,n.d*i-n.c*e)*O.MathUtils.radDeg},C.prototype.localToWorldRotation=function(t){var e=O.MathUtils.sinDeg(t),i=O.MathUtils.cosDeg(t),n=this.matrix;return Math.atan2(i*n.b+e*n.d,i*n.a+e*n.c)*O.MathUtils.radDeg},C.prototype.rotateWorld=function(t){var e=this.matrix,i=e.a,n=e.c,o=e.b,r=e.d,a=O.MathUtils.cosDeg(t),s=O.MathUtils.sinDeg(t);e.a=a*i-s*o,e.c=a*n-s*r,e.b=s*i+a*o,e.d=s*n+a*r,this.appliedValid=!1},C.yDown=!1,C}(),O.Bone=e}(pixi_spine||(pixi_spine={})),function(t){var e,n,i,o;e=t.core||(t.core={}),o=function(t,e,i){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=n.Normal,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=i},e.BoneData=o,(i=n=e.TransformMode||(e.TransformMode={}))[i.Normal=0]="Normal",i[i.OnlyTranslation=1]="OnlyTranslation",i[i.NoRotationOrReflection=2]="NoRotationOrReflection",i[i.NoScale=3]="NoScale",i[i.NoScaleOrReflection=4]="NoScaleOrReflection"}(pixi_spine||(pixi_spine={})),function(t){var e;e=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e},(t.core||(t.core={})).Event=e}(pixi_spine||(pixi_spine={})),function(t){var e;e=function(t){this.name=t},(t.core||(t.core={})).EventData=e}(pixi_spine||(pixi_spine={})),function(t){var nt,e;nt=t.core||(t.core={}),e=function(){function t(t,e){if(this.mix=1,this.bendDirection=0,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}return t.prototype.getOrder=function(){return this.data.order},t.prototype.apply=function(){this.update()},t.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}},t.prototype.apply1=function(t,e,i,n){t.appliedValid||t.updateAppliedTransform();var o=t.parent.matrix,r=1/(o.a*o.d-o.b*o.c),a=e-o.tx,s=i-o.ty,h=(a*o.d-s*o.c)*r-t.ax,l=(s*o.a-a*o.b)*r-t.ay,p=Math.atan2(l,h)*nt.MathUtils.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(p+=180),180<p?p-=360:p<-180&&(p+=360),t.updateWorldTransformWith(t.ax,t.ay,t.arotation+p*n,t.ascaleX,t.ascaleY,t.ashearX,t.ashearY)},t.prototype.apply2=function(t,e,i,n,o,r){if(0!=r){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var a=t.ax,s=t.ay,h=t.ascaleX,l=t.ascaleY,p=e.ascaleX,c=t.matrix,u=0,d=0,f=0;f=h<0?(h=-h,u=180,-1):(u=0,1),l<0&&(l=-l,f=-f),d=p<0?(p=-p,180):0;var y=e.ax,m=0,g=0,v=0,b=c.a,_=c.c,w=c.b,P=c.d,A=Math.abs(h-l)<=1e-4;v=A?(g=b*y+_*(m=e.ay)+c.tx,w*y+P*m+c.ty):(m=0,g=b*y+c.tx,w*y+c.ty);var x=t.parent.matrix;b=x.a,_=x.c,w=x.b;var E=1/(b*(P=x.d)-_*w),M=i-x.tx,S=n-x.ty,I=(M*P-S*_)*E-a,T=(S*b-M*w)*E-s,C=((M=g-x.tx)*P-(S=v-x.ty)*_)*E-a,O=(S*b-M*w)*E-s,B=Math.sqrt(C*C+O*O),L=e.data.length*p,R=0,N=0;t:if(A){var D=(I*I+T*T-B*B-(L*=h)*L)/(2*B*L);D<-1?D=-1:1<D&&(D=1),N=Math.acos(D)*o,b=B+L*D,_=L*Math.sin(N),R=Math.atan2(T*b-I*_,I*b+T*_)}else{var G=(b=h*L)*b,k=(_=l*L)*_,j=I*I+T*T,V=Math.atan2(T,I),F=-2*k*B,X=k-G;if(0<=(P=F*F-4*X*(w=k*B*B+G*j-G*k))){var q=Math.sqrt(P);F<0&&(q=-q);var U=(q=-(F+q)/2)/X,W=w/q,Y=Math.abs(U)<Math.abs(W)?U:W;if(Y*Y<=j){S=Math.sqrt(j-Y*Y)*o,R=V-Math.atan2(S,Y),N=Math.atan2(S/l,(Y-B)/h);break t}}var z=nt.MathUtils.PI,H=B-b,K=H*H,Z=0,J=0,Q=B+b,$=Q*Q,tt=0;-1<=(w=-b*B/(G-k))&&w<=1&&(w=Math.acos(w),(P=(M=b*Math.cos(w)+B)*M+(S=_*Math.sin(w))*S)<K&&(z=w,K=P,H=M,Z=S),$<P&&(J=w,$=P,Q=M,tt=S)),N=j<=(K+$)/2?(R=V-Math.atan2(Z*o,H),z*o):(R=V-Math.atan2(tt*o,Q),J*o)}var et=Math.atan2(m,y)*f,it=t.arotation;180<(R=(R-et)*nt.MathUtils.radDeg+u-it)?R-=360:R<-180&&(R+=360),t.updateWorldTransformWith(a,s,it+R*r,t.ascaleX,t.ascaleY,0,0),it=e.arotation,180<(N=((N+et)*nt.MathUtils.radDeg-e.ashearX)*f+d-it)?N-=360:N<-180&&(N+=360),e.updateWorldTransformWith(y,m,it+N*r,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()},t}(),nt.IkConstraint=e}(pixi_spine||(pixi_spine={})),function(t){var e;e=function(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.mix=1,this.name=t},(t.core||(t.core={})).IkConstraintData=e}(pixi_spine||(pixi_spine={})),function(t){var K,e;K=t.core||(t.core={}),e=function(){function H(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return H.prototype.apply=function(){this.update()},H.prototype.update=function(){var t=this.target.getAttachment();if(t instanceof K.PathAttachment){var e=this.rotateMix,i=this.translateMix,n=0<e;if(0<i||n){var o=this.data,r=o.spacingMode,a=r==K.SpacingMode.Length,s=o.rotateMode,h=s==K.RotateMode.Tangent,l=s==K.RotateMode.ChainScale,p=this.bones.length,c=h?p:p+1,u=this.bones,d=K.Utils.setArraySize(this.spaces,c),f=null,y=this.spacing;if(l||a){l&&(f=K.Utils.setArraySize(this.lengths,p));for(var m=0,g=c-1;m<g;){var v=(I=u[m]).data.length,b=v*I.matrix.a,_=v*I.matrix.b,w=Math.sqrt(b*b+_*_);l&&(f[m]=w),d[++m]=(a?v+y:y)*w/v}}else for(m=1;m<c;m++)d[m]=y;var P=this.computeWorldPositions(t,c,h,o.positionMode==K.PositionMode.Percent,r==K.SpacingMode.Percent),A=P[0],x=P[1],E=o.offsetRotation,M=!1;if(0==E)M=s==K.RotateMode.Chain;else M=!1,E*=0<(S=this.target.bone.matrix).a*S.d-S.b*S.c?K.MathUtils.degRad:-K.MathUtils.degRad;m=0;for(var S=3;m<p;m++,S+=3){var I,T=(I=u[m]).matrix;T.tx+=(A-T.tx)*i,T.ty+=(x-T.ty)*i;var C=(b=P[S])-A,O=(_=P[S+1])-x;if(l){var B=f[m];if(0!=B){var L=(Math.sqrt(C*C+O*O)/B-1)*e+1;T.a*=L,T.b*=L}}if(A=b,x=_,n){var R=T.a,N=T.c,D=T.b,G=T.d,k=0,j=0,V=0;if(k=h?P[S-1]:0==d[m+1]?P[S+2]:Math.atan2(O,C),k-=Math.atan2(D,R),M){j=Math.cos(k),V=Math.sin(k);var F=I.data.length;A+=(F*(j*R-V*D)-C)*e,x+=(F*(V*R+j*D)-O)*e}else k+=E;k>K.MathUtils.PI?k-=K.MathUtils.PI2:k<-K.MathUtils.PI&&(k+=K.MathUtils.PI2),k*=e,j=Math.cos(k),V=Math.sin(k),T.a=j*R-V*D,T.c=j*N-V*G,T.b=V*R+j*D,T.d=V*N+j*G}I.appliedValid=!1}}}},H.prototype.computeWorldPositions=function(t,e,i,n,o){var r=this.target,a=this.position,s=this.spaces,h=K.Utils.setArraySize(this.positions,3*e+2),l=null,p=t.closed,c=t.worldVerticesLength,u=c/6,d=H.NONE;if(!t.constantSpeed){var f=t.lengths,y=f[u-=p?1:2];if(n&&(a*=y),o)for(var m=0;m<e;m++)s[m]*=y;l=K.Utils.setArraySize(this.world,8);m=0;for(var g=0,v=0;m<e;m++,g+=3){var b=a+=q=s[m];if(p)(b%=y)<0&&(b+=y),v=0;else{if(b<0){d!=H.BEFORE&&(d=H.BEFORE,t.computeWorldVertices(r,2,4,l,0,2)),this.addBeforePosition(b,l,0,h,g);continue}if(y<b){d!=H.AFTER&&(d=H.AFTER,t.computeWorldVertices(r,c-6,4,l,0,2)),this.addAfterPosition(b-y,l,0,h,g);continue}}for(;;v++){var _=f[v];if(!(_<b)){if(0==v)b/=_;else b=(b-(z=f[v-1]))/(_-z);break}}v!=d&&(d=v,p&&v==u?(t.computeWorldVertices(r,c-4,4,l,0,2),t.computeWorldVertices(r,0,4,l,4,2)):t.computeWorldVertices(r,6*v+2,8,l,0,2)),this.addCurvePosition(b,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,g,i||0<m&&0==q)}return h}p?(c+=2,l=K.Utils.setArraySize(this.world,c),t.computeWorldVertices(r,2,c-4,l,0,2),t.computeWorldVertices(r,0,2,l,c-4,2),l[c-2]=l[0],l[c-1]=l[1]):(u--,c-=4,l=K.Utils.setArraySize(this.world,c),t.computeWorldVertices(r,2,c,l,0,2));for(var w=K.Utils.setArraySize(this.curves,u),P=0,A=l[0],x=l[1],E=0,M=0,S=0,I=0,T=0,C=0,O=0,B=0,L=0,R=0,N=0,D=0,G=0,k=0,j=(m=0,2);m<u;m++,j+=6)E=l[j],M=l[j+1],S=l[j+2],I=l[j+3],N=2*(O=.1875*(A-2*E+S))+(L=.09375*(3*(E-S)-A+(T=l[j+4]))),D=2*(B=.1875*(x-2*M+I))+(R=.09375*(3*(M-I)-x+(C=l[j+5]))),G=.75*(E-A)+O+.16666667*L,k=.75*(M-x)+B+.16666667*R,P+=Math.sqrt(G*G+k*k),G+=N,k+=D,N+=L,D+=R,P+=Math.sqrt(G*G+k*k),G+=N,k+=D,P+=Math.sqrt(G*G+k*k),G+=N+L,k+=D+R,P+=Math.sqrt(G*G+k*k),w[m]=P,A=T,x=C;if(n&&(a*=P),o)for(m=0;m<e;m++)s[m]*=P;for(var V=this.segments,F=0,X=(m=0,g=0,v=0,0);m<e;m++,g+=3){var q;b=a+=q=s[m];if(p)(b%=P)<0&&(b+=P),v=0;else{if(b<0){this.addBeforePosition(b,l,0,h,g);continue}if(P<b){this.addAfterPosition(b-P,l,c-4,h,g);continue}}for(;;v++){var U=w[v];if(!(U<b)){if(0==v)b/=U;else b=(b-(z=w[v-1]))/(U-z);break}}if(v!=d){var W=6*(d=v);for(A=l[W],x=l[W+1],E=l[W+2],M=l[W+3],S=l[W+4],I=l[W+5],N=2*(O=.03*(A-2*E+S))+(L=.006*(3*(E-S)-A+(T=l[W+6]))),D=2*(B=.03*(x-2*M+I))+(R=.006*(3*(M-I)-x+(C=l[W+7]))),G=.3*(E-A)+O+.16666667*L,k=.3*(M-x)+B+.16666667*R,F=Math.sqrt(G*G+k*k),V[0]=F,W=1;W<8;W++)G+=N,k+=D,N+=L,D+=R,F+=Math.sqrt(G*G+k*k),V[W]=F;G+=N,k+=D,F+=Math.sqrt(G*G+k*k),V[8]=F,G+=N+L,k+=D+R,F+=Math.sqrt(G*G+k*k),V[9]=F,X=0}for(b*=F;;X++){var Y=V[X];if(!(Y<b)){var z;if(0==X)b/=Y;else b=X+(b-(z=V[X-1]))/(Y-z);break}}this.addCurvePosition(.1*b,A,x,E,M,S,I,T,C,h,g,i||0<m&&0==q)}return h},H.prototype.addBeforePosition=function(t,e,i,n,o){var r=e[i],a=e[i+1],s=e[i+2]-r,h=e[i+3]-a,l=Math.atan2(h,s);n[o]=r+t*Math.cos(l),n[o+1]=a+t*Math.sin(l),n[o+2]=l},H.prototype.addAfterPosition=function(t,e,i,n,o){var r=e[i+2],a=e[i+3],s=r-e[i],h=a-e[i+1],l=Math.atan2(h,s);n[o]=r+t*Math.cos(l),n[o+1]=a+t*Math.sin(l),n[o+2]=l},H.prototype.addCurvePosition=function(t,e,i,n,o,r,a,s,h,l,p,c){(0==t||isNaN(t))&&(t=1e-4);var u=t*t,d=u*t,f=1-t,y=f*f,m=y*f,g=f*t,v=3*g,b=f*v,_=v*t,w=e*m+n*b+r*_+s*d,P=i*m+o*b+a*_+h*d;l[p]=w,l[p+1]=P,c&&(l[p+2]=Math.atan2(P-(i*y+o*g*2+a*u),w-(e*y+n*g*2+r*u)))},H.prototype.getOrder=function(){return this.data.order},H.NONE=-1,H.BEFORE=-2,H.AFTER=-3,H}(),K.PathConstraint=e}(pixi_spine||(pixi_spine={})),function(t){var e,i,n,o,r;e=t.core||(t.core={}),r=function(t){this.order=0,this.bones=new Array,this.name=t},e.PathConstraintData=r,(i=e.PositionMode||(e.PositionMode={}))[i.Fixed=0]="Fixed",i[i.Percent=1]="Percent",(n=e.SpacingMode||(e.SpacingMode={}))[n.Length=0]="Length",n[n.Fixed=1]="Fixed",n[n.Percent=2]="Percent",(o=e.RotateMode||(e.RotateMode={}))[o.Tangent=0]="Tangent",o[o.Chain=1]="Chain",o[o.ChainScale=2]="ChainScale"}(pixi_spine||(pixi_spine={})),function(t){var b,e;b=t.core||(t.core={}),e=function(){function t(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.flipX=!1,this.flipY=!1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(var e=0;e<t.bones.length;e++){var i=t.bones[e],n=void 0;if(null==i.parent)n=new b.Bone(i,this,null);else{var o=this.bones[i.parent.index];n=new b.Bone(i,this,o),o.children.push(n)}this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(e=0;e<t.slots.length;e++){var r=t.slots[e],a=(n=this.bones[r.boneData.index],new b.Slot(r,n));this.slots.push(a),this.drawOrder.push(a)}this.ikConstraints=new Array;for(e=0;e<t.ikConstraints.length;e++){var s=t.ikConstraints[e];this.ikConstraints.push(new b.IkConstraint(s,this))}this.transformConstraints=new Array;for(e=0;e<t.transformConstraints.length;e++){var h=t.transformConstraints[e];this.transformConstraints.push(new b.TransformConstraint(h,this))}this.pathConstraints=new Array;for(e=0;e<t.pathConstraints.length;e++){var l=t.pathConstraints[e];this.pathConstraints.push(new b.PathConstraint(l,this))}this.color=new b.Color(1,1,1,1),this.updateCache()}return t.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].sorted=!1;var n=this.ikConstraints,o=this.transformConstraints,r=this.pathConstraints,a=n.length,s=o.length,h=r.length,l=a+s+h;t:for(e=0;e<l;e++){for(var p=0;p<a;p++){if((c=n[p]).data.order==e){this.sortIkConstraint(c);continue t}}for(p=0;p<s;p++){if((c=o[p]).data.order==e){this.sortTransformConstraint(c);continue t}}for(p=0;p<h;p++){var c;if((c=r[p]).data.order==e){this.sortPathConstraint(c);continue t}}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e])},t.prototype.sortIkConstraint=function(t){var e=t.target;this.sortBone(e);var i=t.bones,n=i[0];if(this.sortBone(n),1<i.length){var o=i[i.length-1];-1<this._updateCache.indexOf(o)||this.updateCacheReset.push(o)}this._updateCache.push(t),this.sortReset(n.children),i[i.length-1].sorted=!0},t.prototype.sortPathConstraint=function(t){var e=t.target,i=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,i,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,n);for(var o=0,r=this.data.skins.length;o<r;o++)this.sortPathConstraintAttachment(this.data.skins[o],i,n);var a=e.getAttachment();a instanceof b.PathAttachment&&this.sortPathConstraintAttachmentWith(a,n);var s=t.bones,h=s.length;for(o=0;o<h;o++)this.sortBone(s[o]);this._updateCache.push(t);for(o=0;o<h;o++)this.sortReset(s[o].children);for(o=0;o<h;o++)s[o].sorted=!0},t.prototype.sortTransformConstraint=function(t){this.sortBone(t.target);var e=t.bones,i=e.length;if(t.data.local)for(var n=0;n<i;n++){var o=e[n];this.sortBone(o.parent),-1<this._updateCache.indexOf(o)||this.updateCacheReset.push(o)}else for(n=0;n<i;n++)this.sortBone(e[n]);this._updateCache.push(t);for(var r=0;r<i;r++)this.sortReset(e[r].children);for(r=0;r<i;r++)e[r].sorted=!0},t.prototype.sortPathConstraintAttachment=function(t,e,i){var n=t.attachments[e];if(n)for(var o in n)this.sortPathConstraintAttachmentWith(n[o],i)},t.prototype.sortPathConstraintAttachmentWith=function(t,e){if(t instanceof b.PathAttachment){var i=t.bones;if(null==i)this.sortBone(e);else for(var n=this.bones,o=0;o<i.length;)for(var r=i[o++],a=o+r;o<a;o++){var s=i[o];this.sortBone(n[s])}}},t.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},t.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];n.sorted&&this.sortReset(n.children),n.sorted=!1}},t.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,i=t.length;e<i;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}var o=this._updateCache;for(e=0,i=o.length;e<i;e++)o[e].update()},t.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},t.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var n=this.ikConstraints;for(e=0,i=n.length;e<i;e++){(s=n[e]).bendDirection=s.data.bendDirection,s.mix=s.data.mix}var o=this.transformConstraints;for(e=0,i=o.length;e<i;e++){var r=(s=o[e]).data;s.rotateMix=r.rotateMix,s.translateMix=r.translateMix,s.scaleMix=r.scaleMix,s.shearMix=r.shearMix}var a=this.pathConstraints;for(e=0,i=a.length;e<i;e++){var s;r=(s=a[e]).data;s.position=r.position,s.spacing=r.spacing,s.rotateMix=r.rotateMix,s.translateMix=r.translateMix}},t.prototype.setSlotsToSetupPose=function(){var t=this.slots;b.Utils.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,i=t.length;e<i;e++)t[e].setToSetupPose()},t.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var o=e[i];if(o.data.name==t)return o}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var o=e[i];if(o.data.name==t)return o}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},t.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},t.prototype.setSkin=function(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var o=e[i],r=o.data.attachmentName;if(null!=r){var a=t.getAttachment(i,r);null!=a&&o.setAttachment(a)}}this.skin=t},t.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},t.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},t.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,n=0,o=i.length;n<o;n++){var r=i[n];if(r.data.name==t){var a=null;if(null!=e&&null==(a=this.getAttachment(n,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void r.setAttachment(a)}}throw new Error("Slot not found: "+t)},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var o=e[i];if(o.data.name==t)return o}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var o=e[i];if(o.data.name==t)return o}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var o=e[i];if(o.data.name==t)return o}return null},t.prototype.getBounds=function(t,e,i){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");for(var n=this.drawOrder,o=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY,h=0,l=n.length;h<l;h++){var p=n[h],c=0,u=null,d=p.getAttachment();if(d instanceof b.RegionAttachment)c=8,u=b.Utils.setArraySize(i,c,0),d.computeWorldVertices(p.bone,u,0,2);else if(d instanceof b.MeshAttachment){var f=d;c=f.worldVerticesLength,u=b.Utils.setArraySize(i,c,0),f.computeWorldVertices(p,0,c,u,0,2)}if(null!=u)for(var y=0,m=u.length;y<m;y+=2){var g=u[y],v=u[y+1];o=Math.min(o,g),r=Math.min(r,v),a=Math.max(a,g),s=Math.max(s,v)}}t.set(o,r),e.set(a-o,s-r)},t.prototype.update=function(t){this.time+=t},t}(),b.Skeleton=e}(pixi_spine||(pixi_spine={})),function(t){var u,e;u=t.core||(t.core={}),e=function(){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new u.Pool(function(){return u.Utils.newFloatArray(16)})}return t.prototype.update=function(t,e){if(null==t)throw new Error("skeleton cannot be null.");var i=this.boundingBoxes,n=this.polygons,o=this.polygonPool,r=t.slots,a=r.length;i.length=0,o.freeAll(n);for(var s=n.length=0;s<a;s++){var h=r[s],l=h.getAttachment();if(l instanceof u.BoundingBoxAttachment){var p=l;i.push(p);var c=o.obtain();c.length!=p.worldVerticesLength&&(c=u.Utils.newFloatArray(p.worldVerticesLength)),n.push(c),p.computeWorldVertices(h,0,p.worldVerticesLength,c,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},t.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=this.polygons,r=0,a=o.length;r<a;r++)for(var s=o[r],h=s,l=0,p=s.length;l<p;l+=2){var c=h[l],u=h[l+1];t=Math.min(t,c),e=Math.min(e,u),i=Math.max(i,c),n=Math.max(n,u)}this.minX=t,this.minY=e,this.maxX=i,this.maxY=n},t.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},t.prototype.aabbIntersectsSegment=function(t,e,i,n){var o=this.minX,r=this.minY,a=this.maxX,s=this.maxY;if(t<=o&&i<=o||e<=r&&n<=r||a<=t&&a<=i||s<=e&&s<=n)return!1;var h=(n-e)/(i-t),l=h*(o-t)+e;if(r<l&&l<s)return!0;if(r<(l=h*(a-t)+e)&&l<s)return!0;var p=(r-e)/h+t;return o<p&&p<a||o<(p=(s-e)/h+t)&&p<a},t.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},t.prototype.containsPoint=function(t,e){for(var i=this.polygons,n=0,o=i.length;n<o;n++)if(this.containsPointPolygon(i[n],t,e))return this.boundingBoxes[n];return null},t.prototype.containsPointPolygon=function(t,e,i){for(var n=t,o=t.length,r=o-2,a=!1,s=0;s<o;s+=2){var h=n[s+1],l=n[r+1];if(h<i&&i<=l||l<i&&i<=h){var p=n[s];p+(i-h)/(l-h)*(n[r]-p)<e&&(a=!a)}r=s}return a},t.prototype.intersectsSegment=function(t,e,i,n){for(var o=this.polygons,r=0,a=o.length;r<a;r++)if(this.intersectsSegmentPolygon(o[r],t,e,i,n))return this.boundingBoxes[r];return null},t.prototype.intersectsSegmentPolygon=function(t,e,i,n,o){for(var r=t,a=t.length,s=e-n,h=i-o,l=e*o-i*n,p=r[a-2],c=r[a-1],u=0;u<a;u+=2){var d=r[u],f=r[u+1],y=p*f-c*d,m=p-d,g=c-f,v=s*g-h*m,b=(l*m-s*y)/v;if((p<=b&&b<=d||d<=b&&b<=p)&&(e<=b&&b<=n||n<=b&&b<=e)){var _=(l*g-h*y)/v;if((c<=_&&_<=f||f<=_&&_<=c)&&(i<=_&&_<=o||o<=_&&_<=i))return!0}p=d,c=f}return!1},t.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},t.prototype.getWidth=function(){return this.maxX-this.minX},t.prototype.getHeight=function(){return this.maxY-this.minY},t}(),u.SkeletonBounds=e}(pixi_spine||(pixi_spine={})),function(t){var K,e;K=t.core||(t.core={}),e=function(){function l(){this.triangulator=new K.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return l.prototype.clipStart=function(t,e){if(null!=this.clipAttachment)return 0;var i=(this.clipAttachment=e).worldVerticesLength,n=K.Utils.setArraySize(this.clippingPolygon,i);e.computeWorldVertices(t,0,i,n,0,2);var o=this.clippingPolygon;l.makeClockwise(o);for(var r=this.clippingPolygons=this.triangulator.decompose(o,this.triangulator.triangulate(o)),a=0,s=r.length;a<s;a++){var h=r[a];l.makeClockwise(h),h.push(h[0]),h.push(h[1])}return r.length},l.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},l.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},l.prototype.isClipping=function(){return null!=this.clipAttachment},l.prototype.clipTriangles=function(t,e,i,n,o,r,a,s){var h=this.clipOutput,l=this.clippedVertices,p=this.clippedTriangles,c=this.clippingPolygons,u=this.clippingPolygons.length,d=s?12:8,f=0;l.length=0;t:for(var y=p.length=0;y<n;y+=3)for(var m=i[y]<<1,g=t[m],v=t[m+1],b=o[m],_=o[m+1],w=t[m=i[y+1]<<1],P=t[m+1],A=o[m],x=o[m+1],E=t[m=i[y+2]<<1],M=t[m+1],S=o[m],I=o[m+1],T=0;T<u;T++){var C=l.length;if(!this.clip(g,v,w,P,E,M,c[T],h)){(j=K.Utils.setArraySize(l,C+3*d))[C]=g,j[C+1]=v,j[C+2]=r.r,j[C+3]=r.g,j[C+4]=r.b,j[C+5]=r.a,s?(j[C+6]=b,j[C+7]=_,j[C+8]=a.r,j[C+9]=a.g,j[C+10]=a.b,j[C+11]=a.a,j[C+12]=w,j[C+13]=P,j[C+14]=r.r,j[C+15]=r.g,j[C+16]=r.b,j[C+17]=r.a,j[C+18]=A,j[C+19]=x,j[C+20]=a.r,j[C+21]=a.g,j[C+22]=a.b,j[C+23]=a.a,j[C+24]=E,j[C+25]=M,j[C+26]=r.r,j[C+27]=r.g,j[C+28]=r.b,j[C+29]=r.a,j[C+30]=S,j[C+31]=I,j[C+32]=a.r,j[C+33]=a.g,j[C+34]=a.b,j[C+35]=a.a):(j[C+6]=b,j[C+7]=_,j[C+8]=w,j[C+9]=P,j[C+10]=r.r,j[C+11]=r.g,j[C+12]=r.b,j[C+13]=r.a,j[C+14]=A,j[C+15]=x,j[C+16]=E,j[C+17]=M,j[C+18]=r.r,j[C+19]=r.g,j[C+20]=r.b,j[C+21]=r.a,j[C+22]=S,j[C+23]=I),C=p.length,(H=K.Utils.setArraySize(p,C+3))[C]=f,H[C+1]=f+1,H[C+2]=f+2,f+=3;continue t}var O=h.length;if(0!=O){for(var B=P-M,L=E-w,R=g-E,N=M-v,D=1/(B*R+L*(v-M)),G=O>>1,k=this.clipOutput,j=K.Utils.setArraySize(l,C+G*d),V=0;V<O;V+=2){var F=k[V],X=k[V+1];j[C]=F,j[C+1]=X,j[C+2]=r.r,j[C+3]=r.g,j[C+4]=r.b,j[C+5]=r.a;var q=F-E,U=X-M,W=(B*q+L*U)*D,Y=(N*q+R*U)*D,z=1-W-Y;j[C+6]=b*W+A*Y+S*z,j[C+7]=_*W+x*Y+I*z,s&&(j[C+8]=a.r,j[C+9]=a.g,j[C+10]=a.b,j[C+11]=a.a),C+=d}C=p.length;var H=K.Utils.setArraySize(p,C+3*(G-2));G--;for(V=1;V<G;V++)H[C]=f,H[C+1]=f+V,H[C+2]=f+V+1,C+=3;f+=G+1}}},l.prototype.clip=function(t,e,i,n,o,r,a,s){var h=s,l=!1,p=null;2<=a.length%4?(p=s,s=this.scratch):p=this.scratch,p.length=0,p.push(t),p.push(e),p.push(i),p.push(n),p.push(o),p.push(r),p.push(t),p.push(e),s.length=0;for(var c=a,u=a.length-4,d=0;;d+=2){for(var f=c[d],y=c[d+1],m=c[d+2],g=c[d+3],v=f-m,b=y-g,_=p,w=p.length-2,P=s.length,A=0;A<w;A+=2){var x=_[A],E=_[A+1],M=_[A+2],S=_[A+3],I=0<v*(S-g)-b*(M-m);if(0<v*(E-g)-b*(x-m)){if(I){s.push(M),s.push(S);continue}var T=((O=M-x)*(y-E)-(C=S-E)*(f-x))/(C*(m-f)-O*(g-y));s.push(f+(m-f)*T),s.push(y+(g-y)*T)}else if(I){var C,O;T=((O=M-x)*(y-E)-(C=S-E)*(f-x))/(C*(m-f)-O*(g-y));s.push(f+(m-f)*T),s.push(y+(g-y)*T),s.push(M),s.push(S)}l=!0}if(P==s.length)return!(h.length=0);if(s.push(s[0]),s.push(s[1]),d==u)break;var B=s;(s=p).length=0,p=B}if(h!=s){d=h.length=0;for(var L=s.length-2;d<L;d++)h[d]=s[d]}else h.length=h.length-2;return l},l.makeClockwise=function(t){for(var e=t,i=t.length,n=e[i-2]*e[1]-e[0]*e[i-1],o=0,r=0,a=0,s=0,h=i-3;s<h;s+=2)o=e[s],r=e[s+1],a=e[s+2],n+=o*e[s+3]-a*r;if(!(n<0)){s=0;var l=i-2;for(h=i>>1;s<h;s+=2){var p=e[s],c=e[s+1],u=l-s;e[s]=e[u],e[s+1]=e[u+1],e[u]=p,e[u+1]=c}}},l}(),K.SkeletonClipping=e}(pixi_spine||(pixi_spine={})),function(t){var e,i;e=t.core||(t.core={}),i=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var o=e[i];if(o.name==t)return o}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var o=e[i];if(o.name==t)return o}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,i=0,n=e.length;i<n;i++){var o=e[i];if(o.name==t)return o}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,i=0,n=e.length;i<n;i++){var o=e[i];if(o.name==t)return o}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,i=0,n=e.length;i<n;i++){var o=e[i];if(o.name==t)return o}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var o=e[i];if(o.name==t)return o}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var o=e[i];if(o.name==t)return o}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var o=e[i];if(o.name==t)return o}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t}(),e.SkeletonData=i}(pixi_spine||(pixi_spine={})),function(t){!function($){var t=function(){function L(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return L.prototype.readSkeletonData=function(t){var e=this.scale,i=new $.SkeletonData,n="string"==typeof t?JSON.parse(t):t,o=n.skeleton;if(null!=o&&(i.hash=o.hash,i.version=o.spine,i.width=o.width,i.height=o.height,i.fps=o.fps,i.imagesPath=o.images),n.bones)for(var r=0;r<n.bones.length;r++){var a=n.bones[r],s=null,h=this.getValue(a,"parent",null);if(null!=h&&null==(s=i.findBone(h)))throw new Error("Parent bone not found: "+h);(u=new $.BoneData(i.bones.length,a.name,s)).length=this.getValue(a,"length",0)*e,u.x=this.getValue(a,"x",0)*e,u.y=this.getValue(a,"y",0)*e,u.rotation=this.getValue(a,"rotation",0),u.scaleX=this.getValue(a,"scaleX",1),u.scaleY=this.getValue(a,"scaleY",1),u.shearX=this.getValue(a,"shearX",0),u.shearY=this.getValue(a,"shearY",0),u.transformMode=L.transformModeFromString(this.getValue(a,"transform","normal")),i.bones.push(u)}if(n.slots)for(r=0;r<n.slots.length;r++){var l=(A=n.slots[r]).name,p=A.bone,c=i.findBone(p);if(null==c)throw new Error("Slot bone not found: "+p);var u=new $.SlotData(i.slots.length,l,c),d=this.getValue(A,"color",null);null!=d&&u.color.setFromString(d);var f=this.getValue(A,"dark",null);null!=f&&(u.darkColor=new $.Color(1,1,1,1),u.darkColor.setFromString(f)),u.attachmentName=this.getValue(A,"attachment",null),u.blendMode=L.blendModeFromString(this.getValue(A,"blend","normal")),i.slots.push(u)}if(n.ik)for(r=0;r<n.ik.length;r++){var y=n.ik[r];(u=new $.IkConstraintData(y.name)).order=this.getValue(y,"order",0);for(var m=0;m<y.bones.length;m++){p=y.bones[m];if(null==(v=i.findBone(p)))throw new Error("IK bone not found: "+p);u.bones.push(v)}var g=y.target;if(u.target=i.findBone(g),null==u.target)throw new Error("IK target bone not found: "+g);u.bendDirection=this.getValue(y,"bendPositive",!0)?1:-1,u.mix=this.getValue(y,"mix",1),i.ikConstraints.push(u)}if(n.transform)for(r=0;r<n.transform.length;r++){y=n.transform[r];(u=new $.TransformConstraintData(y.name)).order=this.getValue(y,"order",0);for(m=0;m<y.bones.length;m++){p=y.bones[m];if(null==(v=i.findBone(p)))throw new Error("Transform constraint bone not found: "+p);u.bones.push(v)}g=y.target;if(u.target=i.findBone(g),null==u.target)throw new Error("Transform constraint target bone not found: "+g);u.local=this.getValue(y,"local",!1),u.relative=this.getValue(y,"relative",!1),u.offsetRotation=this.getValue(y,"rotation",0),u.offsetX=this.getValue(y,"x",0)*e,u.offsetY=this.getValue(y,"y",0)*e,u.offsetScaleX=this.getValue(y,"scaleX",0),u.offsetScaleY=this.getValue(y,"scaleY",0),u.offsetShearY=this.getValue(y,"shearY",0),u.rotateMix=this.getValue(y,"rotateMix",1),u.translateMix=this.getValue(y,"translateMix",1),u.scaleMix=this.getValue(y,"scaleMix",1),u.shearMix=this.getValue(y,"shearMix",1),i.transformConstraints.push(u)}if(n.path)for(r=0;r<n.path.length;r++){y=n.path[r];(u=new $.PathConstraintData(y.name)).order=this.getValue(y,"order",0);for(m=0;m<y.bones.length;m++){var v;p=y.bones[m];if(null==(v=i.findBone(p)))throw new Error("Transform constraint bone not found: "+p);u.bones.push(v)}g=y.target;if(u.target=i.findSlot(g),null==u.target)throw new Error("Path target slot not found: "+g);u.positionMode=L.positionModeFromString(this.getValue(y,"positionMode","percent")),u.spacingMode=L.spacingModeFromString(this.getValue(y,"spacingMode","length")),u.rotateMode=L.rotateModeFromString(this.getValue(y,"rotateMode","tangent")),u.offsetRotation=this.getValue(y,"rotation",0),u.position=this.getValue(y,"position",0),u.positionMode==$.PositionMode.Fixed&&(u.position*=e),u.spacing=this.getValue(y,"spacing",0),u.spacingMode!=$.SpacingMode.Length&&u.spacingMode!=$.SpacingMode.Fixed||(u.spacing*=e),u.rotateMix=this.getValue(y,"rotateMix",1),u.translateMix=this.getValue(y,"translateMix",1),i.pathConstraints.push(u)}if(n.skins)for(var b in n.skins){var _=n.skins[b],w=new $.Skin(b);for(var l in _){var P=i.findSlotIndex(l);if(-1==P)throw new Error("Slot not found: "+l);var A=_[l];for(var x in A){var E=this.readAttachment(A[x],w,P,x,i);null!=E&&w.addAttachment(P,x,E)}}i.skins.push(w),"default"==w.name&&(i.defaultSkin=w)}r=0;for(var M=this.linkedMeshes.length;r<M;r++){var S=this.linkedMeshes[r];if(null==(w=null==S.skin?i.defaultSkin:i.findSkin(S.skin)))throw new Error("Skin not found: "+S.skin);var I=w.getAttachment(S.slotIndex,S.parent);if(null==I)throw new Error("Parent mesh not found: "+S.parent);S.mesh.setParentMesh(I)}if(this.linkedMeshes.length=0,n.events)for(var T in n.events){var C=n.events[T];(u=new $.EventData(T)).intValue=this.getValue(C,"int",0),u.floatValue=this.getValue(C,"float",0),u.stringValue=this.getValue(C,"string",""),i.events.push(u)}if(n.animations)for(var O in n.animations){var B=n.animations[O];this.readAnimation(B,O,i)}return i},L.prototype.readAttachment=function(t,e,i,n,o){var r=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":var a=this.getValue(t,"path",n),s=this.attachmentLoader.newRegionAttachment(e,n,a);return null==s?null:(s.path=a,s.x=this.getValue(t,"x",0)*r,s.y=this.getValue(t,"y",0)*r,s.scaleX=this.getValue(t,"scaleX",1),s.scaleY=this.getValue(t,"scaleY",1),s.rotation=this.getValue(t,"rotation",0),s.width=t.width*r,s.height=t.height*r,null!=(b=this.getValue(t,"color",null))&&s.color.setFromString(b),s);case"boundingbox":var h=this.attachmentLoader.newBoundingBoxAttachment(e,n);return null==h?null:(this.readVertices(t,h,t.vertexCount<<1),null!=(b=this.getValue(t,"color",null))&&h.color.setFromString(b),h);case"mesh":case"linkedmesh":a=this.getValue(t,"path",n);var l=this.attachmentLoader.newMeshAttachment(e,n,a);if(null==l)return null;l.path=a,null!=(b=this.getValue(t,"color",null))&&l.color.setFromString(b);var p=this.getValue(t,"parent",null);if(null!=p)return l.inheritDeform=this.getValue(t,"deform",!0),this.linkedMeshes.push(new _(l,this.getValue(t,"skin",null),i,p)),l;var c=t.uvs;return this.readVertices(t,l,c.length),l.triangles=t.triangles,l.regionUVs=c,l.hullLength=2*this.getValue(t,"hull",0),l;case"path":if(null==(a=this.attachmentLoader.newPathAttachment(e,n)))return null;a.closed=this.getValue(t,"closed",!1),a.constantSpeed=this.getValue(t,"constantSpeed",!0);var u=t.vertexCount;this.readVertices(t,a,u<<1);for(var d=$.Utils.newArray(u/3,0),f=0;f<t.lengths.length;f++)d[f]=t.lengths[f]*r;return a.lengths=d,null!=(b=this.getValue(t,"color",null))&&a.color.setFromString(b),a;case"point":var y=this.attachmentLoader.newPointAttachment(e,n);return null==y?null:(y.x=this.getValue(t,"x",0)*r,y.y=this.getValue(t,"y",0)*r,y.rotation=this.getValue(t,"rotation",0),null!=(b=this.getValue(t,"color",null))&&y.color.setFromString(b),y);case"clipping":var m=this.attachmentLoader.newClippingAttachment(e,n);if(null==m)return null;var g=this.getValue(t,"end",null);if(null!=g){var v=o.findSlot(g);if(null==v)throw new Error("Clipping end slot not found: "+g);m.endSlot=v}var b;u=t.vertexCount;return this.readVertices(t,m,u<<1),null!=(b=this.getValue(t,"color",null))&&m.color.setFromString(b),m}return null},L.prototype.readVertices=function(t,e,i){var n=this.scale;e.worldVerticesLength=i;var o=t.vertices;if(i!=o.length){var r=new Array,a=new Array;for(p=0,c=o.length;p<c;){var s=o[p++];a.push(s);for(var h=p+4*s;p<h;p+=4)a.push(o[p]),r.push(o[p+1]*n),r.push(o[p+2]*n),r.push(o[p+3])}e.bones=a,e.vertices=$.Utils.toFloatArray(r)}else{var l=$.Utils.toFloatArray(o);if(1!=n)for(var p=0,c=o.length;p<c;p++)l[p]*=n;e.vertices=l}},L.prototype.readAnimation=function(t,e,i){var n=this.scale,o=new Array,r=0;if(t.slots)for(var a in t.slots){var s=t.slots[a];if(-1==(H=i.findSlotIndex(a)))throw new Error("Slot not found: "+a);for(var h in s){var l=s[h];if("attachment"==h){(b=new $.AttachmentTimeline(l.length)).slotIndex=H;for(var p=0,c=0;c<l.length;c++){var u=l[c];b.setFrame(p++,u.time,u.name)}o.push(b),r=Math.max(r,b.frames[b.getFrameCount()-1])}else if("color"==h){(b=new $.ColorTimeline(l.length)).slotIndex=H;for(p=0,c=0;c<l.length;c++){u=l[c];var d=new $.Color;d.setFromString(u.color||"ffffffff"),b.setFrame(p,u.time,d.r,d.g,d.b,d.a),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[(b.getFrameCount()-1)*$.ColorTimeline.ENTRIES])}else{if("twoColor"!=h)throw new Error("Invalid timeline type for a slot: "+h+" ("+a+")");(b=new $.TwoColorTimeline(l.length)).slotIndex=H;for(p=0,c=0;c<l.length;c++){u=l[c];var f=new $.Color,y=new $.Color;f.setFromString(u.light),y.setFromString(u.dark),b.setFrame(p,u.time,f.r,f.g,f.b,f.a,y.r,y.g,y.b),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[(b.getFrameCount()-1)*$.TwoColorTimeline.ENTRIES])}}}if(t.bones)for(var m in t.bones){var g=t.bones[m],v=i.findBoneIndex(m);if(-1==v)throw new Error("Bone not found: "+m);for(var h in g){l=g[h];if("rotate"===h){(b=new $.RotateTimeline(l.length)).boneIndex=v;for(p=0,c=0;c<l.length;c++){u=l[c];b.setFrame(p,u.time,u.angle),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[(b.getFrameCount()-1)*$.RotateTimeline.ENTRIES])}else{if("translate"!==h&&"scale"!==h&&"shear"!==h)throw new Error("Invalid timeline type for a bone: "+h+" ("+m+")");var b=null,_=1;"scale"===h?b=new $.ScaleTimeline(l.length):"shear"===h?b=new $.ShearTimeline(l.length):(b=new $.TranslateTimeline(l.length),_=n),b.boneIndex=v;for(p=0,c=0;c<l.length;c++){u=l[c];var w=this.getValue(u,"x",0),P=this.getValue(u,"y",0);b.setFrame(p,u.time,w*_,P*_),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[(b.getFrameCount()-1)*$.TranslateTimeline.ENTRIES])}}}if(t.ik)for(var A in t.ik){var x=t.ik[A],E=i.findIkConstraint(A);(b=new $.IkConstraintTimeline(x.length)).ikConstraintIndex=i.ikConstraints.indexOf(E);for(p=0,c=0;c<x.length;c++){u=x[c];b.setFrame(p,u.time,this.getValue(u,"mix",1),this.getValue(u,"bendPositive",!0)?1:-1),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[(b.getFrameCount()-1)*$.IkConstraintTimeline.ENTRIES])}if(t.transform)for(var A in t.transform){x=t.transform[A],E=i.findTransformConstraint(A);(b=new $.TransformConstraintTimeline(x.length)).transformConstraintIndex=i.transformConstraints.indexOf(E);for(p=0,c=0;c<x.length;c++){u=x[c];b.setFrame(p,u.time,this.getValue(u,"rotateMix",1),this.getValue(u,"translateMix",1),this.getValue(u,"scaleMix",1),this.getValue(u,"shearMix",1)),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[(b.getFrameCount()-1)*$.TransformConstraintTimeline.ENTRIES])}if(t.paths)for(var A in t.paths){x=t.paths[A];var M=i.findPathConstraintIndex(A);if(-1==M)throw new Error("Path constraint not found: "+A);var S=i.pathConstraints[M];for(var h in x){l=x[h];if("position"===h||"spacing"===h){b=null,_=1;"spacing"===h?(b=new $.PathConstraintSpacingTimeline(l.length),S.spacingMode!=$.SpacingMode.Length&&S.spacingMode!=$.SpacingMode.Fixed||(_=n)):(b=new $.PathConstraintPositionTimeline(l.length),S.positionMode==$.PositionMode.Fixed&&(_=n)),b.pathConstraintIndex=M;for(p=0,c=0;c<l.length;c++){u=l[c];b.setFrame(p,u.time,this.getValue(u,h,0)*_),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[(b.getFrameCount()-1)*$.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===h){(b=new $.PathConstraintMixTimeline(l.length)).pathConstraintIndex=M;for(p=0,c=0;c<l.length;c++){u=l[c];b.setFrame(p,u.time,this.getValue(u,"rotateMix",1),this.getValue(u,"translateMix",1)),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[(b.getFrameCount()-1)*$.PathConstraintMixTimeline.ENTRIES])}}}if(t.deform)for(var I in t.deform){var T=t.deform[I],C=i.findSkin(I);if(null==C)throw new Error("Skin not found: "+I);for(var a in T){s=T[a];if(-1==(H=i.findSlotIndex(a)))throw new Error("Slot not found: "+s.name);for(var h in s){l=s[h];var O=C.getAttachment(H,h);if(null==O)throw new Error("Deform attachment not found: "+l.name);var B=null!=O.bones,L=O.vertices,R=B?L.length/3*2:L.length;(b=new $.DeformTimeline(l.length)).slotIndex=H,b.attachment=O;p=0;for(var N=0;N<l.length;N++){u=l[N];var D=void 0,G=this.getValue(u,"vertices",null);if(null==G)D=B?$.Utils.newFloatArray(R):L;else{D=$.Utils.newFloatArray(R);var k=this.getValue(u,"offset",0);if($.Utils.arrayCopy(G,0,D,k,G.length),1!=n)for(var j=(c=k)+G.length;c<j;c++)D[c]*=n;if(!B)for(c=0;c<R;c++)D[c]+=L[c]}b.setFrame(p,u.time,D),this.readCurve(u,b,p),p++}o.push(b),r=Math.max(r,b.frames[b.getFrameCount()-1])}}}var V=t.drawOrder;if(null==V&&(V=t.draworder),null!=V){b=new $.DrawOrderTimeline(V.length);var F=i.slots.length;for(p=0,N=0;N<V.length;N++){var X=V[N],q=null,U=this.getValue(X,"offsets",null);if(null!=U){q=$.Utils.newArray(F,-1);var W=$.Utils.newArray(F-U.length,0),Y=0,z=0;for(c=0;c<U.length;c++){var H,K=U[c];if(-1==(H=i.findSlotIndex(K.slot)))throw new Error("Slot not found: "+K.slot);for(;Y!=H;)W[z++]=Y++;q[Y+K.offset]=Y++}for(;Y<F;)W[z++]=Y++;for(c=F-1;0<=c;c--)-1==q[c]&&(q[c]=W[--z])}b.setFrame(p++,X.time,q)}o.push(b),r=Math.max(r,b.frames[b.getFrameCount()-1])}if(t.events){for(b=new $.EventTimeline(t.events.length),p=0,c=0;c<t.events.length;c++){var Z=t.events[c],J=i.findEvent(Z.name);if(null==J)throw new Error("Event not found: "+Z.name);var Q=new $.Event($.Utils.toSinglePrecision(Z.time),J);Q.intValue=this.getValue(Z,"int",J.intValue),Q.floatValue=this.getValue(Z,"float",J.floatValue),Q.stringValue=this.getValue(Z,"string",J.stringValue),b.setFrame(p++,Q)}o.push(b),r=Math.max(r,b.frames[b.getFrameCount()-1])}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");i.animations.push(new $.Animation(e,o,r))},L.prototype.readCurve=function(t,e,i){if(t.curve)if("stepped"===t.curve)e.setStepped(i);else if("[object Array]"===Object.prototype.toString.call(t.curve)){var n=t.curve;e.setCurve(i,n[0],n[1],n[2],n[3])}},L.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i},L.blendModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return $.BlendMode.Normal;if("additive"==t)return $.BlendMode.Additive;if("multiply"==t)return $.BlendMode.Multiply;if("screen"==t)return $.BlendMode.Screen;throw new Error("Unknown blend mode: "+t)},L.positionModeFromString=function(t){if("fixed"==(t=t.toLowerCase()))return $.PositionMode.Fixed;if("percent"==t)return $.PositionMode.Percent;throw new Error("Unknown position mode: "+t)},L.spacingModeFromString=function(t){if("length"==(t=t.toLowerCase()))return $.SpacingMode.Length;if("fixed"==t)return $.SpacingMode.Fixed;if("percent"==t)return $.SpacingMode.Percent;throw new Error("Unknown position mode: "+t)},L.rotateModeFromString=function(t){if("tangent"==(t=t.toLowerCase()))return $.RotateMode.Tangent;if("chain"==t)return $.RotateMode.Chain;if("chainscale"==t)return $.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+t)},L.transformModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return $.TransformMode.Normal;if("onlytranslation"==t)return $.TransformMode.OnlyTranslation;if("norotationorreflection"==t)return $.TransformMode.NoRotationOrReflection;if("noscale"==t)return $.TransformMode.NoScale;if("noscaleorreflection"==t)return $.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+t)},L}();$.SkeletonJson=t;var _=function(t,e,i,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=n}}(t.core||(t.core={}))}(pixi_spine||(pixi_spine={})),function(t){var e,i;e=t.core||(t.core={}),i=function(){function t(t){if(this.attachments=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return t.prototype.addAttachment=function(t,e,i){if(null==i)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=i},t.prototype.getAttachment=function(t,e){var i=this.attachments[t];return i?i[e]:null},t.prototype.attachAll=function(t,e){for(var i=0,n=0;n<t.slots.length;n++){var o=t.slots[n],r=o.getAttachment();if(r&&i<e.attachments.length){var a=e.attachments[i];for(var s in a){if(r==a[s]){var h=this.getAttachment(i,name);null!=h&&o.setAttachment(h);break}}}i++}},t}(),e.Skin=i}(pixi_spine||(pixi_spine={})),function(t){var i,e;i=t.core||(t.core={}),e=function(){function t(t,e){if(this.attachmentVertices=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new i.Color,this.darkColor=null==t.darkColor?null:new i.Color,this.setToSetupPose(),this.blendMode=this.data.blendMode}return t.prototype.getAttachment=function(){return this.attachment},t.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)},t.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},t.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},t.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},t}(),i.Slot=e}(pixi_spine||(pixi_spine={})),function(t){var n,e;n=t.core||(t.core={}),e=function(t,e,i){if(this.color=new n.Color(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==i)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=i},n.SlotData=e}(pixi_spine||(pixi_spine={})),function(t){!function(t){var e,i,n,o,r=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return n.MirroredRepeat;case"clamptoedge":return n.ClampToEdge;case"repeat":return n.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=r,(i=e=t.TextureFilter||(t.TextureFilter={}))[i.Nearest=9728]="Nearest",i[i.Linear=9729]="Linear",i[i.MipMap=9987]="MipMap",i[i.MipMapNearestNearest=9984]="MipMapNearestNearest",i[i.MipMapLinearNearest=9985]="MipMapLinearNearest",i[i.MipMapNearestLinear=9986]="MipMapNearestLinear",i[i.MipMapLinearLinear=9987]="MipMapLinearLinear",(o=n=t.TextureWrap||(t.TextureWrap={}))[o.MirroredRepeat=33648]="MirroredRepeat",o[o.ClampToEdge=33071]="ClampToEdge",o[o.Repeat=10497]="Repeat";var a=function(){function t(){this.size=null}return Object.defineProperty(t.prototype,"width",{get:function(){var t=this.texture;return"3"==PIXI.VERSION[0]?t.crop.width:t.trim?t.trim.width:t.orig.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){var t=this.texture;return"3"==PIXI.VERSION[0]?t.crop.height:t.trim?t.trim.height:t.orig.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"u",{get:function(){return this.texture._uvs.x0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"v",{get:function(){return this.texture._uvs.y0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"u2",{get:function(){return this.texture._uvs.x2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"v2",{get:function(){return this.texture._uvs.y2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){var t=this.texture;return t.trim?t.trim.x:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return console.warn("Deprecation Warning: @Hackerham: I guess, if you are using PIXI-SPINE ATLAS region.offsetY, you want a texture, right? Use region.texture from now on."),this.spineOffsetY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pixiOffsetY",{get:function(){var t=this.texture;return t.trim?t.trim.y:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spineOffsetY",{get:function(){var t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originalWidth",{get:function(){var t=this.texture;return"3"==PIXI.VERSION[0]?t.trim?t.trim.width:t.crop.width:t.orig.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originalHeight",{get:function(){var t=this.texture;return"3"==PIXI.VERSION[0]?t.trim?t.trim.height:t.crop.height:t.orig.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.texture.frame.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.texture.frame.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return 0!==this.texture.rotate},enumerable:!0,configurable:!0}),t}();t.TextureRegion=a}(t.core||(t.core={}))}(pixi_spine||(pixi_spine={})),function(t){!function(E){var t=function(){function t(t,e,i){this.pages=new Array,this.regions=new Array,t&&this.addSpineAtlas(t,e,i)}return t.prototype.addTexture=function(t,e){for(var i=this.pages,n=null,o=0;o<i.length;o++)if(i[o].baseTexture===e.baseTexture){n=i[o];break}if(null===n){(n=new M).name="texturePage";var r=e.baseTexture;n.width=r.realWidth,n.height=r.realHeight,n.baseTexture=r,n.minFilter=n.magFilter=E.TextureFilter.Nearest,n.uWrap=E.TextureWrap.ClampToEdge,n.vWrap=E.TextureWrap.ClampToEdge,i.push(n)}var a=new S;return a.name=t,a.page=n,a.texture=e,a.index=-1,this.regions.push(a),a},t.prototype.addTextureHash=function(t,e){for(var i in t)t.hasOwnProperty(i)&&this.addTexture(e&&-1!==i.indexOf(".")?i.substr(0,i.lastIndexOf(".")):i,t[i])},t.prototype.addSpineAtlas=function(t,e,i){return this.load(t,e,i)},t.prototype.load=function(t,v,b){var _=this;if(null==v)throw new Error("textureLoader cannot be null.");var w=new e(t),P=new Array(4),A=null,x=function(){for(;;){var t=w.readLine();if(null==t)return b&&b(_);if(0==(t=t.trim()).length)A=null;else{if(!A){(A=new M).name=t,2==w.readTuple(P)&&(A.width=parseInt(P[0]),A.height=parseInt(P[1]),w.readTuple(P)),w.readTuple(P),A.minFilter=E.Texture.filterFromString(P[0]),A.magFilter=E.Texture.filterFromString(P[1]);var e=w.readValue();A.uWrap=E.TextureWrap.ClampToEdge,A.vWrap=E.TextureWrap.ClampToEdge,"x"==e?A.uWrap=E.TextureWrap.Repeat:"y"==e?A.vWrap=E.TextureWrap.Repeat:"xy"==e&&(A.uWrap=A.vWrap=E.TextureWrap.Repeat),v(t,function(t){(A.baseTexture=t).valid||(t.width=A.width,t.height=A.height),_.pages.push(A),A.setFilters(),A.width&&A.height||(A.width=t.realWidth,A.height=t.realHeight,A.width&&A.height||console.log("ERROR spine atlas page "+A.name+": meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)")),x()}),_.pages.push(A);break}var i=new S;i.name=t,i.page=A;var n="true"==w.readValue()?6:0;w.readTuple(P);var o=parseInt(P[0]),r=parseInt(P[1]);w.readTuple(P);var a=parseInt(P[0]),s=parseInt(P[1]),h=A.baseTexture.resolution;o/=h,r/=h,a/=h,s/=h;var l=new PIXI.Rectangle(o,r,n?s:a,n?a:s);4==w.readTuple(P)&&4==w.readTuple(P)&&w.readTuple(P);var p=parseInt(P[0])/h,c=parseInt(P[1])/h;w.readTuple(P);var u=parseInt(P[0])/h,d=parseInt(P[1])/h,f=new PIXI.Rectangle(0,0,p,c),y=new PIXI.Rectangle(u,c-s-d,a,s);if("3"!=PIXI.VERSION[0])i.texture=new PIXI.Texture(i.page.baseTexture,l,f,y,n);else{var m=new PIXI.Rectangle(o,r,a,s),g=m.clone();y.width=p,y.height=c,i.texture=new PIXI.Texture(i.page.baseTexture,m,g,y,n)}i.index=parseInt(w.readValue()),i.texture.updateUvs(),_.regions.push(i)}}};x()},t.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},t.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()},t}();E.TextureAtlas=t;var e=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);for(var n=0,o=i+1;n<3;n++){var r=e.indexOf(",",o);if(-1==r)break;t[n]=e.substr(o,r-o).trim(),o=r+1}return t[n]=e.substring(o).trim(),n+1},t}(),M=function(){function t(){}return t.prototype.setFilters=function(){var t=this.baseTexture,e=this.minFilter;e==E.TextureFilter.Linear?t.scaleMode=PIXI.SCALE_MODES.LINEAR:this.minFilter==E.TextureFilter.Nearest?t.scaleMode=PIXI.SCALE_MODES.NEAREST:(t.mipmap=!0,e==E.TextureFilter.MipMapNearestNearest?t.scaleMode=PIXI.SCALE_MODES.NEAREST:t.scaleMode=PIXI.SCALE_MODES.LINEAR)},t}();E.TextureAtlasPage=M;var S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(E.TextureRegion);E.TextureAtlasRegion=S}(t.core||(t.core={}))}(pixi_spine||(pixi_spine={})),function(t){var C,e;C=t.core||(t.core={}),e=function(){function t(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new C.Vector2,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}return t.prototype.apply=function(){this.update()},t.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},t.prototype.applyAbsoluteWorld=function(){for(var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,o=this.target,r=o.matrix,a=r.a,s=r.c,h=r.b,l=r.d,p=0<a*l-s*h?C.MathUtils.degRad:-C.MathUtils.degRad,c=this.data.offsetRotation*p,u=this.data.offsetShearY*p,d=this.bones,f=0,y=d.length;f<y;f++){var m=d[f],g=!1,v=m.matrix;if(0!=t){var b=v.a,_=v.c,w=v.b,P=v.d;(I=Math.atan2(h,a)-Math.atan2(w,b)+c)>C.MathUtils.PI?I-=C.MathUtils.PI2:I<-C.MathUtils.PI&&(I+=C.MathUtils.PI2),I*=t;var A=Math.cos(I),x=Math.sin(I);v.a=A*b-x*w,v.c=A*_-x*P,v.b=x*b+A*w,v.d=x*_+A*P,g=!0}if(0!=e){var E=this.temp;o.localToWorld(E.set(this.data.offsetX,this.data.offsetY)),v.tx+=(E.x-v.tx)*e,v.ty+=(E.y-v.ty)*e,g=!0}if(0<i){var M=Math.sqrt(v.a*v.a+v.b*v.b),S=Math.sqrt(a*a+h*h);1e-5<M&&(M=(M+(S-M+this.data.offsetScaleX)*i)/M),v.a*=M,v.b*=M,M=Math.sqrt(v.c*v.c+v.d*v.d),S=Math.sqrt(s*s+l*l),1e-5<M&&(M=(M+(S-M+this.data.offsetScaleY)*i)/M),v.c*=M,v.d*=M,g=!0}if(0<n){_=v.c,P=v.d;var I,T=Math.atan2(P,_);(I=Math.atan2(l,s)-Math.atan2(h,a)-(T-Math.atan2(v.b,v.a)))>C.MathUtils.PI?I-=C.MathUtils.PI2:I<-C.MathUtils.PI&&(I+=C.MathUtils.PI2),I=T+(I+u)*n;M=Math.sqrt(_*_+P*P);v.c=Math.cos(I)*M,v.d=Math.sin(I)*M,g=!0}g&&(m.appliedValid=!1)}},t.prototype.applyRelativeWorld=function(){for(var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,o=this.target,r=o.matrix,a=r.a,s=r.c,h=r.b,l=r.d,p=0<a*l-s*h?C.MathUtils.degRad:-C.MathUtils.degRad,c=this.data.offsetRotation*p,u=this.data.offsetShearY*p,d=this.bones,f=0,y=d.length;f<y;f++){var m=d[f],g=!1,v=m.matrix;if(0!=t){var b=v.a,_=v.c,w=v.b,P=v.d;(S=Math.atan2(h,a)+c)>C.MathUtils.PI?S-=C.MathUtils.PI2:S<-C.MathUtils.PI&&(S+=C.MathUtils.PI2),S*=t;var A=Math.cos(S),x=Math.sin(S);v.a=A*b-x*w,v.c=A*_-x*P,v.b=x*b+A*w,v.d=x*_+A*P,g=!0}if(0!=e){var E=this.temp;o.localToWorld(E.set(this.data.offsetX,this.data.offsetY)),v.tx+=E.x*e,v.ty+=E.y*e,g=!0}if(0<i){var M=(Math.sqrt(a*a+h*h)-1+this.data.offsetScaleX)*i+1;v.a*=M,v.b*=M,M=(Math.sqrt(s*s+l*l)-1+this.data.offsetScaleY)*i+1,v.c*=M,v.d*=M,g=!0}if(0<n){var S;(S=Math.atan2(l,s)-Math.atan2(h,a))>C.MathUtils.PI?S-=C.MathUtils.PI2:S<-C.MathUtils.PI&&(S+=C.MathUtils.PI2);_=v.c,P=v.d;S=Math.atan2(P,_)+(S-C.MathUtils.PI/2+u)*n;M=Math.sqrt(_*_+P*P);v.c=Math.cos(S)*M,v.d=Math.sin(S)*M,g=!0}g&&(m.appliedValid=!1)}},t.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,o=this.target;o.appliedValid||o.updateAppliedTransform();for(var r=this.bones,a=0,s=r.length;a<s;a++){var h=r[a];h.appliedValid||h.updateAppliedTransform();var l=h.arotation;if(0!=t){var p=o.arotation-l+this.data.offsetRotation;l+=(p-=360*(16384-(16384.499999999996-p/360|0)))*t}var c=h.ax,u=h.ay;0!=e&&(c+=(o.ax-c+this.data.offsetX)*e,u+=(o.ay-u+this.data.offsetY)*e);var d=h.ascaleX,f=h.ascaleY;0<i&&(1e-5<d&&(d=(d+(o.ascaleX-d+this.data.offsetScaleX)*i)/d),1e-5<f&&(f=(f+(o.ascaleY-f+this.data.offsetScaleY)*i)/f));var y=h.ashearY;if(0<n){p=o.ashearY-y+this.data.offsetShearY;p-=360*(16384-(16384.499999999996-p/360|0)),h.shearY+=p*n}h.updateWorldTransformWith(c,u,l,d,f,h.ashearX,y)}},t.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,o=this.target;o.appliedValid||o.updateAppliedTransform();for(var r=this.bones,a=0,s=r.length;a<s;a++){var h=r[a];h.appliedValid||h.updateAppliedTransform();var l=h.arotation;0!=t&&(l+=(o.arotation+this.data.offsetRotation)*t);var p=h.ax,c=h.ay;0!=e&&(p+=(o.ax+this.data.offsetX)*e,c+=(o.ay+this.data.offsetY)*e);var u=h.ascaleX,d=h.ascaleY;0<i&&(1e-5<u&&(u*=(o.ascaleX-1+this.data.offsetScaleX)*i+1),1e-5<d&&(d*=(o.ascaleY-1+this.data.offsetScaleY)*i+1));var f=h.ashearY;0<n&&(f+=(o.ashearY+this.data.offsetShearY)*n),h.updateWorldTransformWith(p,c,l,u,d,h.ashearX,f)}},t.prototype.getOrder=function(){return this.data.order},t}(),C.TransformConstraint=e}(pixi_spine||(pixi_spine={})),function(t){var e;e=function(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1,null==t)throw new Error("name cannot be null.");this.name=t},(t.core||(t.core={})).TransformConstraintData=e}(pixi_spine||(pixi_spine={})),function(t){var e,i;e=t.core||(t.core={}),i=function(){function F(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new e.Pool(function(){return new Array}),this.polygonIndicesPool=new e.Pool(function(){return new Array})}return F.prototype.triangulate=function(t){for(var e=t,i=t.length>>1,n=this.indicesArray,o=n.length=0;o<i;o++)n[o]=o;for(var r=this.isConcaveArray,a=(o=r.length=0,i);o<a;++o)r[o]=F.isConcave(o,i,e,n);var s=this.triangles;for(s.length=0;3<i;){for(var h=i-1,l=(o=0,1);;){t:if(!r[o]){for(var p=n[h]<<1,c=n[o]<<1,u=n[l]<<1,d=e[p],f=e[p+1],y=e[c],m=e[c+1],g=e[u],v=e[u+1],b=(l+1)%i;b!=h;b=(b+1)%i)if(r[b]){var _=n[b]<<1,w=e[_],P=e[_+1];if(F.positiveArea(g,v,d,f,w,P)&&F.positiveArea(d,f,y,m,w,P)&&F.positiveArea(y,m,g,v,w,P))break t}break}if(0==l){do{if(!r[o])break;o--}while(0<o);break}h=o,l=((o=l)+1)%i}s.push(n[(i+o-1)%i]),s.push(n[o]),s.push(n[(o+1)%i]),n.splice(o,1),r.splice(o,1);var A=(--i+o-1)%i,x=o==i?0:o;r[A]=F.isConcave(A,i,e,n),r[x]=F.isConcave(x,i,e,n)}return 3==i&&(s.push(n[2]),s.push(n[0]),s.push(n[1])),s},F.prototype.decompose=function(t,e){var i=t,n=this.convexPolygons;this.polygonPool.freeAll(n),n.length=0;var o=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(o),o.length=0;var r=this.polygonIndicesPool.obtain();r.length=0;for(var a=this.polygonPool.obtain(),s=-1,h=a.length=0,l=0,p=e.length;l<p;l+=3){var c=e[l]<<1,u=e[l+1]<<1,d=e[l+2]<<1,f=i[c],y=i[c+1],m=i[u],g=i[u+1],v=i[d],b=i[d+1],_=!1;if(s==c){var w=a.length-4,P=F.winding(a[w],a[w+1],a[w+2],a[w+3],v,b),A=F.winding(v,b,a[0],a[1],a[2],a[3]);P==h&&A==h&&(a.push(v),a.push(b),r.push(d),_=!0)}_||(0<a.length?(n.push(a),o.push(r)):(this.polygonPool.free(a),this.polygonIndicesPool.free(r)),(a=this.polygonPool.obtain()).length=0,a.push(f),a.push(y),a.push(m),a.push(g),a.push(v),a.push(b),(r=this.polygonIndicesPool.obtain()).length=0,r.push(c),r.push(u),r.push(d),h=F.winding(f,y,m,g,v,b),s=c)}0<a.length&&(n.push(a),o.push(r));for(l=0,p=n.length;l<p;l++)if(0!=(r=o[l]).length)for(var x=r[0],E=r[r.length-1],M=(a=n[l])[w=a.length-4],S=a[w+1],I=a[w+2],T=a[w+3],C=a[0],O=a[1],B=a[2],L=a[3],R=F.winding(M,S,I,T,C,O),N=0;N<p;N++)if(N!=l){var D=o[N];if(3==D.length){var G=D[0],k=D[1],j=D[2],V=n[N];v=V[V.length-2],b=V[V.length-1];if(G==x&&k==E){P=F.winding(M,S,I,T,v,b),A=F.winding(v,b,C,O,B,L);P==R&&A==R&&(V.length=0,D.length=0,a.push(v),a.push(b),r.push(j),M=I,S=T,I=v,T=b,N=0)}}}for(l=n.length-1;0<=l;l--)0==(a=n[l]).length&&(n.splice(l,1),this.polygonPool.free(a),r=o[l],o.splice(l,1),this.polygonIndicesPool.free(r));return n},F.isConcave=function(t,e,i,n){var o=n[(e+t-1)%e]<<1,r=n[t]<<1,a=n[(t+1)%e]<<1;return!this.positiveArea(i[o],i[o+1],i[r],i[r+1],i[a],i[a+1])},F.positiveArea=function(t,e,i,n,o,r){return 0<=t*(r-n)+i*(e-r)+o*(n-e)},F.winding=function(t,e,i,n,o,r){var a=i-t,s=n-e;return 0<=o*s-r*a+a*e-t*s?1:-1},F}(),e.Triangulator=i}(pixi_spine||(pixi_spine={})),function(t){!function(t){var e=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e;var i=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=e,this.b=i,this.a=n}return t.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,i,n){return this.r+=t,this.g+=e,this.b+=i,this.a+=n,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:1<this.r&&(this.r=1),this.g<0?this.g=0:1<this.g&&(this.g=1),this.b<0?this.b=0:1<this.b&&(this.b=1),this.a<0?this.a=0:1<this.a&&(this.a=1),this},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=i;var n=function(){function i(){}return i.clamp=function(t,e,i){return t<e?e:i<t?i:t},i.cosDeg=function(t){return Math.cos(t*i.degRad)},i.sinDeg=function(t){return Math.sin(t*i.degRad)},i.signum=function(t){return 0<t?1:t<0?-1:0},i.toInt=function(t){return 0<t?Math.floor(t):Math.ceil(t)},i.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},i.randomTriangular=function(t,e){return i.randomTriangularWith(t,e,.5*(t+e))},i.randomTriangularWith=function(t,e,i){var n=Math.random(),o=e-t;return n<=(i-t)/o?t+Math.sqrt(n*o*(i-t)):e-Math.sqrt((1-n)*o*(e-i))},i.PI2=2*(i.PI=3.1415927),i.radDeg=i.radiansToDegrees=180/i.PI,i.degRad=i.degreesToRadians=i.PI/180,i}();t.MathUtils=n;var o=function(){function t(){}return t.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i)},t}(),r=function(i){function t(t){var e=i.call(this)||this;return e.power=2,e.power=t,e}return __extends(t,i),t.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},t}(t.Interpolation=o),a=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},t}(t.Pow=r);t.PowOut=a;var s=function(){function n(){}return n.arrayCopy=function(t,e,i,n,o){for(var r=e,a=n;r<e+o;r++,a++)i[a]=t[r]},n.setArraySize=function(t,e,i){void 0===i&&(i=0);var n=t.length;if(n==e)return t;if(n<(t.length=e))for(var o=n;o<e;o++)t[o]=i;return t},n.ensureArrayCapacity=function(t,e,i){return void 0===i&&(i=0),t.length>=e?t:n.setArraySize(t,e,i)},n.newArray=function(t,e){for(var i=new Array(t),n=0;n<t;n++)i[n]=e;return i},n.newFloatArray=function(t){if(n.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);for(var e=new Array(t),i=0;i<e.length;i++)e[i]=0;return e},n.newShortArray=function(t){if(n.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);for(var e=new Array(t),i=0;i<e.length;i++)e[i]=0;return e},n.toFloatArray=function(t){return n.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t},n.toSinglePrecision=function(t){return n.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t},n.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,n}();t.Utils=s;var h=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e],n=i.matrix;console.log(i.data.name+", "+n.a+", "+n.b+", "+n.c+", "+n.d+", "+n.tx+", "+n.ty)}},t}();t.DebugUtils=h;var l=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return 0<this.items.length?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=l;var p=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=p;var c=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,1<this.frameTime&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=c;var u=function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}();t.WindowedMean=u}(t.core||(t.core={}))}(pixi_spine||(pixi_spine={})),function(t){var e,i,n;e=t.core||(t.core={}),i=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t},n=function(i){function n(t){var e=i.call(this,t)||this;return e.id=(65535&n.nextID++)<<11,e.worldVerticesLength=0,e}return __extends(n,i),n.prototype.computeWorldVerticesOld=function(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)},n.prototype.computeWorldVertices=function(t,e,i,n,o,r){i=o+(i>>1)*r;var a=t.bone.skeleton,s=t.attachmentVertices,h=this.vertices,l=this.bones;if(null!=l){for(var p=0,c=0,u=0;u<e;u+=2){p+=(m=l[p])+1,c+=m}var d=a.bones;if(0==s.length)for(I=o,x=3*c;I<i;I+=r){var f=0,y=0,m=l[p++];for(m+=p;p<m;p++,x+=3){_=d[l[p]].matrix,T=h[x],C=h[x+1];var g=h[x+2];f+=(T*_.a+C*_.c+_.tx)*g,y+=(T*_.b+C*_.d+_.ty)*g}n[I]=f,n[I+1]=y}else for(var v=s,b=(I=o,x=3*c,c<<1);I<i;I+=r){f=0,y=0,m=l[p++];for(m+=p;p<m;p++,x+=3,b+=2){_=d[l[p]].matrix,T=h[x]+v[b],C=h[x+1]+v[b+1],g=h[x+2];f+=(T*_.a+C*_.c+_.tx)*g,y+=(T*_.b+C*_.d+_.ty)*g}n[I]=f,n[I+1]=y}}else{0<s.length&&(h=s);for(var _,w=(_=t.bone.matrix).tx,P=_.ty,A=_.a,x=_.c,E=_.b,M=_.d,S=e,I=o;I<i;S+=2,I+=r){var T=h[S],C=h[S+1];n[I]=T*A+C*x+w,n[I+1]=T*E+C*M+P}}},n.prototype.applyDeform=function(t){return this==t},n.nextID=0,n}(e.Attachment=i),e.VertexAttachment=n}(pixi_spine||(pixi_spine={})),function(t){var e,i;e=t.core||(t.core={}),(i=e.AttachmentType||(e.AttachmentType={}))[i.Region=0]="Region",i[i.BoundingBox=1]="BoundingBox",i[i.Mesh=2]="Mesh",i[i.LinkedMesh=3]="LinkedMesh",i[i.Path=4]="Path",i[i.Point=5]="Point"}(pixi_spine||(pixi_spine={})),function(t){var n,e;n=t.core||(t.core={}),e=function(i){function t(t){var e=i.call(this,t)||this;return e.color=new n.Color(1,1,1,1),e}return __extends(t,i),t}(n.VertexAttachment),n.BoundingBoxAttachment=e}(pixi_spine||(pixi_spine={})),function(t){var n,e;n=t.core||(t.core={}),e=function(i){function t(t){var e=i.call(this,t)||this;return e.color=new n.Color(.2275,.2275,.8078,1),e}return __extends(t,i),t}(n.VertexAttachment),n.ClippingAttachment=e}(pixi_spine||(pixi_spine={})),function(t){var d,e;d=t.core||(t.core={}),e=function(i){function t(t){var e=i.call(this,t)||this;return e.color=new d.Color(1,1,1,1),e.inheritDeform=!1,e.tempColor=new d.Color(0,0,0,0),e}return __extends(t,i),t.prototype.updateUVs=function(t,e){var i=this.regionUVs.length;if(e&&e.length==i||(e=d.Utils.newFloatArray(i)),null!=t){for(var n=t.texture._uvs,o=t.width,r=t.height,a=t.originalWidth,s=t.originalHeight,h=t.offsetX,l=t.pixiOffsetY,p=0;p<i;p+=2){var c=this.regionUVs[p],u=this.regionUVs[p+1];c=(c*a-h)/o,u=(u*s-l)/r,e[p]=(n.x0*(1-c)+n.x1*c)*(1-u)+(n.x3*(1-c)+n.x2*c)*u,e[p+1]=(n.y0*(1-c)+n.y1*c)*(1-u)+(n.y3*(1-c)+n.y2*c)*u}return e}},t.prototype.applyDeform=function(t){return this==t||this.inheritDeform&&this.parentMesh==t},t.prototype.getParentMesh=function(){return this.parentMesh},t.prototype.setParentMesh=function(t){null!=(this.parentMesh=t)&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},t}(d.VertexAttachment),d.MeshAttachment=e}(pixi_spine||(pixi_spine={})),function(t){var n,e;n=t.core||(t.core={}),e=function(i){function t(t){var e=i.call(this,t)||this;return e.closed=!1,e.constantSpeed=!1,e.color=new n.Color(1,1,1,1),e}return __extends(t,i),t}(n.VertexAttachment),n.PathAttachment=e}(pixi_spine||(pixi_spine={})),function(t){var a,e;a=t.core||(t.core={}),e=function(i){function t(t){var e=i.call(this,t)||this;return e.color=new a.Color(.38,.94,0,1),e}return __extends(t,i),t.prototype.computeWorldPosition=function(t,e){var i=t.matrix;return e.x=this.x*i.a+this.y*i.c+t.worldX,e.y=this.x*i.b+this.y*i.d+t.worldY,e},t.prototype.computeWorldRotation=function(t){var e=t.matrix,i=a.MathUtils.cosDeg(this.rotation),n=a.MathUtils.sinDeg(this.rotation),o=i*e.a+n*e.c,r=i*e.b+n*e.d;return Math.atan2(r,o)*a.MathUtils.radDeg},t}(a.VertexAttachment),a.PointAttachment=e}(pixi_spine||(pixi_spine={})),function(t){var n,e;n=t.core||(t.core={}),e=function(i){function v(t){var e=i.call(this,t)||this;return e.x=0,e.y=0,e.scaleX=1,e.scaleY=1,e.rotation=0,e.width=0,e.height=0,e.color=new n.Color(1,1,1,1),e.offset=n.Utils.newFloatArray(8),e.uvs=n.Utils.newFloatArray(8),e.tempColor=new n.Color(1,1,1,1),e}return __extends(v,i),v.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,o=i+this.region.width*t,r=n+this.region.height*e,a=this.rotation*Math.PI/180,s=Math.cos(a),h=Math.sin(a),l=i*s+this.x,p=i*h,c=n*s+this.y,u=n*h,d=o*s+this.x,f=o*h,y=r*s+this.y,m=r*h,g=this.offset;g[v.OX1]=l-u,g[v.OY1]=c+p,g[v.OX2]=l-m,g[v.OY2]=y+p,g[v.OX3]=d-m,g[v.OY3]=y+f,g[v.OX4]=d-u,g[v.OY4]=c+f},v.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},v.prototype.computeWorldVertices=function(t,e,i,n){var o=this.offset,r=t.matrix,a=r.tx,s=r.ty,h=r.a,l=r.c,p=r.b,c=r.d,u=0,d=0;u=o[v.OX1],d=o[v.OY1],e[i]=u*h+d*l+a,e[i+1]=u*p+d*c+s,i+=n,u=o[v.OX2],d=o[v.OY2],e[i]=u*h+d*l+a,e[i+1]=u*p+d*c+s,i+=n,u=o[v.OX3],d=o[v.OY3],e[i]=u*h+d*l+a,e[i+1]=u*p+d*c+s,i+=n,u=o[v.OX4],d=o[v.OY4],e[i]=u*h+d*l+a,e[i+1]=u*p+d*c+s},v.OX1=0,v.OY1=1,v.OX2=2,v.OY2=3,v.OX3=4,v.OY3=5,v.OX4=6,v.OY4=7,v.X1=0,v.Y1=1,v.C1R=2,v.C1G=3,v.C1B=4,v.C1A=5,v.U1=6,v.V1=7,v.X2=8,v.Y2=9,v.C2R=10,v.C2G=11,v.C2B=12,v.C2A=13,v.U2=14,v.V2=15,v.X3=16,v.Y3=17,v.C3R=18,v.C3G=19,v.C3B=20,v.C3A=21,v.U3=22,v.V3=23,v.X4=24,v.Y4=25,v.C4R=26,v.C4G=27,v.C4B=28,v.C4A=29,v.U4=30,v.V4=31,v}(n.Attachment),n.RegionAttachment=e}(pixi_spine||(pixi_spine={})),function(t){var o,e;o=t.core||(t.core={}),e=function(){function t(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return t.prototype.begin=function(t){},t.prototype.transform=function(t,e,i,n){t.x+=o.MathUtils.randomTriangular(-this.jitterX,this.jitterY),t.y+=o.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},t.prototype.end=function(){},t}(),o.JitterEffect=e}(pixi_spine||(pixi_spine={})),function(t){var u,e;u=t.core||(t.core={}),e=function(){function c(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}return c.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},c.prototype.transform=function(t,e,i,n){var o=this.angle*u.MathUtils.degreesToRadians,r=t.x-this.worldX,a=t.y-this.worldY,s=Math.sqrt(r*r+a*a);if(s<this.radius){var h=c.interpolation.apply(0,o,(this.radius-s)/this.radius),l=Math.cos(h),p=Math.sin(h);t.x=l*r-p*a+this.worldX,t.y=p*r+l*a+this.worldY}},c.prototype.end=function(){},c.interpolation=new u.PowOut(2),c}(),u.SwirlEffect=e}(pixi_spine||(pixi_spine={})),function(t){PIXI.spine=t}(pixi_spine||(pixi_spine={})),function(d){var t=function(){function t(){}return t.use=function(i,n){if(!i.data||i.type!==PIXI.LoaderResource.TYPE.JSON||!i.data.bones)return n();var t=i.metadata||{},o=t?i.metadata.spineSkeletonScale:null,e=t?i.metadata.spineAtlas:null;if(!1===e)return n();if(e&&e.pages){var r=new d.core.SkeletonJson(new d.core.AtlasAttachmentLoader(e)).readSkeletonData(i.data);return i.spineData=r,i.spineAtlas=e,n()}var a=t.spineAtlasSuffix||".atlas",s=i.url.substr(0,i.url.lastIndexOf("."))+a;i.metadata&&i.metadata.spineAtlasFile&&(s=i.metadata.spineAtlasFile),s=s.replace(this.baseUrl,"");var h={crossOrigin:i.crossOrigin,xhrType:PIXI.LoaderResource.XHR_RESPONSE_TYPE.TEXT,metadata:t.spineMetadata||null,parentResource:i},l={crossOrigin:i.crossOrigin,metadata:t.imageMetadata||null,parentResource:i},p=i.url.substr(0,i.url.lastIndexOf("/")+1);p=p.replace(this.baseUrl,"");var c=t.images?y(t.images):t.image?y({default:t.image}):t.imageLoader?t.imageLoader(this,i.name+"_atlas_page_",p,l):f(this,i.name+"_atlas_page_",p,l),u=function(t){new d.core.TextureAtlas(t,c,function(t){var e=new d.core.SkeletonJson(new d.core.AtlasAttachmentLoader(t));o&&(e.scale=o),i.spineData=e.readSkeletonData(i.data),i.spineAtlas=t,n()})};i.metadata&&i.metadata.atlasRawData?u(i.metadata.atlasRawData):this.add(i.name+"_atlas",s,h,function(t){u(t.xhr.responseText)})},t}();function f(o,r,a,s){return a&&a.lastIndexOf("/")!==a.length-1&&(a+="/"),function(t,e){var i=r+t,n=a+t;o.add(i,n,s,function(t){e(t.texture.baseTexture)})}}function y(n){return function(t,e){var i=n[t]||n.default;i&&i.baseTexture?e(i.baseTexture):e(i)}}d.AtlasParser=t,d.imageLoaderAdapter=f,d.syncImageLoaderAdapter=function(t,i){return t&&t.lastIndexOf("/")!==t.length-1&&(t+="/"),function(t,e){e(PIXI.BaseTexture.from(t,{resourceOptions:{crossOrigin:i}}))}},d.staticImageLoader=y,PIXI.Loader.registerPlugin(t)}(pixi_spine||(pixi_spine={})),function(){var e;Math.fround||(Math.fround=Math.fround=(e=new Float32Array(1),function(t){return e[0]=t,e[0]}))}(),function(S){S.core.Bone.yDown=!0;var I=[0,0,0],i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.region=null,t}return __extends(t,e),t}(PIXI.Sprite);S.SpineSprite=i;var r=function(r){function t(t,e,i,n,o){return r.call(this,t,e,i,n,o)||this}return __extends(t,r),t}(PIXI.Mesh);S.SpineMesh=r;var t=function(p){function e(t){var e=p.call(this)||this;if(!t)throw new Error("The spineData param is required.");if("string"==typeof t)throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.');e.spineData=t,e.skeleton=new S.core.Skeleton(t),e.skeleton.updateWorldTransform(),e.stateData=new S.core.AnimationStateData(t),e.state=new S.core.AnimationState(e.stateData),e.slotContainers=[],e.tempClipContainers=[];for(var i=0,n=e.skeleton.slots.length;i<n;i++){var o=e.skeleton.slots[i],r=o.attachment,a=e.newContainer();if(e.slotContainers.push(a),e.addChild(a),e.tempClipContainers.push(null),r instanceof S.core.RegionAttachment){var s=r.region.name,h=e.createSprite(o,r,s);o.currentSprite=h,o.currentSpriteName=s,a.addChild(h)}else if(r instanceof S.core.MeshAttachment){var l=e.createMesh(o,r);o.currentMesh=l,o.currentMeshName=r.name,a.addChild(l)}else{if(!(r instanceof S.core.ClippingAttachment))continue;e.createGraphics(o,r),a.addChild(o.clippingContainer),a.addChild(o.currentGraphics)}}return e.autoUpdate=!0,e.tintRgb=new Float32Array([1,1,1]),e}return __extends(e,p),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this.updateTransform===e.prototype.autoUpdateTransform},set:function(t){this.updateTransform=t?e.prototype.autoUpdateTransform:PIXI.Container.prototype.updateTransform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return PIXI.utils.rgb2hex(this.tintRgb)},set:function(t){this.tintRgb=PIXI.utils.hex2rgb(t,this.tintRgb)},enumerable:!0,configurable:!0}),e.prototype.update=function(t){this.state.update(t),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();var e=this.skeleton.slots,i=this.color,n=null,o=null;i?(n=i.light,o=i.dark):n=this.tintRgb;for(var r=0,a=e.length;r<a;r++){var s=(E=e[r]).attachment,h=this.slotContainers[r];if(s){var l=null,p=s.color;if(s instanceof S.core.RegionAttachment){var c=s.region;if(c){E.currentMesh&&(E.currentMesh.visible=!1,E.currentMesh=null,E.currentMeshName=void 0);var u=c;if(!E.currentSpriteName||E.currentSpriteName!==u.name){var d=u.name;if(E.currentSprite&&(E.currentSprite.visible=!1),E.sprites=E.sprites||{},void 0!==E.sprites[d])E.sprites[d].visible=!0;else{var f=this.createSprite(E,s,d);h.addChild(f)}E.currentSprite=E.sprites[d],E.currentSpriteName=d}}if(h.transform){h.transform.setFromMatrix(E.bone.matrix)}else{var y=h.localTransform||new PIXI.Matrix;E.bone.matrix.copyTo(y),h.localTransform=y,h.displayObjectUpdateTransform=T}E.currentSprite.color?l=E.currentSprite.color:(I[0]=n[0]*E.color.r*p.r,I[1]=n[1]*E.color.g*p.g,I[2]=n[2]*E.color.b*p.b,E.currentSprite.tint=PIXI.utils.rgb2hex(I)),E.currentSprite.blendMode=E.blendMode}else if(s instanceof S.core.MeshAttachment){if(E.currentSprite&&(E.currentSprite.visible=!1,E.currentSprite=null,E.currentSpriteName=void 0),!E.currentMeshName||E.currentMeshName!==s.name){var m=s.name;if(E.currentMesh&&(E.currentMesh.visible=!1),E.meshes=E.meshes||{},void 0!==E.meshes[m])E.meshes[m].visible=!0;else{var g=this.createMesh(E,s);h.addChild(g)}E.currentMesh=E.meshes[m],E.currentMeshName=m}if(s.computeWorldVerticesOld(E,E.currentMesh.vertices),E.currentMesh.color)l=E.currentMesh.color;else if("3"!==PIXI.VERSION[0]){var v=E.currentMesh.tintRgb;v[0]=n[0]*E.color.r*p.r,v[1]=n[1]*E.color.g*p.g,v[2]=n[2]*E.color.b*p.b}E.currentMesh.blendMode=E.blendMode}else{if(!(s instanceof S.core.ClippingAttachment)){h.visible=!1;continue}E.currentGraphics||(this.createGraphics(E,s),h.addChild(E.clippingContainer),h.addChild(E.currentGraphics)),this.updateGraphics(E,s)}if(h.visible=!0,l){var b=E.color.r*p.r,_=E.color.g*p.g,w=E.color.b*p.b;l.setLight(n[0]*b+o[0]*(1-b),n[1]*_+o[1]*(1-_),n[2]*w+o[2]*(1-w)),w=E.darkColor?(b=E.darkColor.r,_=E.darkColor.g,E.darkColor.b):_=b=0,l.setDark(n[0]*b+o[0]*(1-b),n[1]*_+o[1]*(1-_),n[2]*w+o[2]*(1-w))}h.alpha=E.color.a}else h.visible=!1}var P=this.skeleton.drawOrder,A=null,x=null;for(r=0,a=P.length;r<a;r++){var E=e[P[r].data.index];h=this.slotContainers[P[r].data.index];if(x||h.parent!==this&&(h.parent.removeChild(h),h.parent=this),E.currentGraphics&&E.attachment)x=E.clippingContainer,A=E.attachment,x.children.length=0,this.children[r]=h,A.endSlot==E.data&&(A.endSlot=null);else if(x){var M=this.tempClipContainers[r];M||((M=this.tempClipContainers[r]=this.newContainer()).visible=!1),this.children[r]=M,h.parent=null,x.addChild(h),A.endSlot==E.data&&(x.renderable=!0,A=x=null)}else this.children[r]=h}},e.prototype.setSpriteRegion=function(t,e,i){e.region=i,e.texture=i.texture,i.size?(e.scale.x=i.size.width/i.originalWidth,e.scale.y=-i.size.height/i.originalHeight):(e.scale.x=t.scaleX*t.width/i.originalWidth,e.scale.y=-t.scaleY*t.height/i.originalHeight)},e.prototype.setMeshRegion=function(t,e,i){e.region=i,e.texture=i.texture,i.texture.updateUvs(),t.updateUVs(i,e.uvs),e.dirty++},e.prototype.autoUpdateTransform=function(){if(e.globalAutoUpdate){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t)}else this.lastTime=0;PIXI.Container.prototype.updateTransform.call(this)},e.prototype.createSprite=function(t,e,i){var n=e.region;t.tempAttachment===e&&(n=t.tempRegion,t.tempAttachment=null,t.tempRegion=null);var o=n.texture,r=this.newSprite(o);return r.rotation=e.rotation*S.core.MathUtils.degRad,r.anchor.x=.5,r.anchor.y=.5,r.position.x=e.x,r.position.y=e.y,r.alpha=e.color.a,r.region=e.region,this.setSpriteRegion(e,r,e.region),t.sprites=t.sprites||{},t.sprites[i]=r},e.prototype.createMesh=function(t,e){var i=e.region;t.tempAttachment===e&&(i=t.tempRegion,t.tempAttachment=null,t.tempRegion=null);var n=this.newMesh(i.texture,new Float32Array(e.regionUVs.length),new Float32Array(e.regionUVs.length),new Uint16Array(e.triangles),PIXI.Mesh.DRAW_MODES.TRIANGLES);return n.alpha=e.color.a,n.region=e.region,this.setMeshRegion(e,n,i),t.meshes=t.meshes||{},t.meshes[e.name]=n},e.prototype.createGraphics=function(t,e){var i=this.newGraphics(),n=new PIXI.Polygon([]);return i.clear(),i.beginFill(16777215,1),i.drawPolygon(n),i.renderable=!1,t.currentGraphics=i,t.clippingContainer=this.newContainer(),t.clippingContainer.mask=t.currentGraphics,i},e.prototype.updateGraphics=function(t,e){var i=t.currentGraphics.graphicsData[0].shape.points,n=e.worldVerticesLength;i.length=n,e.computeWorldVertices(t,0,n,i,0,2),t.currentGraphics.dirty++,t.currentGraphics.clearDirty++},e.prototype.hackTextureBySlotIndex=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);var n=this.skeleton.slots[t];if(!n)return!1;var o=n.attachment,r=o.region;return e&&((r=new S.core.TextureRegion).texture=e,r.size=i),n.currentSprite&&n.currentSprite.region!=r?(this.setSpriteRegion(o,n.currentSprite,r),n.currentSprite.region=r):n.currentMesh&&n.currentMesh.region!=r?this.setMeshRegion(o,n.currentMesh,r):(n.tempRegion=r,n.tempAttachment=o),!0},e.prototype.hackTextureBySlotName=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);var n=this.skeleton.findSlotIndex(t);return-1!=n&&this.hackTextureBySlotIndex(n,e,i)},e.prototype.newContainer=function(){return new PIXI.Container},e.prototype.newSprite=function(t){return new i(t)},e.prototype.newGraphics=function(){return new PIXI.Graphics},e.prototype.newMesh=function(t,e,i,n,o){return new r(t,e,i,n,o)},e.prototype.transformHack=function(){return 1},e.globalAutoUpdate=!0,e.clippingPolygon=[],e}(PIXI.Container);function T(){var t=this.parent.worldTransform,e=this.worldTransform,i=this.localTransform;e.a=i.a*t.a+i.b*t.c,e.b=i.a*t.b+i.b*t.d,e.c=i.c*t.a+i.d*t.c,e.d=i.c*t.b+i.d*t.d,e.tx=i.tx*t.a+i.ty*t.c+t.tx,e.ty=i.tx*t.b+i.ty*t.d+t.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha,this._currentBounds=null}S.Spine=t}(pixi_spine||(pixi_spine={}));